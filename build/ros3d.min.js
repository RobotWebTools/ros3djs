var ROS3D=function(e){"use strict";function t(){}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),i=1;i<arguments.length;i++){var r=arguments[i];if(null!=r)for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t}),Object.assign(t.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners[e];if(void 0!==i){var r=i.indexOf(t);-1!==r&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var i=t.slice(0),r=0,n=i.length;r<n;r++)i[r].call(this,e)}}}});var i,r,n,o,s,a,c,h,l,u=300,p=301,d=302,f=304,m=306,v=307,g=1e3,y=1001,b=1002,x=1003,w=1004,_=1005,M=1006,E=1007,T=1008,S=1009,A=1012,L=1014,R=1015,C=1016,P=1020,N=1022,O=1023,I=1026,D=1027,U=2001,F=2002,k=2003,B=2004,z=2100,G=2101,j=2102,V=2103,H=2300,W=2301,X=2302,q=2400,Y=2401,Z=2402,J=3e3,Q=3007,K={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16).toUpperCase();return function(){var t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]+"-"+e[255&i]+e[i>>8&255]+"-"+e[i>>16&15|64]+e[i>>24&255]+"-"+e[63&r|128]+e[r>>8&255]+"-"+e[r>>16&255]+e[r>>24&255]+e[255&n]+e[n>>8&255]+e[n>>16&255]+e[n>>24&255]}}(),clamp:function(e,t,i){return Math.max(t,Math.min(i,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,i,r,n){return r+(e-t)*(n-r)/(i-t)},lerp:function(e,t,i){return(1-i)*e+i*t},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*K.DEG2RAD},radToDeg:function(e){return e*K.RAD2DEG},isPowerOfTwo:function(e){return 0==(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}};function $(e,t){this.x=e||0,this.y=t||0}function ee(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function te(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==r?r:1}function ie(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0}function re(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties($.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign($.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:(i=new $,r=new $,function(e,t){return i.set(e,e),r.set(t,t),this.clamp(i,r)}),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=this.x-e.x,o=this.y-e.y;return this.x=n*i-o*r+e.x,this.y=n*r+o*i+e.y,this}}),Object.assign(ee.prototype,{isMatrix4:!0,set:function(e,t,i,r,n,o,s,a,c,h,l,u,p,d,f,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=i,v[12]=r,v[1]=n,v[5]=o,v[9]=s,v[13]=a,v[2]=c,v[6]=h,v[10]=l,v[14]=u,v[3]=p,v[7]=d,v[11]=f,v[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new ee).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractBasis:function(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this},extractRotation:(h=new ie,function(e){var t=this.elements,i=e.elements,r=1/h.setFromMatrixColumn(e,0).length(),n=1/h.setFromMatrixColumn(e,1).length(),o=1/h.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[4]=i[4]*n,t[5]=i[5]*n,t[6]=i[6]*n,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,this}),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,i=e.x,r=e.y,n=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(r),c=Math.sin(r),h=Math.cos(n),l=Math.sin(n);if("XYZ"===e.order){var u=o*h,p=o*l,d=s*h,f=s*l;t[0]=a*h,t[4]=-a*l,t[8]=c,t[1]=p+d*c,t[5]=u-f*c,t[9]=-s*a,t[2]=f-u*c,t[6]=d+p*c,t[10]=o*a}else if("YXZ"===e.order){var m=a*h,v=a*l,g=c*h,y=c*l;t[0]=m+y*s,t[4]=g*s-v,t[8]=o*c,t[1]=o*l,t[5]=o*h,t[9]=-s,t[2]=v*s-g,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){m=a*h,v=a*l,g=c*h,y=c*l;t[0]=m-y*s,t[4]=-o*l,t[8]=g+v*s,t[1]=v+g*s,t[5]=o*h,t[9]=y-m*s,t[2]=-o*c,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){u=o*h,p=o*l,d=s*h,f=s*l;t[0]=a*h,t[4]=d*c-p,t[8]=u*c+f,t[1]=a*l,t[5]=f*c+u,t[9]=p*c-d,t[2]=-c,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var b=o*a,x=o*c,w=s*a,_=s*c;t[0]=a*h,t[4]=_-b*l,t[8]=w*l+x,t[1]=l,t[5]=o*h,t[9]=-s*h,t[2]=-c*h,t[6]=x*l+w,t[10]=b-_*l}else if("XZY"===e.order){b=o*a,x=o*c,w=s*a,_=s*c;t[0]=a*h,t[4]=-l,t[8]=c*h,t[1]=b*l+_,t[5]=o*h,t[9]=x*l-w,t[2]=w*l-x,t[6]=s*h,t[10]=_*l+b}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,i=e._x,r=e._y,n=e._z,o=e._w,s=i+i,a=r+r,c=n+n,h=i*s,l=i*a,u=i*c,p=r*a,d=r*c,f=n*c,m=o*s,v=o*a,g=o*c;return t[0]=1-(p+f),t[4]=l-g,t[8]=u+v,t[1]=l+g,t[5]=1-(h+f),t[9]=d-m,t[2]=u-v,t[6]=d+m,t[10]=1-(h+p),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:(s=new ie,a=new ie,c=new ie,function(e,t,i){var r=this.elements;return c.subVectors(e,t),0===c.lengthSq()&&(c.z=1),c.normalize(),s.crossVectors(i,c),0===s.lengthSq()&&(1===Math.abs(i.z)?c.x+=1e-4:c.z+=1e-4,c.normalize(),s.crossVectors(i,c)),s.normalize(),a.crossVectors(c,s),r[0]=s.x,r[4]=a.x,r[8]=c.x,r[1]=s.y,r[5]=a.y,r[9]=c.y,r[2]=s.z,r[6]=a.z,r[10]=c.z,this}),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[4],a=i[8],c=i[12],h=i[1],l=i[5],u=i[9],p=i[13],d=i[2],f=i[6],m=i[10],v=i[14],g=i[3],y=i[7],b=i[11],x=i[15],w=r[0],_=r[4],M=r[8],E=r[12],T=r[1],S=r[5],A=r[9],L=r[13],R=r[2],C=r[6],P=r[10],N=r[14],O=r[3],I=r[7],D=r[11],U=r[15];return n[0]=o*w+s*T+a*R+c*O,n[4]=o*_+s*S+a*C+c*I,n[8]=o*M+s*A+a*P+c*D,n[12]=o*E+s*L+a*N+c*U,n[1]=h*w+l*T+u*R+p*O,n[5]=h*_+l*S+u*C+p*I,n[9]=h*M+l*A+u*P+p*D,n[13]=h*E+l*L+u*N+p*U,n[2]=d*w+f*T+m*R+v*O,n[6]=d*_+f*S+m*C+v*I,n[10]=d*M+f*A+m*P+v*D,n[14]=d*E+f*L+m*N+v*U,n[3]=g*w+y*T+b*R+x*O,n[7]=g*_+y*S+b*C+x*I,n[11]=g*M+y*A+b*P+x*D,n[15]=g*E+y*L+b*N+x*U,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new ie;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix4(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],n=e[12],o=e[1],s=e[5],a=e[9],c=e[13],h=e[2],l=e[6],u=e[10],p=e[14];return e[3]*(+n*a*l-r*c*l-n*s*u+i*c*u+r*s*p-i*a*p)+e[7]*(+t*a*p-t*c*u+n*o*u-r*o*p+r*c*h-n*a*h)+e[11]*(+t*c*l-t*s*p-n*o*l+i*o*p+n*s*h-i*c*h)+e[15]*(-r*s*h-t*a*l+t*s*u+r*o*l-i*o*u+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,r=e.elements,n=r[0],o=r[1],s=r[2],a=r[3],c=r[4],h=r[5],l=r[6],u=r[7],p=r[8],d=r[9],f=r[10],m=r[11],v=r[12],g=r[13],y=r[14],b=r[15],x=d*y*u-g*f*u+g*l*m-h*y*m-d*l*b+h*f*b,w=v*f*u-p*y*u-v*l*m+c*y*m+p*l*b-c*f*b,_=p*g*u-v*d*u+v*h*m-c*g*m-p*h*b+c*d*b,M=v*d*l-p*g*l-v*h*f+c*g*f+p*h*y-c*d*y,E=n*x+o*w+s*_+a*M;if(0===E){var T="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(T);return console.warn(T),this.identity()}var S=1/E;return i[0]=x*S,i[1]=(g*f*a-d*y*a-g*s*m+o*y*m+d*s*b-o*f*b)*S,i[2]=(h*y*a-g*l*a+g*s*u-o*y*u-h*s*b+o*l*b)*S,i[3]=(d*l*a-h*f*a-d*s*u+o*f*u+h*s*m-o*l*m)*S,i[4]=w*S,i[5]=(p*y*a-v*f*a+v*s*m-n*y*m-p*s*b+n*f*b)*S,i[6]=(v*l*a-c*y*a-v*s*u+n*y*u+c*s*b-n*l*b)*S,i[7]=(c*f*a-p*l*a+p*s*u-n*f*u-c*s*m+n*l*m)*S,i[8]=_*S,i[9]=(v*d*a-p*g*a-v*o*m+n*g*m+p*o*b-n*d*b)*S,i[10]=(c*g*a-v*h*a+v*o*u-n*g*u-c*o*b+n*h*b)*S,i[11]=(p*h*a-c*d*a-p*o*u+n*d*u+c*o*m-n*h*m)*S,i[12]=M*S,i[13]=(p*g*s-v*d*s+v*o*f-n*g*f-p*o*y+n*d*y)*S,i[14]=(v*h*s-c*g*s-v*o*l+n*g*l+c*o*y-n*h*y)*S,i[15]=(c*d*s-p*h*s+p*o*l-n*d*l-c*o*f+n*h*f)*S,this},scale:function(e){var t=this.elements,i=e.x,r=e.y,n=e.z;return t[0]*=i,t[4]*=r,t[8]*=n,t[1]*=i,t[5]*=r,t[9]*=n,t[2]*=i,t[6]*=r,t[10]*=n,t[3]*=i,t[7]*=r,t[11]*=n,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),n=1-i,o=e.x,s=e.y,a=e.z,c=n*o,h=n*s;return this.set(c*o+i,c*s-r*a,c*a+r*s,0,c*s+r*a,h*s+i,h*a-r*o,0,c*a-r*s,h*a+r*o,n*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},makeShear:function(e,t,i){return this.set(1,t,i,0,e,1,i,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:(n=new ie,o=new ee,function(e,t,i){var r=this.elements,s=n.set(r[0],r[1],r[2]).length(),a=n.set(r[4],r[5],r[6]).length(),c=n.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],o.copy(this);var h=1/s,l=1/a,u=1/c;return o.elements[0]*=h,o.elements[1]*=h,o.elements[2]*=h,o.elements[4]*=l,o.elements[5]*=l,o.elements[6]*=l,o.elements[8]*=u,o.elements[9]*=u,o.elements[10]*=u,t.setFromRotationMatrix(o),i.x=s,i.y=a,i.z=c,this}),makePerspective:function(e,t,i,r,n,o){void 0===o&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var s=this.elements,a=2*n/(t-e),c=2*n/(i-r),h=(t+e)/(t-e),l=(i+r)/(i-r),u=-(o+n)/(o-n),p=-2*o*n/(o-n);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=c,s[9]=l,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=p,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makeOrthographic:function(e,t,i,r,n,o){var s=this.elements,a=1/(t-e),c=1/(i-r),h=1/(o-n),l=(t+e)*a,u=(i+r)*c,p=(o+n)*h;return s[0]=2*a,s[4]=0,s[8]=0,s[12]=-l,s[1]=0,s[5]=2*c,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2*h,s[14]=-p,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<16;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}),Object.assign(te,{slerp:function(e,t,i,r){return i.copy(e).slerp(t,r)},slerpFlat:function(e,t,i,r,n,o,s){var a=i[r+0],c=i[r+1],h=i[r+2],l=i[r+3],u=n[o+0],p=n[o+1],d=n[o+2],f=n[o+3];if(l!==f||a!==u||c!==p||h!==d){var m=1-s,v=a*u+c*p+h*d+l*f,g=v>=0?1:-1,y=1-v*v;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,v*g);m=Math.sin(m*x)/b,s=Math.sin(s*x)/b}var w=s*g;if(a=a*m+u*w,c=c*m+p*w,h=h*m+d*w,l=l*m+f*w,m===1-s){var _=1/Math.sqrt(a*a+c*c+h*h+l*l);a*=_,c*=_,h*=_,l*=_}}e[t]=a,e[t+1]=c,e[t+2]=h,e[t+3]=l}}),Object.defineProperties(te.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(te.prototype,{set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var i=e._x,r=e._y,n=e._z,o=e.order,s=Math.cos,a=Math.sin,c=s(i/2),h=s(r/2),l=s(n/2),u=a(i/2),p=a(r/2),d=a(n/2);return"XYZ"===o?(this._x=u*h*l+c*p*d,this._y=c*p*l-u*h*d,this._z=c*h*d+u*p*l,this._w=c*h*l-u*p*d):"YXZ"===o?(this._x=u*h*l+c*p*d,this._y=c*p*l-u*h*d,this._z=c*h*d-u*p*l,this._w=c*h*l+u*p*d):"ZXY"===o?(this._x=u*h*l-c*p*d,this._y=c*p*l+u*h*d,this._z=c*h*d+u*p*l,this._w=c*h*l-u*p*d):"ZYX"===o?(this._x=u*h*l-c*p*d,this._y=c*p*l+u*h*d,this._z=c*h*d-u*p*l,this._w=c*h*l+u*p*d):"YZX"===o?(this._x=u*h*l+c*p*d,this._y=c*p*l+u*h*d,this._z=c*h*d-u*p*l,this._w=c*h*l-u*p*d):"XZY"===o&&(this._x=u*h*l-c*p*d,this._y=c*p*l-u*h*d,this._z=c*h*d+u*p*l,this._w=c*h*l+u*p*d),!1!==t&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,i=e.elements,r=i[0],n=i[4],o=i[8],s=i[1],a=i[5],c=i[9],h=i[2],l=i[6],u=i[10],p=r+a+u;return p>0?(t=.5/Math.sqrt(p+1),this._w=.25/t,this._x=(l-c)*t,this._y=(o-h)*t,this._z=(s-n)*t):r>a&&r>u?(t=2*Math.sqrt(1+r-a-u),this._w=(l-c)/t,this._x=.25*t,this._y=(n+s)/t,this._z=(o+h)/t):a>u?(t=2*Math.sqrt(1+a-r-u),this._w=(o-h)/t,this._x=(n+s)/t,this._y=.25*t,this._z=(c+l)/t):(t=2*Math.sqrt(1+u-r-a),this._w=(s-n)/t,this._x=(o+h)/t,this._y=(c+l)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new ie;return function(i,r){return void 0===t&&(t=new ie),(e=i.dot(r)+1)<1e-6?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var i=e._x,r=e._y,n=e._z,o=e._w,s=t._x,a=t._y,c=t._z,h=t._w;return this._x=i*h+o*s+r*c-n*a,this._y=r*h+o*a+n*s-i*c,this._z=n*h+o*c+i*a-r*s,this._w=o*h-i*s-r*a-n*c,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var i=this._x,r=this._y,n=this._z,o=this._w,s=o*e._w+i*e._x+r*e._y+n*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=r,this._z=n,this;var a=Math.sqrt(1-s*s);if(Math.abs(a)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(r+this._y),this._z=.5*(n+this._z),this;var c=Math.atan2(a,s),h=Math.sin((1-t)*c)/a,l=Math.sin(t*c)/a;return this._w=o*h+this._w*l,this._x=i*h+this._x*l,this._y=r*h+this._y*l,this._z=n*h+this._z*l,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(ie.prototype,{isVector3:!0,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:(l=new te,function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(l.setFromEuler(e))}),applyAxisAngle:function(){var e=new te;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i))}}(),applyMatrix3:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6]*r,this.y=n[1]*t+n[4]*i+n[7]*r,this.z=n[2]*t+n[5]*i+n[8]*r,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements,o=1/(n[3]*t+n[7]*i+n[11]*r+n[15]);return this.x=(n[0]*t+n[4]*i+n[8]*r+n[12])*o,this.y=(n[1]*t+n[5]*i+n[9]*r+n[13])*o,this.z=(n[2]*t+n[6]*i+n[10]*r+n[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,r=this.z,n=e.x,o=e.y,s=e.z,a=e.w,c=a*t+o*r-s*i,h=a*i+s*t-n*r,l=a*r+n*i-o*t,u=-n*t-o*i-s*r;return this.x=c*a+u*-n+h*-s-l*-o,this.y=h*a+u*-o+l*-n-c*-s,this.z=l*a+u*-s+c*-o-h*-n,this},project:function(){var e=new ee;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new ee;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,i=this.y,r=this.z,n=e.elements;return this.x=n[0]*t+n[4]*i+n[8]*r,this.y=n[1]*t+n[5]*i+n[9]*r,this.z=n[2]*t+n[6]*i+n[10]*r,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new ie,t=new ie;return function(i,r){return e.set(i,i,i),t.set(r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},cross:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var i=e.x,r=e.y,n=e.z,o=t.x,s=t.y,a=t.z;return this.x=r*a-n*s,this.y=n*o-i*a,this.z=i*s-r*o,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new ie;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new ie;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(K.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(re.prototype,{isMatrix3:!0,set:function(e,t,i,r,n,o,s,a,c){var h=this.elements;return h[0]=e,h[1]=r,h[2]=s,h[3]=t,h[4]=n,h[5]=a,h[6]=i,h[7]=o,h[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new ie;return function(t){for(var i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.applyMatrix3(this),t.setXYZ(i,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var i=e.elements,r=t.elements,n=this.elements,o=i[0],s=i[3],a=i[6],c=i[1],h=i[4],l=i[7],u=i[2],p=i[5],d=i[8],f=r[0],m=r[3],v=r[6],g=r[1],y=r[4],b=r[7],x=r[2],w=r[5],_=r[8];return n[0]=o*f+s*g+a*x,n[3]=o*m+s*y+a*w,n[6]=o*v+s*b+a*_,n[1]=c*f+h*g+l*x,n[4]=c*m+h*y+l*w,n[7]=c*v+h*b+l*_,n[2]=u*f+p*g+d*x,n[5]=u*m+p*y+d*w,n[8]=u*v+p*b+d*_,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],r=e[2],n=e[3],o=e[4],s=e[5],a=e[6],c=e[7],h=e[8];return t*o*h-t*s*c-i*n*h+i*s*a+r*n*c-r*o*a},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var i=e.elements,r=this.elements,n=i[0],o=i[1],s=i[2],a=i[3],c=i[4],h=i[5],l=i[6],u=i[7],p=i[8],d=p*c-h*u,f=h*l-p*a,m=u*a-c*l,v=n*d+o*f+s*m;if(0===v){var g="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===t)throw new Error(g);return console.warn(g),this.identity()}var y=1/v;return r[0]=d*y,r[1]=(s*u-p*o)*y,r[2]=(h*o-s*c)*y,r[3]=f*y,r[4]=(p*n-s*l)*y,r[5]=(s*a-h*n)*y,r[6]=m*y,r[7]=(o*l-u*n)*y,r[8]=(c*n-o*a)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,i,r,n,o,s){var a=Math.cos(n),c=Math.sin(n);this.set(i*a,i*c,-i*(a*o+c*s)+o+e,-r*c,r*a,-r*(-c*o+a*s)+s+t,0,0,1)},scale:function(e,t){var i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this},rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=this.elements,n=r[0],o=r[3],s=r[6],a=r[1],c=r[4],h=r[7];return r[0]=t*n+i*a,r[3]=t*o+i*c,r[6]=t*s+i*h,r[1]=-i*n+t*a,r[4]=-i*o+t*c,r[7]=-i*s+t*h,this},translate:function(e,t){var i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this},equals:function(e){for(var t=this.elements,i=e.elements,r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var i=0;i<9;i++)this.elements[i]=e[i+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}});var ne=0;function oe(e,t,i,r,n,o,s,a,c,h){Object.defineProperty(this,"id",{value:ne++}),this.uuid=K.generateUUID(),this.name="",this.image=void 0!==e?e:oe.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:oe.DEFAULT_MAPPING,this.wrapS=void 0!==i?i:y,this.wrapT=void 0!==r?r:y,this.magFilter=void 0!==n?n:M,this.minFilter=void 0!==o?o:T,this.anisotropy=void 0!==c?c:1,this.format=void 0!==s?s:O,this.type=void 0!==a?a:S,this.offset=new $(0,0),this.repeat=new $(1,1),this.center=new $(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new re,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:J,this.version=0,this.onUpdate=null}function se(e,t,i,r){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==r?r:1}function ae(e,t,i){this.uuid=K.generateUUID(),this.width=e,this.height=t,this.scissor=new se(0,0,e,t),this.scissorTest=!1,this.viewport=new se(0,0,e,t),void 0===(i=i||{}).minFilter&&(i.minFilter=M),this.texture=new oe(void 0,void 0,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0===i.stencilBuffer||i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}function ce(e,t,i){ae.call(this,e,t,i),this.activeCubeFace=0,this.activeMipMapLevel=0}function he(e,t,i,r,n,o,s,a,c,h,l,u){oe.call(this,null,o,s,a,c,h,r,n,l,u),this.image={data:e,width:t,height:i},this.magFilter=void 0!==c?c:x,this.minFilter=void 0!==h?h:x,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function le(e,t,i,r,n,o,s,a,c,h){e=void 0!==e?e:[],t=void 0!==t?t:p,oe.call(this,e,t,i,r,n,o,s,a,c,h),this.flipY=!1}oe.DEFAULT_IMAGE=void 0,oe.DEFAULT_MAPPING=u,oe.prototype=Object.assign(Object.create(t.prototype),{constructor:oe,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var r=this.image;void 0===r.uuid&&(r.uuid=K.generateUUID()),t||void 0!==e.images[r.uuid]||(e.images[r.uuid]={uuid:r.uuid,url:function(e){var t;if(e instanceof HTMLCanvasElement)t=e;else{(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")).width=e.width,t.height=e.height;var i=t.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height)}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}(r)}),i.image=r.uuid}return t||(e.textures[this.uuid]=i),i},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===u){if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case g:e.x=e.x-Math.floor(e.x);break;case y:e.x=e.x<0?0:1;break;case b:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case g:e.y=e.y-Math.floor(e.y);break;case y:e.y=e.y<0?0:1;break;case b:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.defineProperty(oe.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(se.prototype,{isVector4:!0,set:function(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,r=this.z,n=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*n,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*n,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*n,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*n,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,r,n,o=.01,s=.1,a=e.elements,c=a[0],h=a[4],l=a[8],u=a[1],p=a[5],d=a[9],f=a[2],m=a[6],v=a[10];if(Math.abs(h-u)<o&&Math.abs(l-f)<o&&Math.abs(d-m)<o){if(Math.abs(h+u)<s&&Math.abs(l+f)<s&&Math.abs(d+m)<s&&Math.abs(c+p+v-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var g=(c+1)/2,y=(p+1)/2,b=(v+1)/2,x=(h+u)/4,w=(l+f)/4,_=(d+m)/4;return g>y&&g>b?g<o?(i=0,r=.707106781,n=.707106781):(r=x/(i=Math.sqrt(g)),n=w/i):y>b?y<o?(i=.707106781,r=0,n=.707106781):(i=x/(r=Math.sqrt(y)),n=_/r):b<o?(i=.707106781,r=.707106781,n=0):(i=w/(n=Math.sqrt(b)),r=_/n),this.set(i,r,n,t),this}var M=Math.sqrt((m-d)*(m-d)+(l-f)*(l-f)+(u-h)*(u-h));return Math.abs(M)<.001&&(M=1),this.x=(m-d)/M,this.y=(l-f)/M,this.z=(u-h)/M,this.w=Math.acos((c+p+v-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(i,r){return void 0===e&&(e=new se,t=new se),e.set(i,i,i,i),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,i){return this.subVectors(t,e).multiplyScalar(i).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),ae.prototype=Object.assign(Object.create(t.prototype),{constructor:ae,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ce.prototype=Object.create(ae.prototype),ce.prototype.constructor=ce,ce.prototype.isWebGLRenderTargetCube=!0,he.prototype=Object.create(oe.prototype),he.prototype.constructor=he,he.prototype.isDataTexture=!0,le.prototype=Object.create(oe.prototype),le.prototype.constructor=le,le.prototype.isCubeTexture=!0,Object.defineProperty(le.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var ue=new oe,pe=new le;function de(){this.seq=[],this.map={}}var fe=[],me=[],ve=new Float32Array(16),ge=new Float32Array(9);function ye(e,t,i){var r=e[0];if(r<=0||r>0)return e;var n=t*i,o=fe[n];if(void 0===o&&(o=new Float32Array(n),fe[n]=o),0!==t){r.toArray(o,0);for(var s=1,a=0;s!==t;++s)a+=i,e[s].toArray(o,a)}return o}function be(e,t){var i=me[t];void 0===i&&(i=new Int32Array(t),me[t]=i);for(var r=0;r!==t;++r)i[r]=e.allocTextureUnit();return i}function xe(e,t){e.uniform1f(this.addr,t)}function we(e,t){e.uniform1i(this.addr,t)}function _e(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function Me(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function Ee(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function Te(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function Se(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(ge.set(t.elements),e.uniformMatrix3fv(this.addr,!1,ge))}function Ae(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(ve.set(t.elements),e.uniformMatrix4fv(this.addr,!1,ve))}function Le(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),i.setTexture2D(t||ue,r)}function Re(e,t,i){var r=i.allocTextureUnit();e.uniform1i(this.addr,r),i.setTextureCube(t||pe,r)}function Ce(e,t){e.uniform2iv(this.addr,t)}function Pe(e,t){e.uniform3iv(this.addr,t)}function Ne(e,t){e.uniform4iv(this.addr,t)}function Oe(e,t){e.uniform1fv(this.addr,t)}function Ie(e,t){e.uniform1iv(this.addr,t)}function De(e,t){e.uniform2fv(this.addr,ye(t,this.size,2))}function Ue(e,t){e.uniform3fv(this.addr,ye(t,this.size,3))}function Fe(e,t){e.uniform4fv(this.addr,ye(t,this.size,4))}function ke(e,t){e.uniformMatrix2fv(this.addr,!1,ye(t,this.size,4))}function Be(e,t){e.uniformMatrix3fv(this.addr,!1,ye(t,this.size,9))}function ze(e,t){e.uniformMatrix4fv(this.addr,!1,ye(t,this.size,16))}function Ge(e,t,i){var r=t.length,n=be(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.setTexture2D(t[o]||ue,n[o])}function je(e,t,i){var r=t.length,n=be(i,r);e.uniform1iv(this.addr,n);for(var o=0;o!==r;++o)i.setTextureCube(t[o]||pe,n[o])}function Ve(e,t,i){this.id=e,this.addr=i,this.setValue=function(e){switch(e){case 5126:return xe;case 35664:return _e;case 35665:return Me;case 35666:return Ee;case 35674:return Te;case 35675:return Se;case 35676:return Ae;case 35678:case 36198:return Le;case 35680:return Re;case 5124:case 35670:return we;case 35667:case 35671:return Ce;case 35668:case 35672:return Pe;case 35669:case 35673:return Ne}}(t.type)}function He(e,t,i){this.id=e,this.addr=i,this.size=t.size,this.setValue=function(e){switch(e){case 5126:return Oe;case 35664:return De;case 35665:return Ue;case 35666:return Fe;case 35674:return ke;case 35675:return Be;case 35676:return ze;case 35678:return Ge;case 35680:return je;case 5124:case 35670:return Ie;case 35667:case 35671:return Ce;case 35668:case 35672:return Pe;case 35669:case 35673:return Ne}}(t.type)}function We(e){this.id=e,de.call(this)}We.prototype.setValue=function(e,t){for(var i=this.seq,r=0,n=i.length;r!==n;++r){var o=i[r];o.setValue(e,t[o.id])}};var Xe=/([\w\d_]+)(\])?(\[|\.)?/g;function qe(e,t){e.seq.push(t),e.map[t.id]=t}function Ye(e,t,i){var r=e.name,n=r.length;for(Xe.lastIndex=0;;){var o=Xe.exec(r),s=Xe.lastIndex,a=o[1],c="]"===o[2],h=o[3];if(c&&(a|=0),void 0===h||"["===h&&s+2===n){qe(i,void 0===h?new Ve(a,e,t):new He(a,e,t));break}var l=i.map[a];void 0===l&&qe(i,l=new We(a)),i=l}}function Ze(e,t,i){de.call(this),this.renderer=i;for(var r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),n=0;n<r;++n){var o=e.getActiveUniform(t,n),s=o.name;Ye(o,e.getUniformLocation(t,s),this)}}Ze.prototype.setValue=function(e,t,i){var r=this.map[t];void 0!==r&&r.setValue(e,i,this.renderer)},Ze.prototype.setOptional=function(e,t,i){var r=t[i];void 0!==r&&this.setValue(e,i,r)},Ze.upload=function(e,t,i,r){for(var n=0,o=t.length;n!==o;++n){var s=t[n],a=i[s.id];!1!==a.needsUpdate&&s.setValue(e,a.value,r)}},Ze.seqWithValue=function(e,t){for(var i=[],r=0,n=e.length;r!==n;++r){var o=e[r];o.id in t&&i.push(o)}return i};var Je={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Qe(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}Object.assign(Qe.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(){function e(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}return function(t,i,r){if(t=K.euclideanModulo(t,1),i=K.clamp(i,0,1),r=K.clamp(r,0,1),0===i)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+i):r+i-r*i,o=2*r-n;this.r=e(o,n,t+1/3),this.g=e(o,n,t),this.b=e(o,n,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var i;if(i=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var r,n=i[1],o=i[2];switch(n){case"rgb":case"rgba":if(r=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[5]),this;if(r=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[5]),this;break;case"hsl":case"hsla":if(r=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){var s=parseFloat(r[1])/360,a=parseInt(r[2],10)/100,c=parseInt(r[3],10)/100;return t(r[5]),this.setHSL(s,a,c)}}}else if(i=/^\#([A-Fa-f0-9]+)$/.exec(e)){var h,l=(h=i[1]).length;if(3===l)return this.r=parseInt(h.charAt(0)+h.charAt(0),16)/255,this.g=parseInt(h.charAt(1)+h.charAt(1),16)/255,this.b=parseInt(h.charAt(2)+h.charAt(2),16)/255,this;if(6===l)return this.r=parseInt(h.charAt(0)+h.charAt(1),16)/255,this.g=parseInt(h.charAt(2)+h.charAt(3),16)/255,this.b=parseInt(h.charAt(4)+h.charAt(5),16)/255,this}e&&e.length>0&&(void 0!==(h=Je[e])?this.setHex(h):console.warn("THREE.Color: Unknown color "+e));return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,r=e||{h:0,s:0,l:0},n=this.r,o=this.g,s=this.b,a=Math.max(n,o,s),c=Math.min(n,o,s),h=(c+a)/2;if(c===a)t=0,i=0;else{var l=a-c;switch(i=h<=.5?l/(a+c):l/(2-a-c),a){case n:t=(o-s)/l+(o<s?6:0);break;case o:t=(s-n)/l+2;break;case s:t=(n-o)/l+4}t/=6}return r.h=t,r.s=i,r.l=h,r},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,i){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=i,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var Ke={common:{diffuse:{value:new Qe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new re},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new $(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Qe(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Qe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new re}}},$e={merge:function(e){for(var t={},i=0;i<e.length;i++){var r=this.clone(e[i]);for(var n in r)t[n]=r[n]}return t},clone:function(e){var t={};for(var i in e)for(var r in t[i]={},e[i]){var n=e[i][r];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?t[i][r]=n.clone():Array.isArray(n)?t[i][r]=n.slice():t[i][r]=n}return t}},et={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"\nvec3 transformed = vec3( position );\n",beginnormal_vertex:"\nvec3 objectNormal = vec3( normal );\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",envmap_fragment:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\treflectVec = normalize( reflectVec );\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",envmap_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",fog_vertex:"\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gradientmap_pars_fragment:"#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",lights_pars:"uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t\tfloat shadowCameraNear;\n\t\tfloat shadowCameraFar;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",lights_template:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\tgl_Position.z *= gl_Position.w;\n\t#endif\n#endif\n",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",map_particle_fragment:"#ifdef USE_MAP\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",map_particle_pars_fragment:"#ifdef USE_MAP\n\tuniform mat3 uvTransform;\n\tuniform sampler2D map;\n#endif\n",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",normal_fragment:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",dithering_fragment:"#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",dithering_pars_fragment:"#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",tonemapping_pars_fragment:"#ifndef saturate\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",cube_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}\n",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}\n",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}\n",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",equirect_vert:"varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",meshphysical_frag:"#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",meshphysical_vert:"#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <fog_fragment>\n}\n",shadow_vert:"#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n"},tt={basic:{uniforms:$e.merge([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.fog]),vertexShader:et.meshbasic_vert,fragmentShader:et.meshbasic_frag},lambert:{uniforms:$e.merge([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.fog,Ke.lights,{emissive:{value:new Qe(0)}}]),vertexShader:et.meshlambert_vert,fragmentShader:et.meshlambert_frag},phong:{uniforms:$e.merge([Ke.common,Ke.specularmap,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.gradientmap,Ke.fog,Ke.lights,{emissive:{value:new Qe(0)},specular:{value:new Qe(1118481)},shininess:{value:30}}]),vertexShader:et.meshphong_vert,fragmentShader:et.meshphong_frag},standard:{uniforms:$e.merge([Ke.common,Ke.envmap,Ke.aomap,Ke.lightmap,Ke.emissivemap,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,Ke.roughnessmap,Ke.metalnessmap,Ke.fog,Ke.lights,{emissive:{value:new Qe(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:et.meshphysical_vert,fragmentShader:et.meshphysical_frag},points:{uniforms:$e.merge([Ke.points,Ke.fog]),vertexShader:et.points_vert,fragmentShader:et.points_frag},dashed:{uniforms:$e.merge([Ke.common,Ke.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:et.linedashed_vert,fragmentShader:et.linedashed_frag},depth:{uniforms:$e.merge([Ke.common,Ke.displacementmap]),vertexShader:et.depth_vert,fragmentShader:et.depth_frag},normal:{uniforms:$e.merge([Ke.common,Ke.bumpmap,Ke.normalmap,Ke.displacementmap,{opacity:{value:1}}]),vertexShader:et.normal_vert,fragmentShader:et.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:et.cube_vert,fragmentShader:et.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:et.equirect_vert,fragmentShader:et.equirect_frag},distanceRGBA:{uniforms:$e.merge([Ke.common,Ke.displacementmap,{referencePosition:{value:new ie},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:et.distanceRGBA_vert,fragmentShader:et.distanceRGBA_frag},shadow:{uniforms:$e.merge([Ke.lights,Ke.fog,{color:{value:new Qe(0)},opacity:{value:1}}]),vertexShader:et.shadow_vert,fragmentShader:et.shadow_frag}};function it(e,t){this.min=void 0!==e?e:new $(1/0,1/0),this.max=void 0!==t?t:new $(-1/0,-1/0)}function rt(e,t,i,r,n){var o,s,a,c,h,l,u,p;function d(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),r=new Uint16Array([0,1,2,0,2,3]);o=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r,t.STATIC_DRAW),u=t.createTexture(),p=t.createTexture(),i.bindTexture(t.TEXTURE_2D,u),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),i.bindTexture(t.TEXTURE_2D,p),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),a={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tvUV = uv;","\tvec2 pos = position;","\tif ( renderType == 2 ) {","\t\tvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","\t\tvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","\t\tvVisibility =        visibility.r / 9.0;","\t\tvVisibility *= 1.0 - visibility.g / 9.0;","\t\tvVisibility *=       visibility.b / 9.0;","\t\tvVisibility *= 1.0 - visibility.a / 9.0;","\t\tpos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","\t\tpos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","\t}","\tgl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","\tif ( renderType == 0 ) {","\t\tgl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","\t} else if ( renderType == 1 ) {","\t\tgl_FragColor = texture2D( map, vUV );","\t} else {","\t\tvec4 texture = texture2D( map, vUV );","\t\ttexture.a *= opacity * vVisibility;","\t\tgl_FragColor = texture;","\t\tgl_FragColor.rgb *= color;","\t}","}"].join("\n")},c=function(e){var i=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),s="precision "+n.precision+" float;\n";return t.shaderSource(r,s+e.fragmentShader),t.shaderSource(o,s+e.vertexShader),t.compileShader(r),t.compileShader(o),t.attachShader(i,r),t.attachShader(i,o),t.linkProgram(i),i}(a),h={vertex:t.getAttribLocation(c,"position"),uv:t.getAttribLocation(c,"uv")},l={renderType:t.getUniformLocation(c,"renderType"),map:t.getUniformLocation(c,"map"),occlusionMap:t.getUniformLocation(c,"occlusionMap"),opacity:t.getUniformLocation(c,"opacity"),color:t.getUniformLocation(c,"color"),scale:t.getUniformLocation(c,"scale"),rotation:t.getUniformLocation(c,"rotation"),screenPosition:t.getUniformLocation(c,"screenPosition")}}this.render=function(e,n,a,f){if(0!==e.length){var m=new ie,v=f.w/f.z,g=.5*f.z,y=.5*f.w,b=16/f.w,x=new $(b*v,b),w=new ie(1,1,0),_=new $(1,1),M=new it;M.min.set(f.x,f.y),M.max.set(f.x+(f.z-16),f.y+(f.w-16)),void 0===c&&d(),i.useProgram(c),i.initAttributes(),i.enableAttribute(h.vertex),i.enableAttribute(h.uv),i.disableUnusedAttributes(),t.uniform1i(l.occlusionMap,0),t.uniform1i(l.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(h.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(h.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),i.disable(t.CULL_FACE),i.buffers.depth.setMask(!1);for(var E=0,T=e.length;E<T;E++){b=16/f.w,x.set(b*v,b);var S=e[E];if(m.set(S.matrixWorld.elements[12],S.matrixWorld.elements[13],S.matrixWorld.elements[14]),m.applyMatrix4(a.matrixWorldInverse),m.applyMatrix4(a.projectionMatrix),w.copy(m),_.x=f.x+w.x*g+g-8,_.y=f.y+w.y*y+y-8,!0===M.containsPoint(_)){i.activeTexture(t.TEXTURE0),i.bindTexture(t.TEXTURE_2D,null),i.activeTexture(t.TEXTURE1),i.bindTexture(t.TEXTURE_2D,u),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,_.x,_.y,16,16,0),t.uniform1i(l.renderType,0),t.uniform2f(l.scale,x.x,x.y),t.uniform3f(l.screenPosition,w.x,w.y,w.z),i.disable(t.BLEND),i.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),i.activeTexture(t.TEXTURE0),i.bindTexture(t.TEXTURE_2D,p),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,_.x,_.y,16,16,0),t.uniform1i(l.renderType,1),i.disable(t.DEPTH_TEST),i.activeTexture(t.TEXTURE1),i.bindTexture(t.TEXTURE_2D,u),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),S.positionScreen.copy(w),S.customUpdateCallback?S.customUpdateCallback(S):S.updateLensFlares(),t.uniform1i(l.renderType,2),i.enable(t.BLEND);for(var A=0,L=S.lensFlares.length;A<L;A++){var R=S.lensFlares[A];R.opacity>.001&&R.scale>.001&&(w.x=R.x,w.y=R.y,w.z=R.z,b=R.size*R.scale/f.w,x.x=b*v,x.y=b,t.uniform3f(l.screenPosition,w.x,w.y,w.z),t.uniform2f(l.scale,x.x,x.y),t.uniform1f(l.rotation,R.rotation),t.uniform1f(l.opacity,R.opacity),t.uniform3f(l.color,R.color.r,R.color.g,R.color.b),i.setBlending(R.blending,R.blendEquation,R.blendSrc,R.blendDst),r.setTexture2D(R.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0))}}}i.enable(t.CULL_FACE),i.enable(t.DEPTH_TEST),i.buffers.depth.setMask(!0),i.reset()}}}function nt(e,t,i,r,n,o,s,a,c){oe.call(this,e,t,i,r,n,o,s,a,c),this.needsUpdate=!0}function ot(e,t,i,r,n){var o,s,a,c,h,l,u=new ie,p=new te,d=new ie;function f(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),i=new Uint16Array([0,1,2,0,2,3]);o=t.createBuffer(),s=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.bufferData(t.ELEMENT_ARRAY_BUFFER,i,t.STATIC_DRAW),a=function(){var e=t.createProgram(),i=t.createShader(t.VERTEX_SHADER),r=t.createShader(t.FRAGMENT_SHADER);return t.shaderSource(i,["precision "+n.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = position * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n")),t.shaderSource(r,["precision "+n.precision+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n")),t.compileShader(i),t.compileShader(r),t.attachShader(e,i),t.attachShader(e,r),t.linkProgram(e),e}(),c={position:t.getAttribLocation(a,"position"),uv:t.getAttribLocation(a,"uv")},h={uvOffset:t.getUniformLocation(a,"uvOffset"),uvScale:t.getUniformLocation(a,"uvScale"),rotation:t.getUniformLocation(a,"rotation"),scale:t.getUniformLocation(a,"scale"),color:t.getUniformLocation(a,"color"),map:t.getUniformLocation(a,"map"),opacity:t.getUniformLocation(a,"opacity"),modelViewMatrix:t.getUniformLocation(a,"modelViewMatrix"),projectionMatrix:t.getUniformLocation(a,"projectionMatrix"),fogType:t.getUniformLocation(a,"fogType"),fogDensity:t.getUniformLocation(a,"fogDensity"),fogNear:t.getUniformLocation(a,"fogNear"),fogFar:t.getUniformLocation(a,"fogFar"),fogColor:t.getUniformLocation(a,"fogColor"),fogDepth:t.getUniformLocation(a,"fogDepth"),alphaTest:t.getUniformLocation(a,"alphaTest")};var r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");r.width=8,r.height=8;var u=r.getContext("2d");u.fillStyle="white",u.fillRect(0,0,8,8),l=new nt(r)}function m(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}this.render=function(n,v,g){if(0!==n.length){void 0===a&&f(),i.useProgram(a),i.initAttributes(),i.enableAttribute(c.position),i.enableAttribute(c.uv),i.disableUnusedAttributes(),i.disable(t.CULL_FACE),i.enable(t.BLEND),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(c.position,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(c.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),t.uniformMatrix4fv(h.projectionMatrix,!1,g.projectionMatrix.elements),i.activeTexture(t.TEXTURE0),t.uniform1i(h.map,0);var y=0,b=0,x=v.fog;x?(t.uniform3f(h.fogColor,x.color.r,x.color.g,x.color.b),x.isFog?(t.uniform1f(h.fogNear,x.near),t.uniform1f(h.fogFar,x.far),t.uniform1i(h.fogType,1),y=1,b=1):x.isFogExp2&&(t.uniform1f(h.fogDensity,x.density),t.uniform1i(h.fogType,2),y=2,b=2)):(t.uniform1i(h.fogType,0),y=0,b=0);for(var w=0,_=n.length;w<_;w++){(E=n[w]).modelViewMatrix.multiplyMatrices(g.matrixWorldInverse,E.matrixWorld),E.z=-E.modelViewMatrix.elements[14]}n.sort(m);var M=[];for(w=0,_=n.length;w<_;w++){var E,T=(E=n[w]).material;if(!1!==T.visible){E.onBeforeRender(e,v,g,void 0,T,void 0),t.uniform1f(h.alphaTest,T.alphaTest),t.uniformMatrix4fv(h.modelViewMatrix,!1,E.modelViewMatrix.elements),E.matrixWorld.decompose(u,p,d),M[0]=d.x,M[1]=d.y;var S=0;v.fog&&T.fog&&(S=b),y!==S&&(t.uniform1i(h.fogType,S),y=S),null!==T.map?(t.uniform2f(h.uvOffset,T.map.offset.x,T.map.offset.y),t.uniform2f(h.uvScale,T.map.repeat.x,T.map.repeat.y)):(t.uniform2f(h.uvOffset,0,0),t.uniform2f(h.uvScale,1,1)),t.uniform1f(h.opacity,T.opacity),t.uniform3f(h.color,T.color.r,T.color.g,T.color.b),t.uniform1f(h.rotation,T.rotation),t.uniform2fv(h.scale,M),i.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst,T.blendEquationAlpha,T.blendSrcAlpha,T.blendDstAlpha,T.premultipliedAlpha),i.buffers.depth.setTest(T.depthTest),i.buffers.depth.setMask(T.depthWrite),i.buffers.color.setMask(T.colorWrite),r.setTexture2D(T.map||l,0),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),E.onAfterRender(e,v,g,void 0,T,void 0)}}i.enable(t.CULL_FACE),i.reset()}}}tt.physical={uniforms:$e.merge([tt.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:et.meshphysical_vert,fragmentShader:et.meshphysical_frag},Object.assign(it.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new $;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var t=e||new $;return this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new $;return this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return(t||new $).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return(t||new $).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new $;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),nt.prototype=Object.create(oe.prototype),nt.prototype.constructor=nt;var st,at,ct,ht,lt,ut,pt,dt=0;function ft(){Object.defineProperty(this,"id",{value:dt++}),this.uuid=K.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=1,this.side=0,this.flatShading=!1,this.vertexColors=0,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.userData={},this.needsUpdate=!0}function mt(e){ft.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function vt(e){ft.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new ie,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.lights=!1,this.setValues(e)}function gt(e,t){this.min=void 0!==e?e:new ie(1/0,1/0,1/0),this.max=void 0!==t?t:new ie(-1/0,-1/0,-1/0)}function yt(e,t){this.center=void 0!==e?e:new ie,this.radius=void 0!==t?t:0}function bt(e,t){this.normal=void 0!==e?e:new ie(1,0,0),this.constant=void 0!==t?t:0}function xt(e,t,i,r,n,o){this.planes=[void 0!==e?e:new bt,void 0!==t?t:new bt,void 0!==i?i:new bt,void 0!==r?r:new bt,void 0!==n?n:new bt,void 0!==o?o:new bt]}function wt(e,t,i){for(var r=new xt,n=new ee,o=new $,s=new $(i,i),a=new ie,c=new ie,h=new Array(4),l=new Array(4),u={},p=[new ie(1,0,0),new ie(-1,0,0),new ie(0,0,1),new ie(0,0,-1),new ie(0,1,0),new ie(0,-1,0)],d=[new ie(0,1,0),new ie(0,1,0),new ie(0,1,0),new ie(0,1,0),new ie(0,0,1),new ie(0,0,-1)],f=[new se,new se,new se,new se,new se,new se],m=0;4!==m;++m){var v=0!=(1&m),g=0!=(2&m),y=new mt({depthPacking:3201,morphTargets:v,skinning:g});h[m]=y;var b=new vt({morphTargets:v,skinning:g});l[m]=b}var w=this;function _(t,i,r,n,o,s){var a=t.geometry,c=null,p=h,d=t.customDepthMaterial;if(r&&(p=l,d=t.customDistanceMaterial),d)c=d;else{var f=!1;i.morphTargets&&(a&&a.isBufferGeometry?f=a.morphAttributes&&a.morphAttributes.position&&a.morphAttributes.position.length>0:a&&a.isGeometry&&(f=a.morphTargets&&a.morphTargets.length>0)),t.isSkinnedMesh&&!1===i.skinning&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var m=0;f&&(m|=1),t.isSkinnedMesh&&i.skinning&&(m|=2),c=p[m]}if(e.localClippingEnabled&&!0===i.clipShadows&&0!==i.clippingPlanes.length){var v=c.uuid,g=i.uuid,y=u[v];void 0===y&&(y={},u[v]=y);var b=y[g];void 0===b&&(b=c.clone(),y[g]=b),c=b}c.visible=i.visible,c.wireframe=i.wireframe;var x=i.side;return w.renderSingleSided&&2==x&&(x=0),w.renderReverseSided&&(0===x?x=1:1===x&&(x=0)),c.side=x,c.clipShadows=i.clipShadows,c.clippingPlanes=i.clippingPlanes,c.clipIntersection=i.clipIntersection,c.wireframeLinewidth=i.wireframeLinewidth,c.linewidth=i.linewidth,r&&c.isMeshDistanceMaterial&&(c.referencePosition.copy(n),c.nearDistance=o,c.farDistance=s),c}function M(i,n,o,s){if(!1!==i.visible){if(i.layers.test(n.layers)&&(i.isMesh||i.isLine||i.isPoints)&&i.castShadow&&(!i.frustumCulled||r.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,i.matrixWorld);var a=t.update(i),h=i.material;if(Array.isArray(h))for(var l=a.groups,u=0,p=l.length;u<p;u++){var d=l[u],f=h[d.materialIndex];if(f&&f.visible){var m=_(i,f,s,c,o.near,o.far);e.renderBufferDirect(o,null,a,m,i,d)}}else if(h.visible){m=_(i,h,s,c,o.near,o.far);e.renderBufferDirect(o,null,a,m,i,null)}}for(var v=i.children,g=0,y=v.length;g<y;g++)M(v[g],n,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,i,h){if(!1!==w.enabled&&(!1!==w.autoUpdate||!1!==w.needsUpdate)&&0!==t.length){var l,u=e.context,m=e.state;m.disable(u.BLEND),m.buffers.color.setClear(1,1,1,1),m.buffers.depth.setTest(!0),m.setScissorTest(!1);for(var v=0,g=t.length;v<g;v++){var y=t[v],b=y.shadow,_=y&&y.isPointLight;if(void 0!==b){var E=b.camera;if(o.copy(b.mapSize),o.min(s),_){var T=o.x,S=o.y;f[0].set(2*T,S,T,S),f[1].set(0,S,T,S),f[2].set(3*T,S,T,S),f[3].set(T,S,T,S),f[4].set(3*T,0,T,S),f[5].set(T,0,T,S),o.x*=4,o.y*=2}if(null===b.map){var A={minFilter:x,magFilter:x,format:O};b.map=new ae(o.x,o.y,A),b.map.texture.name=y.name+".shadowMap",E.updateProjectionMatrix()}b.isSpotLightShadow&&b.update(y);var L=b.map,R=b.matrix;c.setFromMatrixPosition(y.matrixWorld),E.position.copy(c),_?(l=6,R.makeTranslation(-c.x,-c.y,-c.z)):(l=1,a.setFromMatrixPosition(y.target.matrixWorld),E.lookAt(a),E.updateMatrixWorld(),R.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),R.multiply(E.projectionMatrix),R.multiply(E.matrixWorldInverse)),e.setRenderTarget(L),e.clear();for(var C=0;C<l;C++){if(_){a.copy(E.position),a.add(p[C]),E.up.copy(d[C]),E.lookAt(a),E.updateMatrixWorld();var P=f[C];m.viewport(P)}n.multiplyMatrices(E.projectionMatrix,E.matrixWorldInverse),r.setFromMatrix(n),M(i,h,E,_)}}else console.warn("THREE.WebGLShadowMap:",y,"has no shadow.")}w.needsUpdate=!1}}}function _t(e){var t={};return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),t[e.uuid]},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);var r=t[i.uuid];r&&(e.deleteBuffer(r.buffer),delete t[i.uuid])},update:function(i,r){i.isInterleavedBufferAttribute&&(i=i.data);var n=t[i.uuid];void 0===n?t[i.uuid]=function(t,i){var r=t.array,n=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,o=e.createBuffer();e.bindBuffer(i,o),e.bufferData(i,r,n),t.onUploadCallback();var s=e.FLOAT;return r instanceof Float32Array?s=e.FLOAT:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?s=e.UNSIGNED_SHORT:r instanceof Int16Array?s=e.SHORT:r instanceof Uint32Array?s=e.UNSIGNED_INT:r instanceof Int32Array?s=e.INT:r instanceof Int8Array?s=e.BYTE:r instanceof Uint8Array&&(s=e.UNSIGNED_BYTE),{buffer:o,type:s,bytesPerElement:r.BYTES_PER_ELEMENT,version:t.version}}(i,r):n.version<i.version&&(!function(t,i,r){var n=i.array,o=i.updateRange;e.bindBuffer(r,t),!1===i.dynamic?e.bufferData(r,n,e.STATIC_DRAW):-1===o.count?e.bufferSubData(r,0,n):0===o.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(r,o.offset*n.BYTES_PER_ELEMENT,n.subarray(o.offset,o.offset+o.count)),o.count=-1)}(n.buffer,i,r),n.version=i.version)}}}function Mt(e,t,i,r){this._x=e||0,this._y=t||0,this._z=i||0,this._order=r||Mt.DefaultOrder}function Et(){this.mask=1}ft.prototype=Object.assign(Object.create(t.prototype),{constructor:ft,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]="overdraw"===t?Number(i):i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===i;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),!0===this.flatShading&&(i.flatShading=this.flatShading),0!==this.side&&(i.side=this.side),0!==this.vertexColors&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,0!==this.rotation&&(i.rotation=this.rotation),1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(i.morphTargets=!0),!0===this.skinning&&(i.skinning=!0),!1===this.visible&&(i.visible=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){var n=r(e.textures),o=r(e.images);n.length>0&&(i.textures=n),o.length>0&&(i.images=o)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.userData=JSON.parse(JSON.stringify(e.userData)),this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,i=null;if(null!==t){var r=t.length;i=new Array(r);for(var n=0;n!==r;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),mt.prototype=Object.create(ft.prototype),mt.prototype.constructor=mt,mt.prototype.isMeshDepthMaterial=!0,mt.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},vt.prototype=Object.create(ft.prototype),vt.prototype.constructor=vt,vt.prototype.isMeshDistanceMaterial=!0,vt.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this},Object.assign(gt.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,c=e.length;a<c;a+=3){var h=e[a],l=e[a+1],u=e[a+2];h<t&&(t=h),l<i&&(i=l),u<r&&(r=u),h>n&&(n=h),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,i,r),this.max.set(n,o,s),this},setFromBufferAttribute:function(e){for(var t=1/0,i=1/0,r=1/0,n=-1/0,o=-1/0,s=-1/0,a=0,c=e.count;a<c;a++){var h=e.getX(a),l=e.getY(a),u=e.getZ(a);h<t&&(t=h),l<i&&(i=l),u<r&&(r=u),h>n&&(n=h),l>o&&(o=l),u>s&&(s=u)}return this.min.set(t,i,r),this.max.set(n,o,s),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new ie;return function(t,i){var r=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){var t=e||new ie;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new ie;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e,t,i,r=new ie;function n(n){var o=n.geometry;if(void 0!==o)if(o.isGeometry){var s=o.vertices;for(t=0,i=s.length;t<i;t++)r.copy(s[t]),r.applyMatrix4(n.matrixWorld),e.expandByPoint(r)}else if(o.isBufferGeometry){var a=o.attributes.position;if(void 0!==a)for(t=0,i=a.count;t<i;t++)r.fromBufferAttribute(a,t).applyMatrix4(n.matrixWorld),e.expandByPoint(r)}}return function(t){return e=this,t.updateMatrixWorld(!0),t.traverse(n),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return(t||new ie).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:(at=new ie,function(e){return this.clampPoint(e.center,at),at.distanceToSquared(e.center)<=e.radius*e.radius}),intersectsPlane:function(e){var t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=e.constant&&i>=e.constant},clampPoint:function(e,t){return(t||new ie).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new ie;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new ie;return function(t){var i=t||new yt;return this.getCenter(i.center),i.radius=.5*this.getSize(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:(st=[new ie,new ie,new ie,new ie,new ie,new ie,new ie,new ie],function(e){return this.isEmpty()||(st[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),st[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),st[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),st[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),st[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),st[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),st[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),st[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(st)),this}),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(yt.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:(ct=new gt,function(e,t){var i=this.center;void 0!==t?i.copy(t):ct.setFromPoints(e).getCenter(i);for(var r=0,n=0,o=e.length;n<o;n++)r=Math.max(r,i.distanceToSquared(e[n]));return this.radius=Math.sqrt(r),this}),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),r=t||new ie;return r.copy(e),i>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){var t=e||new gt;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(bt.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new ie,t=new ie;return function(i,r,n){var o=e.subVectors(n,r).cross(t.subVectors(i,r)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return(t||new ie).copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(){var e=new ie;return function(t,i){var r=i||new ie,n=t.delta(e),o=this.normal.dot(n);if(0===o)return 0===this.distanceToPoint(t.start)?r.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return s<0||s>1?void 0:r.copy(n).multiplyScalar(s).add(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return(e||new ie).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new ie,t=new re;return function(i,r){var n=r||t.getNormalMatrix(i),o=this.coplanarPoint(e).applyMatrix4(i),s=this.normal.applyMatrix3(n).normalize();return this.constant=-o.dot(s),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(xt.prototype,{set:function(e,t,i,r,n,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(r),s[4].copy(n),s[5].copy(o),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,i=0;i<6;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,r=i[0],n=i[1],o=i[2],s=i[3],a=i[4],c=i[5],h=i[6],l=i[7],u=i[8],p=i[9],d=i[10],f=i[11],m=i[12],v=i[13],g=i[14],y=i[15];return t[0].setComponents(s-r,l-a,f-u,y-m).normalize(),t[1].setComponents(s+r,l+a,f+u,y+m).normalize(),t[2].setComponents(s+n,l+c,f+p,y+v).normalize(),t[3].setComponents(s-n,l-c,f-p,y-v).normalize(),t[4].setComponents(s-o,l-h,f-d,y-g).normalize(),t[5].setComponents(s+o,l+h,f+d,y+g).normalize(),this},intersectsObject:(ut=new yt,function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),ut.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(ut)}),intersectsSprite:function(){var e=new yt;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,r=-e.radius,n=0;n<6;n++){if(t[n].distanceToPoint(i)<r)return!1}return!0},intersectsBox:(ht=new ie,lt=new ie,function(e){for(var t=this.planes,i=0;i<6;i++){var r=t[i];ht.x=r.normal.x>0?e.min.x:e.max.x,lt.x=r.normal.x>0?e.max.x:e.min.x,ht.y=r.normal.y>0?e.min.y:e.max.y,lt.y=r.normal.y>0?e.max.y:e.min.y,ht.z=r.normal.z>0?e.min.z:e.max.z,lt.z=r.normal.z>0?e.max.z:e.min.z;var n=r.distanceToPoint(ht),o=r.distanceToPoint(lt);if(n<0&&o<0)return!1}return!0}),containsPoint:function(e){for(var t=this.planes,i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}}),Mt.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],Mt.DefaultOrder="XYZ",Object.defineProperties(Mt.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(Mt.prototype,{isEuler:!0,set:function(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._order=r||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,i){var r=K.clamp,n=e.elements,o=n[0],s=n[4],a=n[8],c=n[1],h=n[5],l=n[9],u=n[2],p=n[6],d=n[10];return"XYZ"===(t=t||this._order)?(this._y=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(this._x=Math.atan2(-l,d),this._z=Math.atan2(-s,o)):(this._x=Math.atan2(p,h),this._z=0)):"YXZ"===t?(this._x=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,h)):(this._y=Math.atan2(-u,o),this._z=0)):"ZXY"===t?(this._x=Math.asin(r(p,-1,1)),Math.abs(p)<.99999?(this._y=Math.atan2(-u,d),this._z=Math.atan2(-s,h)):(this._y=0,this._z=Math.atan2(c,o))):"ZYX"===t?(this._y=Math.asin(-r(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(p,d),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-s,h))):"YZX"===t?(this._z=Math.asin(r(c,-1,1)),Math.abs(c)<.99999?(this._x=Math.atan2(-l,h),this._y=Math.atan2(-u,o)):(this._x=0,this._y=Math.atan2(a,d))):"XZY"===t?(this._z=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(p,h),this._y=Math.atan2(a,o)):(this._x=Math.atan2(-l,d),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,!1!==i&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new ee;return function(t,i,r){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,i,r)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:(pt=new te,function(e){return pt.setFromEuler(this),this.setFromQuaternion(pt,e)}),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new ie(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(Et.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!=(this.mask&e.mask)}});var Tt,St,At,Lt,Rt=0;function Ct(){Object.defineProperty(this,"id",{value:Rt++}),this.uuid=K.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ct.DefaultUp.clone();var e=new ie,t=new Mt,i=new te,r=new ie(1,1,1);t.onChange((function(){i.setFromEuler(t,!1)})),i.onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{enumerable:!0,value:e},rotation:{enumerable:!0,value:t},quaternion:{enumerable:!0,value:i},scale:{enumerable:!0,value:r},modelViewMatrix:{value:new ee},normalMatrix:{value:new re}}),this.matrix=new ee,this.matrixWorld=new ee,this.matrixAutoUpdate=Ct.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Et,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Pt(){Ct.call(this),this.type="Camera",this.matrixWorldInverse=new ee,this.projectionMatrix=new ee}function Nt(e,t,i,r,n,o){Pt.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=void 0!==n?n:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()}function Ot(e,t,i,r,n,o){this.a=e,this.b=t,this.c=i,this.normal=r&&r.isVector3?r:new ie,this.vertexNormals=Array.isArray(r)?r:[],this.color=n&&n.isColor?n:new Qe,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==o?o:0}Ct.DefaultUp=new ie(0,1,0),Ct.DefaultMatrixAutoUpdate=!0,Ct.prototype=Object.assign(Object.create(t.prototype),{constructor:Ct,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:(Lt=new te,function(e,t){return Lt.setFromAxisAngle(e,t),this.quaternion.multiply(Lt),this}),rotateOnWorldAxis:function(){var e=new te;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.premultiply(e),this}}(),rotateX:function(){var e=new ie(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new ie(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new ie(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new ie;return function(t,i){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translateX:function(){var e=new ie(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new ie(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new ie(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:(At=new ee,function(e){return e.applyMatrix4(At.getInverse(this.matrixWorld))}),lookAt:function(){var e=new ee,t=new ie;return function(i,r,n){i.isVector3?t.copy(i):t.set(i,r,n),this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var i=this.children.indexOf(e);return-1!==i&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(i,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var i=0,r=this.children.length;i<r;i++){var n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}},getWorldPosition:function(e){var t=e||new ie;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:(Tt=new ie,St=new ie,function(e){var t=e||new te;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(Tt,t,St),t}),getWorldRotation:function(){var e=new te;return function(t){var i=t||new Mt;return this.getWorldQuaternion(e),i.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new ie,t=new te;return function(i){var r=i||new ie;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,r),r}}(),getWorldDirection:function(){var e=new te;return function(t){var i=t||new ie;return this.getWorldQuaternion(e),i.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,i=0,r=t.length;i<r;i++)t[i].updateMatrixWorld(e)},toJSON:function(e){var t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function n(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.matrix=this.matrix.toArray(),void 0!==this.geometry){r.geometry=n(e.geometries,this.geometry);var o=this.geometry.parameters;if(void 0!==o&&void 0!==o.shapes){var s=o.shapes;if(Array.isArray(s))for(var a=0,c=s.length;a<c;a++){var h=s[a];n(e.shapes,h)}else n(e.shapes,s)}}if(void 0!==this.material)if(Array.isArray(this.material)){var l=[];for(a=0,c=this.material.length;a<c;a++)l.push(n(e.materials,this.material[a]));r.material=l}else r.material=n(e.materials,this.material);if(this.children.length>0){r.children=[];for(a=0;a<this.children.length;a++)r.children.push(this.children[a].toJSON(e).object)}if(t){var u=m(e.geometries),p=m(e.materials),d=m(e.textures),f=m(e.images);s=m(e.shapes);u.length>0&&(i.geometries=u),p.length>0&&(i.materials=p),d.length>0&&(i.textures=d),f.length>0&&(i.images=f),s.length>0&&(i.shapes=s)}return i.object=r,i;function m(e){var t=[];for(var i in e){var r=e[i];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var i=0;i<e.children.length;i++){var r=e.children[i];this.add(r.clone())}return this}}),Pt.prototype=Object.assign(Object.create(Ct.prototype),{constructor:Pt,isCamera:!0,copy:function(e,t){return Ct.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new te;return function(t){var i=t||new ie;return this.getWorldQuaternion(e),i.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){Ct.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),Nt.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Nt,isOrthographicCamera:!0,copy:function(e,t){return Pt.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,i,r,n,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2,n=i-e,o=i+e,s=r+t,a=r-t;if(null!==this.view&&this.view.enabled){var c=this.zoom/(this.view.width/this.view.fullWidth),h=this.zoom/(this.view.height/this.view.fullHeight),l=(this.right-this.left)/this.view.width,u=(this.top-this.bottom)/this.view.height;o=(n+=l*(this.view.offsetX/c))+l*(this.view.width/c),a=(s-=u*(this.view.offsetY/h))-u*(this.view.height/h)}this.projectionMatrix.makeOrthographic(n,o,s,a,this.near,this.far)},toJSON:function(e){var t=Ct.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),Object.assign(Ot.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var It,Dt=0;function Ut(){Object.defineProperty(this,"id",{value:Dt+=2}),this.uuid=K.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ft(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=K.generateUUID(),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function kt(e,t,i){Ft.call(this,new Int8Array(e),t,i)}function Bt(e,t,i){Ft.call(this,new Uint8Array(e),t,i)}function zt(e,t,i){Ft.call(this,new Uint8ClampedArray(e),t,i)}function Gt(e,t,i){Ft.call(this,new Int16Array(e),t,i)}function jt(e,t,i){Ft.call(this,new Uint16Array(e),t,i)}function Vt(e,t,i){Ft.call(this,new Int32Array(e),t,i)}function Ht(e,t,i){Ft.call(this,new Uint32Array(e),t,i)}function Wt(e,t,i){Ft.call(this,new Float32Array(e),t,i)}function Xt(e,t,i){Ft.call(this,new Float64Array(e),t,i)}function qt(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Yt(e){if(0===e.length)return-1/0;for(var t=e[0],i=1,r=e.length;i<r;++i)e[i]>t&&(t=e[i]);return t}Ut.prototype=Object.assign(Object.create(t.prototype),{constructor:Ut,isGeometry:!0,applyMatrix:function(e){for(var t=(new re).getNormalMatrix(e),i=0,r=this.vertices.length;i<r;i++){this.vertices[i].applyMatrix4(e)}for(i=0,r=this.faces.length;i<r;i++){var n=this.faces[i];n.normal.applyMatrix3(t).normalize();for(var o=0,s=n.vertexNormals.length;o<s;o++)n.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new ee;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new ee;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new ee;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new ee;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new ee;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:(It=new Ct,function(e){It.lookAt(e),It.updateMatrix(),this.applyMatrix(It.matrix)}),fromBufferGeometry:function(e){var t=this,i=null!==e.index?e.index.array:void 0,r=e.attributes,n=r.position.array,o=void 0!==r.normal?r.normal.array:void 0,s=void 0!==r.color?r.color.array:void 0,a=void 0!==r.uv?r.uv.array:void 0,c=void 0!==r.uv2?r.uv2.array:void 0;void 0!==c&&(this.faceVertexUvs[1]=[]);for(var h=[],l=[],u=[],p=0,d=0;p<n.length;p+=3,d+=2)t.vertices.push(new ie(n[p],n[p+1],n[p+2])),void 0!==o&&h.push(new ie(o[p],o[p+1],o[p+2])),void 0!==s&&t.colors.push(new Qe(s[p],s[p+1],s[p+2])),void 0!==a&&l.push(new $(a[d],a[d+1])),void 0!==c&&u.push(new $(c[d],c[d+1]));function f(e,i,r,n){var p=new Ot(e,i,r,void 0!==o?[h[e].clone(),h[i].clone(),h[r].clone()]:[],void 0!==s?[t.colors[e].clone(),t.colors[i].clone(),t.colors[r].clone()]:[],n);t.faces.push(p),void 0!==a&&t.faceVertexUvs[0].push([l[e].clone(),l[i].clone(),l[r].clone()]),void 0!==c&&t.faceVertexUvs[1].push([u[e].clone(),u[i].clone(),u[r].clone()])}var m=e.groups;if(m.length>0)for(p=0;p<m.length;p++)for(var v=m[p],g=v.start,y=(d=g,g+v.count);d<y;d+=3)void 0!==i?f(i[d],i[d+1],i[d+2],v.materialIndex):f(d,d+1,d+2,v.materialIndex);else if(void 0!==i)for(p=0;p<i.length;p+=3)f(i[p],i[p+1],i[p+2]);else for(p=0;p<n.length/3;p+=3)f(p,p+1,p+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,i=0===t?1:1/t,r=new ee;return r.set(i,0,0,-i*e.x,0,i,0,-i*e.y,0,0,i,-i*e.z,0,0,0,1),this.applyMatrix(r),this},computeFaceNormals:function(){for(var e=new ie,t=new ie,i=0,r=this.faces.length;i<r;i++){var n=this.faces[i],o=this.vertices[n.a],s=this.vertices[n.b],a=this.vertices[n.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),n.normal.copy(e)}},computeVertexNormals:function(e){var t,i,r,n,o,s;for(void 0===e&&(e=!0),s=new Array(this.vertices.length),t=0,i=this.vertices.length;t<i;t++)s[t]=new ie;if(e){var a,c,h,l=new ie,u=new ie;for(r=0,n=this.faces.length;r<n;r++)o=this.faces[r],a=this.vertices[o.a],c=this.vertices[o.b],h=this.vertices[o.c],l.subVectors(h,c),u.subVectors(a,c),l.cross(u),s[o.a].add(l),s[o.b].add(l),s[o.c].add(l)}else for(this.computeFaceNormals(),r=0,n=this.faces.length;r<n;r++)s[(o=this.faces[r]).a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;t<i;t++)s[t].normalize();for(r=0,n=this.faces.length;r<n;r++){var p=(o=this.faces[r]).vertexNormals;3===p.length?(p[0].copy(s[o.a]),p[1].copy(s[o.b]),p[2].copy(s[o.c])):(p[0]=s[o.a].clone(),p[1]=s[o.b].clone(),p[2]=s[o.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,i;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var r=(i=this.faces[e]).vertexNormals;3===r.length?(r[0].copy(i.normal),r[1].copy(i.normal),r[2].copy(i.normal)):(r[0]=i.normal.clone(),r[1]=i.normal.clone(),r[2]=i.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,i,r,n;for(i=0,r=this.faces.length;i<r;i++)for((n=this.faces[i]).__originalFaceNormal?n.__originalFaceNormal.copy(n.normal):n.__originalFaceNormal=n.normal.clone(),n.__originalVertexNormals||(n.__originalVertexNormals=[]),e=0,t=n.vertexNormals.length;e<t;e++)n.__originalVertexNormals[e]?n.__originalVertexNormals[e].copy(n.vertexNormals[e]):n.__originalVertexNormals[e]=n.vertexNormals[e].clone();var o=new Ut;for(o.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s=this.morphNormals[e].faceNormals,a=this.morphNormals[e].vertexNormals;for(i=0,r=this.faces.length;i<r;i++)c=new ie,h={a:new ie,b:new ie,c:new ie},s.push(c),a.push(h)}var c,h,l=this.morphNormals[e];for(o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals(),i=0,r=this.faces.length;i<r;i++)n=this.faces[i],c=l.faceNormals[i],h=l.vertexNormals[i],c.copy(n.normal),h.a.copy(n.vertexNormals[0]),h.b.copy(n.vertexNormals[1]),h.c.copy(n.vertexNormals[2])}for(i=0,r=this.faces.length;i<r;i++)(n=this.faces[i]).normal=n.__originalFaceNormal,n.vertexNormals=n.__originalVertexNormals},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,r=t.length;i<r;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new gt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new yt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,i){if(e&&e.isGeometry){var r,n=this.vertices.length,o=this.vertices,s=e.vertices,a=this.faces,c=e.faces,h=this.faceVertexUvs[0],l=e.faceVertexUvs[0],u=this.colors,p=e.colors;void 0===i&&(i=0),void 0!==t&&(r=(new re).getNormalMatrix(t));for(var d=0,f=s.length;d<f;d++){var m=s[d].clone();void 0!==t&&m.applyMatrix4(t),o.push(m)}for(d=0,f=p.length;d<f;d++)u.push(p[d].clone());for(d=0,f=c.length;d<f;d++){var v,g,y,b=c[d],x=b.vertexNormals,w=b.vertexColors;(v=new Ot(b.a+n,b.b+n,b.c+n)).normal.copy(b.normal),void 0!==r&&v.normal.applyMatrix3(r).normalize();for(var _=0,M=x.length;_<M;_++)g=x[_].clone(),void 0!==r&&g.applyMatrix3(r).normalize(),v.vertexNormals.push(g);v.color.copy(b.color);for(_=0,M=w.length;_<M;_++)y=w[_],v.vertexColors.push(y.clone());v.materialIndex=b.materialIndex+i,a.push(v)}for(d=0,f=l.length;d<f;d++){var E=l[d],T=[];if(void 0!==E){for(_=0,M=E.length;_<M;_++)T.push(E[_].clone());h.push(T)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,i,r,n,o,s,a,c={},h=[],l=[],u=Math.pow(10,4);for(i=0,r=this.vertices.length;i<r;i++)e=this.vertices[i],void 0===c[t=Math.round(e.x*u)+"_"+Math.round(e.y*u)+"_"+Math.round(e.z*u)]?(c[t]=i,h.push(this.vertices[i]),l[i]=h.length-1):l[i]=l[c[t]];var p=[];for(i=0,r=this.faces.length;i<r;i++){(n=this.faces[i]).a=l[n.a],n.b=l[n.b],n.c=l[n.c],o=[n.a,n.b,n.c];for(var d=0;d<3;d++)if(o[d]===o[(d+1)%3]){p.push(i);break}}for(i=p.length-1;i>=0;i--){var f=p[i];for(this.faces.splice(f,1),s=0,a=this.faceVertexUvs.length;s<a;s++)this.faceVertexUvs[s].splice(f,1)}var m=this.vertices.length-h.length;return this.vertices=h,m},setFromPoints:function(e){this.vertices=[];for(var t=0,i=e.length;t<i;t++){var r=e[t];this.vertices.push(new ie(r.x,r.y,r.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,i=0;i<t;i++)e[i]._id=i;e.sort((function(e,t){return e.materialIndex-t.materialIndex}));var r,n,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===t&&(r=[]),s&&s.length===t&&(n=[]);for(i=0;i<t;i++){var a=e[i]._id;r&&r.push(o[a]),n&&n.push(s[a])}r&&(this.faceVertexUvs[0]=r),n&&(this.faceVertexUvs[1]=n)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}for(var r=[],n=0;n<this.vertices.length;n++){var o=this.vertices[n];r.push(o.x,o.y,o.z)}var s=[],a=[],c={},h=[],l={},u=[],p={};for(n=0;n<this.faces.length;n++){var d=this.faces[n],f=void 0!==this.faceVertexUvs[0][n],m=d.normal.length()>0,v=d.vertexNormals.length>0,g=1!==d.color.r||1!==d.color.g||1!==d.color.b,y=d.vertexColors.length>0,b=0;if(b=M(b,0,0),b=M(b,1,!0),b=M(b,2,!1),b=M(b,3,f),b=M(b,4,m),b=M(b,5,v),b=M(b,6,g),b=M(b,7,y),s.push(b),s.push(d.a,d.b,d.c),s.push(d.materialIndex),f){var x=this.faceVertexUvs[0][n];s.push(S(x[0]),S(x[1]),S(x[2]))}if(m&&s.push(E(d.normal)),v){var w=d.vertexNormals;s.push(E(w[0]),E(w[1]),E(w[2]))}if(g&&s.push(T(d.color)),y){var _=d.vertexColors;s.push(T(_[0]),T(_[1]),T(_[2]))}}function M(e,t,i){return i?e|1<<t:e&~(1<<t)}function E(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==c[t]||(c[t]=a.length/3,a.push(e.x,e.y,e.z)),c[t]}function T(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==l[t]||(l[t]=h.length,h.push(e.getHex())),l[t]}function S(e){var t=e.x.toString()+e.y.toString();return void 0!==p[t]||(p[t]=u.length/2,u.push(e.x,e.y)),p[t]}return e.data={},e.data.vertices=r,e.data.normals=a,h.length>0&&(e.data.colors=h),u.length>0&&(e.data.uvs=[u]),e.data.faces=s,e},clone:function(){return(new Ut).copy(this)},copy:function(e){var t,i,r,n,o,s;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var a=e.vertices;for(t=0,i=a.length;t<i;t++)this.vertices.push(a[t].clone());var c=e.colors;for(t=0,i=c.length;t<i;t++)this.colors.push(c[t].clone());var h=e.faces;for(t=0,i=h.length;t<i;t++)this.faces.push(h[t].clone());for(t=0,i=e.faceVertexUvs.length;t<i;t++){var l=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),r=0,n=l.length;r<n;r++){var u=l[r],p=[];for(o=0,s=u.length;o<s;o++){var d=u[o];p.push(d.clone())}this.faceVertexUvs[t].push(p)}}var f=e.morphTargets;for(t=0,i=f.length;t<i;t++){var m={};if(m.name=f[t].name,void 0!==f[t].vertices)for(m.vertices=[],r=0,n=f[t].vertices.length;r<n;r++)m.vertices.push(f[t].vertices[r].clone());if(void 0!==f[t].normals)for(m.normals=[],r=0,n=f[t].normals.length;r<n;r++)m.normals.push(f[t].normals[r].clone());this.morphTargets.push(m)}var v=e.morphNormals;for(t=0,i=v.length;t<i;t++){var g={};if(void 0!==v[t].vertexNormals)for(g.vertexNormals=[],r=0,n=v[t].vertexNormals.length;r<n;r++){var y=v[t].vertexNormals[r],b={};b.a=y.a.clone(),b.b=y.b.clone(),b.c=y.c.clone(),g.vertexNormals.push(b)}if(void 0!==v[t].faceNormals)for(g.faceNormals=[],r=0,n=v[t].faceNormals.length;r<n;r++)g.faceNormals.push(v[t].faceNormals[r].clone());this.morphNormals.push(g)}var x=e.skinWeights;for(t=0,i=x.length;t<i;t++)this.skinWeights.push(x[t].clone());var w=e.skinIndices;for(t=0,i=w.length;t<i;t++)this.skinIndices.push(w[t].clone());var _=e.lineDistances;for(t=0,i=_.length;t<i;t++)this.lineDistances.push(_[t]);var M=e.boundingBox;null!==M&&(this.boundingBox=M.clone());var E=e.boundingSphere;return null!==E&&(this.boundingSphere=E.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Ft.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Ft.prototype,{isBufferAttribute:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.itemSize,i*=t.itemSize;for(var r=0,n=this.itemSize;r<n;r++)this.array[e+r]=t.array[i+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),o=new Qe),t[i++]=o.r,t[i++]=o.g,t[i++]=o.b}return this},copyIndicesArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];t[i++]=o.a,t[i++]=o.b,t[i++]=o.c}return this},copyVector2sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new $),t[i++]=o.x,t[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),o=new ie),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z}return this},copyVector4sArray:function(e){for(var t=this.array,i=0,r=0,n=e.length;r<n;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new se),t[i++]=o.x,t[i++]=o.y,t[i++]=o.z,t[i++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=n,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),kt.prototype=Object.create(Ft.prototype),kt.prototype.constructor=kt,Bt.prototype=Object.create(Ft.prototype),Bt.prototype.constructor=Bt,zt.prototype=Object.create(Ft.prototype),zt.prototype.constructor=zt,Gt.prototype=Object.create(Ft.prototype),Gt.prototype.constructor=Gt,jt.prototype=Object.create(Ft.prototype),jt.prototype.constructor=jt,Vt.prototype=Object.create(Ft.prototype),Vt.prototype.constructor=Vt,Ht.prototype=Object.create(Ft.prototype),Ht.prototype.constructor=Ht,Wt.prototype=Object.create(Ft.prototype),Wt.prototype.constructor=Wt,Xt.prototype=Object.create(Ft.prototype),Xt.prototype.constructor=Xt,Object.assign(qt.prototype,{computeGroups:function(e){for(var t,i=[],r=void 0,n=e.faces,o=0;o<n.length;o++){var s=n[o];s.materialIndex!==r&&(r=s.materialIndex,void 0!==t&&(t.count=3*o-t.start,i.push(t)),t={start:3*o,materialIndex:r})}void 0!==t&&(t.count=3*o-t.start,i.push(t)),this.groups=i},fromGeometry:function(e){var t,i=e.faces,r=e.vertices,n=e.faceVertexUvs,o=n[0]&&n[0].length>0,s=n[1]&&n[1].length>0,a=e.morphTargets,c=a.length;if(c>0){t=[];for(var h=0;h<c;h++)t[h]=[];this.morphTargets.position=t}var l,u=e.morphNormals,p=u.length;if(p>0){l=[];for(h=0;h<p;h++)l[h]=[];this.morphTargets.normal=l}var d=e.skinIndices,f=e.skinWeights,m=d.length===r.length,v=f.length===r.length;for(h=0;h<i.length;h++){var g=i[h];this.vertices.push(r[g.a],r[g.b],r[g.c]);var y=g.vertexNormals;if(3===y.length)this.normals.push(y[0],y[1],y[2]);else{var b=g.normal;this.normals.push(b,b,b)}var x,w=g.vertexColors;if(3===w.length)this.colors.push(w[0],w[1],w[2]);else{var _=g.color;this.colors.push(_,_,_)}if(!0===o)void 0!==(x=n[0][h])?this.uvs.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",h),this.uvs.push(new $,new $,new $));if(!0===s)void 0!==(x=n[1][h])?this.uvs2.push(x[0],x[1],x[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",h),this.uvs2.push(new $,new $,new $));for(var M=0;M<c;M++){var E=a[M].vertices;t[M].push(E[g.a],E[g.b],E[g.c])}for(M=0;M<p;M++){var T=u[M].vertexNormals[h];l[M].push(T.a,T.b,T.c)}m&&this.skinIndices.push(d[g.a],d[g.b],d[g.c]),v&&this.skinWeights.push(f[g.a],f[g.b],f[g.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}});var Zt,Jt,Qt,Kt,$t,ei,ti,ii=1;function ri(){Object.defineProperty(this,"id",{value:ii+=2}),this.uuid=K.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function ni(e,t,i,r,n,o){Ut.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o},this.fromBufferGeometry(new oi(e,t,i,r,n,o)),this.mergeVertices()}function oi(e,t,i,r,n,o){ri.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:n,depthSegments:o};var s=this;e=e||1,t=t||1,i=i||1,r=Math.floor(r)||1,n=Math.floor(n)||1,o=Math.floor(o)||1;var a=[],c=[],h=[],l=[],u=0,p=0;function d(e,t,i,r,n,o,d,f,m,v,g){var y,b,x=o/m,w=d/v,_=o/2,M=d/2,E=f/2,T=m+1,S=v+1,A=0,L=0,R=new ie;for(b=0;b<S;b++){var C=b*w-M;for(y=0;y<T;y++){var P=y*x-_;R[e]=P*r,R[t]=C*n,R[i]=E,c.push(R.x,R.y,R.z),R[e]=0,R[t]=0,R[i]=f>0?1:-1,h.push(R.x,R.y,R.z),l.push(y/m),l.push(1-b/v),A+=1}}for(b=0;b<v;b++)for(y=0;y<m;y++){var N=u+y+T*b,O=u+y+T*(b+1),I=u+(y+1)+T*(b+1),D=u+(y+1)+T*b;a.push(N,O,D),a.push(O,I,D),L+=6}s.addGroup(p,L,g),p+=L,u+=A}d("z","y","x",-1,-1,i,t,e,o,n,0),d("z","y","x",1,-1,i,t,-e,o,n,1),d("x","z","y",1,1,e,i,t,r,o,2),d("x","z","y",1,-1,e,i,-t,r,o,3),d("x","y","z",1,-1,e,t,i,r,n,4),d("x","y","z",-1,-1,e,t,-i,r,n,5),this.setIndex(a),this.addAttribute("position",new Wt(c,3)),this.addAttribute("normal",new Wt(h,3)),this.addAttribute("uv",new Wt(l,2))}function si(e,t,i,r){Ut.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r},this.fromBufferGeometry(new ai(e,t,i,r)),this.mergeVertices()}function ai(e,t,i,r){ri.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};var n,o,s=(e=e||1)/2,a=(t=t||1)/2,c=Math.floor(i)||1,h=Math.floor(r)||1,l=c+1,u=h+1,p=e/c,d=t/h,f=[],m=[],v=[],g=[];for(o=0;o<u;o++){var y=o*d-a;for(n=0;n<l;n++){var b=n*p-s;m.push(b,-y,0),v.push(0,0,1),g.push(n/c),g.push(1-o/h)}}for(o=0;o<h;o++)for(n=0;n<c;n++){var x=n+l*o,w=n+l*(o+1),_=n+1+l*(o+1),M=n+1+l*o;f.push(x,w,M),f.push(w,_,M)}this.setIndex(f),this.addAttribute("position",new Wt(m,3)),this.addAttribute("normal",new Wt(v,3)),this.addAttribute("uv",new Wt(g,2))}function ci(e){ft.call(this),this.type="MeshBasicMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function hi(e){ft.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function li(e,t){this.origin=void 0!==e?e:new ie,this.direction=void 0!==t?t:new ie}function ui(e,t){this.start=void 0!==e?e:new ie,this.end=void 0!==t?t:new ie}function pi(e,t,i){this.a=void 0!==e?e:new ie,this.b=void 0!==t?t:new ie,this.c=void 0!==i?i:new ie}function di(e,t){Ct.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new ri,this.material=void 0!==t?t:new ci({color:16777215*Math.random()}),this.drawMode=0,this.updateMorphTargets()}function fi(e,t,i,r){var n,o,s,a=new Qe(0),c=0;function h(e,i){t.buffers.color.setClear(e.r,e.g,e.b,i,r)}return{getClearColor:function(){return a},setClearColor:function(e,t){a.set(e),h(a,c=void 0!==t?t:1)},getClearAlpha:function(){return c},setClearAlpha:function(e){h(a,c=e)},render:function(t,r,l,u){var p=r.background;null===p?h(a,c):p&&p.isColor&&(h(p,1),u=!0),(e.autoClear||u)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&p.isCubeTexture?(void 0===s&&((s=new di(new oi(1,1,1),new hi({uniforms:tt.cube.uniforms,vertexShader:tt.cube.vertexShader,fragmentShader:tt.cube.fragmentShader,side:1,depthTest:!0,depthWrite:!1,fog:!1}))).geometry.removeAttribute("normal"),s.geometry.removeAttribute("uv"),s.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},i.update(s.geometry)),s.material.uniforms.tCube.value=p,t.push(s,s.geometry,s.material,0,null)):p&&p.isTexture&&(void 0===n&&(n=new Nt(-1,1,1,-1,0,1),o=new di(new ai(2,2),new ci({depthTest:!1,depthWrite:!1,fog:!1})),i.update(o.geometry)),o.material.map=p,e.renderBufferDirect(n,null,o.geometry,o.material,o,null))}}}function mi(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function vi(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function gi(){var e=[],t=0,i=[],r=[];return{opaque:i,transparent:r,init:function(){t=0,i.length=0,r.length=0},push:function(n,o,s,a,c){var h=e[t];void 0===h?(h={id:n.id,object:n,geometry:o,material:s,program:s.program,renderOrder:n.renderOrder,z:a,group:c},e[t]=h):(h.id=n.id,h.object=n,h.geometry=o,h.material=s,h.program=s.program,h.renderOrder=n.renderOrder,h.z=a,h.group=c),(!0===s.transparent?r:i).push(h),t++},sort:function(){i.length>1&&i.sort(mi),r.length>1&&r.sort(vi)}}}function yi(){var e={};return{get:function(t,i){var r=t.id+","+i.id,n=e[r];return void 0===n&&(n=new gi,e[r]=n),n},dispose:function(){e={}}}}function bi(e,t){return Math.abs(t[1])-Math.abs(e[1])}function xi(e){var t={},i=new Float32Array(8);return{update:function(r,n,o,s){var a=r.morphTargetInfluences,c=a.length,h=t[n.id];if(void 0===h){h=[];for(var l=0;l<c;l++)h[l]=[l,0];t[n.id]=h}var u=o.morphTargets&&n.morphAttributes.position,p=o.morphNormals&&n.morphAttributes.normal;for(l=0;l<c;l++){0!==(d=h[l])[1]&&(u&&n.removeAttribute("morphTarget"+l),p&&n.removeAttribute("morphNormal"+l))}for(l=0;l<c;l++){(d=h[l])[0]=l,d[1]=a[l]}for(h.sort(bi),l=0;l<8;l++){var d;if(d=h[l]){var f=d[0],m=d[1];if(m){u&&n.addAttribute("morphTarget"+l,u[f]),p&&n.addAttribute("morphNormal"+l,p[f]),i[l]=m;continue}}i[l]=0}s.getUniforms().setValue(e,"morphTargetInfluences",i)}}}function wi(e,t,i){var r,n,o;this.setMode=function(e){r=e},this.setIndex=function(e){n=e.type,o=e.bytesPerElement},this.render=function(t,s){e.drawElements(r,s,n,t*o),i.calls++,i.vertices+=s,r===e.TRIANGLES?i.faces+=s/3:r===e.POINTS&&(i.points+=s)},this.renderInstances=function(s,a,c){var h=t.get("ANGLE_instanced_arrays");null!==h?(h.drawElementsInstancedANGLE(r,c,n,a*o,s.maxInstancedCount),i.calls++,i.vertices+=c*s.maxInstancedCount,r===e.TRIANGLES?i.faces+=s.maxInstancedCount*c/3:r===e.POINTS&&(i.points+=s.maxInstancedCount*c)):console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}function _i(e,t,i){var r;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.calls++,i.vertices+=n,r===e.TRIANGLES?i.faces+=n/3:r===e.POINTS&&(i.points+=n)},this.renderInstances=function(n,o,s){var a=t.get("ANGLE_instanced_arrays");if(null!==a){var c=n.attributes.position;c.isInterleavedBufferAttribute?(s=c.data.count,a.drawArraysInstancedANGLE(r,0,s,n.maxInstancedCount)):a.drawArraysInstancedANGLE(r,o,s,n.maxInstancedCount),i.calls++,i.vertices+=s*n.maxInstancedCount,r===e.TRIANGLES?i.faces+=n.maxInstancedCount*s/3:r===e.POINTS&&(i.points+=n.maxInstancedCount*s)}else console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.")}}function Mi(e,t,i){var r={},n={};function o(e){var s=e.target,a=r[s.id];for(var c in null!==a.index&&t.remove(a.index),a.attributes)t.remove(a.attributes[c]);s.removeEventListener("dispose",o),delete r[s.id];var h=n[s.id];h&&(t.remove(h),delete n[s.id]),(h=n[a.id])&&(t.remove(h),delete n[a.id]),i.geometries--}return{get:function(e,t){var n=r[t.id];return n||(t.addEventListener("dispose",o),t.isBufferGeometry?n=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new ri).setFromObject(e)),n=t._bufferGeometry),r[t.id]=n,i.geometries++,n)},update:function(i){var r=i.index,n=i.attributes;for(var o in null!==r&&t.update(r,e.ELEMENT_ARRAY_BUFFER),n)t.update(n[o],e.ARRAY_BUFFER);var s=i.morphAttributes;for(var o in s)for(var a=s[o],c=0,h=a.length;c<h;c++)t.update(a[c],e.ARRAY_BUFFER)},getWireframeAttribute:function(i){var r=n[i.id];if(r)return r;var o,s=[],a=i.index,c=i.attributes;if(null!==a)for(var h=0,l=(o=a.array).length;h<l;h+=3){var u=o[h+0],p=o[h+1],d=o[h+2];s.push(u,p,p,d,d,u)}else for(h=0,l=(o=c.position.array).length/3-1;h<l;h+=3){u=h+0,p=h+1,d=h+2;s.push(u,p,p,d,d,u)}return r=new(Yt(s)>65535?Ht:jt)(s,1),t.update(r,e.ELEMENT_ARRAY_BUFFER),n[i.id]=r,r}}}function Ei(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var i;switch(t.type){case"DirectionalLight":i={direction:new ie,color:new Qe,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $};break;case"SpotLight":i={position:new ie,direction:new ie,color:new Qe,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $};break;case"PointLight":i={position:new ie,color:new Qe,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new $,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":i={direction:new ie,skyColor:new Qe,groundColor:new Qe};break;case"RectAreaLight":i={color:new Qe,position:new ie,halfWidth:new ie,halfHeight:new ie}}return e[t.id]=i,i}}}function Ti(){var e=new Ei,t={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=new ie,r=new ee,n=new ee;return{setup:function(o,s,a){for(var c=0,h=0,l=0,u=0,p=0,d=0,f=0,m=0,v=a.matrixWorldInverse,g=0,y=o.length;g<y;g++){var b=o[g],x=b.color,w=b.intensity,_=b.distance,M=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)c+=x.r*w,h+=x.g*w,l+=x.b*w;else if(b.isDirectionalLight){if((T=e.get(b)).color.copy(b.color).multiplyScalar(b.intensity),T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.shadow=b.castShadow,b.castShadow){var E=b.shadow;T.shadowBias=E.bias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize}t.directionalShadowMap[u]=M,t.directionalShadowMatrix[u]=b.shadow.matrix,t.directional[u]=T,u++}else if(b.isSpotLight){if((T=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(v),T.color.copy(x).multiplyScalar(w),T.distance=_,T.direction.setFromMatrixPosition(b.matrixWorld),i.setFromMatrixPosition(b.target.matrixWorld),T.direction.sub(i),T.direction.transformDirection(v),T.coneCos=Math.cos(b.angle),T.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),T.decay=0===b.distance?0:b.decay,T.shadow=b.castShadow,b.castShadow){E=b.shadow;T.shadowBias=E.bias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize}t.spotShadowMap[d]=M,t.spotShadowMatrix[d]=b.shadow.matrix,t.spot[d]=T,d++}else if(b.isRectAreaLight){(T=e.get(b)).color.copy(x).multiplyScalar(w/(b.width*b.height)),T.position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(v),n.identity(),r.copy(b.matrixWorld),r.premultiply(v),n.extractRotation(r),T.halfWidth.set(.5*b.width,0,0),T.halfHeight.set(0,.5*b.height,0),T.halfWidth.applyMatrix4(n),T.halfHeight.applyMatrix4(n),t.rectArea[f]=T,f++}else if(b.isPointLight){if((T=e.get(b)).position.setFromMatrixPosition(b.matrixWorld),T.position.applyMatrix4(v),T.color.copy(b.color).multiplyScalar(b.intensity),T.distance=b.distance,T.decay=0===b.distance?0:b.decay,T.shadow=b.castShadow,b.castShadow){E=b.shadow;T.shadowBias=E.bias,T.shadowRadius=E.radius,T.shadowMapSize=E.mapSize,T.shadowCameraNear=E.camera.near,T.shadowCameraFar=E.camera.far}t.pointShadowMap[p]=M,t.pointShadowMatrix[p]=b.shadow.matrix,t.point[p]=T,p++}else if(b.isHemisphereLight){var T;(T=e.get(b)).direction.setFromMatrixPosition(b.matrixWorld),T.direction.transformDirection(v),T.direction.normalize(),T.skyColor.copy(b.color).multiplyScalar(w),T.groundColor.copy(b.groundColor).multiplyScalar(w),t.hemi[m]=T,m++}}t.ambient[0]=c,t.ambient[1]=h,t.ambient[2]=l,t.directional.length=u,t.spot.length=d,t.rectArea.length=f,t.point.length=p,t.hemi.length=m,t.hash=u+","+p+","+d+","+f+","+m+","+s.length},state:t}}function Si(e,t){var i={};return{update:function(r){var n=t.frame,o=r.geometry,s=e.get(r,o);return i[s.id]!==n&&(o.isGeometry&&s.updateFromObject(r),e.update(s),i[s.id]=n),s},clear:function(){i={}}}}function Ai(e,t,i){var r=e.createShader(t);return e.shaderSource(r,i),e.compileShader(r),!1===e.getShaderParameter(r,e.COMPILE_STATUS)&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(r)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(r),function(e){for(var t=e.split("\n"),i=0;i<t.length;i++)t[i]=i+1+": "+t[i];return t.join("\n")}(i)),r}ri.prototype=Object.assign(Object.create(t.prototype),{constructor:ri,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Yt(e)>65535?Ht:jt)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new Ft(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,i){this.groups.push({start:e,count:t,materialIndex:void 0!==i?i:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var i=this.attributes.normal;void 0!==i&&((new re).getNormalMatrix(e).applyToBufferAttribute(i),i.needsUpdate=!0);return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new ee;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new ee;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new ee;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new ee;return function(t,i,r){return e.makeTranslation(t,i,r),this.applyMatrix(e),this}}(),scale:function(){var e=new ee;return function(t,i,r){return e.makeScale(t,i,r),this.applyMatrix(e),this}}(),lookAt:function(){var e=new Ct;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var i=new Wt(3*t.vertices.length,3),r=new Wt(3*t.colors.length,3);if(this.addAttribute("position",i.copyVector3sArray(t.vertices)),this.addAttribute("color",r.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var n=new Wt(t.lineDistances.length,1);this.addAttribute("lineDistance",n.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i];t.push(n.x,n.y,n.z||0)}return this.addAttribute("position",new Wt(t,3)),this},updateFromObject:function(e){var t,i=e.geometry;if(e.isMesh){var r=i.__directGeometry;if(!0===i.elementsNeedUpdate&&(r=void 0,i.elementsNeedUpdate=!1),void 0===r)return this.fromGeometry(i);r.verticesNeedUpdate=i.verticesNeedUpdate,r.normalsNeedUpdate=i.normalsNeedUpdate,r.colorsNeedUpdate=i.colorsNeedUpdate,r.uvsNeedUpdate=i.uvsNeedUpdate,r.groupsNeedUpdate=i.groupsNeedUpdate,i.verticesNeedUpdate=!1,i.normalsNeedUpdate=!1,i.colorsNeedUpdate=!1,i.uvsNeedUpdate=!1,i.groupsNeedUpdate=!1,i=r}return!0===i.verticesNeedUpdate&&(void 0!==(t=this.attributes.position)&&(t.copyVector3sArray(i.vertices),t.needsUpdate=!0),i.verticesNeedUpdate=!1),!0===i.normalsNeedUpdate&&(void 0!==(t=this.attributes.normal)&&(t.copyVector3sArray(i.normals),t.needsUpdate=!0),i.normalsNeedUpdate=!1),!0===i.colorsNeedUpdate&&(void 0!==(t=this.attributes.color)&&(t.copyColorsArray(i.colors),t.needsUpdate=!0),i.colorsNeedUpdate=!1),i.uvsNeedUpdate&&(void 0!==(t=this.attributes.uv)&&(t.copyVector2sArray(i.uvs),t.needsUpdate=!0),i.uvsNeedUpdate=!1),i.lineDistancesNeedUpdate&&(void 0!==(t=this.attributes.lineDistance)&&(t.copyArray(i.lineDistances),t.needsUpdate=!0),i.lineDistancesNeedUpdate=!1),i.groupsNeedUpdate&&(i.computeGroups(e.geometry),this.groups=i.groups,i.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new qt).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new Ft(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var i=new Float32Array(3*e.normals.length);this.addAttribute("normal",new Ft(i,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var r=new Float32Array(3*e.colors.length);this.addAttribute("color",new Ft(r,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var n=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new Ft(n,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var o=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new Ft(o,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var s=new(Yt(e.indices)>65535?Uint32Array:Uint16Array)(3*e.indices.length);this.setIndex(new Ft(s,1).copyIndicesArray(e.indices))}for(var a in this.groups=e.groups,e.morphTargets){for(var c=[],h=e.morphTargets[a],l=0,u=h.length;l<u;l++){var p=h[l],d=new Wt(3*p.length,3);c.push(d.copyVector3sArray(p))}this.morphAttributes[a]=c}if(e.skinIndices.length>0){var f=new Wt(4*e.skinIndices.length,4);this.addAttribute("skinIndex",f.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var m=new Wt(4*e.skinWeights.length,4);this.addAttribute("skinWeight",m.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new gt);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new gt,t=new ie;return function(){null===this.boundingSphere&&(this.boundingSphere=new yt);var i=this.attributes.position;if(i){var r=this.boundingSphere.center;e.setFromBufferAttribute(i),e.getCenter(r);for(var n=0,o=0,s=i.count;o<s;o++)t.x=i.getX(o),t.y=i.getY(o),t.z=i.getZ(o),n=Math.max(n,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,i=this.groups;if(t.position){var r=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new Ft(new Float32Array(r.length),3));else for(var n=t.normal.array,o=0,s=n.length;o<s;o++)n[o]=0;var a,c,h,l=t.normal.array,u=new ie,p=new ie,d=new ie,f=new ie,m=new ie;if(e){var v=e.array;0===i.length&&this.addGroup(0,v.length);for(var g=0,y=i.length;g<y;++g){var b=i[g],x=b.start;for(o=x,s=x+b.count;o<s;o+=3)a=3*v[o+0],c=3*v[o+1],h=3*v[o+2],u.fromArray(r,a),p.fromArray(r,c),d.fromArray(r,h),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),l[a]+=f.x,l[a+1]+=f.y,l[a+2]+=f.z,l[c]+=f.x,l[c+1]+=f.y,l[c+2]+=f.z,l[h]+=f.x,l[h+1]+=f.y,l[h+2]+=f.z}}else for(o=0,s=r.length;o<s;o+=9)u.fromArray(r,o),p.fromArray(r,o+3),d.fromArray(r,o+6),f.subVectors(d,p),m.subVectors(u,p),f.cross(m),l[o]=f.x,l[o+1]=f.y,l[o+2]=f.z,l[o+3]=f.x,l[o+4]=f.y,l[o+5]=f.z,l[o+6]=f.x,l[o+7]=f.y,l[o+8]=f.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0);var i=this.attributes;for(var r in i)if(void 0!==e.attributes[r])for(var n=i[r].array,o=e.attributes[r],s=o.array,a=0,c=o.itemSize*t;a<s.length;a++,c++)n[c]=s[a];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){var e=new ie;return function(){for(var t=this.attributes.normal,i=0,r=t.count;i<r;i++)e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.normalize(),t.setXYZ(i,e.x,e.y,e.z)}}(),toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new ri,t=this.index.array,i=this.attributes;for(var r in i){for(var n=i[r],o=n.array,s=n.itemSize,a=new o.constructor(t.length*s),c=0,h=0,l=0,u=t.length;l<u;l++){c=t[l]*s;for(var p=0;p<s;p++)a[h++]=o[c++]}e.addAttribute(r,new Ft(a,s))}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};var r=this.index;if(null!==r){var n=Array.prototype.slice.call(r.array);e.data.index={type:r.array.constructor.name,array:n}}var o=this.attributes;for(var i in o){var s=o[i];n=Array.prototype.slice.call(s.array);e.data.attributes[i]={itemSize:s.itemSize,type:s.array.constructor.name,array:n,normalized:s.normalized}}var a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));var c=this.boundingSphere;return null!==c&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e},clone:function(){return(new ri).copy(this)},copy:function(e){var t,i,r;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone());var o=e.attributes;for(t in o){var s=o[t];this.addAttribute(t,s.clone())}var a=e.morphAttributes;for(t in a){var c=[],h=a[t];for(i=0,r=h.length;i<r;i++)c.push(h[i].clone());this.morphAttributes[t]=c}var l=e.groups;for(i=0,r=l.length;i<r;i++){var u=l[i];this.addGroup(u.start,u.count,u.materialIndex)}var p=e.boundingBox;null!==p&&(this.boundingBox=p.clone());var d=e.boundingSphere;return null!==d&&(this.boundingSphere=d.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),ni.prototype=Object.create(Ut.prototype),ni.prototype.constructor=ni,oi.prototype=Object.create(ri.prototype),oi.prototype.constructor=oi,si.prototype=Object.create(Ut.prototype),si.prototype.constructor=si,ai.prototype=Object.create(ri.prototype),ai.prototype.constructor=ai,ci.prototype=Object.create(ft.prototype),ci.prototype.constructor=ci,ci.prototype.isMeshBasicMaterial=!0,ci.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},hi.prototype=Object.create(ft.prototype),hi.prototype.constructor=hi,hi.prototype.isShaderMaterial=!0,hi.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$e.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},hi.prototype.toJSON=function(e){var t=ft.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},Object.assign(li.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new ie).copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new ie;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new ie;i.subVectors(e,this.origin);var r=i.dot(this.direction);return r<0?i.copy(this.origin):i.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new ie;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return i<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:(Jt=new ie,Qt=new ie,Kt=new ie,function(e,t,i,r){Jt.copy(e).add(t).multiplyScalar(.5),Qt.copy(t).sub(e).normalize(),Kt.copy(this.origin).sub(Jt);var n,o,s,a,c=.5*e.distanceTo(t),h=-this.direction.dot(Qt),l=Kt.dot(this.direction),u=-Kt.dot(Qt),p=Kt.lengthSq(),d=Math.abs(1-h*h);if(d>0)if(o=h*l-u,a=c*d,(n=h*u-l)>=0)if(o>=-a)if(o<=a){var f=1/d;s=(n*=f)*(n+h*(o*=f)+2*l)+o*(h*n+o+2*u)+p}else o=c,s=-(n=Math.max(0,-(h*o+l)))*n+o*(o+2*u)+p;else o=-c,s=-(n=Math.max(0,-(h*o+l)))*n+o*(o+2*u)+p;else o<=-a?s=-(n=Math.max(0,-(-h*c+l)))*n+(o=n>0?-c:Math.min(Math.max(-c,-u),c))*(o+2*u)+p:o<=a?(n=0,s=(o=Math.min(Math.max(-c,-u),c))*(o+2*u)+p):s=-(n=Math.max(0,-(h*c+l)))*n+(o=n>0?c:Math.min(Math.max(-c,-u),c))*(o+2*u)+p;else o=h>0?-c:c,s=-(n=Math.max(0,-(h*o+l)))*n+o*(o+2*u)+p;return i&&i.copy(this.direction).multiplyScalar(n).add(this.origin),r&&r.copy(Qt).multiplyScalar(o).add(Jt),s}),intersectSphere:function(){var e=new ie;return function(t,i){e.subVectors(t.center,this.origin);var r=e.dot(this.direction),n=e.dot(e)-r*r,o=t.radius*t.radius;if(n>o)return null;var s=Math.sqrt(o-n),a=r-s,c=r+s;return a<0&&c<0?null:a<0?this.at(c,i):this.at(a,i)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var i,r,n,o,s,a,c=1/this.direction.x,h=1/this.direction.y,l=1/this.direction.z,u=this.origin;return c>=0?(i=(e.min.x-u.x)*c,r=(e.max.x-u.x)*c):(i=(e.max.x-u.x)*c,r=(e.min.x-u.x)*c),h>=0?(n=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(n=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||n>r?null:((n>i||i!=i)&&(i=n),(o<r||r!=r)&&(r=o),l>=0?(s=(e.min.z-u.z)*l,a=(e.max.z-u.z)*l):(s=(e.max.z-u.z)*l,a=(e.min.z-u.z)*l),i>a||s>r?null:((s>i||i!=i)&&(i=s),(a<r||r!=r)&&(r=a),r<0?null:this.at(i>=0?i:r,t)))},intersectsBox:(Zt=new ie,function(e){return null!==this.intersectBox(e,Zt)}),intersectTriangle:function(){var e=new ie,t=new ie,i=new ie,r=new ie;return function(n,o,s,a,c){t.subVectors(o,n),i.subVectors(s,n),r.crossVectors(t,i);var h,l=this.direction.dot(r);if(l>0){if(a)return null;h=1}else{if(!(l<0))return null;h=-1,l=-l}e.subVectors(this.origin,n);var u=h*this.direction.dot(i.crossVectors(e,i));if(u<0)return null;var p=h*this.direction.dot(t.cross(e));if(p<0)return null;if(u+p>l)return null;var d=-h*e.dot(r);return d<0?null:this.at(d/l,c)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(ui.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return(e||new ie).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new ie).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new ie;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:($t=new ie,ei=new ie,function(e,t){$t.subVectors(e,this.start),ei.subVectors(this.end,this.start);var i=ei.dot(ei),r=ei.dot($t)/i;return t&&(r=K.clamp(r,0,1)),r}),closestPointToPoint:function(e,t,i){var r=this.closestPointToPointParameter(e,t),n=i||new ie;return this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(pi,{normal:(ti=new ie,function(e,t,i,r){var n=r||new ie;n.subVectors(i,t),ti.subVectors(e,t),n.cross(ti);var o=n.lengthSq();return o>0?n.multiplyScalar(1/Math.sqrt(o)):n.set(0,0,0)}),barycoordFromPoint:function(){var e=new ie,t=new ie,i=new ie;return function(r,n,o,s,a){e.subVectors(s,n),t.subVectors(o,n),i.subVectors(r,n);var c=e.dot(e),h=e.dot(t),l=e.dot(i),u=t.dot(t),p=t.dot(i),d=c*u-h*h,f=a||new ie;if(0===d)return f.set(-2,-1,-1);var m=1/d,v=(u*l-h*p)*m,g=(c*p-h*l)*m;return f.set(1-v-g,g,v)}}(),containsPoint:function(){var e=new ie;return function(t,i,r,n){var o=pi.barycoordFromPoint(t,i,r,n,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}()}),Object.assign(pi.prototype,{set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new ie,t=new ie;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new ie).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return pi.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new bt).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return pi.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return pi.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e=new bt,t=[new ui,new ui,new ui],i=new ie,r=new ie;return function(n,o){var s=o||new ie,a=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(n,i),!0===this.containsPoint(i))s.copy(i);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var c=0;c<t.length;c++){t[c].closestPointToPoint(i,!0,r);var h=i.distanceToSquared(r);h<a&&(a=h,s.copy(r))}}return s}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),di.prototype=Object.assign(Object.create(Ct.prototype),{constructor:di,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return Ct.prototype.copy.call(this,e),this.drawMode=e.drawMode,void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,i,r=this.geometry;if(r.isBufferGeometry){var n=r.morphAttributes,o=Object.keys(n);if(o.length>0){var s=n[o[0]];if(void 0!==s)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)i=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}}else{var a=r.morphTargets;if(void 0!==a&&a.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=a.length;e<t;e++)i=a[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=e}},raycast:function(){var e=new ee,t=new li,i=new yt,r=new ie,n=new ie,o=new ie,s=new ie,a=new ie,c=new ie,h=new $,l=new $,u=new $,p=new ie,d=new ie,f=new ie;function m(e,t,i,r,n,o,s){return pi.barycoordFromPoint(e,t,i,r,p),n.multiplyScalar(p.x),o.multiplyScalar(p.y),s.multiplyScalar(p.z),n.add(o).add(s),n.clone()}function v(e,t,i,r,n,o,s,a){if(null===(1===t.side?r.intersectTriangle(s,o,n,!0,a):r.intersectTriangle(n,o,s,2!==t.side,a)))return null;f.copy(a),f.applyMatrix4(e.matrixWorld);var c=i.ray.origin.distanceTo(f);return c<i.near||c>i.far?null:{distance:c,point:f.clone(),object:e}}function g(e,t,i,s,a,c,p,f){r.fromBufferAttribute(s,c),n.fromBufferAttribute(s,p),o.fromBufferAttribute(s,f);var g=v(e,e.material,t,i,r,n,o,d);return g&&(a&&(h.fromBufferAttribute(a,c),l.fromBufferAttribute(a,p),u.fromBufferAttribute(a,f),g.uv=m(d,r,n,o,h,l,u)),g.face=new Ot(c,p,f,pi.normal(r,n,o)),g.faceIndex=c),g}return function(p,f){var y,b=this.geometry,x=this.material,w=this.matrixWorld;if(void 0!==x&&(null===b.boundingSphere&&b.computeBoundingSphere(),i.copy(b.boundingSphere),i.applyMatrix4(w),!1!==p.ray.intersectsSphere(i)&&(e.getInverse(w),t.copy(p.ray).applyMatrix4(e),null===b.boundingBox||!1!==t.intersectsBox(b.boundingBox))))if(b.isBufferGeometry){var _,M,E,T,S,A=b.index,L=b.attributes.position,R=b.attributes.uv;if(null!==A)for(T=0,S=A.count;T<S;T+=3)_=A.getX(T),M=A.getX(T+1),E=A.getX(T+2),(y=g(this,p,t,L,R,_,M,E))&&(y.faceIndex=Math.floor(T/3),f.push(y));else if(void 0!==L)for(T=0,S=L.count;T<S;T+=3)(y=g(this,p,t,L,R,_=T,M=T+1,E=T+2))&&(y.index=_,f.push(y))}else if(b.isGeometry){var C,P,N,O,I=Array.isArray(x),D=b.vertices,U=b.faces,F=b.faceVertexUvs[0];F.length>0&&(O=F);for(var k=0,B=U.length;k<B;k++){var z=U[k],G=I?x[z.materialIndex]:x;if(void 0!==G){if(C=D[z.a],P=D[z.b],N=D[z.c],!0===G.morphTargets){var j=b.morphTargets,V=this.morphTargetInfluences;r.set(0,0,0),n.set(0,0,0),o.set(0,0,0);for(var H=0,W=j.length;H<W;H++){var X=V[H];if(0!==X){var q=j[H].vertices;r.addScaledVector(s.subVectors(q[z.a],C),X),n.addScaledVector(a.subVectors(q[z.b],P),X),o.addScaledVector(c.subVectors(q[z.c],N),X)}}r.add(C),n.add(P),o.add(N),C=r,P=n,N=o}if(y=v(this,G,p,t,C,P,N,d)){if(O&&O[k]){var Y=O[k];h.copy(Y[0]),l.copy(Y[1]),u.copy(Y[2]),y.uv=m(d,C,P,N,h,l,u)}y.face=z,y.faceIndex=k,f.push(y)}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Li,Ri,Ci,Pi,Ni,Oi,Ii=0;function Di(e){switch(e){case J:return["Linear","( value )"];case 3001:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case Q:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ui(e,t){var i=Di(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function Fi(e,t){var i;switch(t){case 1:i="Linear";break;case 2:i="Reinhard";break;case 3:i="Uncharted2";break;case 4:i="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function ki(e){return""!==e}function Bi(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function zi(e){return e.replace(/^[ \t]*#include +<([\w\d.]+)>/gm,(function(e,t){var i=et[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return zi(i)}))}function Gi(e){return e.replace(/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,(function(e,t,i,r){for(var n="",o=parseInt(t);o<parseInt(i);o++)n+=r.replace(/\[ i \]/g,"[ "+o+" ]");return n}))}function ji(e,t,i,r,n,o){var s=e.context,a=r.defines,c=n.vertexShader,h=n.fragmentShader,l="SHADOWMAP_TYPE_BASIC";1===o.shadowMapType?l="SHADOWMAP_TYPE_PCF":2===o.shadowMapType&&(l="SHADOWMAP_TYPE_PCF_SOFT");var u="ENVMAP_TYPE_CUBE",g="ENVMAP_MODE_REFLECTION",y="ENVMAP_BLENDING_MULTIPLY";if(o.envMap){switch(r.envMap.mapping){case p:case d:u="ENVMAP_TYPE_CUBE";break;case m:case v:u="ENVMAP_TYPE_CUBE_UV";break;case 303:case f:u="ENVMAP_TYPE_EQUIREC";break;case 305:u="ENVMAP_TYPE_SPHERE"}switch(r.envMap.mapping){case d:case f:g="ENVMAP_MODE_REFRACTION"}switch(r.combine){case 0:y="ENVMAP_BLENDING_MULTIPLY";break;case 1:y="ENVMAP_BLENDING_MIX";break;case 2:y="ENVMAP_BLENDING_ADD"}}var b,x,w,_,M,E=e.gammaFactor>0?e.gammaFactor:1,T=function(e,t,i){return[(e=e||{}).derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&i.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&i.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&i.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ki).join("\n")}(r.extensions,o,t),S=function(e){var t=[];for(var i in e){var r=e[i];!1!==r&&t.push("#define "+i+" "+r)}return t.join("\n")}(a),A=s.createProgram();r.isRawShaderMaterial?((b=[S].filter(ki).join("\n")).length>0&&(b+="\n"),(x=[T,S].filter(ki).join("\n")).length>0&&(x+="\n")):(b=["precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,S,o.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+E,"#define MAX_BONES "+o.maxBones,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+g:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.displacementMap&&o.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.flatShading?"#define FLAT_SHADED":"",o.skinning?"#define USE_SKINNING":"",o.useVertexTexture?"#define BONE_TEXTURE":"",o.morphTargets?"#define USE_MORPHTARGETS":"",o.morphNormals&&!1===o.flatShading?"#define USE_MORPHNORMALS":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+o.numClippingPlanes,o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.sizeAttenuation?"#define USE_SIZEATTENUATION":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ki).join("\n"),x=[T,"precision "+o.precision+" float;","precision "+o.precision+" int;","#define SHADER_NAME "+n.name,S,o.alphaTest?"#define ALPHATEST "+o.alphaTest:"","#define GAMMA_FACTOR "+E,o.useFog&&o.fog?"#define USE_FOG":"",o.useFog&&o.fogExp?"#define FOG_EXP2":"",o.map?"#define USE_MAP":"",o.envMap?"#define USE_ENVMAP":"",o.envMap?"#define "+u:"",o.envMap?"#define "+g:"",o.envMap?"#define "+y:"",o.lightMap?"#define USE_LIGHTMAP":"",o.aoMap?"#define USE_AOMAP":"",o.emissiveMap?"#define USE_EMISSIVEMAP":"",o.bumpMap?"#define USE_BUMPMAP":"",o.normalMap?"#define USE_NORMALMAP":"",o.specularMap?"#define USE_SPECULARMAP":"",o.roughnessMap?"#define USE_ROUGHNESSMAP":"",o.metalnessMap?"#define USE_METALNESSMAP":"",o.alphaMap?"#define USE_ALPHAMAP":"",o.vertexColors?"#define USE_COLOR":"",o.gradientMap?"#define USE_GRADIENTMAP":"",o.flatShading?"#define FLAT_SHADED":"",o.doubleSided?"#define DOUBLE_SIDED":"",o.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+o.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(o.numClippingPlanes-o.numClipIntersection),o.shadowMapEnabled?"#define USE_SHADOWMAP":"",o.shadowMapEnabled?"#define "+l:"",o.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",o.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",o.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",o.logarithmicDepthBuffer&&t.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",o.envMap&&t.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",0!==o.toneMapping?"#define TONE_MAPPING":"",0!==o.toneMapping?et.tonemapping_pars_fragment:"",0!==o.toneMapping?Fi("toneMapping",o.toneMapping):"",o.dithering?"#define DITHERING":"",o.outputEncoding||o.mapEncoding||o.envMapEncoding||o.emissiveMapEncoding?et.encodings_pars_fragment:"",o.mapEncoding?Ui("mapTexelToLinear",o.mapEncoding):"",o.envMapEncoding?Ui("envMapTexelToLinear",o.envMapEncoding):"",o.emissiveMapEncoding?Ui("emissiveMapTexelToLinear",o.emissiveMapEncoding):"",o.outputEncoding?(w="linearToOutputTexel",_=o.outputEncoding,M=Di(_),"vec4 "+w+"( vec4 value ) { return LinearTo"+M[0]+M[1]+"; }"):"",o.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(ki).join("\n")),c=Bi(c=zi(c),o),h=Bi(h=zi(h),o),r.isShaderMaterial||(c=Gi(c),h=Gi(h));var L=b+c,R=x+h,C=Ai(s,s.VERTEX_SHADER,L),P=Ai(s,s.FRAGMENT_SHADER,R);s.attachShader(A,C),s.attachShader(A,P),void 0!==r.index0AttributeName?s.bindAttribLocation(A,0,r.index0AttributeName):!0===o.morphTargets&&s.bindAttribLocation(A,0,"position"),s.linkProgram(A);var N,O,I=s.getProgramInfoLog(A),D=s.getShaderInfoLog(C),U=s.getShaderInfoLog(P),F=!0,k=!0;return!1===s.getProgramParameter(A,s.LINK_STATUS)?(F=!1,console.error("THREE.WebGLProgram: shader error: ",s.getError(),"gl.VALIDATE_STATUS",s.getProgramParameter(A,s.VALIDATE_STATUS),"gl.getProgramInfoLog",I,D,U)):""!==I?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",I):""!==D&&""!==U||(k=!1),k&&(this.diagnostics={runnable:F,material:r,programLog:I,vertexShader:{log:D,prefix:b},fragmentShader:{log:U,prefix:x}}),s.deleteShader(C),s.deleteShader(P),this.getUniforms=function(){return void 0===N&&(N=new Ze(s,A,e)),N},this.getAttributes=function(){return void 0===O&&(O=function(e,t){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),n=0;n<r;n++){var o=e.getActiveAttrib(t,n).name;i[o]=e.getAttribLocation(t,o)}return i}(s,A)),O},this.destroy=function(){s.deleteProgram(A),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Ii++,this.code=i,this.usedTimes=1,this.program=A,this.vertexShader=C,this.fragmentShader=P,this}function Vi(e,t,i){var r=[],n={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function s(e,t){var i;return e?e.isTexture?i=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),i=e.texture.encoding):i=J,i===J&&t&&(i=Q),i}this.getParameters=function(t,r,o,a,c,h,l){var u=n[t.type],p=l.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(i.floatVertexTextures)return 1024;var r=i.maxVertexUniforms,n=Math.floor((r-20)/4),o=Math.min(n,t.length);return o<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+o+"."),0):o}(l):0,d=i.precision;null!==t.precision&&(d=i.getMaxPrecision(t.precision))!==t.precision&&console.warn("THREE.WebGLProgram.getParameters:",t.precision,"not supported, using",d,"instead.");var f=e.getRenderTarget();return{shaderID:u,precision:d,supportsVertexTextures:i.vertexTextures,outputEncoding:s(f?f.texture:null,e.gammaOutput),map:!!t.map,mapEncoding:s(t.map,e.gammaInput),envMap:!!t.envMap,envMapMode:t.envMap&&t.envMap.mapping,envMapEncoding:s(t.envMap,e.gammaInput),envMapCubeUV:!!t.envMap&&(t.envMap.mapping===m||t.envMap.mapping===v),lightMap:!!t.lightMap,aoMap:!!t.aoMap,emissiveMap:!!t.emissiveMap,emissiveMapEncoding:s(t.emissiveMap,e.gammaInput),bumpMap:!!t.bumpMap,normalMap:!!t.normalMap,displacementMap:!!t.displacementMap,roughnessMap:!!t.roughnessMap,metalnessMap:!!t.metalnessMap,specularMap:!!t.specularMap,alphaMap:!!t.alphaMap,gradientMap:!!t.gradientMap,combine:t.combine,vertexColors:t.vertexColors,fog:!!a,useFog:t.fog,fogExp:a&&a.isFogExp2,flatShading:t.flatShading,sizeAttenuation:t.sizeAttenuation,logarithmicDepthBuffer:i.logarithmicDepthBuffer,skinning:t.skinning&&p>0,maxBones:p,useVertexTexture:i.floatVertexTextures,morphTargets:t.morphTargets,morphNormals:t.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:r.directional.length,numPointLights:r.point.length,numSpotLights:r.spot.length,numRectAreaLights:r.rectArea.length,numHemiLights:r.hemi.length,numClippingPlanes:c,numClipIntersection:h,dithering:t.dithering,shadowMapEnabled:e.shadowMap.enabled&&l.receiveShadow&&o.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:t.premultipliedAlpha,alphaTest:t.alphaTest,doubleSided:2===t.side,flipSided:1===t.side,depthPacking:void 0!==t.depthPacking&&t.depthPacking}},this.getProgramCode=function(t,i){var r=[];if(i.shaderID?r.push(i.shaderID):(r.push(t.fragmentShader),r.push(t.vertexShader)),void 0!==t.defines)for(var n in t.defines)r.push(n),r.push(t.defines[n]);for(var s=0;s<o.length;s++)r.push(i[o[s]]);return r.push(t.onBeforeCompile.toString()),r.push(e.gammaOutput),r.join()},this.acquireProgram=function(i,n,o,s){for(var a,c=0,h=r.length;c<h;c++){var l=r[c];if(l.code===s){++(a=l).usedTimes;break}}return void 0===a&&(a=new ji(e,t,s,i,n,o),r.push(a)),a},this.releaseProgram=function(e){if(0==--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function Hi(e,t,i,r,n,o,s){var a="undefined"!=typeof WebGL2RenderingContext&&e instanceof window.WebGL2RenderingContext,c={};function h(e,t){if(e.width>t||e.height>t){var i=t/Math.max(e.width,e.height),r=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return r.width=Math.floor(e.width*i),r.height=Math.floor(e.height*i),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,r.width,r.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+r.width+"x"+r.height,e),r}return e}function l(e){return K.isPowerOfTwo(e.width)&&K.isPowerOfTwo(e.height)}function u(e,t){return e.generateMipmaps&&t&&e.minFilter!==x&&e.minFilter!==M}function p(t){return t===x||t===w||t===_?e.NEAREST:e.LINEAR}function d(t){var i=t.target;i.removeEventListener("dispose",d),function(t){var i=r.get(t);if(t.image&&i.__image__webglTextureCube)e.deleteTexture(i.__image__webglTextureCube);else{if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture)}r.remove(t)}(i),i.isVideoTexture&&delete c[i.id],s.textures--}function f(t){var i=t.target;i.removeEventListener("dispose",f),function(t){var i=r.get(t),n=r.get(t.texture);if(!t)return;void 0!==n.__webglTexture&&e.deleteTexture(n.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLRenderTargetCube)for(var o=0;o<6;o++)e.deleteFramebuffer(i.__webglFramebuffer[o]),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer[o]);else e.deleteFramebuffer(i.__webglFramebuffer),i.__webglDepthbuffer&&e.deleteRenderbuffer(i.__webglDepthbuffer);r.remove(t.texture),r.remove(t)}(i),s.textures--}function m(t,p){var f=r.get(t);if(t.version>0&&f.__version!==t.version){var m=t.image;if(void 0===m)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(!1!==m.complete)return void function(t,r,p){void 0===t.__webglInit&&(t.__webglInit=!0,r.addEventListener("dispose",d),t.__webglTexture=e.createTexture(),r.isVideoTexture&&(c[r.id]=r),s.textures++);i.activeTexture(e.TEXTURE0+p),i.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,r.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,r.unpackAlignment);var f=h(r.image,n.maxTextureSize);(function(e){return e.wrapS!==y||e.wrapT!==y||e.minFilter!==x&&e.minFilter!==M})(r)&&!1===l(f)&&(f=function(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageBitmap){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return t.width=K.floorPowerOfTwo(e.width),t.height=K.floorPowerOfTwo(e.height),t.getContext("2d").drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}(f));var m=l(f),g=o.convert(r.format),b=o.convert(r.type);v(e.TEXTURE_2D,r,m);var w,_=r.mipmaps;if(r.isDepthTexture){var E=e.DEPTH_COMPONENT;if(r.type===R){if(!a)throw new Error("Float Depth Texture only supported in WebGL2.0");E=e.DEPTH_COMPONENT32F}else a&&(E=e.DEPTH_COMPONENT16);r.format===I&&E===e.DEPTH_COMPONENT&&r.type!==A&&r.type!==L&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=A,b=o.convert(r.type)),r.format===D&&(E=e.DEPTH_STENCIL,r.type!==P&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=P,b=o.convert(r.type))),i.texImage2D(e.TEXTURE_2D,0,E,f.width,f.height,0,g,b,null)}else if(r.isDataTexture)if(_.length>0&&m){for(var T=0,S=_.length;T<S;T++)w=_[T],i.texImage2D(e.TEXTURE_2D,T,g,w.width,w.height,0,g,b,w.data);r.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,g,f.width,f.height,0,g,b,f.data);else if(r.isCompressedTexture)for(T=0,S=_.length;T<S;T++)w=_[T],r.format!==O&&r.format!==N?i.getCompressedTextureFormats().indexOf(g)>-1?i.compressedTexImage2D(e.TEXTURE_2D,T,g,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(e.TEXTURE_2D,T,g,w.width,w.height,0,g,b,w.data);else if(_.length>0&&m){for(T=0,S=_.length;T<S;T++)w=_[T],i.texImage2D(e.TEXTURE_2D,T,g,g,b,w);r.generateMipmaps=!1}else i.texImage2D(e.TEXTURE_2D,0,g,g,b,f);u(r,m)&&e.generateMipmap(e.TEXTURE_2D);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(f,t,p);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}i.activeTexture(e.TEXTURE0+p),i.bindTexture(e.TEXTURE_2D,f.__webglTexture)}function v(i,s,a){var c;if(a?(e.texParameteri(i,e.TEXTURE_WRAP_S,o.convert(s.wrapS)),e.texParameteri(i,e.TEXTURE_WRAP_T,o.convert(s.wrapT)),e.texParameteri(i,e.TEXTURE_MAG_FILTER,o.convert(s.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,o.convert(s.minFilter))):(e.texParameteri(i,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(i,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),s.wrapS===y&&s.wrapT===y||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",s),e.texParameteri(i,e.TEXTURE_MAG_FILTER,p(s.magFilter)),e.texParameteri(i,e.TEXTURE_MIN_FILTER,p(s.minFilter)),s.minFilter!==x&&s.minFilter!==M&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",s)),c=t.get("EXT_texture_filter_anisotropic")){if(s.type===R&&null===t.get("OES_texture_float_linear"))return;if(s.type===C&&null===t.get("OES_texture_half_float_linear"))return;(s.anisotropy>1||r.get(s).__currentAnisotropy)&&(e.texParameterf(i,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(s.anisotropy,n.getMaxAnisotropy())),r.get(s).__currentAnisotropy=s.anisotropy)}}function g(t,n,s,a){var c=o.convert(n.texture.format),h=o.convert(n.texture.type);i.texImage2D(a,0,c,n.width,n.height,0,c,h,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,s,a,r.get(n.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function b(t,i){e.bindRenderbuffer(e.RENDERBUFFER,t),i.depthBuffer&&!i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):i.depthBuffer&&i.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,i.width,i.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,i.width,i.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function E(t){var i=r.get(t),n=!0===t.isWebGLRenderTargetCube;if(t.depthTexture){if(n)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,i){if(i&&i.isWebGLRenderTargetCube)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!i.depthTexture||!i.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(i.depthTexture).__webglTexture&&i.depthTexture.image.width===i.width&&i.depthTexture.image.height===i.height||(i.depthTexture.image.width=i.width,i.depthTexture.image.height=i.height,i.depthTexture.needsUpdate=!0),m(i.depthTexture,0);var n=r.get(i.depthTexture).__webglTexture;if(i.depthTexture.format===I)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,n,0);else{if(i.depthTexture.format!==D)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,n,0)}}(i.__webglFramebuffer,t)}else if(n){i.__webglDepthbuffer=[];for(var o=0;o<6;o++)e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer[o]),i.__webglDepthbuffer[o]=e.createRenderbuffer(),b(i.__webglDepthbuffer[o],t)}else e.bindFramebuffer(e.FRAMEBUFFER,i.__webglFramebuffer),i.__webglDepthbuffer=e.createRenderbuffer(),b(i.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}this.setTexture2D=m,this.setTextureCube=function(t,a){var c=r.get(t);if(6===t.image.length)if(t.version>0&&c.__version!==t.version){c.__image__webglTextureCube||(t.addEventListener("dispose",d),c.__image__webglTextureCube=e.createTexture(),s.textures++),i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var p=t&&t.isCompressedTexture,f=t.image[0]&&t.image[0].isDataTexture,m=[],g=0;g<6;g++)m[g]=p||f?f?t.image[g].image:t.image[g]:h(t.image[g],n.maxCubemapSize);var y=l(m[0]),b=o.convert(t.format),x=o.convert(t.type);v(e.TEXTURE_CUBE_MAP,t,y);for(g=0;g<6;g++)if(p)for(var w,_=m[g].mipmaps,M=0,E=_.length;M<E;M++)w=_[M],t.format!==O&&t.format!==N?i.getCompressedTextureFormats().indexOf(b)>-1?i.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,b,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,M,b,w.width,w.height,0,b,x,w.data);else f?i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,b,m[g].width,m[g].height,0,b,x,m[g].data):i.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,b,b,x,m[g]);u(t,y)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),c.__version=t.version,t.onUpdate&&t.onUpdate(t)}else i.activeTexture(e.TEXTURE0+a),i.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)},this.setTextureCubeDynamic=function(t,n){i.activeTexture(e.TEXTURE0+n),i.bindTexture(e.TEXTURE_CUBE_MAP,r.get(t).__webglTexture)},this.setupRenderTarget=function(t){var n=r.get(t),o=r.get(t.texture);t.addEventListener("dispose",f),o.__webglTexture=e.createTexture(),s.textures++;var a=!0===t.isWebGLRenderTargetCube,c=l(t);if(a){n.__webglFramebuffer=[];for(var h=0;h<6;h++)n.__webglFramebuffer[h]=e.createFramebuffer()}else n.__webglFramebuffer=e.createFramebuffer();if(a){i.bindTexture(e.TEXTURE_CUBE_MAP,o.__webglTexture),v(e.TEXTURE_CUBE_MAP,t.texture,c);for(h=0;h<6;h++)g(n.__webglFramebuffer[h],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+h);u(t.texture,c)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),i.bindTexture(e.TEXTURE_CUBE_MAP,null)}else i.bindTexture(e.TEXTURE_2D,o.__webglTexture),v(e.TEXTURE_2D,t.texture,c),g(n.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),u(t.texture,c)&&e.generateMipmap(e.TEXTURE_2D),i.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&E(t)},this.updateRenderTargetMipmap=function(t){var n=t.texture;if(u(n,l(t))){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=r.get(n).__webglTexture;i.bindTexture(o,s),e.generateMipmap(o),i.bindTexture(o,null)}},this.updateVideoTextures=function(){for(var e in c)c[e].update()}}function Wi(){var e={};return{get:function(t){var i=t.uuid,r=e[i];return void 0===r&&(r={},e[i]=r),r},remove:function(t){delete e[t.uuid]},clear:function(){e={}}}}function Xi(e,t,i){var r=new function(){var t=!1,i=new se,r=null,n=new se(0,0,0,0);return{setMask:function(i){r===i||t||(e.colorMask(i,i,i,i),r=i)},setLocked:function(e){t=e},setClear:function(t,r,o,s,a){!0===a&&(t*=s,r*=s,o*=s),i.set(t,r,o,s),!1===n.equals(i)&&(e.clearColor(t,r,o,s),n.copy(i))},reset:function(){t=!1,r=null,n.set(-1,0,0,0)}}},n=new function(){var t=!1,i=null,r=null,n=null;return{setTest:function(t){t?D(e.DEPTH_TEST):U(e.DEPTH_TEST)},setMask:function(r){i===r||t||(e.depthMask(r),i=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(e.NEVER);break;case 1:e.depthFunc(e.ALWAYS);break;case 2:e.depthFunc(e.LESS);break;case 3:e.depthFunc(e.LEQUAL);break;case 4:e.depthFunc(e.EQUAL);break;case 5:e.depthFunc(e.GEQUAL);break;case 6:e.depthFunc(e.GREATER);break;case 7:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);r=t}},setLocked:function(e){t=e},setClear:function(t){n!==t&&(e.clearDepth(t),n=t)},reset:function(){t=!1,i=null,r=null,n=null}}},o=new function(){var t=!1,i=null,r=null,n=null,o=null,s=null,a=null,c=null,h=null;return{setTest:function(t){t?D(e.STENCIL_TEST):U(e.STENCIL_TEST)},setMask:function(r){i===r||t||(e.stencilMask(r),i=r)},setFunc:function(t,i,s){r===t&&n===i&&o===s||(e.stencilFunc(t,i,s),r=t,n=i,o=s)},setOp:function(t,i,r){s===t&&a===i&&c===r||(e.stencilOp(t,i,r),s=t,a=i,c=r)},setLocked:function(e){t=e},setClear:function(t){h!==t&&(e.clearStencil(t),h=t)},reset:function(){t=!1,i=null,r=null,n=null,o=null,s=null,a=null,c=null,h=null}}},s=e.getParameter(e.MAX_VERTEX_ATTRIBS),a=new Uint8Array(s),c=new Uint8Array(s),h=new Uint8Array(s),l={},u=null,p=null,d=null,f=null,m=null,v=null,g=null,y=null,b=null,x=!1,w=null,_=null,M=null,E=null,T=null,S=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),A=parseFloat(/^WebGL\ ([0-9])/.exec(e.getParameter(e.VERSION))[1]),L=parseFloat(A)>=1,R=null,C={},P=new se,N=new se;function O(t,i,r){var n=new Uint8Array(4),o=e.createTexture();e.bindTexture(t,o),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var s=0;s<r;s++)e.texImage2D(i+s,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,n);return o}var I={};function D(t){!0!==l[t]&&(e.enable(t),l[t]=!0)}function U(t){!1!==l[t]&&(e.disable(t),l[t]=!1)}function F(t,r,n,o,s,a,c,h){if(0!==t?D(e.BLEND):U(e.BLEND),5!==t){if(t!==d||h!==x)switch(t){case 2:h?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE));break;case 3:h?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR));break;case 4:h?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR));break;default:h?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA))}f=null,m=null,v=null,g=null,y=null,b=null}else s=s||r,a=a||n,c=c||o,r===f&&s===g||(e.blendEquationSeparate(i.convert(r),i.convert(s)),f=r,g=s),n===m&&o===v&&a===y&&c===b||(e.blendFuncSeparate(i.convert(n),i.convert(o),i.convert(a),i.convert(c)),m=n,v=o,y=a,b=c);d=t,x=h}function k(t){w!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),w=t)}function B(t){0!==t?(D(e.CULL_FACE),t!==_&&(1===t?e.cullFace(e.BACK):2===t?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):U(e.CULL_FACE),_=t}function z(t,i,r){t?(D(e.POLYGON_OFFSET_FILL),E===i&&T===r||(e.polygonOffset(i,r),E=i,T=r)):U(e.POLYGON_OFFSET_FILL)}function G(t){void 0===t&&(t=e.TEXTURE0+S-1),R!==t&&(e.activeTexture(t),R=t)}return I[e.TEXTURE_2D]=O(e.TEXTURE_2D,e.TEXTURE_2D,1),I[e.TEXTURE_CUBE_MAP]=O(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),r.setClear(0,0,0,1),n.setClear(1),o.setClear(0),D(e.DEPTH_TEST),n.setFunc(3),k(!1),B(1),D(e.CULL_FACE),D(e.BLEND),F(1),{buffers:{color:r,depth:n,stencil:o},initAttributes:function(){for(var e=0,t=a.length;e<t;e++)a[e]=0},enableAttribute:function(i){a[i]=1,0===c[i]&&(e.enableVertexAttribArray(i),c[i]=1),0!==h[i]&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,0),h[i]=0)},enableAttributeAndDivisor:function(i,r){a[i]=1,0===c[i]&&(e.enableVertexAttribArray(i),c[i]=1),h[i]!==r&&(t.get("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(i,r),h[i]=r)},disableUnusedAttributes:function(){for(var t=0,i=c.length;t!==i;++t)c[t]!==a[t]&&(e.disableVertexAttribArray(t),c[t]=0)},enable:D,disable:U,getCompressedTextureFormats:function(){if(null===u&&(u=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var i=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),r=0;r<i.length;r++)u.push(i[r]);return u},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:F,setMaterial:function(t,i){2===t.side?U(e.CULL_FACE):D(e.CULL_FACE);var o=1===t.side;i&&(o=!o),k(o),!0===t.transparent?F(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):F(0),n.setFunc(t.depthFunc),n.setTest(t.depthTest),n.setMask(t.depthWrite),r.setMask(t.colorWrite),z(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:k,setCullFace:B,setLineWidth:function(t){t!==M&&(L&&e.lineWidth(t),M=t)},setPolygonOffset:z,setScissorTest:function(t){t?D(e.SCISSOR_TEST):U(e.SCISSOR_TEST)},activeTexture:G,bindTexture:function(t,i){null===R&&G();var r=C[R];void 0===r&&(r={type:void 0,texture:void 0},C[R]=r),r.type===t&&r.texture===i||(e.bindTexture(t,i||I[t]),r.type=t,r.texture=i)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===P.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),P.copy(t))},viewport:function(t){!1===N.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),N.copy(t))},reset:function(){for(var t=0;t<c.length;t++)1===c[t]&&(e.disableVertexAttribArray(t),c[t]=0);l={},u=null,R=null,C={},p=null,d=null,w=null,_=null,r.reset(),n.reset(),o.reset()}}}function qi(e,t,i){var r;function n(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var o=void 0!==i.precision?i.precision:"highp",s=n(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var a=!0===i.logarithmicDepthBuffer,c=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),l=e.getParameter(e.MAX_TEXTURE_SIZE),u=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),p=e.getParameter(e.MAX_VERTEX_ATTRIBS),d=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),f=e.getParameter(e.MAX_VARYING_VECTORS),m=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=h>0,g=!!t.get("OES_texture_float");return{getMaxAnisotropy:function(){if(void 0!==r)return r;var i=t.get("EXT_texture_filter_anisotropic");return r=null!==i?e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:n,precision:o,logarithmicDepthBuffer:a,maxTextures:c,maxVertexTextures:h,maxTextureSize:l,maxCubemapSize:u,maxAttributes:p,maxVertexUniforms:d,maxVaryings:f,maxFragmentUniforms:m,vertexTextures:v,floatFragmentTextures:g,floatVertexTextures:v&&g}}function Yi(e,t,i,r){Pt.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==i?i:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Zi(e){Yi.call(this),this.cameras=e||[]}function Ji(e){var t=this,i=null,r=null,n=null;"undefined"!=typeof window&&"VRFrameData"in window&&(r=new window.VRFrameData);var o=new ee,s=new Yi;s.bounds=new se(0,0,.5,1),s.layers.enable(1);var a=new Yi;a.bounds=new se(.5,0,.5,1),a.layers.enable(2);var c,h,l=new Zi([s,a]);function u(){if(null!==i&&i.isPresenting){var r=i.getEyeParameters("left"),n=r.renderWidth,o=r.renderHeight;h=e.getPixelRatio(),c=e.getSize(),e.setDrawingBufferSize(2*n,o,1)}else t.enabled&&e.setDrawingBufferSize(c.width,c.height,h)}l.layers.enable(1),l.layers.enable(2),"undefined"!=typeof window&&window.addEventListener("vrdisplaypresentchange",u,!1),this.enabled=!1,this.getDevice=function(){return i},this.setDevice=function(e){void 0!==e&&(i=e)},this.setPoseTarget=function(e){void 0!==e&&(n=e)},this.getCamera=function(e){if(null===i)return e;i.depthNear=e.near,i.depthFar=e.far,i.getFrameData(r);var t=r.pose,c=null!==n?n:e;if(null!==t.position?c.position.fromArray(t.position):c.position.set(0,0,0),null!==t.orientation&&c.quaternion.fromArray(t.orientation),c.updateMatrixWorld(),!1===i.isPresenting)return e;s.near=e.near,a.near=e.near,s.far=e.far,a.far=e.far,l.matrixWorld.copy(e.matrixWorld),l.matrixWorldInverse.copy(e.matrixWorldInverse),s.matrixWorldInverse.fromArray(r.leftViewMatrix),a.matrixWorldInverse.fromArray(r.rightViewMatrix);var h=c.parent;null!==h&&(o.getInverse(h.matrixWorld),s.matrixWorldInverse.multiply(o),a.matrixWorldInverse.multiply(o)),s.matrixWorld.getInverse(s.matrixWorldInverse),a.matrixWorld.getInverse(a.matrixWorldInverse),s.projectionMatrix.fromArray(r.leftProjectionMatrix),a.projectionMatrix.fromArray(r.rightProjectionMatrix),l.projectionMatrix.copy(s.projectionMatrix);var u=i.getLayers();if(u.length){var p=u[0];null!==p.leftBounds&&4===p.leftBounds.length&&s.bounds.fromArray(p.leftBounds),null!==p.rightBounds&&4===p.rightBounds.length&&a.bounds.fromArray(p.rightBounds)}return l},this.submitFrame=function(){i&&i.isPresenting&&i.submitFrame()},this.dispose=function(){"undefined"!=typeof window&&window.removeEventListener("vrdisplaypresentchange",u)}}function Qi(e){var t={};return{get:function(i){if(void 0!==t[i])return t[i];var r;switch(i){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":r=e.getExtension("WEBGL_compressed_texture_etc1");break;default:r=e.getExtension(i)}return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),t[i]=r,r}}}function Ki(){var e=this,t=null,i=0,r=!1,n=!1,o=new bt,s=new re,a={value:null,needsUpdate:!1};function c(){a.value!==t&&(a.value=t,a.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function h(t,i,r,n){var c=null!==t?t.length:0,h=null;if(0!==c){if(h=a.value,!0!==n||null===h){var l=r+4*c,u=i.matrixWorldInverse;s.getNormalMatrix(u),(null===h||h.length<l)&&(h=new Float32Array(l));for(var p=0,d=r;p!==c;++p,d+=4)o.copy(t[p]).applyMatrix4(u,s),o.normal.toArray(h,d),h[d+3]=o.constant}a.value=h,a.needsUpdate=!0}return e.numPlanes=c,h}this.uniform=a,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var s=0!==e.length||n||0!==i||r;return r=n,t=h(e,o,0),i=e.length,s},this.beginShadows=function(){n=!0,h(null)},this.endShadows=function(){n=!1,c()},this.setState=function(e,o,s,l,u,p){if(!r||null===e||0===e.length||n&&!s)n?h(null):c();else{var d=n?0:i,f=4*d,m=u.clippingState||null;a.value=m,m=h(e,l,f,p);for(var v=0;v!==f;++v)m[v]=t[v];u.clippingState=m,this.numIntersection=o?this.numPlanes:0,this.numPlanes+=d}}}function $i(e,t){return{convert:function(i){var r;if(i===g)return e.REPEAT;if(i===y)return e.CLAMP_TO_EDGE;if(i===b)return e.MIRRORED_REPEAT;if(i===x)return e.NEAREST;if(i===w)return e.NEAREST_MIPMAP_NEAREST;if(i===_)return e.NEAREST_MIPMAP_LINEAR;if(i===M)return e.LINEAR;if(i===E)return e.LINEAR_MIPMAP_NEAREST;if(i===T)return e.LINEAR_MIPMAP_LINEAR;if(i===S)return e.UNSIGNED_BYTE;if(1017===i)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return e.UNSIGNED_SHORT_5_5_5_1;if(1019===i)return e.UNSIGNED_SHORT_5_6_5;if(1010===i)return e.BYTE;if(1011===i)return e.SHORT;if(i===A)return e.UNSIGNED_SHORT;if(1013===i)return e.INT;if(i===L)return e.UNSIGNED_INT;if(i===R)return e.FLOAT;if(i===C&&null!==(r=t.get("OES_texture_half_float")))return r.HALF_FLOAT_OES;if(1021===i)return e.ALPHA;if(i===N)return e.RGB;if(i===O)return e.RGBA;if(1024===i)return e.LUMINANCE;if(1025===i)return e.LUMINANCE_ALPHA;if(i===I)return e.DEPTH_COMPONENT;if(i===D)return e.DEPTH_STENCIL;if(100===i)return e.FUNC_ADD;if(101===i)return e.FUNC_SUBTRACT;if(102===i)return e.FUNC_REVERSE_SUBTRACT;if(200===i)return e.ZERO;if(201===i)return e.ONE;if(202===i)return e.SRC_COLOR;if(203===i)return e.ONE_MINUS_SRC_COLOR;if(204===i)return e.SRC_ALPHA;if(205===i)return e.ONE_MINUS_SRC_ALPHA;if(206===i)return e.DST_ALPHA;if(207===i)return e.ONE_MINUS_DST_ALPHA;if(208===i)return e.DST_COLOR;if(209===i)return e.ONE_MINUS_DST_COLOR;if(210===i)return e.SRC_ALPHA_SATURATE;if((i===U||i===F||i===k||i===B)&&null!==(r=t.get("WEBGL_compressed_texture_s3tc"))){if(i===U)return r.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===F)return r.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===k)return r.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===B)return r.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((i===z||i===G||i===j||i===V)&&null!==(r=t.get("WEBGL_compressed_texture_pvrtc"))){if(i===z)return r.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===G)return r.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===j)return r.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===V)return r.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(2151===i&&null!==(r=t.get("WEBGL_compressed_texture_etc1")))return r.COMPRESSED_RGB_ETC1_WEBGL;if((103===i||104===i)&&null!==(r=t.get("EXT_blend_minmax"))){if(103===i)return r.MIN_EXT;if(104===i)return r.MAX_EXT}return i===P&&null!==(r=t.get("WEBGL_depth_texture"))?r.UNSIGNED_INT_24_8_WEBGL:0}}}function er(e){console.log("THREE.WebGLRenderer","89");var t=void 0!==(e=e||{}).canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),i=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,n=void 0===e.depth||e.depth,o=void 0===e.stencil||e.stencil,s=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,c=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,h=void 0!==e.powerPreference?e.powerPreference:"default",l=[],u=[],p=null,d=[],f=[];this.domElement=t,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=1,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var m,v,g,y,b,x,w,_,M,E,T,A,L,P,N,I,D,U,F,k=this,B=!1,z=null,G=null,j=-1,V="",H=null,W=null,X=new se,q=new se,Y=null,Z=0,J=t.width,Q=t.height,$=1,te=new se(0,0,J,Q),re=new se(0,0,J,Q),ne=!1,oe=new xt,ae=new Ki,ce=!1,le=!1,ue=new ee,pe=new ie,de={geometries:0,textures:0},fe={frame:0,calls:0,vertices:0,faces:0,points:0};function me(){return null===z?$:1}this.info={render:fe,memory:de,programs:null};try{var ve={alpha:r,depth:n,stencil:o,antialias:s,premultipliedAlpha:a,preserveDrawingBuffer:c,powerPreference:h};if(t.addEventListener("webglcontextlost",xe,!1),t.addEventListener("webglcontextrestored",we,!1),null===(m=i||t.getContext("webgl",ve)||t.getContext("experimental-webgl",ve)))throw null!==t.getContext("webgl")?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");void 0===m.getShaderPrecisionFormat&&(m.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){console.error("THREE.WebGLRenderer: "+e.message)}function ge(){(v=new Qi(m)).get("WEBGL_depth_texture"),v.get("OES_texture_float"),v.get("OES_texture_float_linear"),v.get("OES_texture_half_float"),v.get("OES_texture_half_float_linear"),v.get("OES_standard_derivatives"),v.get("OES_element_index_uint"),v.get("ANGLE_instanced_arrays"),F=new $i(m,v),g=new qi(m,v,e),(y=new Xi(m,v,F)).scissor(q.copy(re).multiplyScalar($)),y.viewport(X.copy(te).multiplyScalar($)),b=new Wi,x=new Hi(m,v,y,b,g,F,de),w=new _t(m),_=new Mi(m,w,de),M=new Si(_,fe),P=new xi(m),T=new Vi(k,v,g),E=new Ti,A=new yi,L=new fi(k,y,_,a),N=new _i(m,v,fe),I=new wi(m,v,fe),D=new rt(k,m,y,x,g),U=new ot(k,m,y,x,g),k.info.programs=T.programs,k.context=m,k.capabilities=g,k.extensions=v,k.properties=b,k.renderLists=A,k.state=y}ge();var ye=new Ji(k);this.vr=ye;var be=new wt(k,M,g.maxTextureSize);function xe(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),B=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),B=!1,ge()}function _e(e){var t=e.target;t.removeEventListener("dispose",_e),function(e){Me(e),b.remove(e)}(t)}function Me(e){var t=b.get(e).program;e.program=void 0,void 0!==t&&T.releaseProgram(t)}this.shadowMap=be,this.getContext=function(){return m},this.getContextAttributes=function(){return m.getContextAttributes()},this.forceContextLoss=function(){var e=v.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=v.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return $},this.setPixelRatio=function(e){void 0!==e&&($=e,this.setSize(J,Q,!1))},this.getSize=function(){return{width:J,height:Q}},this.setSize=function(e,i,r){var n=ye.getDevice();n&&n.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(J=e,Q=i,t.width=e*$,t.height=i*$,!1!==r&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(){return{width:J*$,height:Q*$}},this.setDrawingBufferSize=function(e,i,r){J=e,Q=i,$=r,t.width=e*r,t.height=i*r,this.setViewport(0,0,e,i)},this.setViewport=function(e,t,i,r){te.set(e,Q-t-r,i,r),y.viewport(X.copy(te).multiplyScalar($))},this.setScissor=function(e,t,i,r){re.set(e,Q-t-r,i,r),y.scissor(q.copy(re).multiplyScalar($))},this.setScissorTest=function(e){y.setScissorTest(ne=e)},this.getClearColor=function(){return L.getClearColor()},this.setClearColor=function(){L.setClearColor.apply(L,arguments)},this.getClearAlpha=function(){return L.getClearAlpha()},this.setClearAlpha=function(){L.setClearAlpha.apply(L,arguments)},this.clear=function(e,t,i){var r=0;(void 0===e||e)&&(r|=m.COLOR_BUFFER_BIT),(void 0===t||t)&&(r|=m.DEPTH_BUFFER_BIT),(void 0===i||i)&&(r|=m.STENCIL_BUFFER_BIT),m.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,i,r){this.setRenderTarget(e),this.clear(t,i,r)},this.dispose=function(){t.removeEventListener("webglcontextlost",xe,!1),t.removeEventListener("webglcontextrestored",we,!1),A.dispose(),ye.dispose()},this.renderBufferImmediate=function(e,t,i){y.initAttributes();var r=b.get(e);e.hasPositions&&!r.position&&(r.position=m.createBuffer()),e.hasNormals&&!r.normal&&(r.normal=m.createBuffer()),e.hasUvs&&!r.uv&&(r.uv=m.createBuffer()),e.hasColors&&!r.color&&(r.color=m.createBuffer());var n=t.getAttributes();if(e.hasPositions&&(m.bindBuffer(m.ARRAY_BUFFER,r.position),m.bufferData(m.ARRAY_BUFFER,e.positionArray,m.DYNAMIC_DRAW),y.enableAttribute(n.position),m.vertexAttribPointer(n.position,3,m.FLOAT,!1,0,0)),e.hasNormals){if(m.bindBuffer(m.ARRAY_BUFFER,r.normal),!i.isMeshPhongMaterial&&!i.isMeshStandardMaterial&&!i.isMeshNormalMaterial&&!0===i.flatShading)for(var o=0,s=3*e.count;o<s;o+=9){var a=e.normalArray,c=(a[o+0]+a[o+3]+a[o+6])/3,h=(a[o+1]+a[o+4]+a[o+7])/3,l=(a[o+2]+a[o+5]+a[o+8])/3;a[o+0]=c,a[o+1]=h,a[o+2]=l,a[o+3]=c,a[o+4]=h,a[o+5]=l,a[o+6]=c,a[o+7]=h,a[o+8]=l}m.bufferData(m.ARRAY_BUFFER,e.normalArray,m.DYNAMIC_DRAW),y.enableAttribute(n.normal),m.vertexAttribPointer(n.normal,3,m.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(m.bindBuffer(m.ARRAY_BUFFER,r.uv),m.bufferData(m.ARRAY_BUFFER,e.uvArray,m.DYNAMIC_DRAW),y.enableAttribute(n.uv),m.vertexAttribPointer(n.uv,2,m.FLOAT,!1,0,0)),e.hasColors&&0!==i.vertexColors&&(m.bindBuffer(m.ARRAY_BUFFER,r.color),m.bufferData(m.ARRAY_BUFFER,e.colorArray,m.DYNAMIC_DRAW),y.enableAttribute(n.color),m.vertexAttribPointer(n.color,3,m.FLOAT,!1,0,0)),y.disableUnusedAttributes(),m.drawArrays(m.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,r,n,o){var s=n.isMesh&&n.matrixWorld.determinant()<0;y.setMaterial(r,s);var a=Ne(e,t,r,n),c=i.id+"_"+a.id+"_"+(!0===r.wireframe),h=!1;c!==V&&(V=c,h=!0),n.morphTargetInfluences&&(P.update(n,i,r,a),h=!0);var l,u=i.index,p=i.attributes.position,d=1;!0===r.wireframe&&(u=_.getWireframeAttribute(i),d=2);var f=N;null!==u&&(l=w.get(u),(f=I).setIndex(l)),h&&(!function(e,t,i,r){if(i&&i.isInstancedBufferGeometry&&null===v.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===r&&(r=0);y.initAttributes();var n=i.attributes,o=t.getAttributes(),s=e.defaultAttributeValues;for(var a in o){var c=o[a];if(c>=0){var h=n[a];if(void 0!==h){var l=h.normalized,u=h.itemSize,p=w.get(h);if(void 0===p)continue;var d=p.buffer,f=p.type,g=p.bytesPerElement;if(h.isInterleavedBufferAttribute){var b=h.data,x=b.stride,_=h.offset;b&&b.isInstancedInterleavedBuffer?(y.enableAttributeAndDivisor(c,b.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=b.meshPerAttribute*b.count)):y.enableAttribute(c),m.bindBuffer(m.ARRAY_BUFFER,d),m.vertexAttribPointer(c,u,f,l,x*g,(r*x+_)*g)}else h.isInstancedBufferAttribute?(y.enableAttributeAndDivisor(c,h.meshPerAttribute),void 0===i.maxInstancedCount&&(i.maxInstancedCount=h.meshPerAttribute*h.count)):y.enableAttribute(c),m.bindBuffer(m.ARRAY_BUFFER,d),m.vertexAttribPointer(c,u,f,l,0,r*u*g)}else if(void 0!==s){var M=s[a];if(void 0!==M)switch(M.length){case 2:m.vertexAttrib2fv(c,M);break;case 3:m.vertexAttrib3fv(c,M);break;case 4:m.vertexAttrib4fv(c,M);break;default:m.vertexAttrib1fv(c,M)}}}}y.disableUnusedAttributes()}(r,a,i),null!==u&&m.bindBuffer(m.ELEMENT_ARRAY_BUFFER,l.buffer));var g=0;null!==u?g=u.count:void 0!==p&&(g=p.count);var b=i.drawRange.start*d,x=i.drawRange.count*d,M=null!==o?o.start*d:0,E=null!==o?o.count*d:1/0,T=Math.max(b,M),S=Math.min(g,b+x,M+E)-1,A=Math.max(0,S-T+1);if(0!==A){if(n.isMesh)if(!0===r.wireframe)y.setLineWidth(r.wireframeLinewidth*me()),f.setMode(m.LINES);else switch(n.drawMode){case 0:f.setMode(m.TRIANGLES);break;case 1:f.setMode(m.TRIANGLE_STRIP);break;case 2:f.setMode(m.TRIANGLE_FAN)}else if(n.isLine){var L=r.linewidth;void 0===L&&(L=1),y.setLineWidth(L*me()),n.isLineSegments?f.setMode(m.LINES):n.isLineLoop?f.setMode(m.LINE_LOOP):f.setMode(m.LINE_STRIP)}else n.isPoints&&f.setMode(m.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&f.renderInstances(i,T,A):f.render(T,A)}},this.compile=function(e,t){l.length=0,u.length=0,e.traverse((function(e){e.isLight&&(l.push(e),e.castShadow&&u.push(e))})),E.setup(l,u,t),e.traverse((function(t){if(t.material)if(Array.isArray(t.material))for(var i=0;i<t.material.length;i++)Pe(t.material[i],e.fog,t);else Pe(t.material,e.fog,t)}))};var Ee,Te=!1,Se=null;function Ae(e){null!==Se&&Se(e);var t=ye.getDevice();t&&t.isPresenting?t.requestAnimationFrame(Ae):window.requestAnimationFrame(Ae)}function Le(e,t,i){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isLight)l.push(e),e.castShadow&&u.push(e);else if(e.isSprite)e.frustumCulled&&!oe.intersectsSprite(e)||d.push(e);else if(e.isLensFlare)f.push(e);else if(e.isImmediateRenderObject)i&&pe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue),p.push(e,null,e.material,pe.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||oe.intersectsObject(e))){i&&pe.setFromMatrixPosition(e.matrixWorld).applyMatrix4(ue);var r=M.update(e),n=e.material;if(Array.isArray(n))for(var o=r.groups,s=0,a=o.length;s<a;s++){var c=o[s],h=n[c.materialIndex];h&&h.visible&&p.push(e,r,h,pe.z,c)}else n.visible&&p.push(e,r,n,pe.z,null)}var m=e.children;for(s=0,a=m.length;s<a;s++)Le(m[s],t,i)}}function Re(e,t,i,r){for(var n=0,o=e.length;n<o;n++){var s=e[n],a=s.object,c=s.geometry,h=void 0===r?s.material:r,l=s.group;if(i.isArrayCamera){W=i;for(var u=i.cameras,p=0,d=u.length;p<d;p++){var f=u[p];if(a.layers.test(f.layers)){var m=f.bounds,v=m.x*J,g=m.y*Q,b=m.z*J,x=m.w*Q;y.viewport(X.set(v,g,b,x).multiplyScalar($)),Ce(a,t,f,c,h,l)}}}else W=null,Ce(a,t,i,c,h,l)}}function Ce(e,t,i,r,n,o){if(e.onBeforeRender(k,t,i,r,n,o),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var s=e.isMesh&&e.matrixWorld.determinant()<0;y.setMaterial(n,s);var a=Ne(i,t.fog,n,e);V="",function(e,t,i){e.render((function(e){k.renderBufferImmediate(e,t,i)}))}(e,a,n)}else k.renderBufferDirect(i,t.fog,r,n,e,o);e.onAfterRender(k,t,i,r,n,o)}function Pe(e,t,i){var r=b.get(e),n=T.getParameters(e,E.state,u,t,ae.numPlanes,ae.numIntersection,i),o=T.getProgramCode(e,n),s=r.program,a=!0;if(void 0===s)e.addEventListener("dispose",_e);else if(s.code!==o)Me(e);else{if(void 0!==n.shaderID)return;a=!1}if(a){if(n.shaderID){var c=tt[n.shaderID];r.shader={name:e.type,uniforms:$e.clone(c.uniforms),vertexShader:c.vertexShader,fragmentShader:c.fragmentShader}}else r.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(r.shader),s=T.acquireProgram(e,r.shader,n,o),r.program=s,e.program=s}var h=s.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var l=0;l<k.maxMorphTargets;l++)h["morphTarget"+l]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(l=0;l<k.maxMorphNormals;l++)h["morphNormal"+l]>=0&&e.numSupportedMorphNormals++}var p=r.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=ae.numPlanes,r.numIntersection=ae.numIntersection,p.clippingPlanes=ae.uniform),r.fog=t,r.lightsHash=E.state.hash,e.lights&&(p.ambientLightColor.value=E.state.ambient,p.directionalLights.value=E.state.directional,p.spotLights.value=E.state.spot,p.rectAreaLights.value=E.state.rectArea,p.pointLights.value=E.state.point,p.hemisphereLights.value=E.state.hemi,p.directionalShadowMap.value=E.state.directionalShadowMap,p.directionalShadowMatrix.value=E.state.directionalShadowMatrix,p.spotShadowMap.value=E.state.spotShadowMap,p.spotShadowMatrix.value=E.state.spotShadowMatrix,p.pointShadowMap.value=E.state.pointShadowMap,p.pointShadowMatrix.value=E.state.pointShadowMatrix);var d=r.program.getUniforms(),f=Ze.seqWithValue(d.seq,p);r.uniformsList=f}function Ne(e,t,i,r){Z=0;var n=b.get(i);if(ce&&(le||e!==H)){var o=e===H&&i.id===j;ae.setState(i.clippingPlanes,i.clipIntersection,i.clipShadows,e,n,o)}!1===i.needsUpdate&&(void 0===n.program||i.fog&&n.fog!==t||i.lights&&n.lightsHash!==E.state.hash?i.needsUpdate=!0:void 0===n.numClippingPlanes||n.numClippingPlanes===ae.numPlanes&&n.numIntersection===ae.numIntersection||(i.needsUpdate=!0)),i.needsUpdate&&(Pe(i,t,r),i.needsUpdate=!1);var s=!1,a=!1,c=!1,h=n.program,l=h.getUniforms(),u=n.shader.uniforms;if(y.useProgram(h.program)&&(s=!0,a=!0,c=!0),i.id!==j&&(j=i.id,a=!0),s||e!==H){if(l.setValue(m,"projectionMatrix",e.projectionMatrix),g.logarithmicDepthBuffer&&l.setValue(m,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),H!==(W||e)&&(H=W||e,a=!0,c=!0),i.isShaderMaterial||i.isMeshPhongMaterial||i.isMeshStandardMaterial||i.envMap){var p=l.map.cameraPosition;void 0!==p&&p.setValue(m,pe.setFromMatrixPosition(e.matrixWorld))}(i.isMeshPhongMaterial||i.isMeshLambertMaterial||i.isMeshBasicMaterial||i.isMeshStandardMaterial||i.isShaderMaterial||i.skinning)&&l.setValue(m,"viewMatrix",e.matrixWorldInverse)}if(i.skinning){l.setOptional(m,r,"bindMatrix"),l.setOptional(m,r,"bindMatrixInverse");var d=r.skeleton;if(d){var f=d.bones;if(g.floatVertexTextures){if(void 0===d.boneTexture){var v=Math.sqrt(4*f.length);v=K.ceilPowerOfTwo(v),v=Math.max(v,4);var x=new Float32Array(v*v*4);x.set(d.boneMatrices);var w=new he(x,v,v,O,R);d.boneMatrices=x,d.boneTexture=w,d.boneTextureSize=v}l.setValue(m,"boneTexture",d.boneTexture),l.setValue(m,"boneTextureSize",d.boneTextureSize)}else l.setOptional(m,d,"boneMatrices")}}return a&&(l.setValue(m,"toneMappingExposure",k.toneMappingExposure),l.setValue(m,"toneMappingWhitePoint",k.toneMappingWhitePoint),i.lights&&function(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}(u,c),t&&i.fog&&function(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}(u,t),i.isMeshBasicMaterial?Oe(u,i):i.isMeshLambertMaterial?(Oe(u,i),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(u,i)):i.isMeshPhongMaterial?(Oe(u,i),i.isMeshToonMaterial?function(e,t){Ie(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(u,i):Ie(u,i)):i.isMeshStandardMaterial?(Oe(u,i),i.isMeshPhysicalMaterial?function(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,De(e,t)}(u,i):De(u,i)):i.isMeshDepthMaterial?(Oe(u,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(u,i)):i.isMeshDistanceMaterial?(Oe(u,i),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(u,i)):i.isMeshNormalMaterial?(Oe(u,i),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale);t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(u,i)):i.isLineBasicMaterial?(function(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}(u,i),i.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(u,i)):i.isPointsMaterial?function(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*$,e.scale.value=.5*Q,e.map.value=t.map,null!==t.map){if(!0===t.map.matrixAutoUpdate){var i=t.map.offset,r=t.map.repeat,n=t.map.rotation,o=t.map.center;t.map.matrix.setUvTransform(i.x,i.y,r.x,r.y,n,o.x,o.y)}e.uvTransform.value.copy(t.map.matrix)}}(u,i):i.isShadowMaterial&&(u.color.value=i.color,u.opacity.value=i.opacity),void 0!==u.ltcMat&&(u.ltcMat.value=Ke.LTC_MAT_TEXTURE),void 0!==u.ltcMag&&(u.ltcMag.value=Ke.LTC_MAG_TEXTURE),Ze.upload(m,n.uniformsList,u,k)),l.setValue(m,"modelViewMatrix",r.modelViewMatrix),l.setValue(m,"normalMatrix",r.normalMatrix),l.setValue(m,"modelMatrix",r.matrixWorld),h}function Oe(e,t){var i;if(e.opacity.value=t.opacity,t.color&&(e.diffuse.value=t.color),t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),t.map&&(e.map.value=t.map),t.alphaMap&&(e.alphaMap.value=t.alphaMap),t.specularMap&&(e.specularMap.value=t.specularMap),t.envMap&&(e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio),t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity),t.map?i=t.map:t.specularMap?i=t.specularMap:t.displacementMap?i=t.displacementMap:t.normalMap?i=t.normalMap:t.bumpMap?i=t.bumpMap:t.roughnessMap?i=t.roughnessMap:t.metalnessMap?i=t.metalnessMap:t.alphaMap?i=t.alphaMap:t.emissiveMap&&(i=t.emissiveMap),void 0!==i){if(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate){var r=i.offset,n=i.repeat,o=i.rotation,s=i.center;i.matrix.setUvTransform(r.x,r.y,n.x,n.y,o,s.x,s.y)}e.uvTransform.value.copy(i.matrix)}}function Ie(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function De(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}this.animate=function(e){Se=e,function(){if(!Te){var e=ye.getDevice();e&&e.isPresenting?e.requestAnimationFrame(Ae):window.requestAnimationFrame(Ae),Te=!0}}()},this.render=function(e,t,i,r){if(t&&t.isCamera){if(!B){V="",j=-1,H=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),ye.enabled&&(t=ye.getCamera(t)),ue.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),oe.setFromMatrix(ue),l.length=0,u.length=0,d.length=0,f.length=0,le=this.localClippingEnabled,ce=ae.init(this.clippingPlanes,le,t),(p=A.get(e,t)).init(),Le(e,t,k.sortObjects),!0===k.sortObjects&&p.sort(),x.updateVideoTextures(),ce&&ae.beginShadows(),be.render(u,e,t),E.setup(l,u,t),ce&&ae.endShadows(),fe.frame++,fe.calls=0,fe.vertices=0,fe.faces=0,fe.points=0,void 0===i&&(i=null),this.setRenderTarget(i),L.render(p,e,t,r);var n=p.opaque,o=p.transparent;if(e.overrideMaterial){var s=e.overrideMaterial;n.length&&Re(n,e,t,s),o.length&&Re(o,e,t,s)}else n.length&&Re(n,e,t),o.length&&Re(o,e,t);U.render(d,e,t),D.render(f,e,t,X),i&&x.updateRenderTargetMipmap(i),y.buffers.depth.setTest(!0),y.buffers.depth.setMask(!0),y.buffers.color.setMask(!0),y.setPolygonOffset(!1),ye.enabled&&ye.submitFrame()}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFaceCulling=function(e,t){y.setCullFace(e),y.setFlipSided(0===t)},this.allocTextureUnit=function(){var e=Z;return e>=g.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+g.maxTextures),Z+=1,e},this.setTexture2D=(Ee=!1,function(e,t){e&&e.isWebGLRenderTarget&&(Ee||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),Ee=!0),e=e.texture),x.setTexture2D(e,t)}),this.setTexture=function(){var e=!1;return function(t,i){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),x.setTexture2D(t,i)}}(),this.setTextureCube=function(){var e=!1;return function(t,i){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?x.setTextureCube(t,i):x.setTextureCubeDynamic(t,i)}}(),this.getRenderTarget=function(){return z},this.setRenderTarget=function(e){z=e,e&&void 0===b.get(e).__webglFramebuffer&&x.setupRenderTarget(e);var t=null,i=!1;if(e){var r=b.get(e).__webglFramebuffer;e.isWebGLRenderTargetCube?(t=r[e.activeCubeFace],i=!0):t=r,X.copy(e.viewport),q.copy(e.scissor),Y=e.scissorTest}else X.copy(te).multiplyScalar($),q.copy(re).multiplyScalar($),Y=ne;if(G!==t&&(m.bindFramebuffer(m.FRAMEBUFFER,t),G=t),y.viewport(X),y.scissor(q),y.setScissorTest(Y),i){var n=b.get(e.texture);m.framebufferTexture2D(m.FRAMEBUFFER,m.COLOR_ATTACHMENT0,m.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,n.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,i,r,n,o){if(e&&e.isWebGLRenderTarget){var s=b.get(e).__webglFramebuffer;if(s){var a=!1;s!==G&&(m.bindFramebuffer(m.FRAMEBUFFER,s),a=!0);try{var c=e.texture,h=c.format,l=c.type;if(h!==O&&F.convert(h)!==m.getParameter(m.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(l===S||F.convert(l)===m.getParameter(m.IMPLEMENTATION_COLOR_READ_TYPE)||l===R&&(v.get("OES_texture_float")||v.get("WEBGL_color_buffer_float"))||l===C&&v.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");m.checkFramebufferStatus(m.FRAMEBUFFER)===m.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-r&&i>=0&&i<=e.height-n&&m.readPixels(t,i,r,n,F.convert(h),F.convert(l),o):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{a&&m.bindFramebuffer(m.FRAMEBUFFER,G)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")}}function tr(e,t){this.name="",this.color=new Qe(e),this.density=void 0!==t?t:25e-5}function ir(e,t,i){this.name="",this.color=new Qe(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3}function rr(){Ct.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function nr(e,t,i,r,n){Ct.call(this),this.lensFlares=[],this.positionScreen=new ie,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,r,n)}function or(e){ft.call(this),this.type="SpriteMaterial",this.color=new Qe(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function sr(e){Ct.call(this),this.type="Sprite",this.material=void 0!==e?e:new or}function ar(){Ct.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function cr(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var i=0,r=this.bones.length;i<r;i++)this.boneInverses.push(new ee)}}function hr(){Ct.call(this),this.type="Bone"}function lr(e,t){di.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new ee,this.bindMatrixInverse=new ee;var i=new cr(this.initBones());this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function ur(e){ft.call(this),this.type="LineBasicMaterial",this.color=new Qe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function pr(e,t,i){if(1===i)return console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new dr(e,t);Ct.call(this),this.type="Line",this.geometry=void 0!==e?e:new ri,this.material=void 0!==t?t:new ur({color:16777215*Math.random()})}function dr(e,t){pr.call(this,e,t),this.type="LineSegments"}function fr(e,t){pr.call(this,e,t),this.type="LineLoop"}function mr(e){ft.call(this),this.type="PointsMaterial",this.color=new Qe(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function vr(e,t){Ct.call(this),this.type="Points",this.geometry=void 0!==e?e:new ri,this.material=void 0!==t?t:new mr({color:16777215*Math.random()})}function gr(){Ct.call(this),this.type="Group"}function yr(e,t,i,r,n,o,s,a,c){oe.call(this,e,t,i,r,n,o,s,a,c),this.generateMipmaps=!1;var h=this;e.addEventListener("loadeddata",(function t(){e.removeEventListener("loadeddata",t,!1),h.needsUpdate=!0}),!1)}function br(e,t,i,r,n,o,s,a,c,h,l,u){oe.call(this,null,o,s,a,c,h,r,n,l,u),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function xr(e,t,i,r,n,o,s,a,c,h){if((h=void 0!==h?h:I)!==I&&h!==D)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&h===I&&(i=A),void 0===i&&h===D&&(i=P),oe.call(this,null,r,n,o,s,a,h,i,c),this.image={width:e,height:t},this.magFilter=void 0!==s?s:x,this.minFilter=void 0!==a?a:x,this.flipY=!1,this.generateMipmaps=!1}function wr(e){ri.call(this),this.type="WireframeGeometry";var t,i,r,n,o,s,a,c,h,l,u=[],p=[0,0],d={},f=["a","b","c"];if(e&&e.isGeometry){var m=e.faces;for(t=0,r=m.length;t<r;t++){var v=m[t];for(i=0;i<3;i++)a=v[f[i]],c=v[f[(i+1)%3]],p[0]=Math.min(a,c),p[1]=Math.max(a,c),void 0===d[h=p[0]+","+p[1]]&&(d[h]={index1:p[0],index2:p[1]})}for(h in d)s=d[h],l=e.vertices[s.index1],u.push(l.x,l.y,l.z),l=e.vertices[s.index2],u.push(l.x,l.y,l.z)}else if(e&&e.isBufferGeometry){var g,y,b,x,w,_,M;if(l=new ie,null!==e.index){for(g=e.attributes.position,y=e.index,0===(b=e.groups).length&&(b=[{start:0,count:y.count,materialIndex:0}]),n=0,o=b.length;n<o;++n)for(t=w=(x=b[n]).start,r=w+x.count;t<r;t+=3)for(i=0;i<3;i++)a=y.getX(t+i),c=y.getX(t+(i+1)%3),p[0]=Math.min(a,c),p[1]=Math.max(a,c),void 0===d[h=p[0]+","+p[1]]&&(d[h]={index1:p[0],index2:p[1]});for(h in d)s=d[h],l.fromBufferAttribute(g,s.index1),u.push(l.x,l.y,l.z),l.fromBufferAttribute(g,s.index2),u.push(l.x,l.y,l.z)}else for(t=0,r=(g=e.attributes.position).count/3;t<r;t++)for(i=0;i<3;i++)_=3*t+i,l.fromBufferAttribute(g,_),u.push(l.x,l.y,l.z),M=3*t+(i+1)%3,l.fromBufferAttribute(g,M),u.push(l.x,l.y,l.z)}this.addAttribute("position",new Wt(u,3))}function _r(e,t,i){Ut.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:i},this.fromBufferGeometry(new Mr(e,t,i)),this.mergeVertices()}function Mr(e,t,i){ri.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:i};var r,n,o=[],s=[],a=[],c=[],h=1e-5,l=new ie,u=new ie,p=new ie,d=new ie,f=new ie,m=t+1;for(r=0;r<=i;r++){var v=r/i;for(n=0;n<=t;n++){var g=n/t;u=e(g,v,u),s.push(u.x,u.y,u.z),g-h>=0?(p=e(g-h,v,p),d.subVectors(u,p)):(p=e(g+h,v,p),d.subVectors(p,u)),v-h>=0?(p=e(g,v-h,p),f.subVectors(u,p)):(p=e(g,v+h,p),f.subVectors(p,u)),l.crossVectors(d,f).normalize(),a.push(l.x,l.y,l.z),c.push(g,v)}}for(r=0;r<i;r++)for(n=0;n<t;n++){var y=r*m+n,b=r*m+n+1,x=(r+1)*m+n+1,w=(r+1)*m+n;o.push(y,b,w),o.push(b,x,w)}this.setIndex(o),this.addAttribute("position",new Wt(s,3)),this.addAttribute("normal",new Wt(a,3)),this.addAttribute("uv",new Wt(c,2))}function Er(e,t,i,r){Ut.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},this.fromBufferGeometry(new Tr(e,t,i,r)),this.mergeVertices()}function Tr(e,t,i,r){ri.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:r},i=i||1;var n=[],o=[];function s(e,t,i,r){var n,o,s=Math.pow(2,r),c=[];for(n=0;n<=s;n++){c[n]=[];var h=e.clone().lerp(i,n/s),l=t.clone().lerp(i,n/s),u=s-n;for(o=0;o<=u;o++)c[n][o]=0===o&&n===s?h:h.clone().lerp(l,o/u)}for(n=0;n<s;n++)for(o=0;o<2*(s-n)-1;o++){var p=Math.floor(o/2);o%2==0?(a(c[n][p+1]),a(c[n+1][p]),a(c[n][p])):(a(c[n][p+1]),a(c[n+1][p+1]),a(c[n+1][p]))}}function a(e){n.push(e.x,e.y,e.z)}function c(t,i){var r=3*t;i.x=e[r+0],i.y=e[r+1],i.z=e[r+2]}function h(e,t,i,r){r<0&&1===e.x&&(o[t]=e.x-1),0===i.x&&0===i.z&&(o[t]=r/2/Math.PI+.5)}function l(e){return Math.atan2(e.z,-e.x)}function u(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}!function(e){for(var i=new ie,r=new ie,n=new ie,o=0;o<t.length;o+=3)c(t[o+0],i),c(t[o+1],r),c(t[o+2],n),s(i,r,n,e)}(r=r||0),function(e){for(var t=new ie,i=0;i<n.length;i+=3)t.x=n[i+0],t.y=n[i+1],t.z=n[i+2],t.normalize().multiplyScalar(e),n[i+0]=t.x,n[i+1]=t.y,n[i+2]=t.z}(i),function(){for(var e=new ie,t=0;t<n.length;t+=3){e.x=n[t+0],e.y=n[t+1],e.z=n[t+2];var i=l(e)/2/Math.PI+.5,r=u(e)/Math.PI+.5;o.push(i,1-r)}(function(){for(var e=new ie,t=new ie,i=new ie,r=new ie,s=new $,a=new $,c=new $,u=0,p=0;u<n.length;u+=9,p+=6){e.set(n[u+0],n[u+1],n[u+2]),t.set(n[u+3],n[u+4],n[u+5]),i.set(n[u+6],n[u+7],n[u+8]),s.set(o[p+0],o[p+1]),a.set(o[p+2],o[p+3]),c.set(o[p+4],o[p+5]),r.copy(e).add(t).add(i).divideScalar(3);var d=l(r);h(s,p+0,e,d),h(a,p+2,t,d),h(c,p+4,i,d)}})(),function(){for(var e=0;e<o.length;e+=6){var t=o[e+0],i=o[e+2],r=o[e+4],n=Math.max(t,i,r),s=Math.min(t,i,r);n>.9&&s<.1&&(t<.2&&(o[e+0]+=1),i<.2&&(o[e+2]+=1),r<.2&&(o[e+4]+=1))}}()}(),this.addAttribute("position",new Wt(n,3)),this.addAttribute("normal",new Wt(n.slice(),3)),this.addAttribute("uv",new Wt(o,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Sr(e,t){Ut.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ar(e,t)),this.mergeVertices()}function Ar(e,t){Tr.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Lr(e,t){Ut.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Rr(e,t)),this.mergeVertices()}function Rr(e,t){Tr.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Cr(e,t){Ut.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Pr(e,t)),this.mergeVertices()}function Pr(e,t){var i=(1+Math.sqrt(5))/2,r=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1];Tr.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Nr(e,t){Ut.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Or(e,t)),this.mergeVertices()}function Or(e,t){var i=(1+Math.sqrt(5))/2,r=1/i,n=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-i,0,-r,i,0,r,-i,0,r,i,-r,-i,0,-r,i,0,r,-i,0,r,i,0,-i,0,-r,i,0,-r,-i,0,r,i,0,r];Tr.call(this,n,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Ir(e,t,i,r,n,o){Ut.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");var s=new Dr(e,t,i,r,n);this.tangents=s.tangents,this.normals=s.normals,this.binormals=s.binormals,this.fromBufferGeometry(s),this.mergeVertices()}function Dr(e,t,i,r,n){ri.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:r,closed:n},t=t||64,i=i||1,r=r||8,n=n||!1;var o=e.computeFrenetFrames(t,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;var s,a,c=new ie,h=new ie,l=new $,u=new ie,p=[],d=[],f=[],m=[];function v(n){u=e.getPointAt(n/t,u);var s=o.normals[n],l=o.binormals[n];for(a=0;a<=r;a++){var f=a/r*Math.PI*2,m=Math.sin(f),v=-Math.cos(f);h.x=v*s.x+m*l.x,h.y=v*s.y+m*l.y,h.z=v*s.z+m*l.z,h.normalize(),d.push(h.x,h.y,h.z),c.x=u.x+i*h.x,c.y=u.y+i*h.y,c.z=u.z+i*h.z,p.push(c.x,c.y,c.z)}}!function(){for(s=0;s<t;s++)v(s);v(!1===n?t:0),function(){for(s=0;s<=t;s++)for(a=0;a<=r;a++)l.x=s/t,l.y=a/r,f.push(l.x,l.y)}(),function(){for(a=1;a<=t;a++)for(s=1;s<=r;s++){var e=(r+1)*(a-1)+(s-1),i=(r+1)*a+(s-1),n=(r+1)*a+s,o=(r+1)*(a-1)+s;m.push(e,i,o),m.push(i,n,o)}}()}(),this.setIndex(m),this.addAttribute("position",new Wt(p,3)),this.addAttribute("normal",new Wt(d,3)),this.addAttribute("uv",new Wt(f,2))}function Ur(e,t,i,r,n,o,s){Ut.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},void 0!==s&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new Fr(e,t,i,r,n,o)),this.mergeVertices()}function Fr(e,t,i,r,n,o){ri.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:r,p:n,q:o},e=e||1,t=t||.4,i=Math.floor(i)||64,r=Math.floor(r)||8,n=n||2,o=o||3;var s,a,c=[],h=[],l=[],u=[],p=new ie,d=new ie,f=new ie,m=new ie,v=new ie,g=new ie,y=new ie;for(s=0;s<=i;++s){var b=s/i*n*Math.PI*2;for(A(b,n,o,e,f),A(b+.01,n,o,e,m),g.subVectors(m,f),y.addVectors(m,f),v.crossVectors(g,y),y.crossVectors(v,g),v.normalize(),y.normalize(),a=0;a<=r;++a){var x=a/r*Math.PI*2,w=-t*Math.cos(x),_=t*Math.sin(x);p.x=f.x+(w*y.x+_*v.x),p.y=f.y+(w*y.y+_*v.y),p.z=f.z+(w*y.z+_*v.z),h.push(p.x,p.y,p.z),d.subVectors(p,f).normalize(),l.push(d.x,d.y,d.z),u.push(s/i),u.push(a/r)}}for(a=1;a<=i;a++)for(s=1;s<=r;s++){var M=(r+1)*(a-1)+(s-1),E=(r+1)*a+(s-1),T=(r+1)*a+s,S=(r+1)*(a-1)+s;c.push(M,E,S),c.push(E,T,S)}function A(e,t,i,r,n){var o=Math.cos(e),s=Math.sin(e),a=i/t*e,c=Math.cos(a);n.x=r*(2+c)*.5*o,n.y=r*(2+c)*s*.5,n.z=r*Math.sin(a)*.5}this.setIndex(c),this.addAttribute("position",new Wt(h,3)),this.addAttribute("normal",new Wt(l,3)),this.addAttribute("uv",new Wt(u,2))}function kr(e,t,i,r,n){Ut.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},this.fromBufferGeometry(new Br(e,t,i,r,n)),this.mergeVertices()}function Br(e,t,i,r,n){ri.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:r,arc:n},e=e||1,t=t||.4,i=Math.floor(i)||8,r=Math.floor(r)||6,n=n||2*Math.PI;var o,s,a=[],c=[],h=[],l=[],u=new ie,p=new ie,d=new ie;for(o=0;o<=i;o++)for(s=0;s<=r;s++){var f=s/r*n,m=o/i*Math.PI*2;p.x=(e+t*Math.cos(m))*Math.cos(f),p.y=(e+t*Math.cos(m))*Math.sin(f),p.z=t*Math.sin(m),c.push(p.x,p.y,p.z),u.x=e*Math.cos(f),u.y=e*Math.sin(f),d.subVectors(p,u).normalize(),h.push(d.x,d.y,d.z),l.push(s/r),l.push(o/i)}for(o=1;o<=i;o++)for(s=1;s<=r;s++){var v=(r+1)*o+s-1,g=(r+1)*(o-1)+s-1,y=(r+1)*(o-1)+s,b=(r+1)*o+s;a.push(v,g,b),a.push(g,y,b)}this.setIndex(a),this.addAttribute("position",new Wt(c,3)),this.addAttribute("normal",new Wt(h,3)),this.addAttribute("uv",new Wt(l,2))}Yi.prototype=Object.assign(Object.create(Pt.prototype),{constructor:Yi,isPerspectiveCamera:!0,copy:function(e,t){return Pt.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*K.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*K.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*K.RAD2DEG*Math.atan(Math.tan(.5*K.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,i,r,n,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*K.DEG2RAD*this.fov)/this.zoom,i=2*t,r=this.aspect*i,n=-.5*r,o=this.view;if(null!==this.view&&this.view.enabled){var s=o.fullWidth,a=o.fullHeight;n+=o.offsetX*r/s,t-=o.offsetY*i/a,r*=o.width/s,i*=o.height/a}var c=this.filmOffset;0!==c&&(n+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+r,t,t-i,e,this.far)},toJSON:function(e){var t=Ct.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Zi.prototype=Object.assign(Object.create(Yi.prototype),{constructor:Zi,isArrayCamera:!0}),tr.prototype.isFogExp2=!0,tr.prototype.clone=function(){return new tr(this.color.getHex(),this.density)},tr.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},ir.prototype.isFog=!0,ir.prototype.clone=function(){return new ir(this.color.getHex(),this.near,this.far)},ir.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},rr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:rr,copy:function(e,t){return Ct.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=Ct.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),nr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:nr,isLensFlare:!0,copy:function(e){Ct.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,i=e.lensFlares.length;t<i;t++)this.lensFlares.push(e.lensFlares[t]);return this},add:function(e,t,i,r,n,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===n&&(n=new Qe(16777215)),void 0===r&&(r=1),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:0,opacity:o,color:n,blending:r})},updateLensFlares:function(){var e,t,i=this.lensFlares.length,r=2*-this.positionScreen.x,n=2*-this.positionScreen.y;for(e=0;e<i;e++)(t=this.lensFlares[e]).x=this.positionScreen.x+r*t.distance,t.y=this.positionScreen.y+n*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)}}),or.prototype=Object.create(ft.prototype),or.prototype.constructor=or,or.prototype.isSpriteMaterial=!0,or.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},sr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:sr,isSprite:!0,raycast:(Li=new ie,Ri=new ie,Ci=new ie,function(e,t){Ri.setFromMatrixPosition(this.matrixWorld),e.ray.closestPointToPoint(Ri,Li),Ci.setFromMatrixScale(this.matrixWorld);var i=Ci.x*Ci.y/4;if(!(Ri.distanceToSquared(Li)>i)){var r=e.ray.origin.distanceTo(Li);r<e.near||r>e.far||t.push({distance:r,point:Li.clone(),face:null,object:this})}}),clone:function(){return new this.constructor(this.material).copy(this)}}),ar.prototype=Object.assign(Object.create(Ct.prototype),{constructor:ar,copy:function(e){Ct.prototype.copy.call(this,e,!1);for(var t=e.levels,i=0,r=t.length;i<r;i++){var n=t[i];this.addLevel(n.object.clone(),n.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=this.levels,r=0;r<i.length&&!(t<i[r].distance);r++);i.splice(r,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,i=1,r=t.length;i<r&&!(e<t[i].distance);i++);return t[i-1].object},raycast:(Pi=new ie,function(e,t){Pi.setFromMatrixPosition(this.matrixWorld);var i=e.ray.origin.distanceTo(Pi);this.getObjectForDistance(i).raycast(e,t)}),update:function(){var e=new ie,t=new ie;return function(i){var r=this.levels;if(r.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);r[0].object.visible=!0;for(var o=1,s=r.length;o<s&&n>=r[o].distance;o++)r[o-1].object.visible=!1,r[o].object.visible=!0;for(;o<s;o++)r[o].object.visible=!1}}}(),toJSON:function(e){var t=Ct.prototype.toJSON.call(this,e);t.object.levels=[];for(var i=this.levels,r=0,n=i.length;r<n;r++){var o=i[r];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}),Object.assign(cr.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var i=new ee;this.bones[e]&&i.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(i)}},pose:function(){var e,t,i;for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,i=this.bones.length;t<i;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:(Ni=new ee,Oi=new ee,function(){for(var e=this.bones,t=this.boneInverses,i=this.boneMatrices,r=this.boneTexture,n=0,o=e.length;n<o;n++){var s=e[n]?e[n].matrixWorld:Oi;Ni.multiplyMatrices(s,t[n]),Ni.toArray(i,16*n)}void 0!==r&&(r.needsUpdate=!0)}),clone:function(){return new cr(this.bones,this.boneInverses)}}),hr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:hr,isBone:!0}),lr.prototype=Object.assign(Object.create(di.prototype),{constructor:lr,isSkinnedMesh:!0,initBones:function(){var e,t,i,r,n=[];if(this.geometry&&void 0!==this.geometry.bones){for(i=0,r=this.geometry.bones.length;i<r;i++)t=this.geometry.bones[i],e=new hr,n.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(i=0,r=this.geometry.bones.length;i<r;i++)-1!==(t=this.geometry.bones[i]).parent&&null!==t.parent&&void 0!==n[t.parent]?n[t.parent].add(n[i]):this.add(n[i])}return this.updateMatrixWorld(!0),n},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var i=this.geometry.skinWeights[t];(e=1/i.manhattanLength())!==1/0?i.multiplyScalar(e):i.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new se,n=this.geometry.attributes.skinWeight;for(t=0;t<n.count;t++)r.x=n.getX(t),r.y=n.getY(t),r.z=n.getZ(t),r.w=n.getW(t),(e=1/r.manhattanLength())!==1/0?r.multiplyScalar(e):r.set(1,0,0,0),n.setXYZW(t,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(e){di.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),ur.prototype=Object.create(ft.prototype),ur.prototype.constructor=ur,ur.prototype.isLineBasicMaterial=!0,ur.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},pr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:pr,isLine:!0,raycast:function(){var e=new ee,t=new li,i=new yt;return function(r,n){var o=r.linePrecision,s=o*o,a=this.geometry,c=this.matrixWorld;if(null===a.boundingSphere&&a.computeBoundingSphere(),i.copy(a.boundingSphere),i.applyMatrix4(c),!1!==r.ray.intersectsSphere(i)){e.getInverse(c),t.copy(r.ray).applyMatrix4(e);var h=new ie,l=new ie,u=new ie,p=new ie,d=this&&this.isLineSegments?2:1;if(a.isBufferGeometry){var f=a.index,m=a.attributes.position.array;if(null!==f)for(var v=f.array,g=0,y=v.length-1;g<y;g+=d){var b=v[g],x=v[g+1];if(h.fromArray(m,3*b),l.fromArray(m,3*x),!(t.distanceSqToSegment(h,l,p,u)>s))p.applyMatrix4(this.matrixWorld),(M=r.ray.origin.distanceTo(p))<r.near||M>r.far||n.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}else for(g=0,y=m.length/3-1;g<y;g+=d){if(h.fromArray(m,3*g),l.fromArray(m,3*g+3),!(t.distanceSqToSegment(h,l,p,u)>s))p.applyMatrix4(this.matrixWorld),(M=r.ray.origin.distanceTo(p))<r.near||M>r.far||n.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}else if(a.isGeometry){var w=a.vertices,_=w.length;for(g=0;g<_-1;g+=d){var M;if(!(t.distanceSqToSegment(w[g],w[g+1],p,u)>s))p.applyMatrix4(this.matrixWorld),(M=r.ray.origin.distanceTo(p))<r.near||M>r.far||n.push({distance:M,point:u.clone().applyMatrix4(this.matrixWorld),index:g,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),dr.prototype=Object.assign(Object.create(pr.prototype),{constructor:dr,isLineSegments:!0}),fr.prototype=Object.assign(Object.create(pr.prototype),{constructor:fr,isLineLoop:!0}),mr.prototype=Object.create(ft.prototype),mr.prototype.constructor=mr,mr.prototype.isPointsMaterial=!0,mr.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},vr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:vr,isPoints:!0,raycast:function(){var e=new ee,t=new li,i=new yt;return function(r,n){var o=this,s=this.geometry,a=this.matrixWorld,c=r.params.Points.threshold;if(null===s.boundingSphere&&s.computeBoundingSphere(),i.copy(s.boundingSphere),i.applyMatrix4(a),i.radius+=c,!1!==r.ray.intersectsSphere(i)){e.getInverse(a),t.copy(r.ray).applyMatrix4(e);var h=c/((this.scale.x+this.scale.y+this.scale.z)/3),l=h*h,u=new ie;if(s.isBufferGeometry){var p=s.index,d=s.attributes.position.array;if(null!==p)for(var f=p.array,m=0,v=f.length;m<v;m++){var g=f[m];u.fromArray(d,3*g),x(u,g)}else{m=0;for(var y=d.length/3;m<y;m++)u.fromArray(d,3*m),x(u,m)}}else{var b=s.vertices;for(m=0,y=b.length;m<y;m++)x(b[m],m)}}function x(e,i){var s=t.distanceSqToPoint(e);if(s<l){var c=t.closestPointToPoint(e);c.applyMatrix4(a);var h=r.ray.origin.distanceTo(c);if(h<r.near||h>r.far)return;n.push({distance:h,distanceToRay:Math.sqrt(s),point:c.clone(),index:i,face:null,object:o})}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),gr.prototype=Object.assign(Object.create(Ct.prototype),{constructor:gr,isGroup:!0}),yr.prototype=Object.assign(Object.create(oe.prototype),{constructor:yr,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),br.prototype=Object.create(oe.prototype),br.prototype.constructor=br,br.prototype.isCompressedTexture=!0,xr.prototype=Object.create(oe.prototype),xr.prototype.constructor=xr,xr.prototype.isDepthTexture=!0,wr.prototype=Object.create(ri.prototype),wr.prototype.constructor=wr,_r.prototype=Object.create(Ut.prototype),_r.prototype.constructor=_r,Mr.prototype=Object.create(ri.prototype),Mr.prototype.constructor=Mr,Er.prototype=Object.create(Ut.prototype),Er.prototype.constructor=Er,Tr.prototype=Object.create(ri.prototype),Tr.prototype.constructor=Tr,Sr.prototype=Object.create(Ut.prototype),Sr.prototype.constructor=Sr,Ar.prototype=Object.create(Tr.prototype),Ar.prototype.constructor=Ar,Lr.prototype=Object.create(Ut.prototype),Lr.prototype.constructor=Lr,Rr.prototype=Object.create(Tr.prototype),Rr.prototype.constructor=Rr,Cr.prototype=Object.create(Ut.prototype),Cr.prototype.constructor=Cr,Pr.prototype=Object.create(Tr.prototype),Pr.prototype.constructor=Pr,Nr.prototype=Object.create(Ut.prototype),Nr.prototype.constructor=Nr,Or.prototype=Object.create(Tr.prototype),Or.prototype.constructor=Or,Ir.prototype=Object.create(Ut.prototype),Ir.prototype.constructor=Ir,Dr.prototype=Object.create(ri.prototype),Dr.prototype.constructor=Dr,Ur.prototype=Object.create(Ut.prototype),Ur.prototype.constructor=Ur,Fr.prototype=Object.create(ri.prototype),Fr.prototype.constructor=Fr,kr.prototype=Object.create(Ut.prototype),kr.prototype.constructor=kr,Br.prototype=Object.create(ri.prototype),Br.prototype.constructor=Br;var zr=function(e,t,i){i=i||2;var r,n,o,s,a,c,h,l=t&&t.length,u=l?t[0]*i:e.length,p=Gr(e,0,u,i,!0),d=[];if(!p)return d;if(l&&(p=function(e,t,i,r){var n,o,s,a=[];for(n=0,o=t.length;n<o;n++)(s=Gr(e,t[n]*r,n<o-1?t[n+1]*r:e.length,r,!1))===s.next&&(s.steiner=!0),a.push(Qr(s));for(a.sort(Yr),n=0;n<a.length;n++)Zr(a[n],i),i=jr(i,i.next);return i}(e,t,p,i)),e.length>80*i){r=o=e[0],n=s=e[1];for(var f=i;f<u;f+=i)(a=e[f])<r&&(r=a),(c=e[f+1])<n&&(n=c),a>o&&(o=a),c>s&&(s=c);h=0!==(h=Math.max(o-r,s-n))?1/h:0}return Vr(p,d,i,r,n,h),d};function Gr(e,t,i,r,n){var o,s;if(n===function(e,t,i,r){for(var n=0,o=t,s=i-r;o<i;o+=r)n+=(e[s]-e[o])*(e[o+1]+e[s+1]),s=o;return n}(e,t,i,r)>0)for(o=t;o<i;o+=r)s=sn(o,e[o],e[o+1],s);else for(o=i-r;o>=t;o-=r)s=sn(o,e[o],e[o+1],s);return s&&tn(s,s.next)&&(an(s),s=s.next),s}function jr(e,t){if(!e)return e;t||(t=e);var i,r=e;do{if(i=!1,r.steiner||!tn(r,r.next)&&0!==en(r.prev,r,r.next))r=r.next;else{if(an(r),(r=t=r.prev)===r.next)break;i=!0}}while(i||r!==t);return t}function Vr(e,t,i,r,n,o,s){if(e){!s&&o&&function(e,t,i,r){var n=e;do{null===n.z&&(n.z=Jr(n.x,n.y,t,i,r)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==e);n.prevZ.nextZ=null,n.prevZ=null,function(e){var t,i,r,n,o,s,a,c,h=1;do{for(i=e,e=null,o=null,s=0;i;){for(s++,r=i,a=0,t=0;t<h&&(a++,r=r.nextZ);t++);for(c=h;a>0||c>0&&r;)0!==a&&(0===c||!r||i.z<=r.z)?(n=i,i=i.nextZ,a--):(n=r,r=r.nextZ,c--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=r}o.nextZ=null,h*=2}while(s>1)}(n)}(e,r,n,o);for(var a,c,h=e;e.prev!==e.next;)if(a=e.prev,c=e.next,o?Wr(e,r,n,o):Hr(e))t.push(a.i/i),t.push(e.i/i),t.push(c.i/i),an(e),e=c.next,h=c.next;else if((e=c)===h){s?1===s?Vr(e=Xr(e,t,i),t,i,r,n,o,2):2===s&&qr(e,t,i,r,n,o):Vr(jr(e),t,i,r,n,o,1);break}}}function Hr(e){var t=e.prev,i=e,r=e.next;if(en(t,i,r)>=0)return!1;for(var n=e.next.next;n!==e.prev;){if(Kr(t.x,t.y,i.x,i.y,r.x,r.y,n.x,n.y)&&en(n.prev,n,n.next)>=0)return!1;n=n.next}return!0}function Wr(e,t,i,r){var n=e.prev,o=e,s=e.next;if(en(n,o,s)>=0)return!1;for(var a=n.x<o.x?n.x<s.x?n.x:s.x:o.x<s.x?o.x:s.x,c=n.y<o.y?n.y<s.y?n.y:s.y:o.y<s.y?o.y:s.y,h=n.x>o.x?n.x>s.x?n.x:s.x:o.x>s.x?o.x:s.x,l=n.y>o.y?n.y>s.y?n.y:s.y:o.y>s.y?o.y:s.y,u=Jr(a,c,t,i,r),p=Jr(h,l,t,i,r),d=e.nextZ;d&&d.z<=p;){if(d!==e.prev&&d!==e.next&&Kr(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&en(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(d=e.prevZ;d&&d.z>=u;){if(d!==e.prev&&d!==e.next&&Kr(n.x,n.y,o.x,o.y,s.x,s.y,d.x,d.y)&&en(d.prev,d,d.next)>=0)return!1;d=d.prevZ}return!0}function Xr(e,t,i){var r=e;do{var n=r.prev,o=r.next.next;!tn(n,o)&&rn(n,r,r.next,o)&&nn(n,o)&&nn(o,n)&&(t.push(n.i/i),t.push(r.i/i),t.push(o.i/i),an(r),an(r.next),r=e=o),r=r.next}while(r!==e);return r}function qr(e,t,i,r,n,o){var s=e;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&$r(s,a)){var c=on(s,a);return s=jr(s,s.next),c=jr(c,c.next),Vr(s,t,i,r,n,o),void Vr(c,t,i,r,n,o)}a=a.next}s=s.next}while(s!==e)}function Yr(e,t){return e.x-t.x}function Zr(e,t){if(t=function(e,t){var i,r=t,n=e.x,o=e.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=n&&a>s){if(s=a,a===n){if(o===r.y)return r;if(o===r.next.y)return r.next}i=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!i)return null;if(n===s)return i.prev;var c,h=i,l=i.x,u=i.y,p=1/0;r=i.next;for(;r!==h;)n>=r.x&&r.x>=l&&n!==r.x&&Kr(o<u?n:s,o,l,u,o<u?s:n,o,r.x,r.y)&&((c=Math.abs(o-r.y)/(n-r.x))<p||c===p&&r.x>i.x)&&nn(r,e)&&(i=r,p=c),r=r.next;return i}(e,t)){var i=on(t,e);jr(i,i.next)}}function Jr(e,t,i,r,n){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*n)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*n)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qr(e){var t=e,i=e;do{t.x<i.x&&(i=t),t=t.next}while(t!==e);return i}function Kr(e,t,i,r,n,o,s,a){return(n-s)*(t-a)-(e-s)*(o-a)>=0&&(e-s)*(r-a)-(i-s)*(t-a)>=0&&(i-s)*(o-a)-(n-s)*(r-a)>=0}function $r(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&rn(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&nn(e,t)&&nn(t,e)&&function(e,t){var i=e,r=!1,n=(e.x+t.x)/2,o=(e.y+t.y)/2;do{i.y>o!=i.next.y>o&&i.next.y!==i.y&&n<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(r=!r),i=i.next}while(i!==e);return r}(e,t)}function en(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function tn(e,t){return e.x===t.x&&e.y===t.y}function rn(e,t,i,r){return!!(tn(e,t)&&tn(i,r)||tn(e,r)&&tn(i,t))||en(e,t,i)>0!=en(e,t,r)>0&&en(i,r,e)>0!=en(i,r,t)>0}function nn(e,t){return en(e.prev,e,e.next)<0?en(e,t,e.next)>=0&&en(e,e.prev,t)>=0:en(e,t,e.prev)<0||en(e,e.next,t)<0}function on(e,t){var i=new cn(e.i,e.x,e.y),r=new cn(t.i,t.x,t.y),n=e.next,o=t.prev;return e.next=t,t.prev=e,i.next=n,n.prev=i,r.next=i,i.prev=r,o.next=r,r.prev=o,r}function sn(e,t,i,r){var n=new cn(e,t,i);return r?(n.next=r.next,n.prev=r,r.next.prev=n,r.next=n):(n.prev=n,n.next=n),n}function an(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function cn(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var hn={area:function(e){for(var t=e.length,i=0,r=t-1,n=0;n<t;r=n++)i+=e[r].x*e[n].y-e[n].x*e[r].y;return.5*i},isClockWise:function(e){return hn.area(e)<0},triangulateShape:function(e,t){function i(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function r(e,t){for(var i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}var n=[],o=[],s=[];i(e),r(n,e);var a=e.length;for(t.forEach(i),h=0;h<t.length;h++)o.push(a),a+=t[h].length,r(n,t[h]);for(var c=zr(n,o),h=0;h<c.length;h+=3)s.push(c.slice(h,h+3));return s}};function ln(e,t){Ut.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new un(e,t)),this.mergeVertices()}function un(e,t){void 0!==e&&(ri.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function pn(e,t){Ut.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new dn(e,t)),this.mergeVertices()}function dn(e,t){var i=(t=t||{}).font;if(!i||!i.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new Ut;var r=i.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),un.call(this,r,t),this.type="TextBufferGeometry"}function fn(e,t,i,r,n,o,s){Ut.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new mn(e,t,i,r,n,o,s)),this.mergeVertices()}function mn(e,t,i,r,n,o,s){ri.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:n,thetaStart:o,thetaLength:s},e=e||1,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),r=void 0!==r?r:0,n=void 0!==n?n:2*Math.PI;var a,c,h=(o=void 0!==o?o:0)+(s=void 0!==s?s:Math.PI),l=0,u=[],p=new ie,d=new ie,f=[],m=[],v=[],g=[];for(c=0;c<=i;c++){var y=[],b=c/i;for(a=0;a<=t;a++){var x=a/t;p.x=-e*Math.cos(r+x*n)*Math.sin(o+b*s),p.y=e*Math.cos(o+b*s),p.z=e*Math.sin(r+x*n)*Math.sin(o+b*s),m.push(p.x,p.y,p.z),d.set(p.x,p.y,p.z).normalize(),v.push(d.x,d.y,d.z),g.push(x,1-b),y.push(l++)}u.push(y)}for(c=0;c<i;c++)for(a=0;a<t;a++){var w=u[c][a+1],_=u[c][a],M=u[c+1][a],E=u[c+1][a+1];(0!==c||o>0)&&f.push(w,_,E),(c!==i-1||h<Math.PI)&&f.push(_,M,E)}this.setIndex(f),this.addAttribute("position",new Wt(m,3)),this.addAttribute("normal",new Wt(v,3)),this.addAttribute("uv",new Wt(g,2))}function vn(e,t,i,r,n,o){Ut.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},this.fromBufferGeometry(new gn(e,t,i,r,n,o)),this.mergeVertices()}function gn(e,t,i,r,n,o){ri.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:r,thetaStart:n,thetaLength:o},e=e||.5,t=t||1,n=void 0!==n?n:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8;var s,a,c,h=[],l=[],u=[],p=[],d=e,f=(t-e)/(r=void 0!==r?Math.max(1,r):1),m=new ie,v=new $;for(a=0;a<=r;a++){for(c=0;c<=i;c++)s=n+c/i*o,m.x=d*Math.cos(s),m.y=d*Math.sin(s),l.push(m.x,m.y,m.z),u.push(0,0,1),v.x=(m.x/t+1)/2,v.y=(m.y/t+1)/2,p.push(v.x,v.y);d+=f}for(a=0;a<r;a++){var g=a*(i+1);for(c=0;c<i;c++){var y=s=c+g,b=s+i+1,x=s+i+2,w=s+1;h.push(y,b,w),h.push(b,x,w)}}this.setIndex(h),this.addAttribute("position",new Wt(l,3)),this.addAttribute("normal",new Wt(u,3)),this.addAttribute("uv",new Wt(p,2))}function yn(e,t,i,r){Ut.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},this.fromBufferGeometry(new bn(e,t,i,r)),this.mergeVertices()}function bn(e,t,i,r){ri.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:r},t=Math.floor(t)||12,i=i||0,r=r||2*Math.PI,r=K.clamp(r,0,2*Math.PI);var n,o,s,a=[],c=[],h=[],l=1/t,u=new ie,p=new $;for(o=0;o<=t;o++){var d=i+o*l*r,f=Math.sin(d),m=Math.cos(d);for(s=0;s<=e.length-1;s++)u.x=e[s].x*f,u.y=e[s].y,u.z=e[s].x*m,c.push(u.x,u.y,u.z),p.x=o/t,p.y=s/(e.length-1),h.push(p.x,p.y)}for(o=0;o<t;o++)for(s=0;s<e.length-1;s++){var v=n=s+o*e.length,g=n+e.length,y=n+e.length+1,b=n+1;a.push(v,g,b),a.push(g,y,b)}if(this.setIndex(a),this.addAttribute("position",new Wt(c,3)),this.addAttribute("uv",new Wt(h,2)),this.computeVertexNormals(),r===2*Math.PI){var x=this.attributes.normal.array,w=new ie,_=new ie,M=new ie;for(n=t*e.length*3,o=0,s=0;o<e.length;o++,s+=3)w.x=x[s+0],w.y=x[s+1],w.z=x[s+2],_.x=x[n+s+0],_.y=x[n+s+1],_.z=x[n+s+2],M.addVectors(w,_).normalize(),x[s+0]=x[n+s+0]=M.x,x[s+1]=x[n+s+1]=M.y,x[s+2]=x[n+s+2]=M.z}}function xn(e,t){Ut.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new wn(e,t)),this.mergeVertices()}function wn(e,t){ri.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],n=[],o=[],s=0,a=0;if(!1===Array.isArray(e))h(e);else for(var c=0;c<e.length;c++)h(e[c]),this.addGroup(s,a,c),s+=a,a=0;function h(e){var s,c,h,l=r.length/3,u=e.extractPoints(t),p=u.shape,d=u.holes;if(!1===hn.isClockWise(p))for(p=p.reverse(),s=0,c=d.length;s<c;s++)h=d[s],!0===hn.isClockWise(h)&&(d[s]=h.reverse());var f=hn.triangulateShape(p,d);for(s=0,c=d.length;s<c;s++)h=d[s],p=p.concat(h);for(s=0,c=p.length;s<c;s++){var m=p[s];r.push(m.x,m.y,0),n.push(0,0,1),o.push(m.x,m.y)}for(s=0,c=f.length;s<c;s++){var v=f[s],g=v[0]+l,y=v[1]+l,b=v[2]+l;i.push(g,y,b),a+=3}}this.setIndex(i),this.addAttribute("position",new Wt(r,3)),this.addAttribute("normal",new Wt(n,3)),this.addAttribute("uv",new Wt(o,2))}function _n(e,t){if(t.shapes=[],Array.isArray(e))for(var i=0,r=e.length;i<r;i++){var n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}function Mn(e,t){ri.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var i,r,n,o,s=[],a=Math.cos(K.DEG2RAD*t),c=[0,0],h={},l=["a","b","c"];e.isBufferGeometry?(o=new Ut).fromBufferGeometry(e):o=e.clone(),o.mergeVertices(),o.computeFaceNormals();for(var u=o.vertices,p=o.faces,d=0,f=p.length;d<f;d++)for(var m=p[d],v=0;v<3;v++)i=m[l[v]],r=m[l[(v+1)%3]],c[0]=Math.min(i,r),c[1]=Math.max(i,r),void 0===h[n=c[0]+","+c[1]]?h[n]={index1:c[0],index2:c[1],face1:d,face2:void 0}:h[n].face2=d;for(n in h){var g=h[n];if(void 0===g.face2||p[g.face1].normal.dot(p[g.face2].normal)<=a){var y=u[g.index1];s.push(y.x,y.y,y.z),y=u[g.index2],s.push(y.x,y.y,y.z)}}this.addAttribute("position",new Wt(s,3))}function En(e,t,i,r,n,o,s,a){Ut.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:a},this.fromBufferGeometry(new Tn(e,t,i,r,n,o,s,a)),this.mergeVertices()}function Tn(e,t,i,r,n,o,s,a){ri.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:r,heightSegments:n,openEnded:o,thetaStart:s,thetaLength:a};var c=this;e=void 0!==e?e:1,t=void 0!==t?t:1,i=i||1,r=Math.floor(r)||8,n=Math.floor(n)||1,o=void 0!==o&&o,s=void 0!==s?s:0,a=void 0!==a?a:2*Math.PI;var h=[],l=[],u=[],p=[],d=0,f=[],m=i/2,v=0;function g(i){var n,o,f,g=new $,y=new ie,b=0,x=!0===i?e:t,w=!0===i?1:-1;for(o=d,n=1;n<=r;n++)l.push(0,m*w,0),u.push(0,w,0),p.push(.5,.5),d++;for(f=d,n=0;n<=r;n++){var _=n/r*a+s,M=Math.cos(_),E=Math.sin(_);y.x=x*E,y.y=m*w,y.z=x*M,l.push(y.x,y.y,y.z),u.push(0,w,0),g.x=.5*M+.5,g.y=.5*E*w+.5,p.push(g.x,g.y),d++}for(n=0;n<r;n++){var T=o+n,S=f+n;!0===i?h.push(S,S+1,T):h.push(S+1,S,T),b+=3}c.addGroup(v,b,!0===i?1:2),v+=b}!function(){var o,g,y=new ie,b=new ie,x=0,w=(t-e)/i;for(g=0;g<=n;g++){var _=[],M=g/n,E=M*(t-e)+e;for(o=0;o<=r;o++){var T=o/r,S=T*a+s,A=Math.sin(S),L=Math.cos(S);b.x=E*A,b.y=-M*i+m,b.z=E*L,l.push(b.x,b.y,b.z),y.set(A,w,L).normalize(),u.push(y.x,y.y,y.z),p.push(T,1-M),_.push(d++)}f.push(_)}for(o=0;o<r;o++)for(g=0;g<n;g++){var R=f[g][o],C=f[g+1][o],P=f[g+1][o+1],N=f[g][o+1];h.push(R,C,N),h.push(C,P,N),x+=6}c.addGroup(v,x,0),v+=x}(),!1===o&&(e>0&&g(!0),t>0&&g(!1)),this.setIndex(h),this.addAttribute("position",new Wt(l,3)),this.addAttribute("normal",new Wt(u,3)),this.addAttribute("uv",new Wt(p,2))}function Sn(e,t,i,r,n,o,s){En.call(this,0,e,t,i,r,n,o,s),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:s}}function An(e,t,i,r,n,o,s){Tn.call(this,0,e,t,i,r,n,o,s),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:r,openEnded:n,thetaStart:o,thetaLength:s}}function Ln(e,t,i,r){Ut.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},this.fromBufferGeometry(new Rn(e,t,i,r)),this.mergeVertices()}function Rn(e,t,i,r){ri.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:r},e=e||1,t=void 0!==t?Math.max(3,t):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var n,o,s=[],a=[],c=[],h=[],l=new ie,u=new $;for(a.push(0,0,0),c.push(0,0,1),h.push(.5,.5),o=0,n=3;o<=t;o++,n+=3){var p=i+o/t*r;l.x=e*Math.cos(p),l.y=e*Math.sin(p),a.push(l.x,l.y,l.z),c.push(0,0,1),u.x=(a[n]/e+1)/2,u.y=(a[n+1]/e+1)/2,h.push(u.x,u.y)}for(n=1;n<=t;n++)s.push(n,n+1,0);this.setIndex(s),this.addAttribute("position",new Wt(a,3)),this.addAttribute("normal",new Wt(c,3)),this.addAttribute("uv",new Wt(h,2))}ln.prototype=Object.create(Ut.prototype),ln.prototype.constructor=ln,un.prototype=Object.create(ri.prototype),un.prototype.constructor=un,un.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],i=this.getAttribute("uv"),r=i?Array.prototype.slice.call(i.array):[],n=this.index;return{position:t,uv:r,index:n?Array.prototype.slice.call(n.array):[]}},un.prototype.addShapeList=function(e,t){var i=e.length;t.arrays=this.getArrays();for(var r=0;r<i;r++){var n=e[r];this.addShape(n,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new Wt(t.arrays.position,3)),this.addAttribute("uv",new Wt(t.arrays.uv,2))},un.prototype.addShape=function(e,t){var i,r,n,o,s,a,c,h,l=t.arrays?t.arrays:this.getArrays(),u=l.position,p=l.index,d=l.uv,f=[],m=void 0!==t.amount?t.amount:100,v=void 0!==t.bevelThickness?t.bevelThickness:6,g=void 0!==t.bevelSize?t.bevelSize:v-2,y=void 0!==t.bevelSegments?t.bevelSegments:3,b=void 0===t.bevelEnabled||t.bevelEnabled,x=void 0!==t.curveSegments?t.curveSegments:12,w=void 0!==t.steps?t.steps:1,_=t.extrudePath,M=!1,E=void 0!==t.UVGenerator?t.UVGenerator:ln.WorldUVGenerator;_&&(i=_.getSpacedPoints(w),M=!0,b=!1,r=void 0!==t.frames?t.frames:_.computeFrenetFrames(w,!1),n=new ie,o=new ie,s=new ie),b||(y=0,v=0,g=0);var T=this,S=e.extractPoints(x),A=S.shape,L=S.holes;if(!hn.isClockWise(A))for(A=A.reverse(),c=0,h=L.length;c<h;c++)a=L[c],hn.isClockWise(a)&&(L[c]=a.reverse());var R=hn.triangulateShape(A,L),C=A;for(c=0,h=L.length;c<h;c++)a=L[c],A=A.concat(a);function P(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}var N,O,I,D,U,F,k=A.length,B=R.length;function z(e,t,i){var r,n,o,s=e.x-t.x,a=e.y-t.y,c=i.x-e.x,h=i.y-e.y,l=s*s+a*a,u=s*h-a*c;if(Math.abs(u)>Number.EPSILON){var p=Math.sqrt(l),d=Math.sqrt(c*c+h*h),f=t.x-a/p,m=t.y+s/p,v=((i.x-h/d-f)*h-(i.y+c/d-m)*c)/(s*h-a*c),g=(r=f+s*v-e.x)*r+(n=m+a*v-e.y)*n;if(g<=2)return new $(r,n);o=Math.sqrt(g/2)}else{var y=!1;s>Number.EPSILON?c>Number.EPSILON&&(y=!0):s<-Number.EPSILON?c<-Number.EPSILON&&(y=!0):Math.sign(a)===Math.sign(h)&&(y=!0),y?(r=-a,n=s,o=Math.sqrt(l)):(r=s,n=a,o=Math.sqrt(l/2))}return new $(r/o,n/o)}for(var G=[],j=0,V=C.length,H=V-1,W=j+1;j<V;j++,H++,W++)H===V&&(H=0),W===V&&(W=0),G[j]=z(C[j],C[H],C[W]);var X,q,Y=[],Z=G.concat();for(c=0,h=L.length;c<h;c++){for(a=L[c],X=[],j=0,H=(V=a.length)-1,W=j+1;j<V;j++,H++,W++)H===V&&(H=0),W===V&&(W=0),X[j]=z(a[j],a[H],a[W]);Y.push(X),Z=Z.concat(X)}for(N=0;N<y;N++){for(I=N/y,D=v*Math.cos(I*Math.PI/2),O=g*Math.sin(I*Math.PI/2),j=0,V=C.length;j<V;j++)Q((U=P(C[j],G[j],O)).x,U.y,-D);for(c=0,h=L.length;c<h;c++)for(a=L[c],X=Y[c],j=0,V=a.length;j<V;j++)Q((U=P(a[j],X[j],O)).x,U.y,-D)}for(O=g,j=0;j<k;j++)U=b?P(A[j],Z[j],O):A[j],M?(o.copy(r.normals[0]).multiplyScalar(U.x),n.copy(r.binormals[0]).multiplyScalar(U.y),s.copy(i[0]).add(o).add(n),Q(s.x,s.y,s.z)):Q(U.x,U.y,0);for(q=1;q<=w;q++)for(j=0;j<k;j++)U=b?P(A[j],Z[j],O):A[j],M?(o.copy(r.normals[q]).multiplyScalar(U.x),n.copy(r.binormals[q]).multiplyScalar(U.y),s.copy(i[q]).add(o).add(n),Q(s.x,s.y,s.z)):Q(U.x,U.y,m/w*q);for(N=y-1;N>=0;N--){for(I=N/y,D=v*Math.cos(I*Math.PI/2),O=g*Math.sin(I*Math.PI/2),j=0,V=C.length;j<V;j++)Q((U=P(C[j],G[j],O)).x,U.y,m+D);for(c=0,h=L.length;c<h;c++)for(a=L[c],X=Y[c],j=0,V=a.length;j<V;j++)U=P(a[j],X[j],O),M?Q(U.x,U.y+i[w-1].y,i[w-1].x+D):Q(U.x,U.y,m+D)}function J(e,t){var i,r;for(j=e.length;--j>=0;){i=j,(r=j-1)<0&&(r=e.length-1);var n=0,o=w+2*y;for(n=0;n<o;n++){var s=k*n,a=k*(n+1);ee(t+i+s,t+r+s,t+r+a,t+i+a)}}}function Q(e,t,i){f.push(e),f.push(t),f.push(i)}function K(e,t,i){te(e),te(t),te(i);var r=u.length/3,n=E.generateTopUV(T,u,r-3,r-2,r-1);re(n[0]),re(n[1]),re(n[2])}function ee(e,t,i,r){te(e),te(t),te(r),te(t),te(i),te(r);var n=u.length/3,o=E.generateSideWallUV(T,u,n-6,n-3,n-2,n-1);re(o[0]),re(o[1]),re(o[3]),re(o[1]),re(o[2]),re(o[3])}function te(e){p.push(u.length/3),u.push(f[3*e+0]),u.push(f[3*e+1]),u.push(f[3*e+2])}function re(e){d.push(e.x),d.push(e.y)}!function(){var e=u.length/3;if(b){var i=0,r=k*i;for(j=0;j<B;j++)K((F=R[j])[2]+r,F[1]+r,F[0]+r);for(r=k*(i=w+2*y),j=0;j<B;j++)K((F=R[j])[0]+r,F[1]+r,F[2]+r)}else{for(j=0;j<B;j++)K((F=R[j])[2],F[1],F[0]);for(j=0;j<B;j++)K((F=R[j])[0]+k*w,F[1]+k*w,F[2]+k*w)}T.addGroup(e,u.length/3-e,void 0!==t.material?t.material:0)}(),function(){var e=u.length/3,i=0;for(J(C,i),i+=C.length,c=0,h=L.length;c<h;c++)J(a=L[c],i),i+=a.length;T.addGroup(e,u.length/3-e,void 0!==t.extrudeMaterial?t.extrudeMaterial:1)}(),t.arrays||(this.setIndex(p),this.addAttribute("position",new Wt(u,3)),this.addAttribute("uv",new Wt(d,2)))},ln.WorldUVGenerator={generateTopUV:function(e,t,i,r,n){var o=t[3*i],s=t[3*i+1],a=t[3*r],c=t[3*r+1],h=t[3*n],l=t[3*n+1];return[new $(o,s),new $(a,c),new $(h,l)]},generateSideWallUV:function(e,t,i,r,n,o){var s=t[3*i],a=t[3*i+1],c=t[3*i+2],h=t[3*r],l=t[3*r+1],u=t[3*r+2],p=t[3*n],d=t[3*n+1],f=t[3*n+2],m=t[3*o],v=t[3*o+1],g=t[3*o+2];return Math.abs(a-l)<.01?[new $(s,1-c),new $(h,1-u),new $(p,1-f),new $(m,1-g)]:[new $(a,1-c),new $(l,1-u),new $(d,1-f),new $(v,1-g)]}},pn.prototype=Object.create(Ut.prototype),pn.prototype.constructor=pn,dn.prototype=Object.create(un.prototype),dn.prototype.constructor=dn,fn.prototype=Object.create(Ut.prototype),fn.prototype.constructor=fn,mn.prototype=Object.create(ri.prototype),mn.prototype.constructor=mn,vn.prototype=Object.create(Ut.prototype),vn.prototype.constructor=vn,gn.prototype=Object.create(ri.prototype),gn.prototype.constructor=gn,yn.prototype=Object.create(Ut.prototype),yn.prototype.constructor=yn,bn.prototype=Object.create(ri.prototype),bn.prototype.constructor=bn,xn.prototype=Object.create(Ut.prototype),xn.prototype.constructor=xn,xn.prototype.toJSON=function(){var e=Ut.prototype.toJSON.call(this);return _n(this.parameters.shapes,e)},wn.prototype=Object.create(ri.prototype),wn.prototype.constructor=wn,wn.prototype.toJSON=function(){var e=ri.prototype.toJSON.call(this);return _n(this.parameters.shapes,e)},Mn.prototype=Object.create(ri.prototype),Mn.prototype.constructor=Mn,En.prototype=Object.create(Ut.prototype),En.prototype.constructor=En,Tn.prototype=Object.create(ri.prototype),Tn.prototype.constructor=Tn,Sn.prototype=Object.create(En.prototype),Sn.prototype.constructor=Sn,An.prototype=Object.create(Tn.prototype),An.prototype.constructor=An,Ln.prototype=Object.create(Ut.prototype),Ln.prototype.constructor=Ln,Rn.prototype=Object.create(ri.prototype),Rn.prototype.constructor=Rn;var Cn=Object.freeze({WireframeGeometry:wr,ParametricGeometry:_r,ParametricBufferGeometry:Mr,TetrahedronGeometry:Sr,TetrahedronBufferGeometry:Ar,OctahedronGeometry:Lr,OctahedronBufferGeometry:Rr,IcosahedronGeometry:Cr,IcosahedronBufferGeometry:Pr,DodecahedronGeometry:Nr,DodecahedronBufferGeometry:Or,PolyhedronGeometry:Er,PolyhedronBufferGeometry:Tr,TubeGeometry:Ir,TubeBufferGeometry:Dr,TorusKnotGeometry:Ur,TorusKnotBufferGeometry:Fr,TorusGeometry:kr,TorusBufferGeometry:Br,TextGeometry:pn,TextBufferGeometry:dn,SphereGeometry:fn,SphereBufferGeometry:mn,RingGeometry:vn,RingBufferGeometry:gn,PlaneGeometry:si,PlaneBufferGeometry:ai,LatheGeometry:yn,LatheBufferGeometry:bn,ShapeGeometry:xn,ShapeBufferGeometry:wn,ExtrudeGeometry:ln,ExtrudeBufferGeometry:un,EdgesGeometry:Mn,ConeGeometry:Sn,ConeBufferGeometry:An,CylinderGeometry:En,CylinderBufferGeometry:Tn,CircleGeometry:Ln,CircleBufferGeometry:Rn,BoxGeometry:ni,BoxBufferGeometry:oi});function Pn(e){ft.call(this),this.type="ShadowMaterial",this.color=new Qe(0),this.opacity=1,this.lights=!0,this.transparent=!0,this.setValues(e)}function Nn(e){hi.call(this,e),this.type="RawShaderMaterial"}function On(e){ft.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Qe(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function In(e){On.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function Dn(e){ft.call(this),this.type="MeshPhongMaterial",this.color=new Qe(16777215),this.specular=new Qe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Un(e){Dn.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Fn(e){ft.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new $(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function kn(e){ft.call(this),this.type="MeshLambertMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Bn(e){ur.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Pn.prototype=Object.create(ft.prototype),Pn.prototype.constructor=Pn,Pn.prototype.isShadowMaterial=!0,Nn.prototype=Object.create(hi.prototype),Nn.prototype.constructor=Nn,Nn.prototype.isRawShaderMaterial=!0,On.prototype=Object.create(ft.prototype),On.prototype.constructor=On,On.prototype.isMeshStandardMaterial=!0,On.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},In.prototype=Object.create(On.prototype),In.prototype.constructor=In,In.prototype.isMeshPhysicalMaterial=!0,In.prototype.copy=function(e){return On.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},Dn.prototype=Object.create(ft.prototype),Dn.prototype.constructor=Dn,Dn.prototype.isMeshPhongMaterial=!0,Dn.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Un.prototype=Object.create(Dn.prototype),Un.prototype.constructor=Un,Un.prototype.isMeshToonMaterial=!0,Un.prototype.copy=function(e){return Dn.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Fn.prototype=Object.create(ft.prototype),Fn.prototype.constructor=Fn,Fn.prototype.isMeshNormalMaterial=!0,Fn.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},kn.prototype=Object.create(ft.prototype),kn.prototype.constructor=kn,kn.prototype.isMeshLambertMaterial=!0,kn.prototype.copy=function(e){return ft.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Bn.prototype=Object.create(ur.prototype),Bn.prototype.constructor=Bn,Bn.prototype.isLineDashedMaterial=!0,Bn.prototype.copy=function(e){return ur.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var zn=Object.freeze({ShadowMaterial:Pn,SpriteMaterial:or,RawShaderMaterial:Nn,ShaderMaterial:hi,PointsMaterial:mr,MeshPhysicalMaterial:In,MeshStandardMaterial:On,MeshPhongMaterial:Dn,MeshToonMaterial:Un,MeshNormalMaterial:Fn,MeshLambertMaterial:kn,MeshDepthMaterial:mt,MeshDistanceMaterial:vt,MeshBasicMaterial:ci,LineDashedMaterial:Bn,LineBasicMaterial:ur,Material:ft}),Gn={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function jn(e,t,i){var r=this,n=!1,o=0,s=0,a=void 0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){s++,!1===n&&void 0!==r.onStart&&r.onStart(e,o,s),n=!0},this.itemEnd=function(e){o++,void 0!==r.onProgress&&r.onProgress(e,o,s),o===s&&(n=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return a?a(e):e},this.setURLModifier=function(e){return a=e,this}}var Vn=new jn,Hn={};function Wn(e){this.manager=void 0!==e?e:Vn}function Xn(e){this.manager=void 0!==e?e:Vn,this._parser=null}function qn(e){this.manager=void 0!==e?e:Vn,this._parser=null}function Yn(e){this.manager=void 0!==e?e:Vn}function Zn(e){this.manager=void 0!==e?e:Vn}function Jn(e){this.manager=void 0!==e?e:Vn}function Qn(){this.type="Curve",this.arcLengthDivisions=200}function Kn(e,t,i,r,n,o,s,a){Qn.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=i||1,this.yRadius=r||1,this.aStartAngle=n||0,this.aEndAngle=o||2*Math.PI,this.aClockwise=s||!1,this.aRotation=a||0}function $n(e,t,i,r,n,o){Kn.call(this,e,t,i,i,r,n,o),this.type="ArcCurve"}function eo(){var e=0,t=0,i=0,r=0;function n(n,o,s,a){e=n,t=s,i=-3*n+3*o-2*s-a,r=2*n-2*o+s+a}return{initCatmullRom:function(e,t,i,r,o){n(t,i,o*(i-e),o*(r-t))},initNonuniformCatmullRom:function(e,t,i,r,o,s,a){var c=(t-e)/o-(i-e)/(o+s)+(i-t)/s,h=(i-t)/s-(r-t)/(s+a)+(r-i)/a;n(t,i,c*=s,h*=s)},calc:function(n){var o=n*n;return e+t*n+i*o+r*(o*n)}}}Object.assign(Wn.prototype,{load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Gn.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;if(void 0===Hn[e]){var s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var a=s[1],c=!!s[2],h=s[3];h=window.decodeURIComponent(h),c&&(h=window.atob(h));try{var l,u=(this.responseType||"").toLowerCase();switch(u){case"arraybuffer":case"blob":for(var p=new Uint8Array(h.length),d=0;d<h.length;d++)p[d]=h.charCodeAt(d);l="blob"===u?new Blob([p.buffer],{type:a}):p.buffer;break;case"document":var f=new DOMParser;l=f.parseFromString(h,a);break;case"json":l=JSON.parse(h);break;default:l=h}window.setTimeout((function(){t&&t(l),n.manager.itemEnd(e)}),0)}catch(t){window.setTimeout((function(){r&&r(t),n.manager.itemEnd(e),n.manager.itemError(e)}),0)}}else{Hn[e]=[],Hn[e].push({onLoad:t,onProgress:i,onError:r});var m=new XMLHttpRequest;for(var v in m.open("GET",e,!0),m.addEventListener("load",(function(t){var i=this.response;Gn.add(e,i);var r=Hn[e];if(delete Hn[e],200===this.status){for(var o=0,s=r.length;o<s;o++){(a=r[o]).onLoad&&a.onLoad(i)}n.manager.itemEnd(e)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(o=0,s=r.length;o<s;o++){(a=r[o]).onLoad&&a.onLoad(i)}n.manager.itemEnd(e)}else{for(o=0,s=r.length;o<s;o++){var a;(a=r[o]).onError&&a.onError(t)}n.manager.itemEnd(e),n.manager.itemError(e)}}),!1),m.addEventListener("progress",(function(t){for(var i=Hn[e],r=0,n=i.length;r<n;r++){var o=i[r];o.onProgress&&o.onProgress(t)}}),!1),m.addEventListener("error",(function(t){var i=Hn[e];delete Hn[e];for(var r=0,o=i.length;r<o;r++){var s=i[r];s.onError&&s.onError(t)}n.manager.itemEnd(e),n.manager.itemError(e)}),!1),void 0!==this.responseType&&(m.responseType=this.responseType),void 0!==this.withCredentials&&(m.withCredentials=this.withCredentials),m.overrideMimeType&&m.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)m.setRequestHeader(v,this.requestHeader[v]);m.send(null)}return n.manager.itemStart(e),m}Hn[e].push({onLoad:t,onProgress:i,onError:r})},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(Xn.prototype,{load:function(e,t,i,r){var n=this,o=[],s=new br;s.image=o;var a=new Wn(this.manager);function c(c){a.load(e[c],(function(e){var i=n._parser(e,!0);o[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},6===(h+=1)&&(1===i.mipmapCount&&(s.minFilter=M),s.format=i.format,s.needsUpdate=!0,t&&t(s))}),i,r)}if(a.setPath(this.path),a.setResponseType("arraybuffer"),Array.isArray(e))for(var h=0,l=0,u=e.length;l<u;++l)c(l);else a.load(e,(function(e){var i=n._parser(e,!0);if(i.isCubemap)for(var r=i.mipmaps.length/i.mipmapCount,a=0;a<r;a++){o[a]={mipmaps:[]};for(var c=0;c<i.mipmapCount;c++)o[a].mipmaps.push(i.mipmaps[a*i.mipmapCount+c]),o[a].format=i.format,o[a].width=i.width,o[a].height=i.height}else s.image.width=i.width,s.image.height=i.height,s.mipmaps=i.mipmaps;1===i.mipmapCount&&(s.minFilter=M),s.format=i.format,s.needsUpdate=!0,t&&t(s)}),i,r);return s},setPath:function(e){return this.path=e,this}}),Object.assign(qn.prototype,{load:function(e,t,i,r){var n=this,o=new he,s=new Wn(this.manager);return s.setResponseType("arraybuffer"),s.load(e,(function(e){var i=n._parser(e);i&&(void 0!==i.image?o.image=i.image:void 0!==i.data&&(o.image.width=i.width,o.image.height=i.height,o.image.data=i.data),o.wrapS=void 0!==i.wrapS?i.wrapS:y,o.wrapT=void 0!==i.wrapT?i.wrapT:y,o.magFilter=void 0!==i.magFilter?i.magFilter:M,o.minFilter=void 0!==i.minFilter?i.minFilter:T,o.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.format&&(o.format=i.format),void 0!==i.type&&(o.type=i.type),void 0!==i.mipmaps&&(o.mipmaps=i.mipmaps),1===i.mipmapCount&&(o.minFilter=M),o.needsUpdate=!0,t&&t(o,i))}),i,r),o}}),Object.assign(Yn.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var n=this,o=Gn.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;var s=document.createElementNS("http://www.w3.org/1999/xhtml","img");return s.addEventListener("load",(function(){Gn.add(e,this),t&&t(this),n.manager.itemEnd(e)}),!1),s.addEventListener("error",(function(t){r&&r(t),n.manager.itemEnd(e),n.manager.itemError(e)}),!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),n.manager.itemStart(e),s.src=e,s},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Zn.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,r){var n=new le,o=new Yn(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);var s=0;function a(i){o.load(e[i],(function(e){n.images[i]=e,6===++s&&(n.needsUpdate=!0,t&&t(n))}),void 0,r)}for(var c=0;c<e.length;++c)a(c);return n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Jn.prototype,{crossOrigin:"Anonymous",load:function(e,t,i,r){var n=new oe,o=new Yn(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,(function(i){n.image=i;var r=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);n.format=r?N:O,n.needsUpdate=!0,void 0!==t&&t(n)}),i,r),n},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Qn.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var i=this.getUtoTmapping(e);return this.getPoint(i,t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,r=[],n=this.getPoint(0),o=0;for(r.push(0),i=1;i<=e;i++)o+=(t=this.getPoint(i/e)).distanceTo(n),r.push(o),n=t;return this.cacheArcLengths=r,r},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var i,r=this.getLengths(),n=0,o=r.length;i=t||e*r[o-1];for(var s,a=0,c=o-1;a<=c;)if((s=r[n=Math.floor(a+(c-a)/2)]-i)<0)a=n+1;else{if(!(s>0)){c=n;break}c=n-1}if(r[n=c]===i)return n/(o-1);var h=r[n];return(n+(i-h)/(r[n+1]-h))/(o-1)},getTangent:function(e){var t=1e-4,i=e-t,r=e+t;i<0&&(i=0),r>1&&(r=1);var n=this.getPoint(i);return this.getPoint(r).clone().sub(n).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var i,r,n,o=new ie,s=[],a=[],c=[],h=new ie,l=new ee;for(i=0;i<=e;i++)r=i/e,s[i]=this.getTangentAt(r),s[i].normalize();a[0]=new ie,c[0]=new ie;var u=Number.MAX_VALUE,p=Math.abs(s[0].x),d=Math.abs(s[0].y),f=Math.abs(s[0].z);for(p<=u&&(u=p,o.set(1,0,0)),d<=u&&(u=d,o.set(0,1,0)),f<=u&&o.set(0,0,1),h.crossVectors(s[0],o).normalize(),a[0].crossVectors(s[0],h),c[0].crossVectors(s[0],a[0]),i=1;i<=e;i++)a[i]=a[i-1].clone(),c[i]=c[i-1].clone(),h.crossVectors(s[i-1],s[i]),h.length()>Number.EPSILON&&(h.normalize(),n=Math.acos(K.clamp(s[i-1].dot(s[i]),-1,1)),a[i].applyMatrix4(l.makeRotationAxis(h,n))),c[i].crossVectors(s[i],a[i]);if(!0===t)for(n=Math.acos(K.clamp(a[0].dot(a[e]),-1,1)),n/=e,s[0].dot(h.crossVectors(a[0],a[e]))>0&&(n=-n),i=1;i<=e;i++)a[i].applyMatrix4(l.makeRotationAxis(s[i],n*i)),c[i].crossVectors(s[i],a[i]);return{tangents:s,normals:a,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Kn.prototype=Object.create(Qn.prototype),Kn.prototype.constructor=Kn,Kn.prototype.isEllipseCurve=!0,Kn.prototype.getPoint=function(e,t){for(var i=t||new $,r=2*Math.PI,n=this.aEndAngle-this.aStartAngle,o=Math.abs(n)<Number.EPSILON;n<0;)n+=r;for(;n>r;)n-=r;n<Number.EPSILON&&(n=o?0:r),!0!==this.aClockwise||o||(n===r?n=-r:n-=r);var s=this.aStartAngle+e*n,a=this.aX+this.xRadius*Math.cos(s),c=this.aY+this.yRadius*Math.sin(s);if(0!==this.aRotation){var h=Math.cos(this.aRotation),l=Math.sin(this.aRotation),u=a-this.aX,p=c-this.aY;a=u*h-p*l+this.aX,c=u*l+p*h+this.aY}return i.set(a,c)},Kn.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Kn.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Kn.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},$n.prototype=Object.create(Kn.prototype),$n.prototype.constructor=$n,$n.prototype.isArcCurve=!0;var to=new ie,ro=new eo,no=new eo,oo=new eo;function so(e,t,i,r){Qn.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=i||"centripetal",this.tension=r||.5}function ao(e,t,i,r,n){var o=.5*(r-t),s=.5*(n-i),a=e*e;return(2*i-2*r+o+s)*(e*a)+(-3*i+3*r-2*o-s)*a+o*e+i}function co(e,t,i,r){return function(e,t){var i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,r)}function ho(e,t,i,r,n){return function(e,t){var i=1-e;return i*i*i*t}(e,t)+function(e,t){var i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,n)}function lo(e,t,i,r){Qn.call(this),this.type="CubicBezierCurve",this.v0=e||new $,this.v1=t||new $,this.v2=i||new $,this.v3=r||new $}function uo(e,t,i,r){Qn.call(this),this.type="CubicBezierCurve3",this.v0=e||new ie,this.v1=t||new ie,this.v2=i||new ie,this.v3=r||new ie}function po(e,t){Qn.call(this),this.type="LineCurve",this.v1=e||new $,this.v2=t||new $}function fo(e,t){Qn.call(this),this.type="LineCurve3",this.v1=e||new ie,this.v2=t||new ie}function mo(e,t,i){Qn.call(this),this.type="QuadraticBezierCurve",this.v0=e||new $,this.v1=t||new $,this.v2=i||new $}function vo(e,t,i){Qn.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new ie,this.v1=t||new ie,this.v2=i||new ie}function go(e){Qn.call(this),this.type="SplineCurve",this.points=e||[]}so.prototype=Object.create(Qn.prototype),so.prototype.constructor=so,so.prototype.isCatmullRomCurve3=!0,so.prototype.getPoint=function(e,t){var i,r,n,o,s=t||new ie,a=this.points,c=a.length,h=(c-(this.closed?0:1))*e,l=Math.floor(h),u=h-l;if(this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/a.length)+1)*a.length:0===u&&l===c-1&&(l=c-2,u=1),this.closed||l>0?i=a[(l-1)%c]:(to.subVectors(a[0],a[1]).add(a[0]),i=to),r=a[l%c],n=a[(l+1)%c],this.closed||l+2<c?o=a[(l+2)%c]:(to.subVectors(a[c-1],a[c-2]).add(a[c-1]),o=to),"centripetal"===this.curveType||"chordal"===this.curveType){var p="chordal"===this.curveType?.5:.25,d=Math.pow(i.distanceToSquared(r),p),f=Math.pow(r.distanceToSquared(n),p),m=Math.pow(n.distanceToSquared(o),p);f<1e-4&&(f=1),d<1e-4&&(d=f),m<1e-4&&(m=f),ro.initNonuniformCatmullRom(i.x,r.x,n.x,o.x,d,f,m),no.initNonuniformCatmullRom(i.y,r.y,n.y,o.y,d,f,m),oo.initNonuniformCatmullRom(i.z,r.z,n.z,o.z,d,f,m)}else"catmullrom"===this.curveType&&(ro.initCatmullRom(i.x,r.x,n.x,o.x,this.tension),no.initCatmullRom(i.y,r.y,n.y,o.y,this.tension),oo.initCatmullRom(i.z,r.z,n.z,o.z,this.tension));return s.set(ro.calc(u),no.calc(u),oo.calc(u)),s},so.prototype.copy=function(e){Qn.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},so.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},so.prototype.fromJSON=function(e){Qn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new ie).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},lo.prototype=Object.create(Qn.prototype),lo.prototype.constructor=lo,lo.prototype.isCubicBezierCurve=!0,lo.prototype.getPoint=function(e,t){var i=t||new $,r=this.v0,n=this.v1,o=this.v2,s=this.v3;return i.set(ho(e,r.x,n.x,o.x,s.x),ho(e,r.y,n.y,o.y,s.y)),i},lo.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},lo.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},lo.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},uo.prototype=Object.create(Qn.prototype),uo.prototype.constructor=uo,uo.prototype.isCubicBezierCurve3=!0,uo.prototype.getPoint=function(e,t){var i=t||new ie,r=this.v0,n=this.v1,o=this.v2,s=this.v3;return i.set(ho(e,r.x,n.x,o.x,s.x),ho(e,r.y,n.y,o.y,s.y),ho(e,r.z,n.z,o.z,s.z)),i},uo.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},uo.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},uo.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},po.prototype=Object.create(Qn.prototype),po.prototype.constructor=po,po.prototype.isLineCurve=!0,po.prototype.getPoint=function(e,t){var i=t||new $;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},po.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},po.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},po.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},po.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},po.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},fo.prototype=Object.create(Qn.prototype),fo.prototype.constructor=fo,fo.prototype.isLineCurve3=!0,fo.prototype.getPoint=function(e,t){var i=t||new ie;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i},fo.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},fo.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},fo.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},fo.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},mo.prototype=Object.create(Qn.prototype),mo.prototype.constructor=mo,mo.prototype.isQuadraticBezierCurve=!0,mo.prototype.getPoint=function(e,t){var i=t||new $,r=this.v0,n=this.v1,o=this.v2;return i.set(co(e,r.x,n.x,o.x),co(e,r.y,n.y,o.y)),i},mo.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},mo.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},mo.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},vo.prototype=Object.create(Qn.prototype),vo.prototype.constructor=vo,vo.prototype.isQuadraticBezierCurve3=!0,vo.prototype.getPoint=function(e,t){var i=t||new ie,r=this.v0,n=this.v1,o=this.v2;return i.set(co(e,r.x,n.x,o.x),co(e,r.y,n.y,o.y),co(e,r.z,n.z,o.z)),i},vo.prototype.copy=function(e){return Qn.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},vo.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},vo.prototype.fromJSON=function(e){return Qn.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},go.prototype=Object.create(Qn.prototype),go.prototype.constructor=go,go.prototype.isSplineCurve=!0,go.prototype.getPoint=function(e,t){var i=t||new $,r=this.points,n=(r.length-1)*e,o=Math.floor(n),s=n-o,a=r[0===o?o:o-1],c=r[o],h=r[o>r.length-2?r.length-1:o+1],l=r[o>r.length-3?r.length-1:o+2];return i.set(ao(s,a.x,c.x,h.x,l.x),ao(s,a.y,c.y,h.y,l.y)),i},go.prototype.copy=function(e){Qn.prototype.copy.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push(r.clone())}return this},go.prototype.toJSON=function(){var e=Qn.prototype.toJSON.call(this);e.points=[];for(var t=0,i=this.points.length;t<i;t++){var r=this.points[t];e.points.push(r.toArray())}return e},go.prototype.fromJSON=function(e){Qn.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,i=e.points.length;t<i;t++){var r=e.points[t];this.points.push((new $).fromArray(r))}return this};var yo=Object.freeze({ArcCurve:$n,CatmullRomCurve3:so,CubicBezierCurve:lo,CubicBezierCurve3:uo,EllipseCurve:Kn,LineCurve:po,LineCurve3:fo,QuadraticBezierCurve:mo,QuadraticBezierCurve3:vo,SplineCurve:go});function bo(){Qn.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function xo(e){bo.call(this),this.type="Path",this.currentPoint=new $,e&&this.setFromPoints(e)}function wo(e){xo.call(this,e),this.uuid=K.generateUUID(),this.type="Shape",this.holes=[]}function _o(e,t){Ct.call(this),this.type="Light",this.color=new Qe(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function Mo(e,t,i){_o.call(this,e,i),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(Ct.DefaultUp),this.updateMatrix(),this.groundColor=new Qe(t)}function Eo(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new $(512,512),this.map=null,this.matrix=new ee}function To(){Eo.call(this,new Yi(50,1,.5,500))}function So(e,t,i,r,n,o){_o.call(this,e,t),this.type="SpotLight",this.position.copy(Ct.DefaultUp),this.updateMatrix(),this.target=new Ct,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==i?i:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==n?n:0,this.decay=void 0!==o?o:1,this.shadow=new To}function Ao(e,t,i,r){_o.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==i?i:0,this.decay=void 0!==r?r:1,this.shadow=new Eo(new Yi(90,1,.5,500))}function Lo(){Eo.call(this,new Nt(-5,5,5,-5,.5,500))}function Ro(e,t){_o.call(this,e,t),this.type="DirectionalLight",this.position.copy(Ct.DefaultUp),this.updateMatrix(),this.target=new Ct,this.shadow=new Lo}function Co(e,t){_o.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Po(e,t,i,r){_o.call(this,e,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==i?i:10,this.height=void 0!==r?r:10}function No(e,t,i,r){Vo.call(this,e,t,i,r)}function Oo(e,t,i){Vo.call(this,e,t,i)}function Io(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i}function Do(e,t,i,r){Io.call(this,e,t,i,r)}function Uo(e,t,i,r){Vo.call(this,e,t,i,r)}function Fo(e,t,i,r){Vo.call(this,e,t,i,r)}function ko(e,t,i,r){Vo.call(this,e,t,i,r)}function Bo(e,t,i,r){Io.call(this,e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function zo(e,t,i,r){Io.call(this,e,t,i,r)}function Go(e,t,i,r){Io.call(this,e,t,i,r)}bo.prototype=Object.assign(Object.create(Qn.prototype),{constructor:bo,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new po(t,e))},getPoint:function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),r=0;r<i.length;){if(i[r]>=t){var n=i[r]-t,o=this.curves[r],s=o.getLength(),a=0===s?0:1-n/s;return o.getPointAt(a)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,i=0,r=this.curves.length;i<r;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,i=[],r=0,n=this.curves;r<n.length;r++)for(var o=n[r],s=o&&o.isEllipseCurve?2*e:o&&o.isLineCurve?1:o&&o.isSplineCurve?e*o.points.length:e,a=o.getPoints(s),c=0;c<a.length;c++){var h=a[c];t&&t.equals(h)||(i.push(h),t=h)}return this.autoClose&&i.length>1&&!i[i.length-1].equals(i[0])&&i.push(i[0]),i},copy:function(e){Qn.prototype.copy.call(this,e),this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Qn.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,i=this.curves.length;t<i;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Qn.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,i=e.curves.length;t<i;t++){var r=e.curves[t];this.curves.push((new yo[r.type]).fromJSON(r))}return this}}),xo.prototype=Object.assign(Object.create(bo.prototype),{constructor:xo,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,t){var i=new po(this.currentPoint.clone(),new $(e,t));this.curves.push(i),this.currentPoint.set(e,t)},quadraticCurveTo:function(e,t,i,r){var n=new mo(this.currentPoint.clone(),new $(e,t),new $(i,r));this.curves.push(n),this.currentPoint.set(i,r)},bezierCurveTo:function(e,t,i,r,n,o){var s=new lo(this.currentPoint.clone(),new $(e,t),new $(i,r),new $(n,o));this.curves.push(s),this.currentPoint.set(n,o)},splineThru:function(e){var t=new go([this.currentPoint.clone()].concat(e));this.curves.push(t),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,i,r,n,o){var s=this.currentPoint.x,a=this.currentPoint.y;this.absarc(e+s,t+a,i,r,n,o)},absarc:function(e,t,i,r,n,o){this.absellipse(e,t,i,i,r,n,o)},ellipse:function(e,t,i,r,n,o,s,a){var c=this.currentPoint.x,h=this.currentPoint.y;this.absellipse(e+c,t+h,i,r,n,o,s,a)},absellipse:function(e,t,i,r,n,o,s,a){var c=new Kn(e,t,i,r,n,o,s,a);if(this.curves.length>0){var h=c.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(c);var l=c.getPoint(1);this.currentPoint.copy(l)},copy:function(e){return bo.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=bo.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return bo.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),wo.prototype=Object.assign(Object.create(xo.prototype),{constructor:wo,getPointsHoles:function(e){for(var t=[],i=0,r=this.holes.length;i<r;i++)t[i]=this.holes[i].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){xo.prototype.copy.call(this,e),this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=xo.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,i=this.holes.length;t<i;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){xo.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,i=e.holes.length;t<i;t++){var r=e.holes[t];this.holes.push((new xo).fromJSON(r))}return this}}),_o.prototype=Object.assign(Object.create(Ct.prototype),{constructor:_o,isLight:!0,copy:function(e){return Ct.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=Ct.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),Mo.prototype=Object.assign(Object.create(_o.prototype),{constructor:Mo,isHemisphereLight:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(Eo.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),To.prototype=Object.assign(Object.create(Eo.prototype),{constructor:To,isSpotLightShadow:!0,update:function(e){var t=this.camera,i=2*K.RAD2DEG*e.angle,r=this.mapSize.width/this.mapSize.height,n=e.distance||t.far;i===t.fov&&r===t.aspect&&n===t.far||(t.fov=i,t.aspect=r,t.far=n,t.updateProjectionMatrix())}}),So.prototype=Object.assign(Object.create(_o.prototype),{constructor:So,isSpotLight:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Ao.prototype=Object.assign(Object.create(_o.prototype),{constructor:Ao,isPointLight:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Lo.prototype=Object.assign(Object.create(Eo.prototype),{constructor:Lo}),Ro.prototype=Object.assign(Object.create(_o.prototype),{constructor:Ro,isDirectionalLight:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Co.prototype=Object.assign(Object.create(_o.prototype),{constructor:Co,isAmbientLight:!0}),Po.prototype=Object.assign(Object.create(_o.prototype),{constructor:Po,isRectAreaLight:!0,copy:function(e){return _o.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=_o.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),No.prototype=Object.assign(Object.create(Vo.prototype),{constructor:No,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:H,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Oo.prototype=Object.assign(Object.create(Vo.prototype),{constructor:Oo,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:H,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Object.assign(Io.prototype,{evaluate:function(e){var t=this.parameterPositions,i=this._cachedIndex,r=t[i],n=t[i-1];e:{t:{var o;i:{r:if(!(e<r)){for(var s=i+2;;){if(void 0===r){if(e<n)break r;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,n)}if(i===s)break;if(n=r,e<(r=t[++i]))break t}o=t.length;break i}if(e>=n)break e;var a=t[1];e<a&&(i=2,n=a);for(s=i-2;;){if(void 0===n)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(i===s)break;if(r=n,e>=(n=t[--i-1]))break t}o=i,i=0}for(;i<o;){var c=i+o>>>1;e<t[c]?o=c:i=c+1}if(r=t[i],void 0===(n=t[i-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,n,e)}this._cachedIndex=i,this.intervalChanged_(i,n,r)}return this.interpolate_(i,n,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,n=e*r,o=0;o!==r;++o)t[o]=i[n+o];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Io.prototype,{beforeStart_:Io.prototype.copySampleValue_,afterEnd_:Io.prototype.copySampleValue_}),Do.prototype=Object.assign(Object.create(Io.prototype),{constructor:Do,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=(i-t)/(r-t),h=a+s;a!==h;a+=4)te.slerpFlat(n,0,o,a-s,o,a,c);return n}}),Uo.prototype=Object.assign(Object.create(Vo.prototype),{constructor:Uo,ValueTypeName:"quaternion",DefaultInterpolation:W,InterpolantFactoryMethodLinear:function(e){return new Do(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Fo.prototype=Object.assign(Object.create(Vo.prototype),{constructor:Fo,ValueTypeName:"color"}),ko.prototype=Object.assign(Object.create(Vo.prototype),{constructor:ko,ValueTypeName:"number"}),Bo.prototype=Object.assign(Object.create(Io.prototype),{constructor:Bo,DefaultSettings_:{endingStart:q,endingEnd:q},intervalChanged_:function(e,t,i){var r=this.parameterPositions,n=e-2,o=e+1,s=r[n],a=r[o];if(void 0===s)switch(this.getSettings_().endingStart){case Y:n=e,s=2*t-i;break;case Z:s=t+r[n=r.length-2]-r[n+1];break;default:n=e,s=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Y:o=e,a=2*i-t;break;case Z:o=1,a=i+r[1]-r[0];break;default:o=e-1,a=t}var c=.5*(i-t),h=this.valueSize;this._weightPrev=c/(t-s),this._weightNext=c/(a-i),this._offsetPrev=n*h,this._offsetNext=o*h},interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,h=this._offsetPrev,l=this._offsetNext,u=this._weightPrev,p=this._weightNext,d=(i-t)/(r-t),f=d*d,m=f*d,v=-u*m+2*u*f-u*d,g=(1+u)*m+(-1.5-2*u)*f+(-.5+u)*d+1,y=(-1-p)*m+(1.5+p)*f+.5*d,b=p*m-p*f,x=0;x!==s;++x)n[x]=v*o[h+x]+g*o[c+x]+y*o[a+x]+b*o[l+x];return n}}),zo.prototype=Object.assign(Object.create(Io.prototype),{constructor:zo,interpolate_:function(e,t,i,r){for(var n=this.resultBuffer,o=this.sampleValues,s=this.valueSize,a=e*s,c=a-s,h=(i-t)/(r-t),l=1-h,u=0;u!==s;++u)n[u]=o[c+u]*l+o[a+u]*h;return n}}),Go.prototype=Object.assign(Object.create(Io.prototype),{constructor:Go,interpolate_:function(e){return this.copySampleValue_(e-1)}});var jo={arraySlice:function(e,t,i){return jo.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,i=new Array(t),r=0;r!==t;++r)i[r]=r;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){for(var r=e.length,n=new e.constructor(r),o=0,s=0;s!==r;++o)for(var a=i[o]*t,c=0;c!==t;++c)n[s++]=e[a+c];return n},flattenJSON:function(e,t,i,r){for(var n=1,o=e[0];void 0!==o&&void 0===o[r];)o=e[n++];if(void 0!==o){var s=o[r];if(void 0!==s)if(Array.isArray(s))do{void 0!==(s=o[r])&&(t.push(o.time),i.push.apply(i,s)),o=e[n++]}while(void 0!==o);else if(void 0!==s.toArray)do{void 0!==(s=o[r])&&(t.push(o.time),s.toArray(i,i.length)),o=e[n++]}while(void 0!==o);else do{void 0!==(s=o[r])&&(t.push(o.time),i.push(s)),o=e[n++]}while(void 0!==o)}}};function Vo(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=jo.convertArray(t,this.TimeBufferType),this.values=jo.convertArray(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation),this.validate(),this.optimize()}function Ho(e,t,i,r){Vo.call(this,e,t,i,r)}function Wo(e,t,i){this.name=e,this.tracks=i,this.duration=void 0!==t?t:-1,this.uuid=K.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function Xo(e){this.manager=void 0!==e?e:Vn,this.textures={}}function qo(e){this.manager=void 0!==e?e:Vn}Object.assign(Vo,{parse:function(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=Vo._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var i=[],r=[];jo.flattenJSON(e.keys,i,r,"value"),e.times=i,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,i=e.constructor;if(void 0!==i.toJSON)t=i.toJSON(e);else{t={name:e.name,times:jo.convertArray(e.times,Array),values:jo.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ko;case"vector":case"vector2":case"vector3":case"vector4":return Ho;case"color":return Fo;case"quaternion":return Uo;case"bool":case"boolean":return Oo;case"string":return No}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}}),Object.assign(Vo.prototype,{constructor:Vo,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:W,InterpolantFactoryMethodDiscrete:function(e){return new Go(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new zo(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Bo(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case H:t=this.InterpolantFactoryMethodDiscrete;break;case W:t=this.InterpolantFactoryMethodLinear;break;case X:t=this.InterpolantFactoryMethodSmooth}if(void 0!==t)this.createInterpolant=t;else{var i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}console.warn("THREE.KeyframeTrack:",i)}},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return H;case this.InterpolantFactoryMethodLinear:return W;case this.InterpolantFactoryMethodSmooth:return X}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,i=0,r=t.length;i!==r;++i)t[i]*=e;return this},trim:function(e,t){for(var i=this.times,r=i.length,n=0,o=r-1;n!==r&&i[n]<e;)++n;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==n||o!==r){n>=o&&(n=(o=Math.max(o,1))-1);var s=this.getValueSize();this.times=jo.arraySlice(i,n,o),this.values=jo.arraySlice(this.values,n*s,o*s)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var i=this.times,r=this.values,n=i.length;0===n&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var o=null,s=0;s!==n;s++){var a=i[s];if("number"==typeof a&&isNaN(a)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,s,a),e=!1;break}if(null!==o&&o>a){console.error("THREE.KeyframeTrack: Out of order keys.",this,s,a,o),e=!1;break}o=a}if(void 0!==r&&jo.isTypedArray(r)){s=0;for(var c=r.length;s!==c;++s){var h=r[s];if(isNaN(h)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,s,h),e=!1;break}}}return e},optimize:function(){for(var e=this.times,t=this.values,i=this.getValueSize(),r=this.getInterpolation()===X,n=1,o=e.length-1,s=1;s<o;++s){var a=!1,c=e[s];if(c!==e[s+1]&&(1!==s||c!==c[0]))if(r)a=!0;else for(var h=s*i,l=h-i,u=h+i,p=0;p!==i;++p){var d=t[h+p];if(d!==t[l+p]||d!==t[u+p]){a=!0;break}}if(a){if(s!==n){e[n]=e[s];var f=s*i,m=n*i;for(p=0;p!==i;++p)t[m+p]=t[f+p]}++n}}if(o>0){e[n]=e[o];for(f=o*i,m=n*i,p=0;p!==i;++p)t[m+p]=t[f+p];++n}return n!==e.length&&(this.times=jo.arraySlice(e,0,n),this.values=jo.arraySlice(t,0,n*i)),this}}),Ho.prototype=Object.assign(Object.create(Vo.prototype),{constructor:Ho,ValueTypeName:"vector"}),Object.assign(Wo,{parse:function(e){for(var t=[],i=e.tracks,r=1/(e.fps||1),n=0,o=i.length;n!==o;++n)t.push(Vo.parse(i[n]).scale(r));return new Wo(e.name,e.duration,t)},toJSON:function(e){for(var t=[],i=e.tracks,r={name:e.name,duration:e.duration,tracks:t},n=0,o=i.length;n!==o;++n)t.push(Vo.toJSON(i[n]));return r},CreateFromMorphTargetSequence:function(e,t,i,r){for(var n=t.length,o=[],s=0;s<n;s++){var a=[],c=[];a.push((s+n-1)%n,s,(s+1)%n),c.push(0,1,0);var h=jo.getKeyframeOrder(a);a=jo.sortedArray(a,1,h),c=jo.sortedArray(c,1,h),r||0!==a[0]||(a.push(n),c.push(c[0])),o.push(new ko(".morphTargetInfluences["+t[s].name+"]",a,c).scale(1/i))}return new Wo(e,-1,o)},findByName:function(e,t){var i=e;if(!Array.isArray(e)){var r=e;i=r.geometry&&r.geometry.animations||r.animations}for(var n=0;n<i.length;n++)if(i[n].name===t)return i[n];return null},CreateClipsFromMorphTargetSequences:function(e,t,i){for(var r={},n=/^([\w-]*?)([\d]+)$/,o=0,s=e.length;o<s;o++){var a=e[o],c=a.name.match(n);if(c&&c.length>1){var h=r[u=c[1]];h||(r[u]=h=[]),h.push(a)}}var l=[];for(var u in r)l.push(Wo.CreateFromMorphTargetSequence(u,r[u],t,i));return l},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var i=function(e,t,i,r,n){if(0!==i.length){var o=[],s=[];jo.flattenJSON(i,o,s,r),0!==o.length&&n.push(new e(t,o,s))}},r=[],n=e.name||"default",o=e.length||-1,s=e.fps||30,a=e.hierarchy||[],c=0;c<a.length;c++){var h=a[c].keys;if(h&&0!==h.length)if(h[0].morphTargets){for(var l={},u=0;u<h.length;u++)if(h[u].morphTargets)for(var p=0;p<h[u].morphTargets.length;p++)l[h[u].morphTargets[p]]=-1;for(var d in l){var f=[],m=[];for(p=0;p!==h[u].morphTargets.length;++p){var v=h[u];f.push(v.time),m.push(v.morphTarget===d?1:0)}r.push(new ko(".morphTargetInfluence["+d+"]",f,m))}o=l.length*(s||1)}else{var g=".bones["+t[c].name+"]";i(Ho,g+".position",h,"pos",r),i(Uo,g+".quaternion",h,"rot",r),i(Ho,g+".scale",h,"scl",r)}}return 0===r.length?null:new Wo(n,o,r)}}),Object.assign(Wo.prototype,{resetDuration:function(){for(var e=0,t=0,i=this.tracks.length;t!==i;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}this.duration=e},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(Xo.prototype,{load:function(e,t,i,r){var n=this;new Wn(n.manager).load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},setTextures:function(e){this.textures=e},parse:function(e){var t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new zn[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(r.uniforms=e.uniforms),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=i(e.map)),void 0!==e.alphaMap&&(r.alphaMap=i(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=i(e.normalMap)),void 0!==e.normalScale){var n=e.normalScale;!1===Array.isArray(n)&&(n=[n,n]),r.normalScale=(new $).fromArray(n)}return void 0!==e.displacementMap&&(r.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=i(e.specularMap)),void 0!==e.envMap&&(r.envMap=i(e.envMap)),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=i(e.gradientMap)),r}}),Object.assign(qo.prototype,{load:function(e,t,i,r){var n=this;new Wn(n.manager).load(e,(function(e){t(n.parse(JSON.parse(e)))}),i,r)},parse:function(e){var t=new ri,i=e.data.index;if(void 0!==i){var r=new Ko[i.type](i.array);t.setIndex(new Ft(r,1))}var n=e.data.attributes;for(var o in n){var s=n[o];r=new Ko[s.type](s.array);t.addAttribute(o,new Ft(r,s.itemSize,s.normalized))}var a=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==a)for(var c=0,h=a.length;c!==h;++c){var l=a[c];t.addGroup(l.start,l.count,l.materialIndex)}var u=e.data.boundingSphere;if(void 0!==u){var p=new ie;void 0!==u.center&&p.fromArray(u.center),t.boundingSphere=new yt(p,u.radius)}return t}});var Yo,Zo,Jo,Qo,Ko={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function $o(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}$o.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,i=0,r=t.length;i<r;i+=2){var n=t[i],o=t[i+1];if(n.test(e))return o}return null}},Object.assign($o.prototype,{crossOrigin:void 0,initMaterials:function(e,t,i){for(var r=[],n=0;n<e.length;++n)r[n]=this.createMaterial(e[n],t,i);return r},createMaterial:(Yo={NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5},Zo=new Qe,Jo=new Jn,Qo=new Xo,function(e,t,i){var r={};function n(e,n,o,s,a){var c,h=t+e,l=$o.Handlers.get(h);null!==l?c=l.load(h):(Jo.setCrossOrigin(i),c=Jo.load(h)),void 0!==n&&(c.repeat.fromArray(n),1!==n[0]&&(c.wrapS=g),1!==n[1]&&(c.wrapT=g)),void 0!==o&&c.offset.fromArray(o),void 0!==s&&("repeat"===s[0]&&(c.wrapS=g),"mirror"===s[0]&&(c.wrapS=b),"repeat"===s[1]&&(c.wrapT=g),"mirror"===s[1]&&(c.wrapT=b)),void 0!==a&&(c.anisotropy=a);var u=K.generateUUID();return r[u]=c,u}var o={uuid:K.generateUUID(),type:"MeshLambertMaterial"};for(var s in e){var a=e[s];switch(s){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":o.name=a;break;case"blending":o.blending=Yo[a];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",s,"is no longer supported.");break;case"colorDiffuse":o.color=Zo.fromArray(a).getHex();break;case"colorSpecular":o.specular=Zo.fromArray(a).getHex();break;case"colorEmissive":o.emissive=Zo.fromArray(a).getHex();break;case"specularCoef":o.shininess=a;break;case"shading":"basic"===a.toLowerCase()&&(o.type="MeshBasicMaterial"),"phong"===a.toLowerCase()&&(o.type="MeshPhongMaterial"),"standard"===a.toLowerCase()&&(o.type="MeshStandardMaterial");break;case"mapDiffuse":o.map=n(a,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":o.emissiveMap=n(a,e.mapEmissiveRepeat,e.mapEmissiveOffset,e.mapEmissiveWrap,e.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":o.lightMap=n(a,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":o.aoMap=n(a,e.mapAORepeat,e.mapAOOffset,e.mapAOWrap,e.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":o.bumpMap=n(a,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy);break;case"mapBumpScale":o.bumpScale=a;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":o.normalMap=n(a,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy);break;case"mapNormalFactor":o.normalScale=[a,a];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":o.specularMap=n(a,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":o.metalnessMap=n(a,e.mapMetalnessRepeat,e.mapMetalnessOffset,e.mapMetalnessWrap,e.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":o.roughnessMap=n(a,e.mapRoughnessRepeat,e.mapRoughnessOffset,e.mapRoughnessWrap,e.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":o.alphaMap=n(a,e.mapAlphaRepeat,e.mapAlphaOffset,e.mapAlphaWrap,e.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":o.side=1;break;case"doubleSided":o.side=2;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),o.opacity=a;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":o[s]=a;break;case"vertexColors":!0===a&&(o.vertexColors=2),"face"===a&&(o.vertexColors=1);break;default:console.error("THREE.Loader.createMaterial: Unsupported",s,a)}}return"MeshBasicMaterial"===o.type&&delete o.emissive,"MeshPhongMaterial"!==o.type&&delete o.specular,o.opacity<1&&(o.transparent=!0),Qo.setTextures(r),Qo.parse(o)})});var es={decodeText:function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",i=0,r=e.length;i<r;i++)t+=String.fromCharCode(e[i]);return t},extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")}};function ts(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Vn,this.withCredentials=!1}function is(e){this.manager=void 0!==e?e:Vn,this.texturePath=""}Object.assign(ts.prototype,{load:function(e,t,i,r){var n=this,o=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:es.extractUrlBase(e),s=new Wn(this.manager);s.setWithCredentials(this.withCredentials),s.load(e,(function(i){var r=JSON.parse(i),s=r.metadata;if(void 0!==s){var a=s.type;if(void 0!==a){if("object"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===a.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var c=n.parse(r,o);t(c.geometry,c.materials)}),i,r)},setTexturePath:function(e){this.texturePath=e},parse:function(e,t){void 0!==e.data&&(e=e.data),void 0!==e.scale?e.scale=1/e.scale:e.scale=1;var i=new Ut;return function(e,t){function i(e,t){return e&1<<t}var r,n,o,s,a,c,h,l,u,p,d,f,m,v,g,y,b,x,w,_,M,E,T,S,A,L=e.faces,R=e.vertices,C=e.normals,P=e.colors,N=e.scale,O=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&O++;for(r=0;r<O;r++)t.faceVertexUvs[r]=[]}for(s=0,a=R.length;s<a;)(x=new ie).x=R[s++]*N,x.y=R[s++]*N,x.z=R[s++]*N,t.vertices.push(x);for(s=0,a=L.length;s<a;)if(d=i(p=L[s++],0),f=i(p,1),m=i(p,3),v=i(p,4),g=i(p,5),y=i(p,6),b=i(p,7),d){if((_=new Ot).a=L[s],_.b=L[s+1],_.c=L[s+3],(M=new Ot).a=L[s+1],M.b=L[s+2],M.c=L[s+3],s+=4,f&&(u=L[s++],_.materialIndex=u,M.materialIndex=u),o=t.faces.length,m)for(r=0;r<O;r++)for(S=e.uvs[r],t.faceVertexUvs[r][o]=[],t.faceVertexUvs[r][o+1]=[],n=0;n<4;n++)A=new $(S[2*(l=L[s++])],S[2*l+1]),2!==n&&t.faceVertexUvs[r][o].push(A),0!==n&&t.faceVertexUvs[r][o+1].push(A);if(v&&(h=3*L[s++],_.normal.set(C[h++],C[h++],C[h]),M.normal.copy(_.normal)),g)for(r=0;r<4;r++)h=3*L[s++],T=new ie(C[h++],C[h++],C[h]),2!==r&&_.vertexNormals.push(T),0!==r&&M.vertexNormals.push(T);if(y&&(E=P[c=L[s++]],_.color.setHex(E),M.color.setHex(E)),b)for(r=0;r<4;r++)E=P[c=L[s++]],2!==r&&_.vertexColors.push(new Qe(E)),0!==r&&M.vertexColors.push(new Qe(E));t.faces.push(_),t.faces.push(M)}else{if((w=new Ot).a=L[s++],w.b=L[s++],w.c=L[s++],f&&(u=L[s++],w.materialIndex=u),o=t.faces.length,m)for(r=0;r<O;r++)for(S=e.uvs[r],t.faceVertexUvs[r][o]=[],n=0;n<3;n++)A=new $(S[2*(l=L[s++])],S[2*l+1]),t.faceVertexUvs[r][o].push(A);if(v&&(h=3*L[s++],w.normal.set(C[h++],C[h++],C[h])),g)for(r=0;r<3;r++)h=3*L[s++],T=new ie(C[h++],C[h++],C[h]),w.vertexNormals.push(T);if(y&&(c=L[s++],w.color.setHex(P[c])),b)for(r=0;r<3;r++)c=L[s++],w.vertexColors.push(new Qe(P[c]));t.faces.push(w)}}(e,i),function(e,t){var i=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,n=e.skinWeights.length;r<n;r+=i){var o=e.skinWeights[r],s=i>1?e.skinWeights[r+1]:0,a=i>2?e.skinWeights[r+2]:0,c=i>3?e.skinWeights[r+3]:0;t.skinWeights.push(new se(o,s,a,c))}if(e.skinIndices)for(r=0,n=e.skinIndices.length;r<n;r+=i){var h=e.skinIndices[r],l=i>1?e.skinIndices[r+1]:0,u=i>2?e.skinIndices[r+2]:0,p=i>3?e.skinIndices[r+3]:0;t.skinIndices.push(new se(h,l,u,p))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}(e,i),function(e,t){var i=e.scale;if(void 0!==e.morphTargets)for(var r=0,n=e.morphTargets.length;r<n;r++){t.morphTargets[r]={},t.morphTargets[r].name=e.morphTargets[r].name,t.morphTargets[r].vertices=[];for(var o=t.morphTargets[r].vertices,s=e.morphTargets[r].vertices,a=0,c=s.length;a<c;a+=3){var h=new ie;h.x=s[a]*i,h.y=s[a+1]*i,h.z=s[a+2]*i,o.push(h)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');var l=t.faces,u=e.morphColors[0].colors;for(r=0,n=l.length;r<n;r++)l[r].color.fromArray(u,3*r)}}(e,i),function(e,t){var i=[],r=[];void 0!==e.animation&&r.push(e.animation),void 0!==e.animations&&(e.animations.length?r=r.concat(e.animations):r.push(e.animations));for(var n=0;n<r.length;n++){var o=Wo.parseAnimation(r[n],t.bones);o&&i.push(o)}if(t.morphTargets){var s=Wo.CreateClipsFromMorphTargetSequences(t.morphTargets,10);i=i.concat(s)}i.length>0&&(t.animations=i)}(e,i),i.computeFaceNormals(),i.computeBoundingSphere(),void 0===e.materials||0===e.materials.length?{geometry:i}:{geometry:i,materials:$o.prototype.initMaterials(e.materials,t,this.crossOrigin)}}}),Object.assign(is.prototype,{load:function(e,t,i,r){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var n=this;new Wn(n.manager).load(e,(function(i){var o=null;try{o=JSON.parse(i)}catch(t){return void 0!==r&&r(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}var s=o.metadata;void 0!==s&&void 0!==s.type&&"geometry"!==s.type.toLowerCase()?n.parse(o,t):console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead.")}),i,r)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var i=this.parseShape(e.shapes),r=this.parseGeometries(e.geometries,i),n=this.parseImages(e.images,(function(){void 0!==t&&t(a)})),o=this.parseTextures(e.textures,n),s=this.parseMaterials(e.materials,o),a=this.parseObject(e.object,r,s);return e.animations&&(a.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(a),a},parseShape:function(e){var t={};if(void 0!==e)for(var i=0,r=e.length;i<r;i++){var n=(new wo).fromJSON(e[i]);t[n.uuid]=n}return t},parseGeometries:function(e,t){var i={};if(void 0!==e)for(var r=new ts,n=new qo,o=0,s=e.length;o<s;o++){var a,c=e[o];switch(c.type){case"PlaneGeometry":case"PlaneBufferGeometry":a=new Cn[c.type](c.width,c.height,c.widthSegments,c.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":a=new Cn[c.type](c.width,c.height,c.depth,c.widthSegments,c.heightSegments,c.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":a=new Cn[c.type](c.radius,c.segments,c.thetaStart,c.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":a=new Cn[c.type](c.radiusTop,c.radiusBottom,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":a=new Cn[c.type](c.radius,c.height,c.radialSegments,c.heightSegments,c.openEnded,c.thetaStart,c.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":a=new Cn[c.type](c.radius,c.widthSegments,c.heightSegments,c.phiStart,c.phiLength,c.thetaStart,c.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":a=new Cn[c.type](c.radius,c.detail);break;case"RingGeometry":case"RingBufferGeometry":a=new Cn[c.type](c.innerRadius,c.outerRadius,c.thetaSegments,c.phiSegments,c.thetaStart,c.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":a=new Cn[c.type](c.radius,c.tube,c.radialSegments,c.tubularSegments,c.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":a=new Cn[c.type](c.radius,c.tube,c.tubularSegments,c.radialSegments,c.p,c.q);break;case"LatheGeometry":case"LatheBufferGeometry":a=new Cn[c.type](c.points,c.segments,c.phiStart,c.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":a=new Cn[c.type](c.vertices,c.indices,c.radius,c.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":var h=[];for(o=0,s=c.shapes.length;o<s;o++){var l=t[c.shapes[o]];h.push(l)}a=new Cn[c.type](h,c.curveSegments);break;case"BufferGeometry":a=n.parse(c);break;case"Geometry":a=r.parse(c,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+c.type+'"');continue}a.uuid=c.uuid,void 0!==c.name&&(a.name=c.name),i[c.uuid]=a}return i},parseMaterials:function(e,t){var i={};if(void 0!==e){var r=new Xo;r.setTextures(t);for(var n=0,o=e.length;n<o;n++){var s=e[n];if("MultiMaterial"===s.type){for(var a=[],c=0;c<s.materials.length;c++)a.push(r.parse(s.materials[c]));i[s.uuid]=a}else i[s.uuid]=r.parse(s)}}return i},parseAnimations:function(e){for(var t=[],i=0;i<e.length;i++){var r=Wo.parse(e[i]);t.push(r)}return t},parseImages:function(e,t){var i=this,r={};function n(e){return i.manager.itemStart(e),o.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemEnd(e),i.manager.itemError(e)}))}if(void 0!==e&&e.length>0){var o=new Yn(new jn(t));o.setCrossOrigin(this.crossOrigin);for(var s=0,a=e.length;s<a;s++){var c=e[s],h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(c.url)?c.url:i.texturePath+c.url;r[c.uuid]=n(h)}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var n=0,o=e.length;n<o;n++){var s=e[n];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var a=new oe(t[s.image]);a.needsUpdate=!0,a.uuid=s.uuid,void 0!==s.name&&(a.name=s.name),void 0!==s.mapping&&(a.mapping=i(s.mapping,ns)),void 0!==s.offset&&a.offset.fromArray(s.offset),void 0!==s.repeat&&a.repeat.fromArray(s.repeat),void 0!==s.center&&a.center.fromArray(s.center),void 0!==s.rotation&&(a.rotation=s.rotation),void 0!==s.wrap&&(a.wrapS=i(s.wrap[0],os),a.wrapT=i(s.wrap[1],os)),void 0!==s.minFilter&&(a.minFilter=i(s.minFilter,ss)),void 0!==s.magFilter&&(a.magFilter=i(s.magFilter,ss)),void 0!==s.anisotropy&&(a.anisotropy=s.anisotropy),void 0!==s.flipY&&(a.flipY=s.flipY),r[s.uuid]=a}return r},parseObject:function(){var e=new ee;return function(t,i,r){var n;function o(e){return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),i[e]}function s(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],i=0,n=e.length;i<n;i++){var o=e[i];void 0===r[o]&&console.warn("THREE.ObjectLoader: Undefined material",o),t.push(r[o])}return t}return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),r[e]}}switch(t.type){case"Scene":n=new rr,void 0!==t.background&&Number.isInteger(t.background)&&(n.background=new Qe(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?n.fog=new ir(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(n.fog=new tr(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":n=new Yi(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(n.focus=t.focus),void 0!==t.zoom&&(n.zoom=t.zoom),void 0!==t.filmGauge&&(n.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(n.filmOffset=t.filmOffset),void 0!==t.view&&(n.view=Object.assign({},t.view));break;case"OrthographicCamera":n=new Nt(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":n=new Co(t.color,t.intensity);break;case"DirectionalLight":n=new Ro(t.color,t.intensity);break;case"PointLight":n=new Ao(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":n=new Po(t.color,t.intensity,t.width,t.height);break;case"SpotLight":n=new So(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":n=new Mo(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var a=o(t.geometry),c=s(t.material);n=a.bones&&a.bones.length>0?new lr(a,c):new di(a,c);break;case"LOD":n=new ar;break;case"Line":n=new pr(o(t.geometry),s(t.material),t.mode);break;case"LineLoop":n=new fr(o(t.geometry),s(t.material));break;case"LineSegments":n=new dr(o(t.geometry),s(t.material));break;case"PointCloud":case"Points":n=new vr(o(t.geometry),s(t.material));break;case"Sprite":n=new sr(s(t.material));break;case"Group":n=new gr;break;default:n=new Ct}if(n.uuid=t.uuid,void 0!==t.name&&(n.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(n.position,n.quaternion,n.scale)):(void 0!==t.position&&n.position.fromArray(t.position),void 0!==t.rotation&&n.rotation.fromArray(t.rotation),void 0!==t.quaternion&&n.quaternion.fromArray(t.quaternion),void 0!==t.scale&&n.scale.fromArray(t.scale)),void 0!==t.castShadow&&(n.castShadow=t.castShadow),void 0!==t.receiveShadow&&(n.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(n.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(n.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&n.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(n.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(n.visible=t.visible),void 0!==t.userData&&(n.userData=t.userData),void 0!==t.children)for(var h=t.children,l=0;l<h.length;l++)n.add(this.parseObject(h[l],i,r));if("LOD"===t.type)for(var u=t.levels,p=0;p<u.length;p++){var d=u[p],f=n.getObjectByProperty("uuid",d.object);void 0!==f&&n.addLevel(f,d.distance)}return n}}()});var rs,ns={UVMapping:u,CubeReflectionMapping:p,CubeRefractionMapping:d,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:f,SphericalReflectionMapping:305,CubeUVReflectionMapping:m,CubeUVRefractionMapping:v},os={RepeatWrapping:g,ClampToEdgeWrapping:y,MirroredRepeatWrapping:b},ss={NearestFilter:x,NearestMipMapNearestFilter:w,NearestMipMapLinearFilter:_,LinearFilter:M,LinearMipMapNearestFilter:E,LinearMipMapLinearFilter:T};function as(e){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.manager=void 0!==e?e:Vn,this.options=void 0}function cs(){this.type="ShapePath",this.subPaths=[],this.currentPath=null}function hs(e){this.type="Font",this.data=e}function ls(e){this.manager=void 0!==e?e:Vn}as.prototype={constructor:as,setOptions:function(e){return this.options=e,this},load:function(e,t,i,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var n=this,o=Gn.get(e);if(void 0!==o)return n.manager.itemStart(e),setTimeout((function(){t&&t(o),n.manager.itemEnd(e)}),0),o;fetch(e).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,n.options)})).then((function(i){Gn.add(e,i),t&&t(i),n.manager.itemEnd(e)})).catch((function(t){r&&r(t),n.manager.itemEnd(e),n.manager.itemError(e)}))},setCrossOrigin:function(){return this},setPath:function(e){return this.path=e,this}},Object.assign(cs.prototype,{moveTo:function(e,t){this.currentPath=new xo,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,i,r){this.currentPath.quadraticCurveTo(e,t,i,r)},bezierCurveTo:function(e,t,i,r,n,o){this.currentPath.bezierCurveTo(e,t,i,r,n,o)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function i(e){for(var t=[],i=0,r=e.length;i<r;i++){var n=e[i],o=new wo;o.curves=n.curves,t.push(o)}return t}function r(e,t){for(var i=t.length,r=!1,n=i-1,o=0;o<i;n=o++){var s=t[n],a=t[o],c=a.x-s.x,h=a.y-s.y;if(Math.abs(h)>Number.EPSILON){if(h<0&&(s=t[o],c=-c,a=t[n],h=-h),e.y<s.y||e.y>a.y)continue;if(e.y===s.y){if(e.x===s.x)return!0}else{var l=h*(e.x-s.x)-c*(e.y-s.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(e.y!==s.y)continue;if(a.x<=e.x&&e.x<=s.x||s.x<=e.x&&e.x<=a.x)return!0}}return r}var n=hn.isClockWise,o=this.subPaths;if(0===o.length)return[];if(!0===t)return i(o);var s,a,c,h=[];if(1===o.length)return a=o[0],(c=new wo).curves=a.curves,h.push(c),h;var l=!n(o[0].getPoints());l=e?!l:l;var u,p,d=[],f=[],m=[],v=0;f[v]=void 0,m[v]=[];for(var g=0,y=o.length;g<y;g++)s=n(u=(a=o[g]).getPoints()),(s=e?!s:s)?(!l&&f[v]&&v++,f[v]={s:new wo,p:u},f[v].s.curves=a.curves,l&&v++,m[v]=[]):m[v].push({h:a,p:u[0]});if(!f[0])return i(o);if(f.length>1){for(var b=!1,x=[],w=0,_=f.length;w<_;w++)d[w]=[];for(w=0,_=f.length;w<_;w++)for(var M=m[w],E=0;E<M.length;E++){for(var T=M[E],S=!0,A=0;A<f.length;A++)r(T.p,f[A].p)&&(w!==A&&x.push({froms:w,tos:A,hole:E}),S?(S=!1,d[A].push(T)):b=!0);S&&d[w].push(T)}x.length>0&&(b||(m=d))}g=0;for(var L=f.length;g<L;g++){c=f[g].s,h.push(c);for(var R=0,C=(p=m[g]).length;R<C;R++)c.holes.push(p[R].h)}return h}}),Object.assign(hs.prototype,{isFont:!0,generateShapes:function(e,t,i){function r(e,t,i,r){var o=n.glyphs[e]||n.glyphs["?"];if(o){var s,a,c,h,l,u,p,d,f=new cs;if(o.o)for(var m=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),v=0,g=m.length;v<g;){switch(m[v++]){case"m":s=m[v++]*t+i,a=m[v++]*t+r,f.moveTo(s,a);break;case"l":s=m[v++]*t+i,a=m[v++]*t+r,f.lineTo(s,a);break;case"q":c=m[v++]*t+i,h=m[v++]*t+r,l=m[v++]*t+i,u=m[v++]*t+r,f.quadraticCurveTo(l,u,c,h);break;case"b":c=m[v++]*t+i,h=m[v++]*t+r,l=m[v++]*t+i,u=m[v++]*t+r,p=m[v++]*t+i,d=m[v++]*t+r,f.bezierCurveTo(l,u,p,d,c,h)}}return{offsetX:o.ha*t,path:f}}}void 0===t&&(t=100);for(var n=this.data,o=function(e){for(var i=String(e).split(""),o=t/n.resolution,s=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*o,a=0,c=0,h=[],l=0;l<i.length;l++){var u=i[l];if("\n"===u)a=0,c-=s;else{var p=r(u,o,a,c);a+=p.offsetX,h.push(p.path)}}return h}(e),s=[],a=0,c=o.length;a<c;a++)Array.prototype.push.apply(s,o[a].toShapes());return s}}),Object.assign(ls.prototype,{load:function(e,t,i,r){var n=this,o=new Wn(this.manager);o.setPath(this.path),o.load(e,(function(e){var i;try{i=JSON.parse(e)}catch(t){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),i=JSON.parse(e.substring(65,e.length-2))}var r=n.parse(i);t&&t(r)}),i,r)},parse:function(e){return new hs(e)},setPath:function(e){return this.path=e,this}});var us,ps,ds,fs,ms,vs,gs,ys,bs,xs,ws,_s,Ms,Es,Ts,Ss,As={getContext:function(){return void 0===rs&&(rs=new(window.AudioContext||window.webkitAudioContext)),rs},setContext:function(e){rs=e}};function Ls(e){this.manager=void 0!==e?e:Vn}function Rs(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Yi,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Yi,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Cs(e,t,i){Ct.call(this),this.type="CubeCamera";var r=90,n=new Yi(r,1,e,t);n.up.set(0,-1,0),n.lookAt(new ie(1,0,0)),this.add(n);var o=new Yi(r,1,e,t);o.up.set(0,-1,0),o.lookAt(new ie(-1,0,0)),this.add(o);var s=new Yi(r,1,e,t);s.up.set(0,0,1),s.lookAt(new ie(0,1,0)),this.add(s);var a=new Yi(r,1,e,t);a.up.set(0,0,-1),a.lookAt(new ie(0,-1,0)),this.add(a);var c=new Yi(r,1,e,t);c.up.set(0,-1,0),c.lookAt(new ie(0,0,1)),this.add(c);var h=new Yi(r,1,e,t);h.up.set(0,-1,0),h.lookAt(new ie(0,0,-1)),this.add(h);var l={format:N,magFilter:M,minFilter:M};this.renderTarget=new ce(i,i,l),this.renderTarget.texture.name="CubeCamera",this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var i=this.renderTarget,r=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,n,i),i.activeCubeFace=1,e.render(t,o,i),i.activeCubeFace=2,e.render(t,s,i),i.activeCubeFace=3,e.render(t,a,i),i.activeCubeFace=4,e.render(t,c,i),i.texture.generateMipmaps=r,i.activeCubeFace=5,e.render(t,h,i),e.setRenderTarget(null)},this.clear=function(e,t,i,r){for(var n=this.renderTarget,o=0;o<6;o++)n.activeCubeFace=o,e.setRenderTarget(n),e.clear(t,i,r);e.setRenderTarget(null)}}function Ps(){Ct.call(this),this.type="AudioListener",this.context=As.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function Ns(e){Ct.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.offset=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function Os(e){Ns.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Is(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Ds(e,t,i){this.binding=e,this.valueSize=i;var r,n=Float64Array;switch(t){case"quaternion":r=this._slerp;break;case"string":case"bool":n=Array,r=this._select;break;default:r=this._lerp}this.buffer=new n(4*i),this._mixBufferRegion=r,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Us(e,t,i){var r=i||Fs.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Fs(e,t,i){this.path=t,this.parsedPath=i||Fs.parseTrackName(t),this.node=Fs.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function ks(){this.uuid=K.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Bs(e,t,i){this._mixer=e,this._clip=t,this._localRoot=i||null;for(var r=t.tracks,n=r.length,o=new Array(n),s={endingStart:q,endingEnd:q},a=0;a!==n;++a){var c=r[a].createInterpolant(null);o[a]=c,c.settings=s}this._interpolantSettings=s,this._interpolants=o,this._propertyBindings=new Array(n),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function zs(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Gs(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function js(){ri.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Vs(e,t,i,r){this.uuid=K.generateUUID(),this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===r}function Hs(e,t){this.uuid=K.generateUUID(),this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function Ws(e,t,i){Hs.call(this,e,t),this.meshPerAttribute=i||1}function Xs(e,t,i){Ft.call(this,e,t),this.meshPerAttribute=i||1}function qs(e,t,i,r){this.ray=new li(e,t),this.near=i||0,this.far=r||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function Ys(e,t){return e.distance-t.distance}function Zs(e,t,i,r){if(!1!==e.visible&&(e.raycast(t,i),!0===r))for(var n=e.children,o=0,s=n.length;o<s;o++)Zs(n[o],t,i,!0)}function Js(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function Qs(e,t,i){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==i?i:0,this}function Ks(e,t,i){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==i?i:0,this}function $s(e){Ct.call(this),this.material=e,this.render=function(){}}function ea(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16711680,o=void 0!==r?r:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=3*a.faces.length:a&&a.isBufferGeometry&&(s=a.attributes.normal.count);var c=new ri,h=new Wt(2*s*3,3);c.addAttribute("position",h),dr.call(this,c,new ur({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function ta(e,t){Ct.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var i=new ri,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],n=0,o=1;n<32;n++,o++){var s=n/32*Math.PI*2,a=o/32*Math.PI*2;r.push(Math.cos(s),Math.sin(s),1,Math.cos(a),Math.sin(a),1)}i.addAttribute("position",new Wt(r,3));var c=new ur({fog:!1});this.cone=new dr(i,c),this.add(this.cone),this.update()}function ia(e){var t=[];e&&e.isBone&&t.push(e);for(var i=0;i<e.children.length;i++)t.push.apply(t,ia(e.children[i]));return t}function ra(e){for(var t=ia(e),i=new ri,r=[],n=[],o=new Qe(0,0,1),s=new Qe(0,1,0),a=0;a<t.length;a++){var c=t[a];c.parent&&c.parent.isBone&&(r.push(0,0,0),r.push(0,0,0),n.push(o.r,o.g,o.b),n.push(s.r,s.g,s.b))}i.addAttribute("position",new Wt(r,3)),i.addAttribute("color",new Wt(n,3));var h=new ur({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});dr.call(this,i,h),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function na(e,t,i){this.light=e,this.light.updateMatrixWorld(),this.color=i;var r=new mn(t,4,2),n=new ci({wireframe:!0,fog:!1});di.call(this,r,n),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}function oa(e,t){Ct.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;var i=new ur({fog:!1}),r=new ri;r.addAttribute("position",new Ft(new Float32Array(15),3)),this.line=new pr(r,i),this.add(this.line),this.update()}function sa(e,t,i){Ct.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;var r=new Rr(t);r.rotateY(.5*Math.PI),this.material=new ci({wireframe:!0,fog:!1}),void 0===this.color&&(this.material.vertexColors=2);var n=r.getAttribute("position"),o=new Float32Array(3*n.count);r.addAttribute("color",new Ft(o,3)),this.add(new di(r,this.material)),this.update()}function aa(e,t,i,r){e=e||10,t=t||10,i=new Qe(void 0!==i?i:4473924),r=new Qe(void 0!==r?r:8947848);for(var n=t/2,o=e/t,s=e/2,a=[],c=[],h=0,l=0,u=-s;h<=t;h++,u+=o){a.push(-s,0,u,s,0,u),a.push(u,0,-s,u,0,s);var p=h===n?i:r;p.toArray(c,l),l+=3,p.toArray(c,l),l+=3,p.toArray(c,l),l+=3,p.toArray(c,l),l+=3}var d=new ri;d.addAttribute("position",new Wt(a,3)),d.addAttribute("color",new Wt(c,3));var f=new ur({vertexColors:2});dr.call(this,d,f)}function ca(e,t,i,r,n,o){e=e||10,t=t||16,i=i||8,r=r||64,n=new Qe(void 0!==n?n:4473924),o=new Qe(void 0!==o?o:8947848);var s,a,c,h,l,u,p,d=[],f=[];for(h=0;h<=t;h++)c=h/t*(2*Math.PI),s=Math.sin(c)*e,a=Math.cos(c)*e,d.push(0,0,0),d.push(s,0,a),p=1&h?n:o,f.push(p.r,p.g,p.b),f.push(p.r,p.g,p.b);for(h=0;h<=i;h++)for(p=1&h?n:o,u=e-e/i*h,l=0;l<r;l++)c=l/r*(2*Math.PI),s=Math.sin(c)*u,a=Math.cos(c)*u,d.push(s,0,a),f.push(p.r,p.g,p.b),c=(l+1)/r*(2*Math.PI),s=Math.sin(c)*u,a=Math.cos(c)*u,d.push(s,0,a),f.push(p.r,p.g,p.b);var m=new ri;m.addAttribute("position",new Wt(d,3)),m.addAttribute("color",new Wt(f,3));var v=new ur({vertexColors:2});dr.call(this,m,v)}function ha(e,t,i,r){this.object=e,this.size=void 0!==t?t:1;var n=void 0!==i?i:16776960,o=void 0!==r?r:1,s=0,a=this.object.geometry;a&&a.isGeometry?s=a.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var c=new ri,h=new Wt(2*s*3,3);c.addAttribute("position",h),dr.call(this,c,new ur({color:n,linewidth:o})),this.matrixAutoUpdate=!1,this.update()}function la(e,t,i){Ct.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);var r=new ri;r.addAttribute("position",new Wt([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var n=new ur({fog:!1});this.lightPlane=new pr(r,n),this.add(this.lightPlane),(r=new ri).addAttribute("position",new Wt([0,0,0,0,0,1],3)),this.targetLine=new pr(r,n),this.add(this.targetLine),this.update()}function ua(e){var t=new ri,i=new ur({color:16777215,vertexColors:1}),r=[],n=[],o={},s=new Qe(16755200),a=new Qe(16711680),c=new Qe(43775),h=new Qe(16777215),l=new Qe(3355443);function u(e,t,i){p(e,i),p(t,i)}function p(e,t){r.push(0,0,0),n.push(t.r,t.g,t.b),void 0===o[e]&&(o[e]=[]),o[e].push(r.length/3-1)}u("n1","n2",s),u("n2","n4",s),u("n4","n3",s),u("n3","n1",s),u("f1","f2",s),u("f2","f4",s),u("f4","f3",s),u("f3","f1",s),u("n1","f1",s),u("n2","f2",s),u("n3","f3",s),u("n4","f4",s),u("p","n1",a),u("p","n2",a),u("p","n3",a),u("p","n4",a),u("u1","u2",c),u("u2","u3",c),u("u3","u1",c),u("c","t",h),u("p","c",l),u("cn1","cn2",l),u("cn3","cn4",l),u("cf1","cf2",l),u("cf3","cf4",l),t.addAttribute("position",new Wt(r,3)),t.addAttribute("color",new Wt(n,3)),dr.call(this,t,i),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()}function pa(e,t){this.object=e,void 0===t&&(t=16776960);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Float32Array(24),n=new ri;n.setIndex(new Ft(i,1)),n.addAttribute("position",new Ft(r,3)),dr.call(this,n,new ur({color:t})),this.matrixAutoUpdate=!1,this.update()}function da(e,t){this.type="Box3Helper",this.box=e;var i=void 0!==t?t:16776960,r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new ri;n.setIndex(new Ft(r,1)),n.addAttribute("position",new Wt([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),dr.call(this,n,new ur({color:i})),this.geometry.computeBoundingSphere()}function fa(e,t,i){this.type="PlaneHelper",this.plane=e,this.size=void 0===t?1:t;var r=void 0!==i?i:16776960,n=new ri;n.addAttribute("position",new Wt([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),n.computeBoundingSphere(),pr.call(this,n,new ur({color:r}));var o=new ri;o.addAttribute("position",new Wt([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),o.computeBoundingSphere(),this.add(new di(o,new ci({color:r,opacity:.2,transparent:!0,depthWrite:!1})))}function ma(e,t,i,r,n,o){Ct.call(this),void 0===r&&(r=16776960),void 0===i&&(i=1),void 0===n&&(n=.2*i),void 0===o&&(o=.2*n),void 0===Ms&&((Ms=new ri).addAttribute("position",new Wt([0,0,0,0,1,0],3)),(Es=new Tn(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new pr(Ms,new ur({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new di(Es,new ci({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,n,o)}function va(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new ri;i.addAttribute("position",new Wt(t,3)),i.addAttribute("color",new Wt([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var r=new ur({vertexColors:2});dr.call(this,i,r)}Object.assign(Ls.prototype,{load:function(e,t,i,r){var n=new Wn(this.manager);n.setResponseType("arraybuffer"),n.load(e,(function(e){As.getContext().decodeAudioData(e,(function(e){t(e)}))}),i,r)}}),Object.assign(Rs.prototype,{update:(bs=new ee,xs=new ee,function(e){if(us!==this||ps!==e.focus||ds!==e.fov||fs!==e.aspect*this.aspect||ms!==e.near||vs!==e.far||gs!==e.zoom||ys!==this.eyeSep){us=this,ps=e.focus,ds=e.fov,fs=e.aspect*this.aspect,ms=e.near,vs=e.far,gs=e.zoom;var t,i,r=e.projectionMatrix.clone(),n=(ys=this.eyeSep/2)*ms/ps,o=ms*Math.tan(K.DEG2RAD*ds*.5)/gs;xs.elements[12]=-ys,bs.elements[12]=ys,t=-o*fs+n,i=o*fs+n,r.elements[0]=2*ms/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraL.projectionMatrix.copy(r),t=-o*fs-n,i=o*fs-n,r.elements[0]=2*ms/(i-t),r.elements[8]=(i+t)/(i-t),this.cameraR.projectionMatrix.copy(r)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(xs),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(bs)})}),Cs.prototype=Object.create(Ct.prototype),Cs.prototype.constructor=Cs,Ps.prototype=Object.assign(Object.create(Ct.prototype),{constructor:Ps,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new ie,t=new te,i=new ie,r=new ie;return function(n){Ct.prototype.updateMatrixWorld.call(this,n);var o=this.context.listener,s=this.up;this.matrixWorld.decompose(e,t,i),r.set(0,0,-1).applyQuaternion(t),o.positionX?(o.positionX.setValueAtTime(e.x,this.context.currentTime),o.positionY.setValueAtTime(e.y,this.context.currentTime),o.positionZ.setValueAtTime(e.z,this.context.currentTime),o.forwardX.setValueAtTime(r.x,this.context.currentTime),o.forwardY.setValueAtTime(r.y,this.context.currentTime),o.forwardZ.setValueAtTime(r.z,this.context.currentTime),o.upX.setValueAtTime(s.x,this.context.currentTime),o.upY.setValueAtTime(s.y,this.context.currentTime),o.upZ.setValueAtTime(s.z,this.context.currentTime)):(o.setPosition(e.x,e.y,e.z),o.setOrientation(r.x,r.y,r.z,s.x,s.y,s.z))}}()}),Ns.prototype=Object.assign(Object.create(Ct.prototype),{constructor:Ns,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),this.startTime=this.context.currentTime,e.start(this.startTime,this.offset),this.isPlaying=!0,this.source=e,this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this.source.stop(),this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this.source.stop(),this.offset=0,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),!0===this.isPlaying?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),Os.prototype=Object.assign(Object.create(Ns.prototype),{constructor:Os,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new ie;return function(t){Ct.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(Is.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),i=0;i<t.length;i++)e+=t[i];return e/t.length}}),Object.assign(Ds.prototype,{accumulate:function(e,t){var i=this.buffer,r=this.valueSize,n=e*r+r,o=this.cumulativeWeight;if(0===o){for(var s=0;s!==r;++s)i[n+s]=i[s];o=t}else{var a=t/(o+=t);this._mixBufferRegion(i,n,0,a,r)}this.cumulativeWeight=o},apply:function(e){var t=this.valueSize,i=this.buffer,r=e*t+t,n=this.cumulativeWeight,o=this.binding;if(this.cumulativeWeight=0,n<1){var s=3*t;this._mixBufferRegion(i,r,s,1-n,t)}for(var a=t,c=t+t;a!==c;++a)if(i[a]!==i[a+t]){o.setValue(i,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,i=this.valueSize,r=3*i;e.getValue(t,r);for(var n=i,o=r;n!==o;++n)t[n]=t[r+n%i];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,i,r,n){if(r>=.5)for(var o=0;o!==n;++o)e[t+o]=e[i+o]},_slerp:function(e,t,i,r){te.slerpFlat(e,t,e,t,e,i,r)},_lerp:function(e,t,i,r,n){for(var o=1-r,s=0;s!==n;++s){var a=t+s;e[a]=e[a]*o+e[i+s]*r}}}),Object.assign(Us.prototype,{getValue:function(e,t){this.bind();var i=this._targetGroup.nCachedObjects_,r=this._bindings[i];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var i=this._bindings,r=this._targetGroup.nCachedObjects_,n=i.length;r!==n;++r)i[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}),Object.assign(Fs,{Composite:Us,create:function(e,t,i){return e&&e.isAnimationObjectGroup?new Fs.Composite(e,t,i):new Fs(e,t,i)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:(ws=new RegExp("^"+/((?:[\w-]+[\/:])*)/.source+/([\w-\.]+)?/.source+/(?:\.([\w-]+)(?:\[(.+)\])?)?/.source+/\.([\w-]+)(?:\[(.+)\])?/.source+"$"),_s=["material","materials","bones"],function(e){var t=ws.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var n=i.nodeName.substring(r+1);-1!==_s.indexOf(n)&&(i.nodeName=i.nodeName.substring(0,r),i.objectName=n)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var i=function(e){for(var i=0;i<e.bones.length;i++){var r=e.bones[i];if(r.name===t)return r}return null}(e.skeleton);if(i)return i}if(e.children){var r=function(e){for(var i=0;i<e.length;i++){var n=e[i];if(n.name===t||n.uuid===t)return n;var o=r(n.children);if(o)return o}return null},n=r(e.children);if(n)return n}return null}}),Object.assign(Fs.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)e[t++]=i[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++]},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var i=this.resolvedProperty,r=0,n=i.length;r!==n;++r)i[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,i=t.objectName,r=t.propertyName,n=t.propertyIndex;if(e||(e=Fs.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(i){var o=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var s=0;s<e.length;s++)if(e[s].name===o){o=s;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==o){if(void 0===e[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[o]}}var a=e[r];if(void 0!==a){var c=this.Versioning.None;void 0!==e.needsUpdate?(c=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var h=this.BindingType.Direct;if(void 0!==n){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(s=0;s<this.node.geometry.morphAttributes.position.length;s++)if(e.geometry.morphAttributes.position[s].name===n){n=s;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(s=0;s<this.node.geometry.morphTargets.length;s++)if(e.geometry.morphTargets[s].name===n){n=s;break}}}h=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else void 0!==a.fromArray&&void 0!==a.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(h=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][c]}else{var l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),
//!\ DECLARE ALIAS AFTER assign prototype !
Object.assign(Fs.prototype,{_getValue_unbound:Fs.prototype.getValue,_setValue_unbound:Fs.prototype.setValue}),Object.assign(ks.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._paths,o=this._parsedPaths,s=this._bindings,a=s.length,c=0,h=arguments.length;c!==h;++c){var l=arguments[c],u=l.uuid,p=r[u],d=void 0;if(void 0===p){p=t++,r[u]=p,e.push(l);for(var f=0,m=a;f!==m;++f)s[f].push(new Fs(l,n[f],o[f]))}else if(p<i){d=e[p];var v=--i,g=e[v];r[g.uuid]=p,e[p]=g,r[u]=v,e[v]=l;for(f=0,m=a;f!==m;++f){var y=s[f],b=y[v],x=y[p];y[p]=b,void 0===x&&(x=new Fs(l,n[f],o[f])),y[v]=x}}else e[p]!==d&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,n=r.length,o=0,s=arguments.length;o!==s;++o){var a=arguments[o],c=a.uuid,h=i[c];if(void 0!==h&&h>=t){var l=t++,u=e[l];i[u.uuid]=h,e[h]=u,i[c]=l,e[l]=a;for(var p=0,d=n;p!==d;++p){var f=r[p],m=f[l],v=f[h];f[h]=m,f[l]=v}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,i=this.nCachedObjects_,r=this._indicesByUUID,n=this._bindings,o=n.length,s=0,a=arguments.length;s!==a;++s){var c=arguments[s],h=c.uuid,l=r[h];if(void 0!==l)if(delete r[h],l<i){var u=--i,p=e[u],d=e[y=--t];r[p.uuid]=l,e[l]=p,r[d.uuid]=u,e[u]=d,e.pop();for(var f=0,m=o;f!==m;++f){var v=(b=n[f])[u],g=b[y];b[l]=v,b[u]=g,b.pop()}}else{var y;r[(d=e[y=--t]).uuid]=l,e[l]=d,e.pop();for(f=0,m=o;f!==m;++f){var b;(b=n[f])[l]=b[y],b.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var i=this._bindingsIndicesByPath,r=i[e],n=this._bindings;if(void 0!==r)return n[r];var o=this._paths,s=this._parsedPaths,a=this._objects,c=a.length,h=this.nCachedObjects_,l=new Array(c);r=n.length,i[e]=r,o.push(e),s.push(t),n.push(l);for(var u=h,p=a.length;u!==p;++u){var d=a[u];l[u]=new Fs(d,e,t)}return l},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){var r=this._paths,n=this._parsedPaths,o=this._bindings,s=o.length-1,a=o[s];t[e[s]]=i,o[i]=a,o.pop(),n[i]=n[s],n.pop(),r[i]=r[s],r.pop()}}}),Object.assign(Bs.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){var r=this._clip.duration,n=e._clip.duration,o=n/r,s=r/n;e.warp(1,o,t),this.warp(s,1,t)}return this},crossFadeTo:function(e,t,i){return e.crossFadeFrom(this,t,i)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,i){var r=this._mixer,n=r.time,o=this._timeScaleInterpolant,s=this.timeScale;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var a=o.parameterPositions,c=o.sampleValues;return a[0]=n,a[1]=n+i,c[0]=e/s,c[1]=t/s,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,i,r){if(this.enabled){var n=this._startTime;if(null!==n){var o=(e-n)*i;if(o<0||0===i)return;this._startTime=null,t=i*o}t*=this._updateTimeScale(e);var s=this._updateTime(t),a=this._updateWeight(e);if(a>0)for(var c=this._interpolants,h=this._propertyBindings,l=0,u=c.length;l!==u;++l)c[l].evaluate(s),h[l].accumulate(r,a)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var i=this._weightInterpolant;if(null!==i){var r=i.evaluate(e)[0];t*=r,e>i.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var i=this._timeScaleInterpolant;if(null!==i)t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var i=this._clip.duration,r=this.loop,n=this._loopCount;if(2200===r){-1===n&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=i)t=i;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var o=2202===r;if(-1===n&&(e>=0?(n=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),t>=i||t<0){var s=Math.floor(t/i);t-=i*s,n+=Math.abs(s);var a=this.repetitions-n;if(a<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?i:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(0===a){var c=e<0;this._setEndings(c,!c,o)}else this._setEndings(!1,!1,o);this._loopCount=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:s})}}if(o&&1==(1&n))return this.time=t,i-t}return this.time=t,t},_setEndings:function(e,t,i){var r=this._interpolantSettings;i?(r.endingStart=Y,r.endingEnd=Y):(r.endingStart=e?this.zeroSlopeAtStart?Y:q:Z,r.endingEnd=t?this.zeroSlopeAtEnd?Y:q:Z)},_scheduleFading:function(e,t,i){var r=this._mixer,n=r.time,o=this._weightInterpolant;null===o&&(o=r._lendControlInterpolant(),this._weightInterpolant=o);var s=o.parameterPositions,a=o.sampleValues;return s[0]=n,a[0]=t,s[1]=n+e,a[1]=i,this}}),zs.prototype=Object.assign(Object.create(t.prototype),{constructor:zs,_bindAction:function(e,t){var i=e._localRoot||this._root,r=e._clip.tracks,n=r.length,o=e._propertyBindings,s=e._interpolants,a=i.uuid,c=this._bindingsByRootAndName,h=c[a];void 0===h&&(h={},c[a]=h);for(var l=0;l!==n;++l){var u=r[l],p=u.name,d=h[p];if(void 0!==d)o[l]=d;else{if(void 0!==(d=o[l])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,a,p));continue}var f=t&&t._propertyBindings[l].binding.parsedPath;++(d=new Ds(Fs.create(i,p,f),u.ValueTypeName,u.getValueSize())).referenceCount,this._addInactiveBinding(d,a,p),o[l]=d}s[l].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,i=e._clip.uuid,r=this._actionsByClip[i];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,i,t)}for(var n=e._propertyBindings,o=0,s=n.length;o!==s;++o){var a=n[o];0==a.useCount++&&(this._lendBinding(a),a.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.useCount&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,i){var r=this._actions,n=this._actionsByClip,o=n[t];if(void 0===o)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,n[t]=o;else{var s=o.knownActions;e._byClipCacheIndex=s.length,s.push(e)}e._cacheIndex=r.length,r.push(e),o.actionByRoot[i]=e},_removeInactiveAction:function(e){var t=this._actions,i=t[t.length-1],r=e._cacheIndex;i._cacheIndex=r,t[r]=i,t.pop(),e._cacheIndex=null;var n=e._clip.uuid,o=this._actionsByClip,s=o[n],a=s.knownActions,c=a[a.length-1],h=e._byClipCacheIndex;c._byClipCacheIndex=h,a[h]=c,a.pop(),e._byClipCacheIndex=null,delete s.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete o[n],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,i=0,r=t.length;i!==r;++i){var n=t[i];0==--n.referenceCount&&this._removeInactiveBinding(n)}},_lendAction:function(e){var t=this._actions,i=e._cacheIndex,r=this._nActiveActions++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackAction:function(e){var t=this._actions,i=e._cacheIndex,r=--this._nActiveActions,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_addInactiveBinding:function(e,t,i){var r=this._bindingsByRootAndName,n=r[t],o=this._bindings;void 0===n&&(n={},r[t]=n),n[i]=e,e._cacheIndex=o.length,o.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,i=e.binding,r=i.rootNode.uuid,n=i.path,o=this._bindingsByRootAndName,s=o[r],a=t[t.length-1],c=e._cacheIndex;a._cacheIndex=c,t[c]=a,t.pop(),delete s[n];e:{for(var h in s)break e;delete o[r]}},_lendBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=this._nActiveBindings++,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_takeBackBinding:function(e){var t=this._bindings,i=e._cacheIndex,r=--this._nActiveBindings,n=t[r];e._cacheIndex=r,t[r]=e,n._cacheIndex=i,t[i]=n},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,i=e[t];return void 0===i&&((i=new zo(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=i),i},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,i=e.__cacheIndex,r=--this._nActiveControlInterpolants,n=t[r];e.__cacheIndex=r,t[r]=e,n.__cacheIndex=i,t[i]=n},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?Wo.findByName(i,e):e,o=null!==n?n.uuid:e,s=this._actionsByClip[o],a=null;if(void 0!==s){var c=s.actionByRoot[r];if(void 0!==c)return c;a=s.knownActions[0],null===n&&(n=a._clip)}if(null===n)return null;var h=new Bs(this,n,t);return this._bindAction(h,a),this._addInactiveAction(h,o,r),h},existingAction:function(e,t){var i=t||this._root,r=i.uuid,n="string"==typeof e?Wo.findByName(i,e):e,o=n?n.uuid:e,s=this._actionsByClip[o];return void 0!==s&&s.actionByRoot[r]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,i=this._bindings,r=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var n=0;n!==t;++n)e[n].reset();for(n=0;n!==r;++n)i[n].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,i=this._nActiveActions,r=this.time+=e,n=Math.sign(e),o=this._accuIndex^=1,s=0;s!==i;++s){t[s]._update(r,e,n,o)}var a=this._bindings,c=this._nActiveBindings;for(s=0;s!==c;++s)a[s].apply(o);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,i=e.uuid,r=this._actionsByClip,n=r[i];if(void 0!==n){for(var o=n.knownActions,s=0,a=o.length;s!==a;++s){var c=o[s];this._deactivateAction(c);var h=c._cacheIndex,l=t[t.length-1];c._cacheIndex=null,c._byClipCacheIndex=null,l._cacheIndex=h,t[h]=l,t.pop(),this._removeInactiveBindingsForAction(c)}delete r[i]}},uncacheRoot:function(e){var t=e.uuid,i=this._actionsByClip;for(var r in i){var n=i[r].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}var o=this._bindingsByRootAndName[t];if(void 0!==o)for(var s in o){var a=o[s];a.restoreOriginalState(),this._removeInactiveBinding(a)}},uncacheAction:function(e,t){var i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}),Gs.prototype.clone=function(){return new Gs(void 0===this.value.clone?this.value:this.value.clone())},js.prototype=Object.assign(Object.create(ri.prototype),{constructor:js,isInstancedBufferGeometry:!0,copy:function(e){return ri.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return(new this.constructor).copy(this)}}),Object.defineProperties(Vs.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Vs.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this},setXYZ:function(e,t,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this},setXYZW:function(e,t,i,r,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=r,this.data.array[e+3]=n,this}}),Object.defineProperty(Hs.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(Hs.prototype,{isInterleavedBuffer:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,i){e*=this.stride,i*=t.stride;for(var r=0,n=this.stride;r<n;r++)this.array[e+r]=t.array[i+r];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),Ws.prototype=Object.assign(Object.create(Hs.prototype),{constructor:Ws,isInstancedInterleavedBuffer:!0,copy:function(e){return Hs.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Xs.prototype=Object.assign(Object.create(Ft.prototype),{constructor:Xs,isInstancedBufferAttribute:!0,copy:function(e){return Ft.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(qs.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var i=[];return Zs(e,this,i,t),i.sort(Ys),i},intersectObjects:function(e,t){var i=[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var r=0,n=e.length;r<n;r++)Zs(e[r],this,i,t);return i.sort(Ys),i}}),Object.assign(Js.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(Qs.prototype,{set:function(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(K.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(Ks.prototype,{set:function(e,t,i){return this.radius=e,this.theta=t,this.y=i,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),$s.prototype=Object.create(Ct.prototype),$s.prototype.constructor=$s,$s.prototype.isImmediateRenderObject=!0,ea.prototype=Object.create(dr.prototype),ea.prototype.constructor=ea,ea.prototype.update=function(){var e=new ie,t=new ie,i=new re;return function(){var r=["a","b","c"];this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);var n=this.object.matrixWorld,o=this.geometry.attributes.position,s=this.object.geometry;if(s&&s.isGeometry)for(var a=s.vertices,c=s.faces,h=0,l=0,u=c.length;l<u;l++)for(var p=c[l],d=0,f=p.vertexNormals.length;d<f;d++){var m=a[p[r[d]]],v=p.vertexNormals[d];e.copy(m).applyMatrix4(n),t.copy(v).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(h,e.x,e.y,e.z),h+=1,o.setXYZ(h,t.x,t.y,t.z),h+=1}else if(s&&s.isBufferGeometry){var g=s.attributes.position,y=s.attributes.normal;for(h=0,d=0,f=g.count;d<f;d++)e.set(g.getX(d),g.getY(d),g.getZ(d)).applyMatrix4(n),t.set(y.getX(d),y.getY(d),y.getZ(d)),t.applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),o.setXYZ(h,e.x,e.y,e.z),h+=1,o.setXYZ(h,t.x,t.y,t.z),h+=1}o.needsUpdate=!0}}(),ta.prototype=Object.create(Ct.prototype),ta.prototype.constructor=ta,ta.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},ta.prototype.update=function(){var e=new ie,t=new ie;return function(){this.light.updateMatrixWorld();var i=this.light.distance?this.light.distance:1e3,r=i*Math.tan(this.light.angle);this.cone.scale.set(r,r,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}(),ra.prototype=Object.create(dr.prototype),ra.prototype.constructor=ra,ra.prototype.updateMatrixWorld=function(){var e=new ie,t=new ee,i=new ee;return function(r){var n=this.bones,o=this.geometry,s=o.getAttribute("position");i.getInverse(this.root.matrixWorld);for(var a=0,c=0;a<n.length;a++){var h=n[a];h.parent&&h.parent.isBone&&(t.multiplyMatrices(i,h.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c,e.x,e.y,e.z),t.multiplyMatrices(i,h.parent.matrixWorld),e.setFromMatrixPosition(t),s.setXYZ(c+1,e.x,e.y,e.z),c+=2)}o.getAttribute("position").needsUpdate=!0,Ct.prototype.updateMatrixWorld.call(this,r)}}(),na.prototype=Object.create(di.prototype),na.prototype.constructor=na,na.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},na.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)},oa.prototype=Object.create(Ct.prototype),oa.prototype.constructor=oa,oa.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},oa.prototype.update=function(){var e=.5*this.light.width,t=.5*this.light.height,i=this.line.geometry.attributes.position,r=i.array;r[0]=e,r[1]=-t,r[2]=0,r[3]=e,r[4]=t,r[5]=0,r[6]=-e,r[7]=t,r[8]=0,r[9]=-e,r[10]=-t,r[11]=0,r[12]=e,r[13]=-t,r[14]=0,i.needsUpdate=!0,void 0!==this.color?this.line.material.color.set(this.color):this.line.material.color.copy(this.light.color)},sa.prototype=Object.create(Ct.prototype),sa.prototype.constructor=sa,sa.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},sa.prototype.update=function(){var e=new ie,t=new Qe,i=new Qe;return function(){var r=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var n=r.geometry.getAttribute("color");t.copy(this.light.color),i.copy(this.light.groundColor);for(var o=0,s=n.count;o<s;o++){var a=o<s/2?t:i;n.setXYZ(o,a.r,a.g,a.b)}n.needsUpdate=!0}r.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate())}}(),aa.prototype=Object.create(dr.prototype),aa.prototype.constructor=aa,ca.prototype=Object.create(dr.prototype),ca.prototype.constructor=ca,ha.prototype=Object.create(dr.prototype),ha.prototype.constructor=ha,ha.prototype.update=function(){var e=new ie,t=new ie,i=new re;return function(){this.object.updateMatrixWorld(!0),i.getNormalMatrix(this.object.matrixWorld);for(var r=this.object.matrixWorld,n=this.geometry.attributes.position,o=this.object.geometry,s=o.vertices,a=o.faces,c=0,h=0,l=a.length;h<l;h++){var u=a[h],p=u.normal;e.copy(s[u.a]).add(s[u.b]).add(s[u.c]).divideScalar(3).applyMatrix4(r),t.copy(p).applyMatrix3(i).normalize().multiplyScalar(this.size).add(e),n.setXYZ(c,e.x,e.y,e.z),c+=1,n.setXYZ(c,t.x,t.y,t.z),c+=1}n.needsUpdate=!0}}(),la.prototype=Object.create(Ct.prototype),la.prototype.constructor=la,la.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},la.prototype.update=function(){var e=new ie,t=new ie,i=new ie;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(i),this.targetLine.scale.z=i.length()}}(),ua.prototype=Object.create(dr.prototype),ua.prototype.constructor=ua,ua.prototype.update=function(){var e,t,i=new ie,r=new Pt;function n(n,o,s,a){i.set(o,s,a).unproject(r);var c=t[n];if(void 0!==c)for(var h=e.getAttribute("position"),l=0,u=c.length;l<u;l++)h.setXYZ(c[l],i.x,i.y,i.z)}return function(){e=this.geometry,t=this.pointMap;r.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-1,-1,-1),n("n2",1,-1,-1),n("n3",-1,1,-1),n("n4",1,1,-1),n("f1",-1,-1,1),n("f2",1,-1,1),n("f3",-1,1,1),n("f4",1,1,1),n("u1",.7,1.1,-1),n("u2",-.7,1.1,-1),n("u3",0,2,-1),n("cf1",-1,0,1),n("cf2",1,0,1),n("cf3",0,-1,1),n("cf4",0,1,1),n("cn1",-1,0,-1),n("cn2",1,0,-1),n("cn3",0,-1,-1),n("cn4",0,1,-1),e.getAttribute("position").needsUpdate=!0}}(),pa.prototype=Object.create(dr.prototype),pa.prototype.constructor=pa,pa.prototype.update=function(){var e=new gt;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var i=e.min,r=e.max,n=this.geometry.attributes.position,o=n.array;o[0]=r.x,o[1]=r.y,o[2]=r.z,o[3]=i.x,o[4]=r.y,o[5]=r.z,o[6]=i.x,o[7]=i.y,o[8]=r.z,o[9]=r.x,o[10]=i.y,o[11]=r.z,o[12]=r.x,o[13]=r.y,o[14]=i.z,o[15]=i.x,o[16]=r.y,o[17]=i.z,o[18]=i.x,o[19]=i.y,o[20]=i.z,o[21]=r.x,o[22]=i.y,o[23]=i.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),pa.prototype.setFromObject=function(e){return this.object=e,this.update(),this},da.prototype=Object.create(dr.prototype),da.prototype.constructor=da,da.prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),Ct.prototype.updateMatrixWorld.call(this,e))},fa.prototype=Object.create(pr.prototype),fa.prototype.constructor=fa,fa.prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.lookAt(this.plane.normal),Ct.prototype.updateMatrixWorld.call(this,e)},ma.prototype=Object.create(Ct.prototype),ma.prototype.constructor=ma,ma.prototype.setDirection=(Ss=new ie,function(e){e.y>.99999?this.quaternion.set(0,0,0,1):e.y<-.99999?this.quaternion.set(1,0,0,0):(Ss.set(e.z,0,-e.x).normalize(),Ts=Math.acos(e.y),this.quaternion.setFromAxisAngle(Ss,Ts))}),ma.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},ma.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},va.prototype=Object.create(dr.prototype),va.prototype.constructor=va;var ga={createMultiMaterialObject:function(e,t){for(var i=new gr,r=0,n=t.length;r<n;r++)i.add(new di(e,t[r]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){e.applyMatrix((new ee).getInverse(i.matrixWorld)),t.remove(e),i.add(e)}};function ya(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),so.call(this,e),this.type="catmullrom",this.closed=!0}function ba(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),so.call(this,e),this.type="catmullrom"}function xa(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),so.call(this,e),this.type="catmullrom"}Qn.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Qn.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(bo.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new Ut,i=0,r=e.length;i<r;i++){var n=e[i];t.vertices.push(new ie(n.x,n.y,n.z||0))}return t}}),Object.assign(xo.prototype,{fromPoints:function(e){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),ya.prototype=Object.create(so.prototype),ba.prototype=Object.create(so.prototype),xa.prototype=Object.create(so.prototype),Object.assign(xa.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),aa.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},ra.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign($o.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),es.extractUrlBase(e)}}),Object.assign(it.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(gt.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),ui.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(K,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),K.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),K.ceilPowerOfTwo(e)}}),Object.assign(re.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(ee.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new ie),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,i,r,n,o){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,i,n,o)}}),bt.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},te.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(li.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(wo.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ln(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new xn(this,e)}}),Object.assign($.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(ie.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(se.prototype,{fromAttribute:function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Ut.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(Ct.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(Ct.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(ar.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(cr.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Qn.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Yi.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(_o.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Ft.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(ri.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(ri.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Gs.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(ft.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Qe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}}}),Object.defineProperties(Dn.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(hi.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(er.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(er.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(wt.prototype,{cullFace:{get:function(){return this.renderReverseSided?2:1},set:function(e){var t=1!==e;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(ae.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.assign(Ji.prototype,{getStandingMatrix:function(){console.warn("THREE.WebVRManager: .getStandingMatrix() has been removed.")}}),Object.defineProperties(Ji.prototype,{standing:{set:function(){console.warn("THREE.WebVRManager: .standing has been removed.")}}}),Ns.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Ls).load(e,(function(e){t.setBuffer(e)})),this},Is.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Cs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var wa={merge:function(e,t,i){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,i)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},_a={crossOrigin:void 0,loadTexture:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var n=new Jn;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadTextureCube:function(e,t,i,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var n=new Zn;n.setCrossOrigin(this.crossOrigin);var o=n.load(e,i,void 0,r);return t&&(o.mapping=t),o},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};var Ma=Object.freeze({__proto__:null,WebGLRenderTargetCube:ce,WebGLRenderTarget:ae,WebGLRenderer:er,ShaderLib:tt,UniformsLib:Ke,UniformsUtils:$e,ShaderChunk:et,FogExp2:tr,Fog:ir,Scene:rr,LensFlare:nr,Sprite:sr,LOD:ar,SkinnedMesh:lr,Skeleton:cr,Bone:hr,Mesh:di,LineSegments:dr,LineLoop:fr,Line:pr,Points:vr,Group:gr,VideoTexture:yr,DataTexture:he,CompressedTexture:br,CubeTexture:le,CanvasTexture:nt,DepthTexture:xr,Texture:oe,CompressedTextureLoader:Xn,DataTextureLoader:qn,CubeTextureLoader:Zn,TextureLoader:Jn,ObjectLoader:is,MaterialLoader:Xo,BufferGeometryLoader:qo,DefaultLoadingManager:Vn,LoadingManager:jn,JSONLoader:ts,ImageLoader:Yn,ImageBitmapLoader:as,FontLoader:ls,FileLoader:Wn,Loader:$o,LoaderUtils:es,Cache:Gn,AudioLoader:Ls,SpotLightShadow:To,SpotLight:So,PointLight:Ao,RectAreaLight:Po,HemisphereLight:Mo,DirectionalLightShadow:Lo,DirectionalLight:Ro,AmbientLight:Co,LightShadow:Eo,Light:_o,StereoCamera:Rs,PerspectiveCamera:Yi,OrthographicCamera:Nt,CubeCamera:Cs,ArrayCamera:Zi,Camera:Pt,AudioListener:Ps,PositionalAudio:Os,AudioContext:As,AudioAnalyser:Is,Audio:Ns,VectorKeyframeTrack:Ho,StringKeyframeTrack:No,QuaternionKeyframeTrack:Uo,NumberKeyframeTrack:ko,ColorKeyframeTrack:Fo,BooleanKeyframeTrack:Oo,PropertyMixer:Ds,PropertyBinding:Fs,KeyframeTrack:Vo,AnimationUtils:jo,AnimationObjectGroup:ks,AnimationMixer:zs,AnimationClip:Wo,Uniform:Gs,InstancedBufferGeometry:js,BufferGeometry:ri,Geometry:Ut,InterleavedBufferAttribute:Vs,InstancedInterleavedBuffer:Ws,InterleavedBuffer:Hs,InstancedBufferAttribute:Xs,Face3:Ot,Object3D:Ct,Raycaster:qs,Layers:Et,EventDispatcher:t,Clock:Js,QuaternionLinearInterpolant:Do,LinearInterpolant:zo,DiscreteInterpolant:Go,CubicInterpolant:Bo,Interpolant:Io,Triangle:pi,Math:K,Spherical:Qs,Cylindrical:Ks,Plane:bt,Frustum:xt,Sphere:yt,Ray:li,Matrix4:ee,Matrix3:re,Box3:gt,Box2:it,Line3:ui,Euler:Mt,Vector4:se,Vector3:ie,Vector2:$,Quaternion:te,Color:Qe,ImmediateRenderObject:$s,VertexNormalsHelper:ea,SpotLightHelper:ta,SkeletonHelper:ra,PointLightHelper:na,RectAreaLightHelper:oa,HemisphereLightHelper:sa,GridHelper:aa,PolarGridHelper:ca,FaceNormalsHelper:ha,DirectionalLightHelper:la,CameraHelper:ua,BoxHelper:pa,Box3Helper:da,PlaneHelper:fa,ArrowHelper:ma,AxesHelper:va,Shape:wo,Path:xo,ShapePath:cs,Font:hs,CurvePath:bo,Curve:Qn,ShapeUtils:hn,SceneUtils:ga,WebGLUtils:$i,WireframeGeometry:wr,ParametricGeometry:_r,ParametricBufferGeometry:Mr,TetrahedronGeometry:Sr,TetrahedronBufferGeometry:Ar,OctahedronGeometry:Lr,OctahedronBufferGeometry:Rr,IcosahedronGeometry:Cr,IcosahedronBufferGeometry:Pr,DodecahedronGeometry:Nr,DodecahedronBufferGeometry:Or,PolyhedronGeometry:Er,PolyhedronBufferGeometry:Tr,TubeGeometry:Ir,TubeBufferGeometry:Dr,TorusKnotGeometry:Ur,TorusKnotBufferGeometry:Fr,TorusGeometry:kr,TorusBufferGeometry:Br,TextGeometry:pn,TextBufferGeometry:dn,SphereGeometry:fn,SphereBufferGeometry:mn,RingGeometry:vn,RingBufferGeometry:gn,PlaneGeometry:si,PlaneBufferGeometry:ai,LatheGeometry:yn,LatheBufferGeometry:bn,ShapeGeometry:xn,ShapeBufferGeometry:wn,ExtrudeGeometry:ln,ExtrudeBufferGeometry:un,EdgesGeometry:Mn,ConeGeometry:Sn,ConeBufferGeometry:An,CylinderGeometry:En,CylinderBufferGeometry:Tn,CircleGeometry:Ln,CircleBufferGeometry:Rn,BoxGeometry:ni,BoxBufferGeometry:oi,ShadowMaterial:Pn,SpriteMaterial:or,RawShaderMaterial:Nn,ShaderMaterial:hi,PointsMaterial:mr,MeshPhysicalMaterial:In,MeshStandardMaterial:On,MeshPhongMaterial:Dn,MeshToonMaterial:Un,MeshNormalMaterial:Fn,MeshLambertMaterial:kn,MeshDepthMaterial:mt,MeshDistanceMaterial:vt,MeshBasicMaterial:ci,LineDashedMaterial:Bn,LineBasicMaterial:ur,Material:ft,Float64BufferAttribute:Xt,Float32BufferAttribute:Wt,Uint32BufferAttribute:Ht,Int32BufferAttribute:Vt,Uint16BufferAttribute:jt,Int16BufferAttribute:Gt,Uint8ClampedBufferAttribute:zt,Uint8BufferAttribute:Bt,Int8BufferAttribute:kt,BufferAttribute:Ft,ArcCurve:$n,CatmullRomCurve3:so,CubicBezierCurve:lo,CubicBezierCurve3:uo,EllipseCurve:Kn,LineCurve:po,LineCurve3:fo,QuadraticBezierCurve:mo,QuadraticBezierCurve3:vo,SplineCurve:go,REVISION:"89",MOUSE:{LEFT:0,MIDDLE:1,RIGHT:2},CullFaceNone:0,CullFaceBack:1,CullFaceFront:2,CullFaceFrontBack:3,FrontFaceDirectionCW:0,FrontFaceDirectionCCW:1,BasicShadowMap:0,PCFShadowMap:1,PCFSoftShadowMap:2,FrontSide:0,BackSide:1,DoubleSide:2,FlatShading:1,SmoothShading:2,NoColors:0,FaceColors:1,VertexColors:2,NoBlending:0,NormalBlending:1,AdditiveBlending:2,SubtractiveBlending:3,MultiplyBlending:4,CustomBlending:5,AddEquation:100,SubtractEquation:101,ReverseSubtractEquation:102,MinEquation:103,MaxEquation:104,ZeroFactor:200,OneFactor:201,SrcColorFactor:202,OneMinusSrcColorFactor:203,SrcAlphaFactor:204,OneMinusSrcAlphaFactor:205,DstAlphaFactor:206,OneMinusDstAlphaFactor:207,DstColorFactor:208,OneMinusDstColorFactor:209,SrcAlphaSaturateFactor:210,NeverDepth:0,AlwaysDepth:1,LessDepth:2,LessEqualDepth:3,EqualDepth:4,GreaterEqualDepth:5,GreaterDepth:6,NotEqualDepth:7,MultiplyOperation:0,MixOperation:1,AddOperation:2,NoToneMapping:0,LinearToneMapping:1,ReinhardToneMapping:2,Uncharted2ToneMapping:3,CineonToneMapping:4,UVMapping:u,CubeReflectionMapping:p,CubeRefractionMapping:d,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:f,SphericalReflectionMapping:305,CubeUVReflectionMapping:m,CubeUVRefractionMapping:v,RepeatWrapping:g,ClampToEdgeWrapping:y,MirroredRepeatWrapping:b,NearestFilter:x,NearestMipMapNearestFilter:w,NearestMipMapLinearFilter:_,LinearFilter:M,LinearMipMapNearestFilter:E,LinearMipMapLinearFilter:T,UnsignedByteType:S,ByteType:1010,ShortType:1011,UnsignedShortType:A,IntType:1013,UnsignedIntType:L,FloatType:R,HalfFloatType:C,UnsignedShort4444Type:1017,UnsignedShort5551Type:1018,UnsignedShort565Type:1019,UnsignedInt248Type:P,AlphaFormat:1021,RGBFormat:N,RGBAFormat:O,LuminanceFormat:1024,LuminanceAlphaFormat:1025,RGBEFormat:1023,DepthFormat:I,DepthStencilFormat:D,RGB_S3TC_DXT1_Format:U,RGBA_S3TC_DXT1_Format:F,RGBA_S3TC_DXT3_Format:k,RGBA_S3TC_DXT5_Format:B,RGB_PVRTC_4BPPV1_Format:z,RGB_PVRTC_2BPPV1_Format:G,RGBA_PVRTC_4BPPV1_Format:j,RGBA_PVRTC_2BPPV1_Format:V,RGB_ETC1_Format:2151,LoopOnce:2200,LoopRepeat:2201,LoopPingPong:2202,InterpolateDiscrete:H,InterpolateLinear:W,InterpolateSmooth:X,ZeroCurvatureEnding:q,ZeroSlopeEnding:Y,WrapAroundEnding:Z,TrianglesDrawMode:0,TriangleStripDrawMode:1,TriangleFanDrawMode:2,LinearEncoding:J,sRGBEncoding:3001,GammaEncoding:Q,RGBEEncoding:3002,LogLuvEncoding:3003,RGBM7Encoding:3004,RGBM16Encoding:3005,RGBDEncoding:3006,BasicDepthPacking:3200,RGBADepthPacking:3201,CubeGeometry:ni,Face4:function(e,t,i,r,n,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new Ot(e,t,i,n,o,s)},LineStrip:0,LinePieces:1,MeshFaceMaterial:function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},MultiMaterial:function(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e},PointCloud:function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new vr(e,t)},Particle:function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new sr(e)},ParticleSystem:function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new vr(e,t)},PointCloudMaterial:function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new mr(e)},ParticleBasicMaterial:function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new mr(e)},ParticleSystemMaterial:function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new mr(e)},Vertex:function(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new ie(e,t,i)},DynamicBufferAttribute:function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new Ft(e,t).setDynamic(!0)},Int8Attribute:function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new kt(e,t)},Uint8Attribute:function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Bt(e,t)},Uint8ClampedAttribute:function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new zt(e,t)},Int16Attribute:function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Gt(e,t)},Uint16Attribute:function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new jt(e,t)},Int32Attribute:function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Vt(e,t)},Uint32Attribute:function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ht(e,t)},Float32Attribute:function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Wt(e,t)},Float64Attribute:function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Xt(e,t)},ClosedSplineCurve3:ya,SplineCurve3:ba,Spline:xa,AxisHelper:function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new va(e)},BoundingBoxHelper:function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new pa(e,t)},EdgesHelper:function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new dr(new Mn(e.geometry),new ur({color:void 0!==t?t:16777215}))},WireframeHelper:function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new dr(new wr(e.geometry),new ur({color:void 0!==t?t:16777215}))},XHRLoader:function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new Wn(e)},BinaryTextureLoader:function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new qn(e)},GeometryUtils:wa,ImageUtils:_a,Projector:function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}},CanvasRenderer:function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}}),Ea=Object.assign({},Ma);var Ta=function(e,t,i,r){var n=new Ea.Color;return n.setRGB(e,t,i),r<=.99?new Ea.MeshBasicMaterial({color:n.getHex(),opacity:r+.1,transparent:!0,depthWrite:!0,blendSrc:Ea.SrcAlphaFactor,blendDst:Ea.OneMinusSrcAlphaFactor,blendEquation:Ea.ReverseSubtractEquation,blending:Ea.NormalBlending}):new Ea.MeshPhongMaterial({color:n.getHex(),opacity:r,blending:Ea.NormalBlending})},Sa=function(e,t,i){var r=new Ea.Vector3,n=new Ea.Vector3;r.subVectors(t,e.origin);var o=e.direction.dot(i);if(!(Math.abs(o)<e.precision)){var s=i.dot(r)/o;return n.addVectors(e.origin,e.direction.clone().multiplyScalar(s)),n}},Aa=function(e,t){var i=new Ea.Vector3;i.subVectors(e.origin,t.origin);var r=t.direction.clone(),n=e.direction.clone(),o=i.dot(r),s=r.dot(n),a=i.dot(n),c=r.dot(r),h=n.dot(n)*c-s*s;if(!(Math.abs(h)<=1e-4))return(o*s-a*c)/h},La=function(e,t,i){var r=e.origin.clone();r.project(t);var n=e.direction.clone().add(e.origin);n.project(t);var o=n.clone().sub(r),s=(new Ea.Vector2).subVectors(i,r).dot(o)/o.dot(o),a=new Ea.Vector2;a.addVectors(r,o.clone().multiplyScalar(s));var c=new Ea.Vector3(a.x,a.y,.5);c.unproject(t);var h=new Ea.Ray(t.position,c.sub(t.position).normalize());return Aa(e,h)};class Ra extends Ea.Object3D{constructor(e){super(),e=e||{},this.url=e.url,this.streamType=e.streamType||"vp8",this.f=e.f||526,this.maxDepthPerTile=e.maxDepthPerTile||1,this.pointSize=e.pointSize||3,this.width=e.width||1024,this.height=e.height||1024,this.resolutionFactor=Math.max(this.width,this.height)/1024,this.whiteness=e.whiteness||0,this.varianceThreshold=e.varianceThreshold||16667e-9,this.isMjpeg="mjpeg"===this.streamType.toLowerCase(),this.video=document.createElement(this.isMjpeg?"img":"video"),this.video.crossOrigin="Anonymous",this.video.addEventListener(this.isMjpeg?"load":"loadedmetadata",this.metaLoaded.bind(this),!1),this.isMjpeg||(this.video.loop=!0),this.video.src=this.url,this.video.setAttribute("crossorigin","Anonymous"),this.vertex_shader=["uniform sampler2D map;","","uniform float width;","uniform float height;","uniform float nearClipping, farClipping;","","uniform float pointSize;","uniform float zOffset;","","uniform float focallength;","uniform float maxDepthPerTile;","uniform float resolutionFactor;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","float sampleDepth(vec2 pos)","  {","    float depth;","    ","    vec2 vUv = vec2( pos.x / (width*2.0), pos.y / (height*2.0)+0.5 );","    vec2 vUv2 = vec2( pos.x / (width*2.0)+0.5, pos.y / (height*2.0)+0.5 );","    ","    vec4 depthColor = texture2D( map, vUv );","    ","    depth = ( depthColor.r + depthColor.g + depthColor.b ) / 3.0 ;","    ","    if (depth>0.99)","    {","      vec4 depthColor2 = texture2D( map, vUv2 );","      float depth2 = ( depthColor2.r + depthColor2.g + depthColor2.b ) / 3.0 ;","      depth = 0.99+depth2;","    }","    ","    return depth;","  }","","float median(float a, float b, float c)","  {","    float r=a;","    ","    if ( (a<b) && (b<c) )","    {","      r = b;","    }","    if ( (a<c) && (c<b) )","    {","      r = c;","    }","    return r;","  }","","float variance(float d1, float d2, float d3, float d4, float d5, float d6, float d7, float d8, float d9)","  {","    float mean = (d1 + d2 + d3 + d4 + d5 + d6 + d7 + d8 + d9) / 9.0;","    float t1 = (d1-mean);","    float t2 = (d2-mean);","    float t3 = (d3-mean);","    float t4 = (d4-mean);","    float t5 = (d5-mean);","    float t6 = (d6-mean);","    float t7 = (d7-mean);","    float t8 = (d8-mean);","    float t9 = (d9-mean);","    float v = (t1*t1+t2*t2+t3*t3+t4*t4+t5*t5+t6*t6+t7*t7+t8*t8+t9*t9)/9.0;","    return v;","  }","","vec2 decodeDepth(vec2 pos)","  {","    vec2 ret;","    ","    ","    float depth1 = sampleDepth(vec2(position.x-1.0, position.y-1.0));","    float depth2 = sampleDepth(vec2(position.x, position.y-1.0));","    float depth3 = sampleDepth(vec2(position.x+1.0, position.y-1.0));","    float depth4 = sampleDepth(vec2(position.x-1.0, position.y));","    float depth5 = sampleDepth(vec2(position.x, position.y));","    float depth6 = sampleDepth(vec2(position.x+1.0, position.y));","    float depth7 = sampleDepth(vec2(position.x-1.0, position.y+1.0));","    float depth8 = sampleDepth(vec2(position.x, position.y+1.0));","    float depth9 = sampleDepth(vec2(position.x+1.0, position.y+1.0));","    ","    float median1 = median(depth1, depth2, depth3);","    float median2 = median(depth4, depth5, depth6);","    float median3 = median(depth7, depth8, depth9);","    ","    ret.x = median(median1, median2, median3);","    ret.y = variance(depth1, depth2, depth3, depth4, depth5, depth6, depth7, depth8, depth9);","    ","    return ret;","    ","  }","","","void main() {","  ","  vUvP = vec2( position.x / (width*2.0), position.y / (height*2.0)+0.5 );","  colorP = vec2( position.x / (width*2.0)+0.5 , position.y / (height*2.0)  );","  ","  vec4 pos = vec4(0.0,0.0,0.0,0.0);","  depthVariance = 0.0;","  ","  if ( (vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>0.0))","  {","    vec2 smp = decodeDepth(vec2(position.x, position.y));","    float depth = smp.x;","    depthVariance = smp.y;","    ","    float z = -depth;","    ","    pos = vec4(","      ( position.x / width - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength) * -1.0,","      ( position.y / height - 0.5 ) * z * 0.5 * maxDepthPerTile * resolutionFactor * (1000.0/focallength),","      (- z + zOffset / 1000.0) * maxDepthPerTile,","      1.0);","    ","    vec2 maskP = vec2( position.x / (width*2.0), position.y / (height*2.0)  );","    vec4 maskColor = texture2D( map, maskP );","    maskVal = ( maskColor.r + maskColor.g + maskColor.b ) / 3.0 ;","  }","  ","  gl_PointSize = pointSize;","  gl_Position = projectionMatrix * modelViewMatrix * pos;","  ","}"].join("\n"),this.fragment_shader=["uniform sampler2D map;","uniform float varianceThreshold;","uniform float whiteness;","","varying vec2 vUvP;","varying vec2 colorP;","","varying float depthVariance;","varying float maskVal;","","","void main() {","  ","  vec4 color;","  ","  if ( (depthVariance>varianceThreshold) || (maskVal>0.5) ||(vUvP.x<0.0)|| (vUvP.x>0.5) || (vUvP.y<0.5) || (vUvP.y>1.0))","  {  ","    discard;","  }","  else ","  {","    color = texture2D( map, colorP );","    ","    float fader = whiteness /100.0;","    ","    color.r = color.r * (1.0-fader)+ fader;","    ","    color.g = color.g * (1.0-fader)+ fader;","    ","    color.b = color.b * (1.0-fader)+ fader;","    ","    color.a = 1.0;//smoothstep( 20000.0, -20000.0, gl_FragCoord.z / gl_FragCoord.w );","  }","  ","  gl_FragColor = vec4( color.r, color.g, color.b, color.a );","  ","}"].join("\n")}metaLoaded(){this.metaLoaded=!0,this.initStreamer()}initStreamer(){if(this.metaLoaded){this.texture=new Ea.Texture(this.video),this.geometry=new Ea.Geometry;for(var e=0,t=this.width*this.height;e<t;e++){var i=new Ea.Vector3;i.x=e%this.width,i.y=Math.floor(e/this.width),this.geometry.vertices.push(i)}this.material=new Ea.ShaderMaterial({uniforms:{map:{type:"t",value:this.texture},width:{type:"f",value:this.width},height:{type:"f",value:this.height},focallength:{type:"f",value:this.f},pointSize:{type:"f",value:this.pointSize},zOffset:{type:"f",value:0},whiteness:{type:"f",value:this.whiteness},varianceThreshold:{type:"f",value:this.varianceThreshold},maxDepthPerTile:{type:"f",value:this.maxDepthPerTile},resolutionFactor:{type:"f",value:this.resolutionFactor}},vertexShader:this.vertex_shader,fragmentShader:this.fragment_shader}),this.mesh=new Ea.ParticleSystem(this.geometry,this.material),this.mesh.position.x=0,this.mesh.position.y=0,this.add(this.mesh);var r=this;setInterval((function(){(r.isMjpeg||r.video.readyState===r.video.HAVE_ENOUGH_DATA)&&(r.texture.needsUpdate=!0)}),1e3/30)}}startStream(){this.isMjpeg||this.video.play()}stopStream(){this.isMjpeg||this.video.pause()}}var Ca="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Pa(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Na={};!function e(t,i,r){function n(s,a){if(!i[s]){if(!t[s]){if(!a&&Pa)return Pa(s);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=i[s]={exports:{}};t[s][0].call(h.exports,(function(e){return n(t[s][1][e]||e)}),h,h.exports,e,t,i,r)}return i[s].exports}for(var o=Pa,s=0;s<r.length;s++)n(r[s]);return n}({1:[function(e,t,i){!function(e,i){var r=Math.pow(2,-24),n=Math.pow(2,32),o=Math.pow(2,53);var s={encode:function(e){var t,r=new ArrayBuffer(256),s=new DataView(r),a=0;function c(e){for(var i=r.byteLength,n=a+e;i<n;)i*=2;if(i!==r.byteLength){var o=s;r=new ArrayBuffer(i),s=new DataView(r);for(var c=a+3>>2,h=0;h<c;++h)s.setUint32(4*h,o.getUint32(4*h))}return t=e,s}function h(){a+=t}function l(e){h(c(1).setUint8(a,e))}function u(e){for(var t=c(e.length),i=0;i<e.length;++i)t.setUint8(a+i,e[i]);h()}function p(e,t){t<24?l(e<<5|t):t<256?(l(e<<5|24),l(t)):t<65536?(l(e<<5|25),function(e){h(c(2).setUint16(a,e))}(t)):t<4294967296?(l(e<<5|26),function(e){h(c(4).setUint32(a,e))}(t)):(l(e<<5|27),function(e){var t=e%n,i=(e-t)/n,r=c(8);r.setUint32(a,i),r.setUint32(a+4,t),h()}(t))}if(function e(t){var r;if(!1===t)return l(244);if(!0===t)return l(245);if(null===t)return l(246);if(t===i)return l(247);switch(typeof t){case"number":if(Math.floor(t)===t){if(0<=t&&t<=o)return p(0,t);if(-o<=t&&t<0)return p(1,-(t+1))}return l(251),function(e){h(c(8).setFloat64(a,e))}(t);case"string":var n=[];for(r=0;r<t.length;++r){var s=t.charCodeAt(r);s<128?n.push(s):s<2048?(n.push(192|s>>6),n.push(128|63&s)):s<55296?(n.push(224|s>>12),n.push(128|s>>6&63),n.push(128|63&s)):(s=(1023&s)<<10,s|=1023&t.charCodeAt(++r),s+=65536,n.push(240|s>>18),n.push(128|s>>12&63),n.push(128|s>>6&63),n.push(128|63&s))}return p(3,n.length),u(n);default:var d;if(Array.isArray(t))for(p(4,d=t.length),r=0;r<d;++r)e(t[r]);else if(t instanceof Uint8Array)p(2,t.length),u(t);else{var f=Object.keys(t);for(p(5,d=f.length),r=0;r<d;++r){var m=f[r];e(m),e(t[m])}}}}(e),"slice"in r)return r.slice(0,a);for(var d=new ArrayBuffer(a),f=new DataView(d),m=0;m<a;++m)f.setUint8(m,s.getUint8(m));return d},decode:function(e,t,o){var s=new DataView(e),a=0;function c(e,t){return a+=t,e}function h(t){return c(new Uint8Array(e,a,t),t)}function l(){return c(s.getUint8(a),1)}function u(){return c(s.getUint16(a),2)}function p(){return c(s.getUint32(a),4)}function d(){return 255===s.getUint8(a)&&(a+=1,!0)}function f(e){if(e<24)return e;if(24===e)return l();if(25===e)return u();if(26===e)return p();if(27===e)return p()*n+p();if(31===e)return-1;throw"Invalid length encoding"}function m(e){var t=l();if(255===t)return-1;var i=f(31&t);if(i<0||t>>5!==e)throw"Invalid indefinite length element";return i}function v(e,t){for(var i=0;i<t;++i){var r=l();128&r&&(r<224?(r=(31&r)<<6|63&l(),t-=1):r<240?(r=(15&r)<<12|(63&l())<<6|63&l(),t-=2):(r=(15&r)<<18|(63&l())<<12|(63&l())<<6|63&l(),t-=3)),r<65536?e.push(r):(r-=65536,e.push(55296|r>>10),e.push(56320|1023&r))}}"function"!=typeof t&&(t=function(e){return e}),"function"!=typeof o&&(o=function(){return i});var g=function e(){var n,p,g=l(),y=g>>5,b=31&g;if(7===y)switch(b){case 25:return function(){var e=new ArrayBuffer(4),t=new DataView(e),i=u(),n=32768&i,o=31744&i,s=1023&i;if(31744===o)o=261120;else if(0!==o)o+=114688;else if(0!==s)return s*r;return t.setUint32(0,n<<16|o<<13|s<<13),t.getFloat32(0)}();case 26:return c(s.getFloat32(a),4);case 27:return c(s.getFloat64(a),8)}if((p=f(b))<0&&(y<2||6<y))throw"Invalid length";switch(y){case 0:return p;case 1:return-1-p;case 2:if(p<0){for(var x=[],w=0;(p=m(y))>=0;)w+=p,x.push(h(p));var _=new Uint8Array(w),M=0;for(n=0;n<x.length;++n)_.set(x[n],M),M+=x[n].length;return _}return h(p);case 3:var E=[];if(p<0)for(;(p=m(y))>=0;)v(E,p);else v(E,p);return String.fromCharCode.apply(null,E);case 4:var T;if(p<0)for(T=[];!d();)T.push(e());else for(T=new Array(p),n=0;n<p;++n)T[n]=e();return T;case 5:var S={};for(n=0;n<p||p<0&&!d();++n){S[e()]=e()}return S;case 6:return t(e(),p);case 7:switch(p){case 20:return!1;case 21:return!0;case 22:return null;case 23:return i;default:return o(p)}}}();if(a!==e.byteLength)throw"Remaining bytes";return g}};void 0!==t&&t.exports?t.exports=s:e.CBOR||(e.CBOR=s)}(this)},{}],2:[function(e,t,i){(function(e){!function(r){var n=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};function o(){this._events={},this._conf&&s.call(this,this._conf)}function s(e){e?(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),this._maxListeners=e.maxListeners!==r?e.maxListeners:10,e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this.newListener=e.newListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),this.wildcard&&(this.listenerTree={})):this._maxListeners=10}function a(t,i){var r="(node) warning: possible EventEmitter memory leak detected. "+t+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(r+=" Event name: "+i+"."),void 0!==e&&e.emitWarning){var n=new Error(r);n.name="MaxListenersExceededWarning",n.emitter=this,n.count=t,e.emitWarning(n)}else console.error(r),console.trace&&console.trace()}function c(e){this._events={},this.newListener=!1,this.verboseMemoryLeak=!1,s.call(this,e)}function h(e,t,i,r){if(!i)return[];var n,o,s,a,c,l,u,p=[],d=t.length,f=t[r],m=t[r+1];if(r===d&&i._listeners){if("function"==typeof i._listeners)return e&&e.push(i._listeners),[i];for(n=0,o=i._listeners.length;n<o;n++)e&&e.push(i._listeners[n]);return[i]}if("*"===f||"**"===f||i[f]){if("*"===f){for(s in i)"_listeners"!==s&&i.hasOwnProperty(s)&&(p=p.concat(h(e,t,i[s],r+1)));return p}if("**"===f){for(s in(u=r+1===d||r+2===d&&"*"===m)&&i._listeners&&(p=p.concat(h(e,t,i,d))),i)"_listeners"!==s&&i.hasOwnProperty(s)&&("*"===s||"**"===s?(i[s]._listeners&&!u&&(p=p.concat(h(e,t,i[s],d))),p=p.concat(h(e,t,i[s],r))):p=s===m?p.concat(h(e,t,i[s],r+2)):p.concat(h(e,t,i[s],r)));return p}p=p.concat(h(e,t,i[f],r+1))}if((a=i["*"])&&h(e,t,a,r+1),c=i["**"])if(r<d)for(s in c._listeners&&h(e,t,c,d),c)"_listeners"!==s&&c.hasOwnProperty(s)&&(s===m?h(e,t,c[s],r+2):s===f?h(e,t,c[s],r+1):((l={})[s]=c[s],h(e,t,{"**":l},r+1)));else c._listeners?h(e,t,c,d):c["*"]&&c["*"]._listeners&&h(e,t,c["*"],d);return p}function l(e,t){for(var i=0,n=(e="string"==typeof e?e.split(this.delimiter):e.slice()).length;i+1<n;i++)if("**"===e[i]&&"**"===e[i+1])return;for(var o=this.listenerTree,s=e.shift();s!==r;){if(o[s]||(o[s]={}),o=o[s],0===e.length)return o._listeners?("function"==typeof o._listeners&&(o._listeners=[o._listeners]),o._listeners.push(t),!o._listeners.warned&&this._maxListeners>0&&o._listeners.length>this._maxListeners&&(o._listeners.warned=!0,a.call(this,o._listeners.length,s))):o._listeners=t,!0;s=e.shift()}return!0}c.EventEmitter2=c,c.prototype.delimiter=".",c.prototype.setMaxListeners=function(e){e!==r&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},c.prototype.event="",c.prototype.once=function(e,t){return this._once(e,t,!1)},c.prototype.prependOnceListener=function(e,t){return this._once(e,t,!0)},c.prototype._once=function(e,t,i){return this._many(e,1,t,i),this},c.prototype.many=function(e,t,i){return this._many(e,t,i,!1)},c.prototype.prependMany=function(e,t,i){return this._many(e,t,i,!0)},c.prototype._many=function(e,t,i,r){var n=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function o(){return 0==--t&&n.off(e,o),i.apply(this,arguments)}return o._origin=i,this._on(e,o,r),n},c.prototype.emit=function(){this._events||o.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return!1;var t,i,r,n,s,a=arguments.length;if(this._all&&this._all.length){if(s=this._all.slice(),a>3)for(t=new Array(a),n=0;n<a;n++)t[n]=arguments[n];for(r=0,i=s.length;r<i;r++)switch(this.event=e,a){case 1:s[r].call(this,e);break;case 2:s[r].call(this,e,arguments[1]);break;case 3:s[r].call(this,e,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}}if(this.wildcard){s=[];var c="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,s,c,this.listenerTree,0)}else{if("function"==typeof(s=this._events[e])){switch(this.event=e,a){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(a-1),n=1;n<a;n++)t[n-1]=arguments[n];s.apply(this,t)}return!0}s&&(s=s.slice())}if(s&&s.length){if(a>3)for(t=new Array(a-1),n=1;n<a;n++)t[n-1]=arguments[n];for(r=0,i=s.length;r<i;r++)switch(this.event=e,a){case 1:s[r].call(this);break;case 2:s[r].call(this,arguments[1]);break;case 3:s[r].call(this,arguments[1],arguments[2]);break;default:s[r].apply(this,t)}return!0}if(!this._all&&"error"===e)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},c.prototype.emitAsync=function(){this._events||o.call(this);var e=arguments[0];if("newListener"===e&&!this.newListener&&!this._events.newListener)return Promise.resolve([!1]);var t,i,r,n,s,a=[],c=arguments.length;if(this._all){if(c>3)for(t=new Array(c),n=1;n<c;n++)t[n]=arguments[n];for(r=0,i=this._all.length;r<i;r++)switch(this.event=e,c){case 1:a.push(this._all[r].call(this,e));break;case 2:a.push(this._all[r].call(this,e,arguments[1]));break;case 3:a.push(this._all[r].call(this,e,arguments[1],arguments[2]));break;default:a.push(this._all[r].apply(this,t))}}if(this.wildcard){s=[];var l="string"==typeof e?e.split(this.delimiter):e.slice();h.call(this,s,l,this.listenerTree,0)}else s=this._events[e];if("function"==typeof s)switch(this.event=e,c){case 1:a.push(s.call(this));break;case 2:a.push(s.call(this,arguments[1]));break;case 3:a.push(s.call(this,arguments[1],arguments[2]));break;default:for(t=new Array(c-1),n=1;n<c;n++)t[n-1]=arguments[n];a.push(s.apply(this,t))}else if(s&&s.length){if(s=s.slice(),c>3)for(t=new Array(c-1),n=1;n<c;n++)t[n-1]=arguments[n];for(r=0,i=s.length;r<i;r++)switch(this.event=e,c){case 1:a.push(s[r].call(this));break;case 2:a.push(s[r].call(this,arguments[1]));break;case 3:a.push(s[r].call(this,arguments[1],arguments[2]));break;default:a.push(s[r].apply(this,t))}}else if(!this._all&&"error"===e)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(a)},c.prototype.on=function(e,t){return this._on(e,t,!1)},c.prototype.prependListener=function(e,t){return this._on(e,t,!0)},c.prototype.onAny=function(e){return this._onAny(e,!1)},c.prototype.prependAny=function(e){return this._onAny(e,!0)},c.prototype.addListener=c.prototype.on,c.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},c.prototype._on=function(e,t,i){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");return this._events||o.call(this),this.emit("newListener",e,t),this.wildcard?(l.call(this,e,t),this):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,a.call(this,this._events[e].length,e))):this._events[e]=t,this)},c.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var i,o=[];if(this.wildcard){var s="string"==typeof e?e.split(this.delimiter):e.slice();o=h.call(this,null,s,this.listenerTree,0)}else{if(!this._events[e])return this;i=this._events[e],o.push({_listeners:i})}for(var a=0;a<o.length;a++){var c=o[a];if(i=c._listeners,n(i)){for(var l=-1,u=0,p=i.length;u<p;u++)if(i[u]===t||i[u].listener&&i[u].listener===t||i[u]._origin&&i[u]._origin===t){l=u;break}if(l<0)continue;return this.wildcard?c._listeners.splice(l,1):this._events[e].splice(l,1),0===i.length&&(this.wildcard?delete c._listeners:delete this._events[e]),this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete c._listeners:delete this._events[e],this.emit("removeListener",e,t))}return function e(t){if(t!==r){var i=Object.keys(t);for(var n in i){var o=i[n],s=t[o];s instanceof Function||"object"!=typeof s||null===s||(Object.keys(s).length>0&&e(t[o]),0===Object.keys(s).length&&delete t[o])}}}(this.listenerTree),this},c.prototype.offAny=function(e){var t,i=0,r=0;if(e&&this._all&&this._all.length>0){for(i=0,r=(t=this._all).length;i<r;i++)if(e===t[i])return t.splice(i,1),this.emit("removeListenerAny",e),this}else{for(i=0,r=(t=this._all).length;i<r;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},c.prototype.removeListener=c.prototype.off,c.prototype.removeAllListeners=function(e){if(0===arguments.length)return!this._events||o.call(this),this;if(this.wildcard)for(var t="string"==typeof e?e.split(this.delimiter):e.slice(),i=h.call(this,null,t,this.listenerTree,0),r=0;r<i.length;r++){var n=i[r];n._listeners=null}else this._events&&(this._events[e]=null);return this},c.prototype.listeners=function(e){if(this.wildcard){var t=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return h.call(this,t,i,this.listenerTree,0),t}return this._events||o.call(this),this._events[e]||(this._events[e]=[]),n(this._events[e])||(this._events[e]=[this._events[e]]),this._events[e]},c.prototype.eventNames=function(){return Object.keys(this._events)},c.prototype.listenerCount=function(e){return this.listeners(e).length},c.prototype.listenersAny=function(){return this._all?this._all:[]},"object"==typeof i?t.exports=c:window.EventEmitter2=c}()}).call(this,e("_process"))},{_process:4}],3:[function(e,t,i){var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}t.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(e){return!1}}()?Object.assign:function(e,t){for(var i,a,c=s(e),h=1;h<arguments.length;h++){for(var l in i=Object(arguments[h]))n.call(i,l)&&(c[l]=i[l]);if(r){a=r(i);for(var u=0;u<a.length;u++)o.call(i,a[u])&&(c[a[u]]=i[a[u]])}}return c}},{}],4:[function(e,t,i){var r,n,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function c(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:a}catch(e){n=a}}();var h,l=[],u=!1,p=-1;function d(){u&&h&&(u=!1,h.length?l=h.concat(l):p=-1,l.length&&f())}function f(){if(!u){var e=c(d);u=!0;for(var t=l.length;t;){for(h=l,l=[];++p<t;)h&&h[p].run();p=-1,t=l.length}h=null,u=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===a||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function m(e,t){this.fun=e,this.array=t}function v(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];l.push(new m(e,t)),1!==l.length||u||c(f)},m.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=v,o.addListener=v,o.once=v,o.off=v,o.removeListener=v,o.removeAllListeners=v,o.emit=v,o.prependListener=v,o.prependOnceListener=v,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],5:[function(e,t,i){var r=arguments[3],n=arguments[4],o=arguments[5],s=JSON.stringify;t.exports=function(e,t){for(var i,a=Object.keys(o),c=0,h=a.length;c<h;c++){var l=a[c],u=o[l].exports;if(u===e||u&&u.default===e){i=l;break}}if(!i){i=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var p={};for(c=0,h=a.length;c<h;c++){p[l=a[c]]=l}n[i]=["function(require,module,exports){"+e+"(self); }",p]}var d=Math.floor(Math.pow(16,8)*Math.random()).toString(16),f={};f[i]=i,n[d]=["function(require,module,exports){var f = require("+s(i)+");(f.default ? f.default : f)(self);}",f];var m={};!function e(t){for(var i in m[t]=!0,n[t][1]){var r=n[t][1][i];m[r]||e(r)}}(d);var v="("+r+")({"+Object.keys(m).map((function(e){return s(e)+":["+n[e][0]+","+s(n[e][1])+"]"})).join(",")+"},{},["+s(d)+"])",g=window.URL||window.webkitURL||window.mozURL||window.msURL,y=new Blob([v],{type:"text/javascript"});if(t&&t.bare)return y;var b=g.createObjectURL(y),x=new Worker(b);return x.objectURL=b,x}},{}],6:[function(e,t,i){var r=this.ROSLIB||{REVISION:"1.1.0"},n=e("object-assign");n(r,e("./core")),n(r,e("./actionlib")),n(r,e("./math")),n(r,e("./tf")),n(r,e("./urdf")),t.exports=r},{"./actionlib":12,"./core":21,"./math":26,"./tf":29,"./urdf":41,"object-assign":3}],7:[function(e,t,i){(function(t){t.ROSLIB=e("./RosLib")}).call(this,void 0!==Ca?Ca:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./RosLib":6}],8:[function(e,t,i){var r=e("../core/Topic"),n=e("../core/Message"),o=e("eventemitter2").EventEmitter2;function s(e){var t=this;e=e||{},this.ros=e.ros,this.serverName=e.serverName,this.actionName=e.actionName,this.timeout=e.timeout,this.omitFeedback=e.omitFeedback,this.omitStatus=e.omitStatus,this.omitResult=e.omitResult,this.goals={};var i=!1;this.feedbackListener=new r({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.statusListener=new r({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),this.resultListener=new r({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.goalTopic=new r({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),this.cancelTopic=new r({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"}),this.goalTopic.advertise(),this.cancelTopic.advertise(),this.omitStatus||this.statusListener.subscribe((function(e){i=!0,e.status_list.forEach((function(e){var i=t.goals[e.goal_id.id];i&&i.emit("status",e)}))})),this.omitFeedback||this.feedbackListener.subscribe((function(e){var i=t.goals[e.status.goal_id.id];i&&(i.emit("status",e.status),i.emit("feedback",e.feedback))})),this.omitResult||this.resultListener.subscribe((function(e){var i=t.goals[e.status.goal_id.id];i&&(i.emit("status",e.status),i.emit("result",e.result))})),this.timeout&&setTimeout((function(){i||t.emit("timeout")}),this.timeout)}s.prototype.__proto__=o.prototype,s.prototype.cancel=function(){var e=new n;this.cancelTopic.publish(e)},s.prototype.dispose=function(){this.goalTopic.unadvertise(),this.cancelTopic.unadvertise(),this.omitStatus||this.statusListener.unsubscribe(),this.omitFeedback||this.feedbackListener.unsubscribe(),this.omitResult||this.resultListener.unsubscribe()},t.exports=s},{"../core/Message":13,"../core/Topic":20,eventemitter2:2}],9:[function(e,t,i){var r=e("../core/Topic");e("../core/Message");var n=e("eventemitter2").EventEmitter2;function o(e){var t=this;e=e||{},this.ros=e.ros,this.serverName=e.serverName,this.actionName=e.actionName,this.timeout=e.timeout,this.omitFeedback=e.omitFeedback,this.omitStatus=e.omitStatus,this.omitResult=e.omitResult;var i=new r({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),n=new r({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),o=new r({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"}),s=new r({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"});i.subscribe((function(e){t.emit("goal",e)})),o.subscribe((function(e){e.status_list.forEach((function(e){t.emit("status",e)}))})),n.subscribe((function(e){t.emit("status",e.status),t.emit("feedback",e.feedback)})),s.subscribe((function(e){t.emit("status",e.status),t.emit("result",e.result)}))}o.prototype.__proto__=n.prototype,t.exports=o},{"../core/Message":13,"../core/Topic":20,eventemitter2:2}],10:[function(e,t,i){var r=e("../core/Message"),n=e("eventemitter2").EventEmitter2;function o(e){var t=this;this.actionClient=e.actionClient,this.goalMessage=e.goalMessage,this.isFinished=!1;var i=new Date;this.goalID="goal_"+Math.random()+"_"+i.getTime(),this.goalMessage=new r({goal_id:{stamp:{secs:0,nsecs:0},id:this.goalID},goal:this.goalMessage}),this.on("status",(function(e){t.status=e})),this.on("result",(function(e){t.isFinished=!0,t.result=e})),this.on("feedback",(function(e){t.feedback=e})),this.actionClient.goals[this.goalID]=this}o.prototype.__proto__=n.prototype,o.prototype.send=function(e){var t=this;t.actionClient.goalTopic.publish(t.goalMessage),e&&setTimeout((function(){t.isFinished||t.emit("timeout")}),e)},o.prototype.cancel=function(){var e=new r({id:this.goalID});this.actionClient.cancelTopic.publish(e)},t.exports=o},{"../core/Message":13,eventemitter2:2}],11:[function(e,t,i){var r=e("../core/Topic"),n=e("../core/Message"),o=e("eventemitter2").EventEmitter2;function s(e){var t=this;e=e||{},this.ros=e.ros,this.serverName=e.serverName,this.actionName=e.actionName,this.feedbackPublisher=new r({ros:this.ros,name:this.serverName+"/feedback",messageType:this.actionName+"Feedback"}),this.feedbackPublisher.advertise();var i=new r({ros:this.ros,name:this.serverName+"/status",messageType:"actionlib_msgs/GoalStatusArray"});i.advertise(),this.resultPublisher=new r({ros:this.ros,name:this.serverName+"/result",messageType:this.actionName+"Result"}),this.resultPublisher.advertise();var o=new r({ros:this.ros,name:this.serverName+"/goal",messageType:this.actionName+"Goal"}),s=new r({ros:this.ros,name:this.serverName+"/cancel",messageType:"actionlib_msgs/GoalID"});this.statusMessage=new n({header:{stamp:{secs:0,nsecs:100},frame_id:""},status_list:[]}),this.currentGoal=null,this.nextGoal=null,o.subscribe((function(e){t.currentGoal?(t.nextGoal=e,t.emit("cancel")):(t.statusMessage.status_list=[{goal_id:e.goal_id,status:1}],t.currentGoal=e,t.emit("goal",e.goal))}));var a=function(e,t){return!(e.secs>t.secs)&&(e.secs<t.secs||e.nsecs<t.nsecs)};s.subscribe((function(e){0===e.stamp.secs&&0===e.stamp.secs&&""===e.id?(t.nextGoal=null,t.currentGoal&&t.emit("cancel")):(t.currentGoal&&e.id===t.currentGoal.goal_id.id?t.emit("cancel"):t.nextGoal&&e.id===t.nextGoal.goal_id.id&&(t.nextGoal=null),t.nextGoal&&a(t.nextGoal.goal_id.stamp,e.stamp)&&(t.nextGoal=null),t.currentGoal&&a(t.currentGoal.goal_id.stamp,e.stamp)&&t.emit("cancel"))})),setInterval((function(){var e=new Date,r=Math.floor(e.getTime()/1e3),n=Math.round(1e9*(e.getTime()/1e3-r));t.statusMessage.header.stamp.secs=r,t.statusMessage.header.stamp.nsecs=n,i.publish(t.statusMessage)}),500)}s.prototype.__proto__=o.prototype,s.prototype.setSucceeded=function(e){var t=new n({status:{goal_id:this.currentGoal.goal_id,status:3},result:e});this.resultPublisher.publish(t),this.statusMessage.status_list=[],this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},s.prototype.sendFeedback=function(e){var t=new n({status:{goal_id:this.currentGoal.goal_id,status:1},feedback:e});this.feedbackPublisher.publish(t)},s.prototype.setPreempted=function(){this.statusMessage.status_list=[];var e=new n({status:{goal_id:this.currentGoal.goal_id,status:2}});this.resultPublisher.publish(e),this.nextGoal?(this.currentGoal=this.nextGoal,this.nextGoal=null,this.emit("goal",this.currentGoal.goal)):this.currentGoal=null},t.exports=s},{"../core/Message":13,"../core/Topic":20,eventemitter2:2}],12:[function(e,t,i){var r=e("../core/Ros");e("../mixin")(r,["ActionClient","SimpleActionServer"],t.exports={ActionClient:e("./ActionClient"),ActionListener:e("./ActionListener"),Goal:e("./Goal"),SimpleActionServer:e("./SimpleActionServer")})},{"../core/Ros":15,"../mixin":27,"./ActionClient":8,"./ActionListener":9,"./Goal":10,"./SimpleActionServer":11}],13:[function(e,t,i){var r=e("object-assign");t.exports=function(e){r(this,e)}},{"object-assign":3}],14:[function(e,t,i){var r=e("./Service"),n=e("./ServiceRequest");function o(e){e=e||{},this.ros=e.ros,this.name=e.name}o.prototype.get=function(e){var t=new r({ros:this.ros,name:"/rosapi/get_param",serviceType:"rosapi/GetParam"}),i=new n({name:this.name});t.callService(i,(function(t){var i=JSON.parse(t.value);e(i)}))},o.prototype.set=function(e,t){var i=new r({ros:this.ros,name:"/rosapi/set_param",serviceType:"rosapi/SetParam"}),o=new n({name:this.name,value:JSON.stringify(e)});i.callService(o,t)},o.prototype.delete=function(e){var t=new r({ros:this.ros,name:"/rosapi/delete_param",serviceType:"rosapi/DeleteParam"}),i=new n({name:this.name});t.callService(i,e)},t.exports=o},{"./Service":16,"./ServiceRequest":17}],15:[function(e,t,i){var r=e("ws"),n=e("../util/workerSocket"),o=e("./SocketAdapter.js"),s=e("./Service"),a=e("./ServiceRequest"),c=e("object-assign"),h=e("eventemitter2").EventEmitter2;function l(e){e=e||{},this.socket=null,this.idCounter=0,this.isConnected=!1,this.transportLibrary=e.transportLibrary||"websocket",this.transportOptions=e.transportOptions||{},void 0===e.groovyCompatibility?this.groovyCompatibility=!0:this.groovyCompatibility=e.groovyCompatibility,this.setMaxListeners(0),e.url&&this.connect(e.url)}l.prototype.__proto__=h.prototype,l.prototype.connect=function(e){if("socket.io"===this.transportLibrary)this.socket=c(io(e,{"force new connection":!0}),o(this)),this.socket.on("connect",this.socket.onopen),this.socket.on("data",this.socket.onmessage),this.socket.on("close",this.socket.onclose),this.socket.on("error",this.socket.onerror);else if("RTCPeerConnection"===this.transportLibrary.constructor.name)this.socket=c(this.transportLibrary.createDataChannel(e,this.transportOptions),o(this));else if("websocket"===this.transportLibrary){if(!this.socket||this.socket.readyState===r.CLOSED){var t=new r(e);t.binaryType="arraybuffer",this.socket=c(t,o(this))}}else{if("workersocket"!==this.transportLibrary)throw"Unknown transportLibrary: "+this.transportLibrary.toString();this.socket=c(new n(e),o(this))}},l.prototype.close=function(){this.socket&&this.socket.close()},l.prototype.authenticate=function(e,t,i,r,n,o,s){var a={op:"auth",mac:e,client:t,dest:i,rand:r,t:n,level:o,end:s};this.callOnConnection(a)},l.prototype.callOnConnection=function(e){var t=this,i=JSON.stringify(e),r=null;r="socket.io"===this.transportLibrary?function(e){t.socket.emit("operation",e)}:function(e){t.socket.send(e)},this.isConnected?r(i):t.once("connection",(function(){r(i)}))},l.prototype.setStatusLevel=function(e,t){var i={op:"set_level",level:e,id:t};this.callOnConnection(i)},l.prototype.getActionServers=function(e,t){var i=new s({ros:this,name:"/rosapi/action_servers",serviceType:"rosapi/GetActionServers"}),r=new a({});"function"==typeof t?i.callService(r,(function(t){e(t.action_servers)}),(function(e){t(e)})):i.callService(r,(function(t){e(t.action_servers)}))},l.prototype.getTopics=function(e,t){var i=new s({ros:this,name:"/rosapi/topics",serviceType:"rosapi/Topics"}),r=new a;"function"==typeof t?i.callService(r,(function(t){e(t)}),(function(e){t(e)})):i.callService(r,(function(t){e(t)}))},l.prototype.getTopicsForType=function(e,t,i){var r=new s({ros:this,name:"/rosapi/topics_for_type",serviceType:"rosapi/TopicsForType"}),n=new a({type:e});"function"==typeof i?r.callService(n,(function(e){t(e.topics)}),(function(e){i(e)})):r.callService(n,(function(e){t(e.topics)}))},l.prototype.getServices=function(e,t){var i=new s({ros:this,name:"/rosapi/services",serviceType:"rosapi/Services"}),r=new a;"function"==typeof t?i.callService(r,(function(t){e(t.services)}),(function(e){t(e)})):i.callService(r,(function(t){e(t.services)}))},l.prototype.getServicesForType=function(e,t,i){var r=new s({ros:this,name:"/rosapi/services_for_type",serviceType:"rosapi/ServicesForType"}),n=new a({type:e});"function"==typeof i?r.callService(n,(function(e){t(e.services)}),(function(e){i(e)})):r.callService(n,(function(e){t(e.services)}))},l.prototype.getServiceRequestDetails=function(e,t,i){var r=new s({ros:this,name:"/rosapi/service_request_details",serviceType:"rosapi/ServiceRequestDetails"}),n=new a({type:e});"function"==typeof i?r.callService(n,(function(e){t(e)}),(function(e){i(e)})):r.callService(n,(function(e){t(e)}))},l.prototype.getServiceResponseDetails=function(e,t,i){var r=new s({ros:this,name:"/rosapi/service_response_details",serviceType:"rosapi/ServiceResponseDetails"}),n=new a({type:e});"function"==typeof i?r.callService(n,(function(e){t(e)}),(function(e){i(e)})):r.callService(n,(function(e){t(e)}))},l.prototype.getNodes=function(e,t){var i=new s({ros:this,name:"/rosapi/nodes",serviceType:"rosapi/Nodes"}),r=new a;"function"==typeof t?i.callService(r,(function(t){e(t.nodes)}),(function(e){t(e)})):i.callService(r,(function(t){e(t.nodes)}))},l.prototype.getNodeDetails=function(e,t,i){var r=new s({ros:this,name:"/rosapi/node_details",serviceType:"rosapi/NodeDetails"}),n=new a({node:e});"function"==typeof i?r.callService(n,(function(e){t(e.subscribing,e.publishing,e.services)}),(function(e){i(e)})):r.callService(n,(function(e){t(e)}))},l.prototype.getParams=function(e,t){var i=new s({ros:this,name:"/rosapi/get_param_names",serviceType:"rosapi/GetParamNames"}),r=new a;"function"==typeof t?i.callService(r,(function(t){e(t.names)}),(function(e){t(e)})):i.callService(r,(function(t){e(t.names)}))},l.prototype.getTopicType=function(e,t,i){var r=new s({ros:this,name:"/rosapi/topic_type",serviceType:"rosapi/TopicType"}),n=new a({topic:e});"function"==typeof i?r.callService(n,(function(e){t(e.type)}),(function(e){i(e)})):r.callService(n,(function(e){t(e.type)}))},l.prototype.getServiceType=function(e,t,i){var r=new s({ros:this,name:"/rosapi/service_type",serviceType:"rosapi/ServiceType"}),n=new a({service:e});"function"==typeof i?r.callService(n,(function(e){t(e.type)}),(function(e){i(e)})):r.callService(n,(function(e){t(e.type)}))},l.prototype.getMessageDetails=function(e,t,i){var r=new s({ros:this,name:"/rosapi/message_details",serviceType:"rosapi/MessageDetails"}),n=new a({type:e});"function"==typeof i?r.callService(n,(function(e){t(e.typedefs)}),(function(e){i(e)})):r.callService(n,(function(e){t(e.typedefs)}))},l.prototype.decodeTypeDefs=function(e){var t=this,i=function(e,r){for(var n={},o=0;o<e.fieldnames.length;o++){var s=e.fieldarraylen[o],a=e.fieldnames[o],c=e.fieldtypes[o];if(-1===c.indexOf("/"))n[a]=-1===s?c:[c];else{for(var h=!1,l=0;l<r.length;l++)if(r[l].type.toString()===c.toString()){h=r[l];break}if(h){var u=i(h,r);-1===s||(n[a]=[u])}else t.emit("error","Cannot find "+c+" in decodeTypeDefs")}}return n};return i(e[0],e)},l.prototype.getTopicsAndRawTypes=function(e,t){var i=new s({ros:this,name:"/rosapi/topics_and_raw_types",serviceType:"rosapi/TopicsAndRawTypes"}),r=new a;"function"==typeof t?i.callService(r,(function(t){e(t)}),(function(e){t(e)})):i.callService(r,(function(t){e(t)}))},t.exports=l},{"../util/workerSocket":47,"./Service":16,"./ServiceRequest":17,"./SocketAdapter.js":19,eventemitter2:2,"object-assign":3,ws:43}],16:[function(e,t,i){var r=e("./ServiceResponse");e("./ServiceRequest");var n=e("eventemitter2").EventEmitter2;function o(e){e=e||{},this.ros=e.ros,this.name=e.name,this.serviceType=e.serviceType,this.isAdvertised=!1,this._serviceCallback=null}o.prototype.__proto__=n.prototype,o.prototype.callService=function(e,t,i){if(!this.isAdvertised){var n="call_service:"+this.name+":"+ ++this.ros.idCounter;(t||i)&&this.ros.once(n,(function(e){void 0!==e.result&&!1===e.result?"function"==typeof i&&i(e.values):"function"==typeof t&&t(new r(e.values))}));var o={op:"call_service",id:n,service:this.name,type:this.serviceType,args:e};this.ros.callOnConnection(o)}},o.prototype.advertise=function(e){this.isAdvertised||"function"!=typeof e||(this._serviceCallback=e,this.ros.on(this.name,this._serviceResponse.bind(this)),this.ros.callOnConnection({op:"advertise_service",type:this.serviceType,service:this.name}),this.isAdvertised=!0)},o.prototype.unadvertise=function(){this.isAdvertised&&(this.ros.callOnConnection({op:"unadvertise_service",service:this.name}),this.isAdvertised=!1)},o.prototype._serviceResponse=function(e){var t={},i=this._serviceCallback(e.args,t),n={op:"service_response",service:this.name,values:new r(t),result:i};e.id&&(n.id=e.id),this.ros.callOnConnection(n)},t.exports=o},{"./ServiceRequest":17,"./ServiceResponse":18,eventemitter2:2}],17:[function(e,t,i){var r=e("object-assign");t.exports=function(e){r(this,e)}},{"object-assign":3}],18:[function(e,t,i){var r=e("object-assign");t.exports=function(e){r(this,e)}},{"object-assign":3}],19:[function(e,t,i){var r=e("../util/decompressPng"),n=e("cbor-js"),o=e("../util/cborTypedArrayTags"),s=null;"undefined"!=typeof bson&&(s=bson().BSON),t.exports=function(e){function t(t){"publish"===t.op?e.emit(t.topic,t.msg):"service_response"===t.op?e.emit(t.id,t):"call_service"===t.op?e.emit(t.service,t):"status"===t.op&&(t.id?e.emit("status:"+t.id,t):e.emit("status",t))}function i(e,t){"png"===e.op?r(e.data,t):t(e)}return{onopen:function(t){e.isConnected=!0,e.emit("connection",t)},onclose:function(t){e.isConnected=!1,e.emit("close",t)},onerror:function(t){e.emit("error",t)},onmessage:function(e){if("undefined"!=typeof Blob&&e.data instanceof Blob)!function(e,t){if(!s)throw"Cannot process BSON encoded message without BSON header.";var i=new FileReader;i.onload=function(){var e=new Uint8Array(this.result),i=s.deserialize(e);t(i)},i.readAsArrayBuffer(e)}(e.data,(function(e){i(e,t)}));else if(e.data instanceof ArrayBuffer){t(n.decode(e.data,o))}else{i(JSON.parse("string"==typeof e?e:e.data),t)}}}}},{"../util/cborTypedArrayTags":42,"../util/decompressPng":45,"cbor-js":1}],20:[function(e,t,i){var r=e("eventemitter2").EventEmitter2,n=e("./Message");function o(e){e=e||{},this.ros=e.ros,this.name=e.name,this.messageType=e.messageType,this.isAdvertised=!1,this.compression=e.compression||"none",this.throttle_rate=e.throttle_rate||0,this.latch=e.latch||!1,this.queue_size=e.queue_size||100,this.queue_length=e.queue_length||0,this.reconnect_on_close=void 0===e.reconnect_on_close||e.reconnect_on_close,this.compression&&"png"!==this.compression&&"cbor"!==this.compression&&"cbor-raw"!==this.compression&&"none"!==this.compression&&(this.emit("warning",this.compression+" compression is not supported. No compression will be used."),this.compression="none"),this.throttle_rate<0&&(this.emit("warning",this.throttle_rate+" is not allowed. Set to 0"),this.throttle_rate=0);var t=this;this.reconnect_on_close?this.callForSubscribeAndAdvertise=function(e){t.ros.callOnConnection(e),t.waitForReconnect=!1,t.reconnectFunc=function(){t.waitForReconnect||(t.waitForReconnect=!0,t.ros.callOnConnection(e),t.ros.once("connection",(function(){t.waitForReconnect=!1})))},t.ros.on("close",t.reconnectFunc)}:this.callForSubscribeAndAdvertise=this.ros.callOnConnection,this._messageCallback=function(e){t.emit("message",new n(e))}}o.prototype.__proto__=r.prototype,o.prototype.subscribe=function(e){"function"==typeof e&&this.on("message",e),this.subscribeId||(this.ros.on(this.name,this._messageCallback),this.subscribeId="subscribe:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"subscribe",id:this.subscribeId,type:this.messageType,topic:this.name,compression:this.compression,throttle_rate:this.throttle_rate,queue_length:this.queue_length}))},o.prototype.unsubscribe=function(e){e&&(this.off("message",e),this.listeners("message").length)||this.subscribeId&&(this.ros.off(this.name,this._messageCallback),this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unsubscribe"),this.ros.callOnConnection({op:"unsubscribe",id:this.subscribeId,topic:this.name}),this.subscribeId=null)},o.prototype.advertise=function(){if(!this.isAdvertised&&(this.advertiseId="advertise:"+this.name+":"+ ++this.ros.idCounter,this.callForSubscribeAndAdvertise({op:"advertise",id:this.advertiseId,type:this.messageType,topic:this.name,latch:this.latch,queue_size:this.queue_size}),this.isAdvertised=!0,!this.reconnect_on_close)){var e=this;this.ros.on("close",(function(){e.isAdvertised=!1}))}},o.prototype.unadvertise=function(){this.isAdvertised&&(this.reconnect_on_close&&this.ros.off("close",this.reconnectFunc),this.emit("unadvertise"),this.ros.callOnConnection({op:"unadvertise",id:this.advertiseId,topic:this.name}),this.isAdvertised=!1)},o.prototype.publish=function(e){this.isAdvertised||this.advertise(),this.ros.idCounter++;var t={op:"publish",id:"publish:"+this.name+":"+this.ros.idCounter,topic:this.name,msg:e,latch:this.latch};this.ros.callOnConnection(t)},t.exports=o},{"./Message":13,eventemitter2:2}],21:[function(e,t,i){var r=e("../mixin"),n=t.exports={Ros:e("./Ros"),Topic:e("./Topic"),Message:e("./Message"),Param:e("./Param"),Service:e("./Service"),ServiceRequest:e("./ServiceRequest"),ServiceResponse:e("./ServiceResponse")};r(n.Ros,["Param","Service","Topic"],n)},{"../mixin":27,"./Message":13,"./Param":14,"./Ros":15,"./Service":16,"./ServiceRequest":17,"./ServiceResponse":18,"./Topic":20}],22:[function(e,t,i){var r=e("./Vector3"),n=e("./Quaternion");function o(e){e=e||{},this.position=new r(e.position),this.orientation=new n(e.orientation)}o.prototype.applyTransform=function(e){this.position.multiplyQuaternion(e.rotation),this.position.add(e.translation);var t=e.rotation.clone();t.multiply(this.orientation),this.orientation=t},o.prototype.clone=function(){return new o(this)},o.prototype.multiply=function(e){var t=e.clone();return t.applyTransform({rotation:this.orientation,translation:this.position}),t},o.prototype.getInverse=function(){var e=this.clone();return e.orientation.invert(),e.position.multiplyQuaternion(e.orientation),e.position.x*=-1,e.position.y*=-1,e.position.z*=-1,e},t.exports=o},{"./Quaternion":23,"./Vector3":25}],23:[function(e,t,i){function r(e){e=e||{},this.x=e.x||0,this.y=e.y||0,this.z=e.z||0,this.w="number"==typeof e.w?e.w:1}r.prototype.conjugate=function(){this.x*=-1,this.y*=-1,this.z*=-1},r.prototype.norm=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},r.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===e?(this.x=0,this.y=0,this.z=0,this.w=1):(e=1/e,this.x=this.x*e,this.y=this.y*e,this.z=this.z*e,this.w=this.w*e)},r.prototype.invert=function(){this.conjugate(),this.normalize()},r.prototype.multiply=function(e){var t=this.x*e.w+this.y*e.z-this.z*e.y+this.w*e.x,i=-this.x*e.z+this.y*e.w+this.z*e.x+this.w*e.y,r=this.x*e.y-this.y*e.x+this.z*e.w+this.w*e.z,n=-this.x*e.x-this.y*e.y-this.z*e.z+this.w*e.w;this.x=t,this.y=i,this.z=r,this.w=n},r.prototype.clone=function(){return new r(this)},t.exports=r},{}],24:[function(e,t,i){var r=e("./Vector3"),n=e("./Quaternion");function o(e){e=e||{},this.translation=new r(e.translation),this.rotation=new n(e.rotation)}o.prototype.clone=function(){return new o(this)},t.exports=o},{"./Quaternion":23,"./Vector3":25}],25:[function(e,t,i){function r(e){e=e||{},this.x=e.x||0,this.y=e.y||0,this.z=e.z||0}r.prototype.add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},r.prototype.subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},r.prototype.multiplyQuaternion=function(e){var t=e.w*this.x+e.y*this.z-e.z*this.y,i=e.w*this.y+e.z*this.x-e.x*this.z,r=e.w*this.z+e.x*this.y-e.y*this.x,n=-e.x*this.x-e.y*this.y-e.z*this.z;this.x=t*e.w+n*-e.x+i*-e.z-r*-e.y,this.y=i*e.w+n*-e.y+r*-e.x-t*-e.z,this.z=r*e.w+n*-e.z+t*-e.y-i*-e.x},r.prototype.clone=function(){return new r(this)},t.exports=r},{}],26:[function(e,t,i){t.exports={Pose:e("./Pose"),Quaternion:e("./Quaternion"),Transform:e("./Transform"),Vector3:e("./Vector3")}},{"./Pose":22,"./Quaternion":23,"./Transform":24,"./Vector3":25}],27:[function(e,t,i){t.exports=function(e,t,i){t.forEach((function(t){var r=i[t];e.prototype[t]=function(e){return e.ros=this,new r(e)}}))}},{}],28:[function(e,t,i){var r=e("../actionlib/ActionClient"),n=e("../actionlib/Goal"),o=e("../core/Service.js"),s=e("../core/ServiceRequest.js"),a=e("../core/Topic.js"),c=e("../math/Transform");function h(e){e=e||{},this.ros=e.ros,this.fixedFrame=e.fixedFrame||"/base_link",this.angularThres=e.angularThres||2,this.transThres=e.transThres||.01,this.rate=e.rate||10,this.updateDelay=e.updateDelay||50;var t=e.topicTimeout||2,i=Math.floor(t),n=Math.floor(1e9*(t-i));this.topicTimeout={secs:i,nsecs:n},this.serverName=e.serverName||"/tf2_web_republisher",this.repubServiceName=e.repubServiceName||"/republish_tfs",this.currentGoal=!1,this.currentTopic=!1,this.frameInfos={},this.republisherUpdateRequested=!1,this.actionClient=new r({ros:e.ros,serverName:this.serverName,actionName:"tf2_web_republisher/TFSubscriptionAction",omitStatus:!0,omitResult:!0}),this.serviceClient=new o({ros:e.ros,name:this.repubServiceName,serviceType:"tf2_web_republisher/RepublishTFs"})}h.prototype.processTFArray=function(e){e.transforms.forEach((function(e){var t=e.child_frame_id;"/"===t[0]&&(t=t.substring(1));var i=this.frameInfos[t];i&&(i.transform=new c({translation:e.transform.translation,rotation:e.transform.rotation}),i.cbs.forEach((function(e){e(i.transform)})))}),this)},h.prototype.updateGoal=function(){var e={source_frames:Object.keys(this.frameInfos),target_frame:this.fixedFrame,angular_thres:this.angularThres,trans_thres:this.transThres,rate:this.rate};if(this.ros.groovyCompatibility)this.currentGoal&&this.currentGoal.cancel(),this.currentGoal=new n({actionClient:this.actionClient,goalMessage:e}),this.currentGoal.on("feedback",this.processTFArray.bind(this)),this.currentGoal.send();else{e.timeout=this.topicTimeout;var t=new s(e);this.serviceClient.callService(t,this.processResponse.bind(this))}this.republisherUpdateRequested=!1},h.prototype.processResponse=function(e){this.currentTopic&&this.currentTopic.unsubscribe(),this.currentTopic=new a({ros:this.ros,name:e.topic_name,messageType:"tf2_web_republisher/TFArray"}),this.currentTopic.subscribe(this.processTFArray.bind(this))},h.prototype.subscribe=function(e,t){"/"===e[0]&&(e=e.substring(1)),this.frameInfos[e]?this.frameInfos[e].transform&&t(this.frameInfos[e].transform):(this.frameInfos[e]={cbs:[]},this.republisherUpdateRequested||(setTimeout(this.updateGoal.bind(this),this.updateDelay),this.republisherUpdateRequested=!0)),this.frameInfos[e].cbs.push(t)},h.prototype.unsubscribe=function(e,t){"/"===e[0]&&(e=e.substring(1));for(var i=this.frameInfos[e],r=i&&i.cbs||[],n=r.length;n--;)r[n]===t&&r.splice(n,1);t&&0!==r.length||delete this.frameInfos[e]},h.prototype.dispose=function(){this.actionClient.dispose(),this.currentTopic&&this.currentTopic.unsubscribe()},t.exports=h},{"../actionlib/ActionClient":8,"../actionlib/Goal":10,"../core/Service.js":16,"../core/ServiceRequest.js":17,"../core/Topic.js":20,"../math/Transform":24}],29:[function(e,t,i){var r=e("../core/Ros");e("../mixin")(r,["TFClient"],t.exports={TFClient:e("./TFClient")})},{"../core/Ros":15,"../mixin":27,"./TFClient":28}],30:[function(e,t,i){var r=e("../math/Vector3"),n=e("./UrdfTypes");t.exports=function(e){this.dimension=null,this.type=n.URDF_BOX;var t=e.xml.getAttribute("size").split(" ");this.dimension=new r({x:parseFloat(t[0]),y:parseFloat(t[1]),z:parseFloat(t[2])})}},{"../math/Vector3":25,"./UrdfTypes":39}],31:[function(e,t,i){t.exports=function(e){var t=e.xml.getAttribute("rgba").split(" ");this.r=parseFloat(t[0]),this.g=parseFloat(t[1]),this.b=parseFloat(t[2]),this.a=parseFloat(t[3])}},{}],32:[function(e,t,i){var r=e("./UrdfTypes");t.exports=function(e){this.type=r.URDF_CYLINDER,this.length=parseFloat(e.xml.getAttribute("length")),this.radius=parseFloat(e.xml.getAttribute("radius"))}},{"./UrdfTypes":39}],33:[function(e,t,i){var r=e("../math/Pose"),n=e("../math/Vector3"),o=e("../math/Quaternion");t.exports=function(e){this.name=e.xml.getAttribute("name"),this.type=e.xml.getAttribute("type");var t=e.xml.getElementsByTagName("parent");t.length>0&&(this.parent=t[0].getAttribute("link"));var i=e.xml.getElementsByTagName("child");i.length>0&&(this.child=i[0].getAttribute("link"));var s=e.xml.getElementsByTagName("limit");s.length>0&&(this.minval=parseFloat(s[0].getAttribute("lower")),this.maxval=parseFloat(s[0].getAttribute("upper")));var a=e.xml.getElementsByTagName("origin");if(0===a.length)this.origin=new r;else{var c=a[0].getAttribute("xyz"),h=new n;c&&(c=c.split(" "),h=new n({x:parseFloat(c[0]),y:parseFloat(c[1]),z:parseFloat(c[2])}));var l=a[0].getAttribute("rpy"),u=new o;if(l){l=l.split(" ");var p=parseFloat(l[0])/2,d=parseFloat(l[1])/2,f=parseFloat(l[2])/2,m=Math.sin(p)*Math.cos(d)*Math.cos(f)-Math.cos(p)*Math.sin(d)*Math.sin(f),v=Math.cos(p)*Math.sin(d)*Math.cos(f)+Math.sin(p)*Math.cos(d)*Math.sin(f),g=Math.cos(p)*Math.cos(d)*Math.sin(f)-Math.sin(p)*Math.sin(d)*Math.cos(f),y=Math.cos(p)*Math.cos(d)*Math.cos(f)+Math.sin(p)*Math.sin(d)*Math.sin(f);(u=new o({x:m,y:v,z:g,w:y})).normalize()}this.origin=new r({position:h,orientation:u})}}},{"../math/Pose":22,"../math/Quaternion":23,"../math/Vector3":25}],34:[function(e,t,i){var r=e("./UrdfVisual");t.exports=function(e){this.name=e.xml.getAttribute("name"),this.visuals=[];for(var t=e.xml.getElementsByTagName("visual"),i=0;i<t.length;i++)this.visuals.push(new r({xml:t[i]}))}},{"./UrdfVisual":40}],35:[function(e,t,i){var r=e("./UrdfColor");function n(e){this.textureFilename=null,this.color=null,this.name=e.xml.getAttribute("name");var t=e.xml.getElementsByTagName("texture");t.length>0&&(this.textureFilename=t[0].getAttribute("filename"));var i=e.xml.getElementsByTagName("color");i.length>0&&(this.color=new r({xml:i[0]}))}n.prototype.isLink=function(){return null===this.color&&null===this.textureFilename};var o=e("object-assign");n.prototype.assign=function(e){return o(this,e)},t.exports=n},{"./UrdfColor":31,"object-assign":3}],36:[function(e,t,i){var r=e("../math/Vector3"),n=e("./UrdfTypes");t.exports=function(e){this.scale=null,this.type=n.URDF_MESH,this.filename=e.xml.getAttribute("filename");var t=e.xml.getAttribute("scale");if(t){var i=t.split(" ");this.scale=new r({x:parseFloat(i[0]),y:parseFloat(i[1]),z:parseFloat(i[2])})}}},{"../math/Vector3":25,"./UrdfTypes":39}],37:[function(e,t,i){var r=e("./UrdfMaterial"),n=e("./UrdfLink"),o=e("./UrdfJoint"),s=e("xmldom").DOMParser;t.exports=function(e){var t=(e=e||{}).xml,i=e.string;this.materials={},this.links={},this.joints={},i&&(t=(new s).parseFromString(i,"text/xml"));var a=t.documentElement;this.name=a.getAttribute("name");for(var c=a.childNodes,h=0;h<c.length;h++){var l=c[h];if("material"===l.tagName){var u=new r({xml:l});void 0!==this.materials[u.name]?this.materials[u.name].isLink()?this.materials[u.name].assign(u):console.warn("Material "+u.name+"is not unique."):this.materials[u.name]=u}else if("link"===l.tagName){var p=new n({xml:l});if(void 0!==this.links[p.name])console.warn("Link "+p.name+" is not unique.");else{for(var d=0;d<p.visuals.length;d++){var f=p.visuals[d].material;null!==f&&(void 0!==this.materials[f.name]?p.visuals[d].material=this.materials[f.name]:this.materials[f.name]=f)}this.links[p.name]=p}}else if("joint"===l.tagName){var m=new o({xml:l});this.joints[m.name]=m}}}},{"./UrdfJoint":33,"./UrdfLink":34,"./UrdfMaterial":35,xmldom:46}],38:[function(e,t,i){var r=e("./UrdfTypes");t.exports=function(e){this.type=r.URDF_SPHERE,this.radius=parseFloat(e.xml.getAttribute("radius"))}},{"./UrdfTypes":39}],39:[function(e,t,i){t.exports={URDF_SPHERE:0,URDF_BOX:1,URDF_CYLINDER:2,URDF_MESH:3}},{}],40:[function(e,t,i){var r=e("../math/Pose"),n=e("../math/Vector3"),o=e("../math/Quaternion"),s=e("./UrdfCylinder"),a=e("./UrdfBox"),c=e("./UrdfMaterial"),h=e("./UrdfMesh"),l=e("./UrdfSphere");t.exports=function(e){var t=e.xml;this.origin=null,this.geometry=null,this.material=null,this.name=e.xml.getAttribute("name");var i=t.getElementsByTagName("origin");if(0===i.length)this.origin=new r;else{var u=i[0].getAttribute("xyz"),p=new n;u&&(u=u.split(" "),p=new n({x:parseFloat(u[0]),y:parseFloat(u[1]),z:parseFloat(u[2])}));var d=i[0].getAttribute("rpy"),f=new o;if(d){d=d.split(" ");var m=parseFloat(d[0])/2,v=parseFloat(d[1])/2,g=parseFloat(d[2])/2,y=Math.sin(m)*Math.cos(v)*Math.cos(g)-Math.cos(m)*Math.sin(v)*Math.sin(g),b=Math.cos(m)*Math.sin(v)*Math.cos(g)+Math.sin(m)*Math.cos(v)*Math.sin(g),x=Math.cos(m)*Math.cos(v)*Math.sin(g)-Math.sin(m)*Math.sin(v)*Math.cos(g),w=Math.cos(m)*Math.cos(v)*Math.cos(g)+Math.sin(m)*Math.sin(v)*Math.sin(g);(f=new o({x:y,y:b,z:x,w:w})).normalize()}this.origin=new r({position:p,orientation:f})}var _=t.getElementsByTagName("geometry");if(_.length>0){for(var M=_[0],E=null,T=0;T<M.childNodes.length;T++){var S=M.childNodes[T];if(1===S.nodeType){E=S;break}}var A=E.nodeName;"sphere"===A?this.geometry=new l({xml:E}):"box"===A?this.geometry=new a({xml:E}):"cylinder"===A?this.geometry=new s({xml:E}):"mesh"===A?this.geometry=new h({xml:E}):console.warn("Unknown geometry type "+A)}var L=t.getElementsByTagName("material");L.length>0&&(this.material=new c({xml:L[0]}))}},{"../math/Pose":22,"../math/Quaternion":23,"../math/Vector3":25,"./UrdfBox":30,"./UrdfCylinder":32,"./UrdfMaterial":35,"./UrdfMesh":36,"./UrdfSphere":38}],41:[function(e,t,i){t.exports=e("object-assign")({UrdfBox:e("./UrdfBox"),UrdfColor:e("./UrdfColor"),UrdfCylinder:e("./UrdfCylinder"),UrdfLink:e("./UrdfLink"),UrdfMaterial:e("./UrdfMaterial"),UrdfMesh:e("./UrdfMesh"),UrdfModel:e("./UrdfModel"),UrdfSphere:e("./UrdfSphere"),UrdfVisual:e("./UrdfVisual")},e("./UrdfTypes"))},{"./UrdfBox":30,"./UrdfColor":31,"./UrdfCylinder":32,"./UrdfLink":34,"./UrdfMaterial":35,"./UrdfMesh":36,"./UrdfModel":37,"./UrdfSphere":38,"./UrdfTypes":39,"./UrdfVisual":40,"object-assign":3}],42:[function(e,t,i){var r=Math.pow(2,32),n=!1;function o(){n||(n=!0,console.warn("CBOR 64-bit integer array values may lose precision. No further warnings."))}var s={64:Uint8Array,69:Uint16Array,70:Uint32Array,72:Int8Array,77:Int16Array,78:Int32Array,85:Float32Array,86:Float64Array},a={71:function(e){o();for(var t=e.byteLength,i=e.byteOffset,n=t/8,s=e.buffer.slice(i,i+t),a=new Uint32Array(s),c=new Array(n),h=0;h<n;h++){var l=2*h,u=a[l],p=a[l+1];c[h]=u+r*p}return c},79:function(e){o();for(var t=e.byteLength,i=e.byteOffset,n=t/8,s=e.buffer.slice(i,i+t),a=new Uint32Array(s),c=new Int32Array(s),h=new Array(n),l=0;l<n;l++){var u=2*l,p=a[u],d=c[u+1];h[l]=p+r*d}return h}};void 0!==t&&t.exports&&(t.exports=function(e,t){var i,r,n,o;return t in s?(r=s[t],n=(i=e).byteLength,o=i.byteOffset,new r(i.buffer.slice(o,o+n))):t in a?a[t](e):e})},{}],43:[function(e,t,i){t.exports="undefined"!=typeof window?window.WebSocket:WebSocket},{}],44:[function(e,t,i){t.exports=function(){return document.createElement("canvas")}},{}],45:[function(e,t,i){var r=e("canvas"),n=r.Image||window.Image;t.exports=function(e,t){var i=new n;i.onload=function(){var e=new r,n=e.getContext("2d");e.width=i.width,e.height=i.height,n.imageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.mozImageSmoothingEnabled=!1,n.drawImage(i,0,0);for(var o=n.getImageData(0,0,i.width,i.height).data,s="",a=0;a<o.length;a+=4)s+=String.fromCharCode(o[a],o[a+1],o[a+2]);t(JSON.parse(s))},i.src="data:image/png;base64,"+e}},{canvas:44}],46:[function(e,t,i){i.DOMImplementation=window.DOMImplementation,i.XMLSerializer=window.XMLSerializer,i.DOMParser=window.DOMParser},{}],47:[function(e,t,i){var r=e("webworkify"),n=e("./workerSocketImpl");function o(e){this.socket_=r(n),this.socket_.addEventListener("message",this.handleWorkerMessage_.bind(this)),this.socket_.postMessage({uri:e})}o.prototype.handleWorkerMessage_=function(e){var t=e.data;if(t instanceof ArrayBuffer||"string"==typeof t)this.onmessage(e);else{var i=t.type;if("close"===i)this.onclose(null);else if("open"===i)this.onopen(null);else{if("error"!==i)throw"Unknown message from workersocket";this.onerror(null)}}},o.prototype.send=function(e){this.socket_.postMessage(e)},o.prototype.close=function(){this.socket_.postMessage({close:!0})},t.exports=o},{"./workerSocketImpl":48,webworkify:5}],48:[function(e,t,i){var r=r||e("ws");t.exports=function(e){var t=null;function i(t){var i=t.data;i instanceof ArrayBuffer?e.postMessage(i,[i]):e.postMessage(i)}function n(t){e.postMessage({type:t.type})}e.addEventListener("message",(function(e){var o=e.data;if("string"==typeof o)t.send(o);else if(o.hasOwnProperty("close"))t.close(),t=null;else{if(!o.hasOwnProperty("uri"))throw"Unknown message to WorkerSocket";var s=o.uri;(t=new r(s)).binaryType="arraybuffer",t.onmessage=i,t.onclose=n,t.onopen=n,t.onerror=n}}))}},{ws:43}]},{},[7]);class Oa extends Ea.Mesh{constructor(e){var t=(e=e||{}).origin||new Ea.Vector3(0,0,0),i=e.direction||new Ea.Vector3(1,0,0),r=e.length||1,n=e.headLength||.2,o=e.shaftDiameter||.05,s=e.headDiameter||.1,a=e.material||new Ea.MeshBasicMaterial,c=r-n,h=new Ea.CylinderGeometry(.5*o,.5*o,c,12,1),l=new Ea.Matrix4;l.setPosition(new Ea.Vector3(0,.5*c,0)),h.applyMatrix(l);var u=new Ea.CylinderGeometry(0,.5*s,n,12,1);l.setPosition(new Ea.Vector3(0,c+.5*n,0)),u.applyMatrix(l),h.merge(u),super(h,a),this.position.copy(t),this.setDirection(i)}setDirection(e){var t=new Ea.Vector3;0===e.x&&0===e.z?t.set(1,0,0):t.set(0,1,0).cross(e);var i=Math.acos(new Ea.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new Ea.Matrix4).makeRotationAxis(t.normalize(),i),this.rotation.setFromRotationMatrix(this.matrix,this.rotation.order)}setLength(e){this.scale.set(e,e,e)}setColor(e){this.material.color.setHex(e)}dispose(){void 0!==this.geometry&&this.geometry.dispose(),void 0!==this.material&&this.material.dispose()}}Ea.STLLoader=function(e){this.manager=void 0!==e?e:Ea.DefaultLoadingManager},Ea.STLLoader.prototype={constructor:Ea.STLLoader,load:function(e,t,i,r){var n=this,o=new Ea.FileLoader(n.manager);o.setResponseType("arraybuffer"),o.load(e,(function(e){t(n.parse(e))}),i,r)},parse:function(e){var t=function(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),i=0;i<e.length;i++)t[i]=255&e.charCodeAt(i);return t.buffer||t}return e}(e);return function(e){var t;if(50,84+50*(t=new DataView(e)).getUint32(80,!0)===t.byteLength)return!0;for(var i=[115,111,108,105,100],r=0;r<5;r++)if(i[r]!=t.getUint8(r,!1))return!0;return!1}(t)?function(e){for(var t,i,r,n,o,s,a,c,h=new DataView(e),l=h.getUint32(80,!0),u=!1,p=0;p<70;p++)1129270351==h.getUint32(p,!1)&&82==h.getUint8(p+4)&&61==h.getUint8(p+5)&&(u=!0,n=[],o=h.getUint8(p+6)/255,s=h.getUint8(p+7)/255,a=h.getUint8(p+8)/255,c=h.getUint8(p+9)/255);for(var d=new Ea.BufferGeometry,f=[],m=[],v=0;v<l;v++){var g=84+50*v,y=h.getFloat32(g,!0),b=h.getFloat32(g+4,!0),x=h.getFloat32(g+8,!0);if(u){var w=h.getUint16(g+48,!0);0==(32768&w)?(t=(31&w)/31,i=(w>>5&31)/31,r=(w>>10&31)/31):(t=o,i=s,r=a)}for(var _=1;_<=3;_++){var M=g+12*_;f.push(h.getFloat32(M,!0)),f.push(h.getFloat32(M+4,!0)),f.push(h.getFloat32(M+8,!0)),m.push(y,b,x),u&&n.push(t,i,r)}}return d.addAttribute("position",new Ea.BufferAttribute(new Float32Array(f),3)),d.addAttribute("normal",new Ea.BufferAttribute(new Float32Array(m),3)),u&&(d.addAttribute("color",new Ea.BufferAttribute(new Float32Array(n),3)),d.hasColors=!0,d.alpha=c),d}(t):function(e){for(var t,i=new Ea.BufferGeometry,r=/facet([\s\S]*?)endfacet/g,n=0,o=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,s=new RegExp("vertex"+o+o+o,"g"),a=new RegExp("normal"+o+o+o,"g"),c=[],h=[],l=new Ea.Vector3;null!==(t=r.exec(e));){for(var u=0,p=0,d=t[0];null!==(t=a.exec(d));)l.x=parseFloat(t[1]),l.y=parseFloat(t[2]),l.z=parseFloat(t[3]),p++;for(;null!==(t=s.exec(d));)c.push(parseFloat(t[1]),parseFloat(t[2]),parseFloat(t[3])),h.push(l.x,l.y,l.z),u++;1!==p&&console.error("THREE.STLLoader: Something isn't right with the normal of face number "+n),3!==u&&console.error("THREE.STLLoader: Something isn't right with the vertices of face number "+n),n++}return i.addAttribute("position",new Ea.Float32BufferAttribute(c,3)),i.addAttribute("normal",new Ea.Float32BufferAttribute(h,3)),i}(function(e){if("string"!=typeof e){var t=new Uint8Array(e);if(void 0!==window.TextDecoder)return(new TextDecoder).decode(t);for(var i="",r=0,n=e.byteLength;r<n;r++)i+=String.fromCharCode(t[r]);return i}return e}(e))}};var Ia=/^[og]\s*(.+)?/,Da=/^mtllib /,Ua=/^usemtl /;function Fa(){var e={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&!1===this.object.fromDeclaration)return this.object.name=e,void(this.object.fromDeclaration=!1!==t);var i=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:!1!==t,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var i=this._finalize(!1);i&&(i.inherited||i.groupCount<=0)&&this.materials.splice(i.index,1);var r={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==i?i.smooth:this.smooth,groupStart:void 0!==i?i.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(r),r},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&-1===t.groupEnd&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var i=this.materials.length-1;i>=0;i--)this.materials[i].groupCount<=0&&this.materials.splice(i,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},i&&i.name&&"function"==typeof i.clone){var r=i.clone(0);r.inherited=!0,this.object.materials.push(r)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseNormalIndex:function(e,t){var i=parseInt(e,10);return 3*(i>=0?i-1:i+t/3)},parseUVIndex:function(e,t){var i=parseInt(e,10);return 2*(i>=0?i-1:i+t/2)},addVertex:function(e,t,i){var r=this.vertices,n=this.object.geometry.vertices;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addVertexPoint:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addVertexLine:function(e){var t=this.vertices;this.object.geometry.vertices.push(t[e+0],t[e+1],t[e+2])},addNormal:function(e,t,i){var r=this.normals,n=this.object.geometry.normals;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addColor:function(e,t,i){var r=this.colors,n=this.object.geometry.colors;n.push(r[e+0],r[e+1],r[e+2]),n.push(r[t+0],r[t+1],r[t+2]),n.push(r[i+0],r[i+1],r[i+2])},addUV:function(e,t,i){var r=this.uvs,n=this.object.geometry.uvs;n.push(r[e+0],r[e+1]),n.push(r[t+0],r[t+1]),n.push(r[i+0],r[i+1])},addUVLine:function(e){var t=this.uvs;this.object.geometry.uvs.push(t[e+0],t[e+1])},addFace:function(e,t,i,r,n,o,s,a,c){var h=this.vertices.length,l=this.parseVertexIndex(e,h),u=this.parseVertexIndex(t,h),p=this.parseVertexIndex(i,h);if(this.addVertex(l,u,p),void 0!==r&&""!==r){var d=this.uvs.length;l=this.parseUVIndex(r,d),u=this.parseUVIndex(n,d),p=this.parseUVIndex(o,d),this.addUV(l,u,p)}if(void 0!==s&&""!==s){var f=this.normals.length;l=this.parseNormalIndex(s,f),u=s===a?l:this.parseNormalIndex(a,f),p=s===c?l:this.parseNormalIndex(c,f),this.addNormal(l,u,p)}this.colors.length>0&&this.addColor(l,u,p)},addPointGeometry:function(e){this.object.geometry.type="Points";for(var t=this.vertices.length,i=0,r=e.length;i<r;i++)this.addVertexPoint(this.parseVertexIndex(e[i],t))},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var i=this.vertices.length,r=this.uvs.length,n=0,o=e.length;n<o;n++)this.addVertexLine(this.parseVertexIndex(e[n],i));var s=0;for(o=t.length;s<o;s++)this.addUVLine(this.parseUVIndex(t[s],r))}};return e.startObject("",!1),e}Ea.OBJLoader=function(e){this.manager=void 0!==e?e:Ea.DefaultLoadingManager,this.materials=null},Ea.OBJLoader.prototype={constructor:Ea.OBJLoader,load:function(e,t,i,r){var n=this,o=new Ea.FileLoader(n.manager);o.setPath(this.path),o.load(e,(function(e){t(n.parse(e))}),i,r)},setPath:function(e){return this.path=e,this},setMaterials:function(e){return this.materials=e,this},parse:function(e){console.time("OBJLoader");var t=new Fa;-1!==e.indexOf("\r\n")&&(e=e.replace(/\r\n/g,"\n")),-1!==e.indexOf("\\\n")&&(e=e.replace(/\\\n/g,""));for(var i=e.split("\n"),r="",n="",o=[],s="function"==typeof"".trimLeft,a=0,c=i.length;a<c;a++)if(r=i[a],0!==(r=s?r.trimLeft():r.trim()).length&&"#"!==(n=r.charAt(0)))if("v"===n){var h=r.split(/\s+/);switch(h[0]){case"v":t.vertices.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])),8===h.length&&t.colors.push(parseFloat(h[4]),parseFloat(h[5]),parseFloat(h[6]));break;case"vn":t.normals.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3]));break;case"vt":t.uvs.push(parseFloat(h[1]),parseFloat(h[2]))}}else if("f"===n){for(var l=r.substr(1).trim().split(/\s+/),u=[],p=0,d=l.length;p<d;p++){var f=l[p];if(f.length>0){var m=f.split("/");u.push(m)}}var v=u[0];for(p=1,d=u.length-1;p<d;p++){var g=u[p],y=u[p+1];t.addFace(v[0],g[0],y[0],v[1],g[1],y[1],v[2],g[2],y[2])}}else if("l"===n){var b=r.substring(1).trim().split(" "),x=[],w=[];if(-1===r.indexOf("/"))x=b;else for(var _=0,M=b.length;_<M;_++){var E=b[_].split("/");""!==E[0]&&x.push(E[0]),""!==E[1]&&w.push(E[1])}t.addLineGeometry(x,w)}else if("p"===n){var T=r.substr(1).trim().split(" ");t.addPointGeometry(T)}else if(null!==(o=Ia.exec(r))){var S=(" "+o[0].substr(1).trim()).substr(1);t.startObject(S)}else if(Ua.test(r))t.object.startMaterial(r.substring(7).trim(),t.materialLibraries);else if(Da.test(r))t.materialLibraries.push(r.substring(7).trim());else{if("s"!==n){if("\0"===r)continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+r+'"')}if((o=r.split(" ")).length>1){var A=o[1].trim().toLowerCase();t.object.smooth="0"!==A&&"off"!==A}else t.object.smooth=!0;(G=t.object.currentMaterial())&&(G.smooth=t.object.smooth)}t.finalize();var L=new Ea.Object3D;L.materialLibraries=[].concat(t.materialLibraries);for(a=0,c=t.objects.length;a<c;a++){var R=t.objects[a],C=R.geometry,P=R.materials,N="Line"===C.type,O="Points"===C.type,I=!1;if(0!==C.vertices.length){var D=new Ea.BufferGeometry;D.addAttribute("position",new Ea.Float32BufferAttribute(C.vertices,3)),C.normals.length>0?D.addAttribute("normal",new Ea.Float32BufferAttribute(C.normals,3)):D.computeVertexNormals(),C.colors.length>0&&(I=!0,D.addAttribute("color",new Ea.Float32BufferAttribute(C.colors,3))),C.uvs.length>0&&D.addAttribute("uv",new Ea.Float32BufferAttribute(C.uvs,2));for(var U,F=[],k=0,B=P.length;k<B;k++){var z=P[k],G=void 0;if(null!==this.materials)if(G=this.materials.create(z.name),!N||!G||G instanceof Ea.LineBasicMaterial){if(O&&G&&!(G instanceof Ea.PointsMaterial)){var j=new Ea.PointsMaterial({size:10,sizeAttenuation:!1});Ea.Material.prototype.copy.call(j,G),j.color.copy(G.color),j.map=G.map,j.lights=!1,G=j}}else{var V=new Ea.LineBasicMaterial;Ea.Material.prototype.copy.call(V,G),V.color.copy(G.color),V.lights=!1,G=V}G||((G=N?new Ea.LineBasicMaterial:O?new Ea.PointsMaterial({size:1,sizeAttenuation:!1}):new Ea.MeshPhongMaterial).name=z.name),G.flatShading=!z.smooth,G.vertexColors=I?Ea.VertexColors:Ea.NoColors,F.push(G)}if(F.length>1){for(k=0,B=P.length;k<B;k++){z=P[k];D.addGroup(z.groupStart,z.groupCount,k)}U=N?new Ea.LineSegments(D,F):O?new Ea.Points(D,F):new Ea.Mesh(D,F)}else U=N?new Ea.LineSegments(D,F[0]):O?new Ea.Points(D,F[0]):new Ea.Mesh(D,F[0]);U.name=R.name,L.add(U)}}return console.timeEnd("OBJLoader"),L}},Ea.MTLLoader=function(e){this.manager=void 0!==e?e:Ea.DefaultLoadingManager},Ea.MTLLoader.prototype={constructor:Ea.MTLLoader,crossOrigin:"anonymous",load:function(e,t,i,r){var n=this,o=void 0===this.path?Ea.LoaderUtils.extractUrlBase(e):this.path,s=new Ea.FileLoader(this.manager);s.setPath(this.path),s.load(e,(function(e){t(n.parse(e,o))}),i,r)},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setTexturePath:function(e){return console.warn("THREE.MTLLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)},setCrossOrigin:function(e){return this.crossOrigin=e,this},setMaterialOptions:function(e){return this.materialOptions=e,this},parse:function(e,t){for(var i=e.split("\n"),r={},n=/\s+/,o={},s=0;s<i.length;s++){var a=i[s];if(0!==(a=a.trim()).length&&"#"!==a.charAt(0)){var c=a.indexOf(" "),h=c>=0?a.substring(0,c):a;h=h.toLowerCase();var l=c>=0?a.substring(c+1):"";if(l=l.trim(),"newmtl"===h)r={name:l},o[l]=r;else if("ka"===h||"kd"===h||"ks"===h||"ke"===h){var u=l.split(n,3);r[h]=[parseFloat(u[0]),parseFloat(u[1]),parseFloat(u[2])]}else r[h]=l}}var p=new Ea.MTLLoader.MaterialCreator(this.resourcePath||t,this.materialOptions);return p.setCrossOrigin(this.crossOrigin),p.setManager(this.manager),p.setMaterials(o),p}},Ea.MTLLoader.MaterialCreator=function(e,t){this.baseUrl=e||"",this.options=t,this.materialsInfo={},this.materials={},this.materialsArray=[],this.nameLookup={},this.side=this.options&&this.options.side?this.options.side:Ea.FrontSide,this.wrap=this.options&&this.options.wrap?this.options.wrap:Ea.RepeatWrapping},Ea.MTLLoader.MaterialCreator.prototype={constructor:Ea.MTLLoader.MaterialCreator,crossOrigin:"anonymous",setCrossOrigin:function(e){return this.crossOrigin=e,this},setManager:function(e){this.manager=e},setMaterials:function(e){this.materialsInfo=this.convert(e),this.materials={},this.materialsArray=[],this.nameLookup={}},convert:function(e){if(!this.options)return e;var t={};for(var i in e){var r=e[i],n={};for(var o in t[i]=n,r){var s=!0,a=r[o],c=o.toLowerCase();switch(c){case"kd":case"ka":case"ks":this.options&&this.options.normalizeRGB&&(a=[a[0]/255,a[1]/255,a[2]/255]),this.options&&this.options.ignoreZeroRGBs&&0===a[0]&&0===a[1]&&0===a[2]&&(s=!1)}s&&(n[c]=a)}}return t},preload:function(){for(var e in this.materialsInfo)this.create(e)},getIndex:function(e){return this.nameLookup[e]},getAsArray:function(){var e=0;for(var t in this.materialsInfo)this.materialsArray[e]=this.create(t),this.nameLookup[t]=e,e++;return this.materialsArray},create:function(e){return void 0===this.materials[e]&&this.createMaterial_(e),this.materials[e]},createMaterial_:function(e){var t=this,i=this.materialsInfo[e],r={name:e,side:this.side};function n(e,i){if(!r[e]){var n,o,s=t.getTextureParams(i,r),a=t.loadTexture((n=t.baseUrl,"string"!=typeof(o=s.url)||""===o?"":/^https?:\/\//i.test(o)?o:n+o));a.repeat.copy(s.scale),a.offset.copy(s.offset),a.wrapS=t.wrap,a.wrapT=t.wrap,r[e]=a}}for(var o in i){var s,a=i[o];if(""!==a)switch(o.toLowerCase()){case"kd":r.color=(new Ea.Color).fromArray(a);break;case"ks":r.specular=(new Ea.Color).fromArray(a);break;case"ke":r.emissive=(new Ea.Color).fromArray(a);break;case"map_kd":n("map",a);break;case"map_ks":n("specularMap",a);break;case"map_ke":n("emissiveMap",a);break;case"norm":n("normalMap",a);break;case"map_bump":case"bump":n("bumpMap",a);break;case"map_d":n("alphaMap",a),r.transparent=!0;break;case"ns":r.shininess=parseFloat(a);break;case"d":(s=parseFloat(a))<1&&(r.opacity=s,r.transparent=!0);break;case"tr":s=parseFloat(a),this.options&&this.options.invertTrProperty&&(s=1-s),s>0&&(r.opacity=1-s,r.transparent=!0)}}return this.materials[e]=new Ea.MeshPhongMaterial(r),this.materials[e]},getTextureParams:function(e,t){var i,r={scale:new Ea.Vector2(1,1),offset:new Ea.Vector2(0,0)},n=e.split(/\s+/);return(i=n.indexOf("-bm"))>=0&&(t.bumpScale=parseFloat(n[i+1]),n.splice(i,2)),(i=n.indexOf("-s"))>=0&&(r.scale.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),(i=n.indexOf("-o"))>=0&&(r.offset.set(parseFloat(n[i+1]),parseFloat(n[i+2])),n.splice(i,4)),r.url=n.join(" ").trim(),r},loadTexture:function(e,t,i,r,n){var o,s=Ea.Loader.Handlers.get(e),a=void 0!==this.manager?this.manager:Ea.DefaultLoadingManager;return null===s&&(s=new Ea.TextureLoader(a)),s.setCrossOrigin&&s.setCrossOrigin(this.crossOrigin),o=s.load(e,i,r,n),void 0!==t&&(o.mapping=t),o}},Ea.ColladaLoader=function(e){this.manager=void 0!==e?e:Ea.DefaultLoadingManager},Ea.ColladaLoader.prototype={constructor:Ea.ColladaLoader,crossOrigin:"Anonymous",load:function(e,t,i,r){var n=this,o=Ea.Loader.prototype.extractUrlBase(e);new Ea.FileLoader(n.manager).load(e,(function(e){t(n.parse(e,o))}),i,r)},options:{set convertUpAxis(e){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){function i(e,t){for(var i=[],r=e.childNodes,n=0,o=r.length;n<o;n++){var s=r[n];s.nodeName===t&&i.push(s)}return i}function r(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=t[r];return i}function n(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseFloat(t[r]);return i}function o(e){if(0===e.length)return[];for(var t=e.trim().split(/\s+/),i=new Array(t.length),r=0,n=t.length;r<n;r++)i[r]=parseInt(t[r]);return i}function s(e){return e.substring(1)}function a(e){return 0===Object.keys(e).length}function c(e){return void 0!==e?parseFloat(e.getAttribute("meter")):1}function h(e){return void 0!==e?e.textContent:"Y_UP"}function l(e,t,r,n){var o=i(e,t)[0];if(void 0!==o)for(var s=i(o,r),a=0;a<s.length;a++)n(s[a])}function u(e,t){for(var i in e){e[i].build=t(e[i])}}function p(e,t){return void 0!==e.build||(e.build=t(e)),e.build}function d(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var o=s(n.getAttribute("source")),a=n.getAttribute("semantic");t.inputs[a]=o}}return t}function f(e){var t={},i=e.getAttribute("target").split("/"),r=i.shift(),n=i.shift(),o=-1!==n.indexOf("("),a=-1!==n.indexOf(".");if(a)i=n.split("."),n=i.shift(),t.member=i.shift();else if(o){var c=n.split("(");n=c.shift();for(var h=0;h<c.length;h++)c[h]=parseInt(c[h].replace(/\)/,""));t.indices=c}return t.id=r,t.sid=n,t.arraySyntax=o,t.memberSyntax=a,t.sampler=s(e.getAttribute("source")),t}function m(e){var t=[],i=e.channels,r=e.samplers,n=e.sources;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o],a=r[s.sampler],c=a.inputs.INPUT,h=a.inputs.OUTPUT;w(g(s,n[c],n[h]),t)}return t}function v(e){return p(Ue.animations[e],m)}function g(e,t,i){var r,n,o,s,a,c,h=Ue.nodes[e.id],l=Te(h.id),u=h.transforms[e.sid],p=h.matrix.clone().transpose(),d={};switch(u){case"matrix":for(o=0,s=t.array.length;o<s;o++)if(r=t.array[o],n=o*i.stride,void 0===d[r]&&(d[r]={}),!0===e.arraySyntax){var f=i.array[n],m=e.indices[0]+4*e.indices[1];d[r][m]=f}else for(a=0,c=i.stride;a<c;a++)d[r][a]=i.array[n+a];break;case"translate":case"rotate":case"scale":console.warn('THREE.ColladaLoader: Animation transform type "%s" not yet implemented.',u)}var v=function(e,t){var i=[];for(var r in e)i.push({time:parseFloat(r),value:e[r]});i.sort(o);for(var n=0;n<16;n++)_(i,n,t.elements[n]);return i;function o(e,t){return e.time-t.time}}(d,p);return{name:l.uuid,keyframes:v}}var y=new Ea.Vector3,b=new Ea.Vector3,x=new Ea.Quaternion;function w(e,t){for(var i=e.keyframes,r=e.name,n=[],o=[],s=[],a=[],c=0,h=i.length;c<h;c++){var l=i[c],u=l.time,p=l.value;ve.fromArray(p).transpose(),ve.decompose(y,x,b),n.push(u),o.push(y.x,y.y,y.z),s.push(x.x,x.y,x.z,x.w),a.push(b.x,b.y,b.z)}return o.length>0&&t.push(new Ea.VectorKeyframeTrack(r+".position",n,o)),s.length>0&&t.push(new Ea.QuaternionKeyframeTrack(r+".quaternion",n,s)),a.length>0&&t.push(new Ea.VectorKeyframeTrack(r+".scale",n,a)),t}function _(e,t,i){var r,n,o,s=!0;for(n=0,o=e.length;n<o;n++)void 0===(r=e[n]).value[t]?r.value[t]=null:s=!1;if(!0===s)for(n=0,o=e.length;n<o;n++)(r=e[n]).value[t]=i;else!function(e,t){for(var i,r,n=0,o=e.length;n<o;n++){var s=e[n];if(null===s.value[t]){if(i=M(e,n,t),r=E(e,n,t),null===i){s.value[t]=r.value[t];continue}if(null===r){s.value[t]=i.value[t];continue}T(s,i,r,t)}}}(e,t)}function M(e,t,i){for(;t>=0;){var r=e[t];if(null!==r.value[i])return r;t--}return null}function E(e,t,i){for(;t<e.length;){var r=e[t];if(null!==r.value[i])return r;t++}return null}function T(e,t,i,r){i.time-t.time!=0?e.value[r]=(e.time-t.time)*(i.value[r]-t.value[r])/(i.time-t.time)+t.value[r]:e.value[r]=t.value[r]}function S(e){for(var t=[],i=e.name,r=e.end-e.start||-1,n=e.animations,o=0,s=n.length;o<s;o++)for(var a=v(n[o]),c=0,h=a.length;c<h;c++)t.push(a[c]);return new Ea.AnimationClip(i,r,t)}function A(e){return p(Ue.clips[e],S)}function L(e){for(var t={sources:{}},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"bind_shape_matrix":t.bindShapeMatrix=n(o.textContent);break;case"source":var s=o.getAttribute("id");t.sources[s]=$(o);break;case"joints":t.joints=R(o);break;case"vertex_weights":t.vertexWeights=C(o)}}return t}function R(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var o=n.getAttribute("semantic"),a=s(n.getAttribute("source"));t.inputs[o]=a}}return t}function C(e){for(var t={inputs:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=n.getAttribute("semantic"),c=s(n.getAttribute("source")),h=parseInt(n.getAttribute("offset"));t.inputs[a]={id:c,offset:h};break;case"vcount":t.vcount=o(n.textContent);break;case"v":t.v=o(n.textContent)}}return t}function P(e){var t={id:e.id},i=Ue.geometries[t.id];return void 0!==e.skin&&(t.skin=function(e){var t,i,r,n=4,o={joints:[],indices:{array:[],stride:n},weights:{array:[],stride:n}},s=e.sources,a=e.vertexWeights,c=a.vcount,h=a.v,l=a.inputs.JOINT.offset,u=a.inputs.WEIGHT.offset,p=e.sources[e.joints.inputs.JOINT],d=e.sources[e.joints.inputs.INV_BIND_MATRIX],f=s[a.inputs.WEIGHT.id].array,m=0;for(t=0,r=c.length;t<r;t++){var v=c[t],g=[];for(i=0;i<v;i++){var y=h[m+l],b=f[h[m+u]];g.push({index:y,weight:b}),m+=2}for(g.sort(M),i=0;i<n;i++){var x=g[i];void 0!==x?(o.indices.array.push(x.index),o.weights.array.push(x.weight)):(o.indices.array.push(0),o.weights.array.push(0))}}for(o.bindMatrix=(new Ea.Matrix4).fromArray(e.bindShapeMatrix).transpose(),t=0,r=p.array.length;t<r;t++){var w=p.array[t],_=(new Ea.Matrix4).fromArray(d.array,t*d.stride).transpose();o.joints.push({name:w,boneInverse:_})}return o;function M(e,t){return t.weight-e.weight}}(e.skin),i.sources.skinIndices=t.skin.indices,i.sources.skinWeights=t.skin.weights),t}function N(e){return void 0!==e.build?e.build:e.init_from}function O(e){for(var t={surfaces:{},samplers:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"newparam":I(n,t);break;case"technique":t.technique=F(n)}}return t}function I(e,t){for(var i=e.getAttribute("sid"),r=0,n=e.childNodes.length;r<n;r++){var o=e.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"surface":t.surfaces[i]=D(o);break;case"sampler2D":t.samplers[i]=U(o)}}}function D(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"init_from":t.init_from=n.textContent}}return t}function U(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"source":t.source=n.textContent}}return t}function F(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"constant":case"lambert":case"blinn":case"phong":t.type=n.nodeName,t.parameters=k(n)}}return t}function k(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparent":case"transparency":t[n.nodeName]=B(n)}}return t}function B(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":t[o.nodeName]=n(o.textContent);break;case"float":t[o.nodeName]=parseFloat(o.textContent);break;case"texture":t[o.nodeName]={id:o.getAttribute("texture"),extra:z(o)}}}return t}function z(e){for(var t={technique:{}},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"extra":G(n,t)}}return t}function G(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique":j(n,t)}}}function j(e,t){for(var i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":t.technique[n.nodeName]=parseFloat(n.textContent);break;case"wrapU":case"wrapV":"TRUE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=1:"FALSE"===n.textContent.toUpperCase()?t.technique[n.nodeName]=0:t.technique[n.nodeName]=parseInt(n.textContent)}}}function V(e){return e}function H(e){var t,i,r=(t=e.url,p(Ue.effects[t],V)),n=r.profile.technique;switch(n.type){case"phong":case"blinn":i=new Ea.MeshPhongMaterial;break;case"lambert":i=new Ea.MeshLambertMaterial;break;default:i=new Ea.MeshBasicMaterial}function o(e){var t=r.profile.samplers[e.id];if(void 0!==t){var i=r.profile.surfaces[t.source],n=Ne.load(function(e){return p(Ue.images[e],N)}(i.init_from)),o=e.extra;if(void 0!==o&&void 0!==o.technique&&!1===a(o.technique)){var s=o.technique;n.wrapS=s.wrapU?Ea.RepeatWrapping:Ea.ClampToEdgeWrapping,n.wrapT=s.wrapV?Ea.RepeatWrapping:Ea.ClampToEdgeWrapping,n.offset.set(s.offsetU||0,s.offsetV||0),n.repeat.set(s.repeatU||1,s.repeatV||1)}else n.wrapS=Ea.RepeatWrapping,n.wrapT=Ea.RepeatWrapping;return n}return console.error("THREE.ColladaLoader: Undefined sampler",e.id),null}i.name=e.name;var s=n.parameters;for(var c in s){var h=s[c];switch(c){case"diffuse":h.color&&i.color.fromArray(h.color),h.texture&&(i.map=o(h.texture));break;case"specular":h.color&&i.specular&&i.specular.fromArray(h.color),h.texture&&(i.specularMap=o(h.texture));break;case"shininess":h.float&&i.shininess&&(i.shininess=h.float);break;case"emission":h.color&&i.emissive&&i.emissive.fromArray(h.color);break;case"transparent":i.transparent=!0;break;case"transparency":void 0!==h.float&&(i.opacity=h.float),i.transparent=!0}}return i}function W(e){return p(Ue.materials[e],H)}function X(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"technique_common":return q(i)}}return{}}function q(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"perspective":case"orthographic":t.technique=r.nodeName,t.parameters=Y(r)}}return t}function Y(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":t[r.nodeName]=parseFloat(r.textContent)}}return t}function Z(e){var t;switch(e.optics.technique){case"perspective":t=new Ea.PerspectiveCamera(e.optics.parameters.yfov,e.optics.parameters.aspect_ratio,e.optics.parameters.znear,e.optics.parameters.zfar);break;case"orthographic":var i=e.optics.parameters.ymag,r=e.optics.parameters.xmag,n=e.optics.parameters.aspect_ratio;r=void 0===r?i*n:r,i=void 0===i?r/n:i,r*=.5,i*=.5,t=new Ea.OrthographicCamera(-r,r,i,-i,e.optics.parameters.znear,e.optics.parameters.zfar);break;default:t=new Ea.PerspectiveCamera}return t.name=e.name,t}function J(e){var t=Ue.cameras[e];return void 0!==t?p(t,Z):null}function Q(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"directional":case"point":case"spot":case"ambient":t.technique=n.nodeName,t.parameters=K(n)}}return t}function K(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"color":var s=n(o.textContent);t.color=(new Ea.Color).fromArray(s);break;case"falloff_angle":t.falloffAngle=parseFloat(o.textContent);break;case"quadratic_attenuation":var a=parseFloat(o.textContent);t.distance=a?Math.sqrt(1/a):0}}return t}function $(e){for(var t={array:[],stride:3},o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1===s.nodeType)switch(s.nodeName){case"float_array":t.array=n(s.textContent);break;case"Name_array":t.array=r(s.textContent);break;case"technique_common":var a=i(s,"accessor")[0];void 0!==a&&(t.stride=parseInt(a.getAttribute("stride")))}}return t}function ee(e){for(var t={},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];1===r.nodeType&&(t[r.getAttribute("semantic")]=s(r.getAttribute("source")))}return t}function te(e){for(var t={type:e.nodeName,material:e.getAttribute("material"),count:parseInt(e.getAttribute("count")),inputs:{},stride:0},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"input":var a=s(n.getAttribute("source")),c=n.getAttribute("semantic"),h=parseInt(n.getAttribute("offset"));t.inputs[c]={id:a,offset:h},t.stride=Math.max(t.stride,h+1);break;case"vcount":t.vcount=o(n.textContent);break;case"p":t.p=o(n.textContent)}}return t}function ie(e){var t={},i=e.sources,r=e.vertices,n=e.primitives;if(0===n.length)return{};var o=function(e){for(var t={},i=0;i<e.length;i++){var r=e[i];void 0===t[r.type]&&(t[r.type]=[]),t[r.type].push(r)}return t}(n);for(var s in o)t[s]=re(o[s],i,r);return t}function re(e,t,i){for(var r={},n={array:[],stride:0},o={array:[],stride:0},s={array:[],stride:0},a={array:[],stride:0},c=[],h=4,l=[],u=4,p=new Ea.BufferGeometry,d=[],f=0,m=0,v=0;v<e.length;v++){var g=e[v],y=g.inputs,b=1;for(var x in g.vcount&&4===g.vcount[0]&&(b=2),m="lines"===g.type||"linestrips"===g.type?2*g.count:3*g.count*b,p.addGroup(f,m,v),f+=m,g.material&&d.push(g.material),y){var w=y[x];switch(x){case"VERTEX":for(var _ in i){var M=i[_];switch(_){case"POSITION":ne(g,t[M],w.offset,n.array),n.stride=t[M].stride,t.skinWeights&&t.skinIndices&&(ne(g,t.skinIndices,w.offset,c),ne(g,t.skinWeights,w.offset,l));break;case"NORMAL":ne(g,t[M],w.offset,o.array),o.stride=t[M].stride;break;case"COLOR":ne(g,t[M],w.offset,a.array),a.stride=t[M].stride;break;case"TEXCOORD":ne(g,t[M],w.offset,s.array),s.stride=t[M].stride;break;default:console.warn('THREE.ColladaLoader: Semantic "%s" not handled in geometry build process.',_)}}break;case"NORMAL":ne(g,t[w.id],w.offset,o.array),o.stride=t[w.id].stride;break;case"COLOR":ne(g,t[w.id],w.offset,a.array),a.stride=t[w.id].stride;break;case"TEXCOORD":ne(g,t[w.id],w.offset,s.array),s.stride=t[w.id].stride}}}return n.array.length>0&&p.addAttribute("position",new Ea.Float32BufferAttribute(n.array,n.stride)),o.array.length>0&&p.addAttribute("normal",new Ea.Float32BufferAttribute(o.array,o.stride)),a.array.length>0&&p.addAttribute("color",new Ea.Float32BufferAttribute(a.array,a.stride)),s.array.length>0&&p.addAttribute("uv",new Ea.Float32BufferAttribute(s.array,s.stride)),c.length>0&&p.addAttribute("skinIndex",new Ea.Float32BufferAttribute(c,h)),l.length>0&&p.addAttribute("skinWeight",new Ea.Float32BufferAttribute(l,u)),r.data=p,r.type=e[0].type,r.materialKeys=d,r}function ne(e,t,i,r){var n=e.p,o=e.stride,s=e.vcount;function a(e){for(var t=n[e+i]*l,o=t+l;t<o;t++)r.push(h[t])}var c=0,h=t.array,l=t.stride;if(void 0!==e.vcount){for(var u=0,p=0,d=s.length;p<d;p++){var f=s[p];if(4===f){var m=u+1*o,v=u+2*o,g=u+3*o;a(u+0*o),a(m),a(g),a(m),a(v),a(g)}else if(3===f){m=u+1*o,v=u+2*o;a(u+0*o),a(m),a(v)}else c=Math.max(c,f);u+=o*f}c>0&&console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}else for(p=0,d=n.length;p<d;p+=o)a(p)}function oe(e){return p(Ue.geometries[e],ie)}function se(e){return void 0!==e.build?e.build:e}function ae(e,t){for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"joint":t.joints[r.getAttribute("sid")]=ce(r);break;case"link":t.links.push(le(r))}}}function ce(e){for(var t,i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"prismatic":case"revolute":t=he(r)}}return t}function he(e,t){t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",axis:new Ea.Vector3,limits:{min:0,max:0},type:e.nodeName,static:!1,zeroPosition:0,middlePosition:0};for(var i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var o=n(r.textContent);t.axis.fromArray(o);break;case"limits":var s=r.getElementsByTagName("max")[0],a=r.getElementsByTagName("min")[0];t.limits.max=parseFloat(s.textContent),t.limits.min=parseFloat(a.textContent)}}return t.limits.min>=t.limits.max&&(t.static=!0),t.middlePosition=(t.limits.min+t.limits.max)/2,t}function le(e){for(var t={sid:e.getAttribute("sid"),name:e.getAttribute("name")||"",attachments:[],transforms:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"attachment_full":t.attachments.push(ue(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(pe(r))}}return t}function ue(e){for(var t={joint:e.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"link":t.links.push(le(r));break;case"matrix":case"translate":case"rotate":t.transforms.push(pe(r))}}return t}function pe(e){var t={type:e.nodeName},i=n(e.textContent);switch(t.type){case"matrix":t.obj=new Ea.Matrix4,t.obj.fromArray(i).transpose();break;case"translate":t.obj=new Ea.Vector3,t.obj.fromArray(i);break;case"rotate":t.obj=new Ea.Vector3,t.obj.fromArray(i),t.angle=Ea.Math.degToRad(i[3])}return t}function de(e){for(var t={target:e.getAttribute("target").split("/").pop()},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"axis":var n=r.getElementsByTagName("param")[0];t.axis=n.textContent;var o=t.axis.split("inst_").pop().split("axis")[0];t.jointIndex=o.substr(0,o.length-1)}}return t}function fe(e){return void 0!==e.build?e.build:e}function me(e){for(var t=[],i=Re.querySelector('[id="'+e.id+'"]'),r=0;r<i.childNodes.length;r++){var o=i.childNodes[r];if(1===o.nodeType)switch(o.nodeName){case"matrix":var s=n(o.textContent),a=(new Ea.Matrix4).fromArray(s).transpose();t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:a});break;case"translate":case"scale":s=n(o.textContent);var c=(new Ea.Vector3).fromArray(s);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c});break;case"rotate":s=n(o.textContent),c=(new Ea.Vector3).fromArray(s);var h=Ea.Math.degToRad(s[3]);t.push({sid:o.getAttribute("sid"),type:o.nodeName,obj:c,angle:h})}}return t}var ve=new Ea.Matrix4,ge=new Ea.Vector3;function ye(e){for(var t={name:e.getAttribute("name")||"",type:e.getAttribute("type"),id:e.getAttribute("id"),sid:e.getAttribute("sid"),matrix:new Ea.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"node":t.nodes.push(r.getAttribute("id")),ye(r);break;case"instance_camera":t.instanceCameras.push(s(r.getAttribute("url")));break;case"instance_controller":t.instanceControllers.push(be(r));break;case"instance_light":t.instanceLights.push(s(r.getAttribute("url")));break;case"instance_geometry":t.instanceGeometries.push(be(r));break;case"instance_node":t.instanceNodes.push(s(r.getAttribute("url")));break;case"matrix":var o=n(r.textContent);t.matrix.multiply(ve.fromArray(o).transpose()),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"translate":o=n(r.textContent);ge.fromArray(o),t.matrix.multiply(ve.makeTranslation(ge.x,ge.y,ge.z)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"rotate":o=n(r.textContent);var a=Ea.Math.degToRad(o[3]);t.matrix.multiply(ve.makeRotationAxis(ge.fromArray(o),a)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"scale":o=n(r.textContent);t.matrix.scale(ge.fromArray(o)),t.transforms[r.getAttribute("sid")]=r.nodeName;break;case"extra":break;default:console.log(r)}}return Ue.nodes[t.id]=t,t}function be(e){for(var t={id:s(e.getAttribute("url")),materials:{},skeletons:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];switch(r.nodeName){case"bind_material":for(var n=r.getElementsByTagName("instance_material"),o=0;o<n.length;o++){var a=n[o],c=a.getAttribute("symbol"),h=a.getAttribute("target");t.materials[c]=s(h)}break;case"skeleton":t.skeletons.push(s(r.textContent))}}return t}function xe(e,t){var i,r,n,o=[],s=[];for(i=0;i<e.length;i++){we(Te(e[i]),t,o)}for(i=0;i<t.length;i++)for(r=0;r<o.length;r++)if((n=o[r]).bone.name===t[i].name){s[i]=n,n.processed=!0;break}for(i=0;i<o.length;i++)!1===(n=o[i]).processed&&(s.push(n),n.processed=!0);var a=[],c=[];for(i=0;i<s.length;i++)n=s[i],a.push(n.bone),c.push(n.boneInverse);return new Ea.Skeleton(a,c)}function we(e,t,i){e.traverse((function(e){if(!0===e.isBone){for(var r,n=0;n<t.length;n++){var o=t[n];if(o.name===e.name){r=o.boneInverse;break}}void 0===r&&(r=new Ea.Matrix4),i.push({bone:e,boneInverse:r,processed:!1})}}))}function _e(e){for(var t,i=[],r=e.matrix,n=e.nodes,o=e.type,s=e.instanceCameras,a=e.instanceControllers,c=e.instanceLights,h=e.instanceGeometries,l=e.instanceNodes,u=0,d=n.length;u<d;u++)i.push(Te(n[u]));for(u=0,d=s.length;u<d;u++){null!==(w=J(s[u]))&&i.push(w.clone())}for(u=0,d=a.length;u<d;u++)for(var f=a[u],m=(t=f.id,p(Ue.controllers[t],P)),v=Ee(oe(m.id),f.materials),g=xe(f.skeletons,m.skin.joints),y=0,b=v.length;y<b;y++){var x;(x=v[y]).isSkinnedMesh&&(x.bind(g,m.skin.bindMatrix),x.normalizeSkinWeights()),i.push(x)}for(u=0,d=c.length;u<d;u++){var w;null!==(w=J(s[u]))&&i.push(w.clone())}for(u=0,d=h.length;u<d;u++)for(y=0,b=(v=Ee(oe((f=h[u]).id),f.materials)).length;y<b;y++)i.push(v[y]);for(u=0,d=l.length;u<d;u++)i.push(Te(l[u]).clone());if(0===n.length&&1===i.length)x=i[0];else{x="JOINT"===o?new Ea.Bone:new Ea.Object3D;for(u=0;u<i.length;u++)x.add(i[u])}return x.name="JOINT"===o?e.sid:e.name,x.matrix.copy(r),x.matrix.decompose(x.position,x.quaternion,x.scale),x}function Me(e,t){for(var i=[],r=0,n=e.length;r<n;r++){var o=t[e[r]];i.push(W(o))}return i}function Ee(e,t){var i=[];for(var r in e){var n=e[r],o=Me(n.materialKeys,t);0===o.length&&("lines"===r||"linestrips"===r?o.push(new Ea.LineBasicMaterial):o.push(new Ea.MeshPhongMaterial));var s=void 0!==n.data.attributes.skinIndex;if(s)for(var a=0,c=o.length;a<c;a++)o[a].skinning=!0;var h,l=1===o.length?o[0]:o;switch(r){case"lines":h=new Ea.LineSegments(n.data,l);break;case"linestrips":h=new Ea.Line(n.data,l);break;case"triangles":case"polylist":h=s?new Ea.SkinnedMesh(n.data,l):new Ea.Mesh(n.data,l)}i.push(h)}return i}function Te(e){return p(Ue.nodes[e],_e)}function Se(e){var t=new Ea.Object3D;t.name=e.name;for(var i=e.children,r=0;r<i.length;r++){var n=i[r];null===n.id?t.add(_e(n)):t.add(Te(n.id))}return t}function Ae(e){return p(Ue.visualScenes[e],Se)}if(console.time("THREE.ColladaLoader"),0===e.length)return{scene:new Ea.Scene};console.time("THREE.ColladaLoader: DOMParser");var Le=(new DOMParser).parseFromString(e,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var Re=i(Le,"COLLADA")[0],Ce=Re.getAttribute("version");console.log("THREE.ColladaLoader: File version",Ce);var Pe=function(e){return{unit:c(i(e,"unit")[0]),upAxis:h(i(e,"up_axis")[0])}}(i(Re,"asset")[0]),Ne=new Ea.TextureLoader(this.manager);Ne.setPath(t).setCrossOrigin(this.crossOrigin);var Oe=[],Ie={},De=0,Ue={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse"),l(Re,"library_animations","animation",(function(e){for(var t={sources:{},samplers:{},channels:{}},i=0,r=e.childNodes.length;i<r;i++){var n,o=e.childNodes[i];if(1===o.nodeType)switch(o.nodeName){case"source":n=o.getAttribute("id"),t.sources[n]=$(o);break;case"sampler":n=o.getAttribute("id"),t.samplers[n]=d(o);break;case"channel":n=o.getAttribute("target"),t.channels[n]=f(o);break;default:console.log(o)}}Ue.animations[e.getAttribute("id")]=t})),l(Re,"library_animation_clips","animation_clip",(function(e){for(var t={name:e.getAttribute("id")||"default",start:parseFloat(e.getAttribute("start")||0),end:parseFloat(e.getAttribute("end")||0),animations:[]},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_animation":t.animations.push(s(n.getAttribute("url")))}}Ue.clips[e.getAttribute("id")]=t})),l(Re,"library_controllers","controller",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"skin":t.id=s(n.getAttribute("source")),t.skin=L(n);break;case"morph":t.id=s(n.getAttribute("source")),console.warn("THREE.ColladaLoader: Morph target animation not supported yet.")}}Ue.controllers[e.getAttribute("id")]=t})),l(Re,"library_images","image",(function(e){var t={init_from:i(e,"init_from")[0].textContent};Ue.images[e.getAttribute("id")]=t})),l(Re,"library_effects","effect",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"profile_COMMON":t.profile=O(n)}}Ue.effects[e.getAttribute("id")]=t})),l(Re,"library_materials","material",(function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"instance_effect":t.url=s(n.getAttribute("url"))}}Ue.materials[e.getAttribute("id")]=t})),l(Re,"library_cameras","camera",(function(e){for(var t={name:e.getAttribute("name")},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"optics":t.optics=X(n)}}Ue.cameras[e.getAttribute("id")]=t})),l(Re,"library_lights","light",(function(e){for(var t={},i=0,r=e.childNodes.length;i<r;i++){var n=e.childNodes[i];if(1===n.nodeType)switch(n.nodeName){case"technique_common":t=Q(n)}}Ue.lights[e.getAttribute("id")]=t})),l(Re,"library_geometries","geometry",(function(e){for(var t={name:e.getAttribute("name"),sources:{},vertices:{},primitives:[]},r=i(e,"mesh")[0],n=0;n<r.childNodes.length;n++){var o=r.childNodes[n];if(1===o.nodeType){var s=o.getAttribute("id");switch(o.nodeName){case"source":t.sources[s]=$(o);break;case"vertices":t.vertices=ee(o);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",o.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":t.primitives.push(te(o));break;default:console.log(o)}}}Ue.geometries[e.getAttribute("id")]=t})),l(Re,"library_nodes","node",ye),l(Re,"library_visual_scenes","visual_scene",(function(e){var t={name:e.getAttribute("name"),children:[]};!function(e){for(var t=e.getElementsByTagName("node"),i=0;i<t.length;i++){var r=t[i];!1===r.hasAttribute("id")&&r.setAttribute("id","three_default_"+De++)}}(e);for(var r=i(e,"node"),n=0;n<r.length;n++)t.children.push(ye(r[n]));Ue.visualScenes[e.getAttribute("id")]=t})),l(Re,"library_kinematics_models","kinematics_model",(function(e){for(var t={name:e.getAttribute("name")||"",joints:{},links:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"technique_common":ae(r,t)}}Ue.kinematicsModels[e.getAttribute("id")]=t})),l(Re,"scene","instance_kinematics_scene",(function(e){for(var t={bindJointAxis:[]},i=0;i<e.childNodes.length;i++){var r=e.childNodes[i];if(1===r.nodeType)switch(r.nodeName){case"bind_joint_axis":t.bindJointAxis.push(de(r))}}Ue.kinematicsScenes[s(e.getAttribute("url"))]=t})),console.timeEnd("THREE.ColladaLoader: Parse"),console.time("THREE.ColladaLoader: Build"),u(Ue.animations,m),u(Ue.clips,S),u(Ue.controllers,P),u(Ue.images,N),u(Ue.effects,V),u(Ue.materials,H),u(Ue.cameras,Z),u(Ue.lights,(function(e){var t;switch(e.technique){case"directional":t=new Ea.DirectionalLight;break;case"point":t=new Ea.PointLight;break;case"spot":t=new Ea.SpotLight;break;case"ambient":t=new Ea.AmbientLight}return e.parameters.color&&t.color.copy(e.parameters.color),e.parameters.distance&&(t.distance=e.parameters.distance),t})),u(Ue.geometries,ie),u(Ue.visualScenes,Se),console.timeEnd("THREE.ColladaLoader: Build"),function(){var e=Ue.clips;if(!0===a(e)){if(!1===a(Ue.animations)){var t=[];for(var i in Ue.animations)for(var r=v(i),n=0,o=r.length;n<o;n++)t.push(r[n]);Oe.push(new Ea.AnimationClip("default",-1,t))}}else for(var i in e)Oe.push(A(i))}(),function(){var e=Object.keys(Ue.kinematicsModels)[0],t=Object.keys(Ue.kinematicsScenes)[0],i=Object.keys(Ue.visualScenes)[0];if(void 0!==e&&void 0!==t){for(var r,n=(r=e,p(Ue.kinematicsModels[r],se)),o=function(e){return p(Ue.kinematicsScenes[e],fe)}(t),s=Ae(i),a=o.bindJointAxis,c={},h=0,l=a.length;h<l;h++){var u=a[h],d=Re.querySelector('[sid="'+u.target+'"]');if(d){var f=d.parentElement;v(u.jointIndex,f)}}var m=new Ea.Matrix4;Ie={joints:n&&n.joints,getJointValue:function(e){var t=c[e];if(t)return t.position;console.warn("THREE.ColladaLoader: Joint "+e+" doesn't exist.")},setJointValue:function(e,t){var i=c[e];if(i){var r=i.joint;if(t>r.limits.max||t<r.limits.min)console.warn("THREE.ColladaLoader: Joint "+e+" value "+t+" outside of limits (min: "+r.limits.min+", max: "+r.limits.max+").");else if(r.static)console.warn("THREE.ColladaLoader: Joint "+e+" is static.");else{var n=i.object,o=r.axis,s=i.transforms;ve.identity();for(var a=0;a<s.length;a++){var h=s[a];if(h.sid&&-1!==h.sid.indexOf(e))switch(r.type){case"revolute":ve.multiply(m.makeRotationAxis(o,Ea.Math.degToRad(t)));break;case"prismatic":ve.multiply(m.makeTranslation(o.x*t,o.y*t,o.z*t));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+r.type)}else switch(h.type){case"matrix":ve.multiply(h.obj);break;case"translate":ve.multiply(m.makeTranslation(h.obj.x,h.obj.y,h.obj.z));break;case"scale":ve.scale(h.obj);break;case"rotate":ve.multiply(m.makeRotationAxis(h.obj,h.angle))}}n.matrix.copy(ve),n.matrix.decompose(n.position,n.quaternion,n.scale),c[e].position=t}}else console.log("THREE.ColladaLoader: "+e+" does not exist.")}}}function v(e,t){var i=t.getAttribute("name"),r=n.joints[e];s.traverse((function(n){n.name===i&&(c[e]={object:n,transforms:me(t),joint:r,position:r.zeroPosition})}))}}();var Fe=function(e){return Ae(s(i(e,"instance_visual_scene")[0].getAttribute("url")))}(i(Re,"scene")[0]);return Fe.scale.multiplyScalar(Pe.unit),console.timeEnd("THREE.ColladaLoader"),{animations:Oe,kinematics:Ie,library:Ue,scene:Fe}}};var ka={onError:function(e){console.error(e)},loaders:{dae:function(e,t,i){const r=i.material,n=new Ea.ColladaLoader(i.loader);return n.log=function(t){e.warnings&&console.warn(t)},n.load(t,(function(t){null!==r&&t.scene.traverse((function(e){e instanceof Ea.Mesh&&void 0===e.material&&(e.material=r)})),e.add(t.scene)}),null,ka.onError),n},obj:function(e,t,i){i.material;const r=new Ea.OBJLoader(i.loader);return r.log=function(t){e.warnings&&console.warn(t)},r.load(t,(function(n){const o=Ea.LoaderUtils.extractUrlBase(t);if(n.materialLibraries.length){const s=n.materialLibraries[0];new Ea.MTLLoader(i.loader).setPath(o).load(s,(function(i){i.preload(),function(i,r){i.setMaterials(r).load(t,(function(t){e.add(t)}),null,ka.onError)}(r,i)}),null,ka.onError)}else e.add(n)}),null,ka.onError),r},stl:function(e,t,i){const r=i.material,n=new Ea.STLLoader(i.loader);return n.load(t,(function(t){var i;t.computeFaceNormals(),i=null!==r?new Ea.Mesh(t,r):new Ea.Mesh(t,new Ea.MeshBasicMaterial({color:10066329})),e.add(i)}),null,ka.onError),n}}};class Ba extends Ea.Object3D{constructor(e){super();var t=(e=e||{}).path||"/",i=e.resource;e.material,this.warnings=e.warnings,"/"!==t.substr(t.length-1)&&(t+="/");var r=t+i,n=r.substr(-3).toLowerCase(),o=ka.loaders[n];o?o(this,r,e):console.warn("Unsupported loader for file type: '"+n+"'")}}class za extends Ea.Object3D{constructor(e){var t=(e=e||{}).material||new Ea.MeshBasicMaterial,i=e.vertices,r=e.colors;super(),t.side=Ea.DoubleSide;var n,o,s=new Ea.Geometry;for(n=0;n<i.length;n++)s.vertices.push(new Ea.Vector3(i[n].x,i[n].y,i[n].z));if(r.length===i.length){for(n=0;n<i.length;n+=3){var a=new Ea.Face3(n,n+1,n+2);for(o=3*n;o<3*n+3;n++){var c=new Ea.Color;c.setRGB(r[n].r,r[n].g,r[n].b),a.vertexColors.push(c)}s.faces.push(a)}t.vertexColors=Ea.VertexColors}else if(r.length===i.length/3){for(n=0;n<i.length;n+=3){var h=new Ea.Face3(n,n+1,n+2);h.color.setRGB(r[n/3].r,r[n/3].g,r[n/3].b),s.faces.push(h)}t.vertexColors=Ea.FaceColors}else for(n=0;n<i.length;n+=3){var l=new Ea.Face3(n,n+1,n+2);s.faces.push(l)}s.computeBoundingBox(),s.computeBoundingSphere(),s.computeFaceNormals(),this.add(new Ea.Mesh(s,t))}setColor(e){this.mesh.material.color.setHex(e)}}class Ga extends Ea.Object3D{constructor(e){super();var t=(e=e||{}).path||"/",i=e.message;"/"!==t.substr(t.length-1)&&(t+="/"),i.scale?this.msgScale=[i.scale.x,i.scale.y,i.scale.z]:this.msgScale=[1,1,1],this.msgColor=i.color,this.msgMesh=void 0,this.setPose(i.pose);var r=Ta(this.msgColor.r,this.msgColor.g,this.msgColor.b,this.msgColor.a);switch(i.type){case 0:var n,o=i.scale.x,s=.23*o,a=i.scale.y,c=.5*a,h=null;if(2===i.points.length){h=new Ea.Vector3(i.points[0].x,i.points[0].y,i.points[0].z);var l=new Ea.Vector3(i.points[1].x,i.points[1].y,i.points[1].z);o=(n=h.clone().negate().add(l)).length(),a=i.scale.y,c=i.scale.x,0!==i.scale.z&&(s=i.scale.z)}this.add(new Oa({direction:n,origin:h,length:o,headLength:s,shaftDiameter:c,headDiameter:a,material:r}));break;case 1:var u=new Ea.BoxGeometry(i.scale.x,i.scale.y,i.scale.z);this.add(new Ea.Mesh(u,r));break;case 2:var p=new Ea.SphereGeometry(.5),d=new Ea.Mesh(p,r);d.scale.x=i.scale.x,d.scale.y=i.scale.y,d.scale.z=i.scale.z,this.add(d);break;case 3:var f=new Ea.CylinderGeometry(.5,.5,1,16,1,!1),m=new Ea.Mesh(f,r);m.quaternion.setFromAxisAngle(new Ea.Vector3(1,0,0),.5*Math.PI),m.scale.set(i.scale.x,i.scale.z,i.scale.y),this.add(m);break;case 4:var v,g=new Ea.Geometry,y=new Ea.LineBasicMaterial({size:i.scale.x});for(v=0;v<i.points.length;v++){var b=new Ea.Vector3;b.x=i.points[v].x,b.y=i.points[v].y,b.z=i.points[v].z,g.vertices.push(b)}if(i.colors.length===i.points.length)for(y.vertexColors=!0,v=0;v<i.points.length;v++){var x=new Ea.Color;x.setRGB(i.colors[v].r,i.colors[v].g,i.colors[v].b),g.colors.push(x)}else y.color.setRGB(i.color.r,i.color.g,i.color.b);this.add(new Ea.Line(g,y));break;case 5:var w,_=new Ea.Geometry,M=new Ea.LineBasicMaterial({size:i.scale.x});for(w=0;w<i.points.length;w++){var E=new Ea.Vector3;E.x=i.points[w].x,E.y=i.points[w].y,E.z=i.points[w].z,_.vertices.push(E)}if(i.colors.length===i.points.length)for(M.vertexColors=!0,w=0;w<i.points.length;w++){var T=new Ea.Color;T.setRGB(i.colors[w].r,i.colors[w].g,i.colors[w].b),_.colors.push(T)}else M.color.setRGB(i.color.r,i.color.g,i.color.b);this.add(new Ea.Line(_,M,Ea.LinePieces));break;case 6:var S,A,L,R,C=new Ea.Object3D,P=i.points.length,N=P===i.colors.length,O=Math.ceil(P/1250);for(S=0;S<P;S+=O)A=new Ea.BoxGeometry(i.scale.x,i.scale.y,i.scale.z),L=N?Ta(i.colors[S].r,i.colors[S].g,i.colors[S].b,i.colors[S].a):r,(R=new Ea.Mesh(A,L)).position.x=i.points[S].x,R.position.y=i.points[S].y,R.position.z=i.points[S].z,C.add(R);this.add(C);break;case 7:var I,D,U,F,k=new Ea.Object3D,B=i.points.length,z=B===i.colors.length,G=Math.ceil(B/1250);for(I=0;I<B;I+=G)D=new Ea.SphereGeometry(.5,8,8),U=z?Ta(i.colors[I].r,i.colors[I].g,i.colors[I].b,i.colors[I].a):r,(F=new Ea.Mesh(D,U)).scale.x=i.scale.x,F.scale.y=i.scale.y,F.scale.z=i.scale.z,F.position.x=i.points[I].x,F.position.y=i.points[I].y,F.position.z=i.points[I].z,k.add(F);this.add(k);break;case 8:var j,V=new Ea.Geometry,H=new Ea.ParticleBasicMaterial({size:i.scale.x});for(j=0;j<i.points.length;j++){var W=new Ea.Vector3;W.x=i.points[j].x,W.y=i.points[j].y,W.z=i.points[j].z,V.vertices.push(W)}if(i.colors.length===i.points.length)for(H.vertexColors=!0,j=0;j<i.points.length;j++){var X=new Ea.Color;X.setRGB(i.colors[j].r,i.colors[j].g,i.colors[j].b),V.colors.push(X)}else H.color.setRGB(i.color.r,i.color.g,i.color.b);this.add(new Ea.ParticleSystem(V,H));break;case 9:if(i.text.length>0){var q=this.msgColor,Y=document.createElement("canvas"),Z=Y.getContext("2d"),J="normal 100px sans-serif";Z.font=J;var Q=Z.measureText(i.text).width;Y.width=Q,Y.height=150,Z.font=J,Z.fillStyle="rgba("+Math.round(255*q.r)+", "+Math.round(255*q.g)+", "+Math.round(255*q.b)+", "+q.a+")",Z.textAlign="left",Z.textBaseline="middle",Z.fillText(i.text,0,Y.height/2);var K=new Ea.Texture(Y);K.needsUpdate=!0;var $=new Ea.SpriteMaterial({map:K,useScreenCoordinates:!1}),ee=new Ea.Sprite($),te=i.scale.x;ee.scale.set(Q/Y.height*te,te,1),this.add(ee)}break;case 10:var ie=null;0===i.color.r&&0===i.color.g&&0===i.color.b&&0===i.color.a||(ie=r),this.msgMesh=i.mesh_resource.substr(10);var re=new Ba({path:t,resource:this.msgMesh,material:ie});this.add(re);break;case 11:var ne=new za({material:r,vertices:i.points,colors:i.colors});ne.scale.set(i.scale.x,i.scale.y,i.scale.z),this.add(ne);break;default:console.error("Currently unsupported marker type: "+i.type)}}setPose(e){this.position.x=e.position.x,this.position.y=e.position.y,this.position.z=e.position.z,this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.quaternion.normalize(),this.updateMatrixWorld()}update(e){if(this.setPose(e.pose),e.color.r!==this.msgColor.r||e.color.g!==this.msgColor.g||e.color.b!==this.msgColor.b||e.color.a!==this.msgColor.a){var t=Ta(e.color.r,e.color.g,e.color.b,e.color.a);switch(e.type){case 4:case 5:case 8:break;case 0:case 1:case 2:case 3:case 11:case 9:this.traverse((function(e){e instanceof Ea.Mesh&&(e.material=t)}));break;case 10:var i=null;0===e.color.r&&0===e.color.g&&0===e.color.b&&0===e.color.a||(i=this.colorMaterial),this.traverse((function(e){e instanceof Ea.Mesh&&(e.material=i)}));break;case 6:case 7:default:return!1}this.msgColor=e.color}var r=Math.abs(this.msgScale[0]-e.scale.x)>1e-6||Math.abs(this.msgScale[1]-e.scale.y)>1e-6||Math.abs(this.msgScale[2]-e.scale.z)>1e-6;switch(this.msgScale=[e.scale.x,e.scale.y,e.scale.z],e.type){case 1:case 2:case 3:if(r)return!1;break;case 9:if(r||this.text!==e.text)return!1;break;case 10:if(e.mesh_resource.substr(10)!==this.msgMesh)return!1;if(r)return!1;break;case 0:case 4:case 5:case 6:case 7:case 8:case 11:return!1}return!0}dispose(){this.children.forEach((function(e){e instanceof Ba?e.children.forEach((function(t){void 0!==t.material&&t.material.dispose(),t.children.forEach((function(e){void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose(),t.remove(e)})),e.remove(t)})):(void 0!==e.geometry&&e.geometry.dispose(),void 0!==e.material&&e.material.dispose()),e.parent.remove(e)}))}}class ja extends Ea.Object3D{constructor(e){super();var t=this;e=e||{},this.parent=e.parent;var i=e.handle,r=e.message;this.message=r,this.name=r.name,this.camera=e.camera,this.path=e.path||"/",this.loader=e.loader,this.dragging=!1,this.startMousePos=new Ea.Vector2,this.isShift=!1;var n=new Ea.Quaternion(r.orientation.x,r.orientation.y,r.orientation.z,r.orientation.w);n.normalize();var o=new Ea.Vector3(1,0,0);switch(o.applyQuaternion(n),this.currentControlOri=new Ea.Quaternion,r.interaction_mode){case 9:case 7:this.addEventListener("mousemove",this.parent.move3d.bind(this.parent,this,o));break;case 3:this.addEventListener("mousemove",this.parent.moveAxis.bind(this.parent,this,o)),this.addEventListener("touchmove",this.parent.moveAxis.bind(this.parent,this,o));break;case 5:this.addEventListener("mousemove",this.parent.rotateAxis.bind(this.parent,this,n));break;case 4:this.addEventListener("mousemove",this.parent.movePlane.bind(this.parent,this,o));break;case 2:this.addEventListener("click",this.parent.buttonClick.bind(this.parent,this))}function s(e){e.stopPropagation()}0!==r.interaction_mode&&(this.addEventListener("mousedown",this.parent.startDrag.bind(this.parent,this)),this.addEventListener("mouseup",this.parent.stopDrag.bind(this.parent,this)),this.addEventListener("contextmenu",this.parent.showMenu.bind(this.parent,this)),this.addEventListener("mouseup",(function(e){0===t.startMousePos.distanceToSquared(e.mousePos)&&(e.type="contextmenu",t.dispatchEvent(e))})),this.addEventListener("mouseover",s),this.addEventListener("mouseout",s),this.addEventListener("click",s),this.addEventListener("mousedown",(function(e){t.startMousePos=e.mousePos})),this.addEventListener("touchstart",(function(e){1===e.domEvent.touches.length&&(e.type="mousedown",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchmove",(function(e){1===e.domEvent.touches.length&&(e.type="mousemove",e.domEvent.button=0,t.dispatchEvent(e))})),this.addEventListener("touchend",(function(e){0===e.domEvent.touches.length&&(e.domEvent.button=0,e.type="mouseup",t.dispatchEvent(e),e.type="click",t.dispatchEvent(e))})),window.addEventListener("keydown",(function(e){16===e.keyCode&&(t.isShift=!0)})),window.addEventListener("keyup",(function(e){16===e.keyCode&&(t.isShift=!1)})));var a=new Ea.Quaternion,c=this.parent.position.clone().multiplyScalar(-1);switch(r.orientation_mode){case 0:a=this.parent.quaternion.clone().inverse();break;case 1:case 2:break;default:console.error("Unkown orientation mode: "+r.orientation_mode)}var h=new Na.TFClient({ros:i.tfClient.ros,fixedFrame:i.message.header.frame_id,serverName:i.tfClient.serverName});r.markers.forEach((function(e){var i=function(i){var r=new Ga({message:e,path:t.path,loader:t.loader});if(null!==i){var n=new Na.Pose({position:r.position,orientation:r.quaternion});n.applyTransform(new Na.Transform(i));var o=new Ga({message:e,path:t.path,loader:t.loader});o.position.add(c),o.position.applyQuaternion(a),o.quaternion.multiplyQuaternions(a,o.quaternion);var s=new Ea.Vector3(o.position.x,o.position.y,o.position.z),l=new Na.Transform({translation:s,orientation:o.quaternion});n.applyTransform(l),r.setPose(n),r.updateMatrixWorld(),h.unsubscribe(e.header.frame_id)}t.add(r)};""!==e.header.frame_id?h.subscribe(e.header.frame_id,i):i(null)}))}updateMatrixWorld(e){var t=this,i=this.message;switch(i.orientation_mode){case 0:super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion),t.currentControlOri.normalize();break;case 1:t.quaternion.copy(t.parent.quaternion.clone().inverse()),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0,super.updateMatrixWorld(e),t.currentControlOri.copy(t.quaternion);break;case 2:t.camera.updateMatrixWorld();var r=(new Ea.Matrix4).extractRotation(t.camera.matrixWorld),n=new Ea.Matrix4,o=.5*Math.PI,s=new Ea.Euler(-o,0,o);n.makeRotationFromEuler(s);var a=new Ea.Matrix4;a.getInverse(t.parent.matrixWorld),r.multiplyMatrices(r,n),r.multiplyMatrices(a,r),t.currentControlOri.setFromRotationMatrix(r),i.independent_marker_orientation||(t.quaternion.copy(t.currentControlOri),t.updateMatrix(),t.matrixWorldNeedsUpdate=!0),super.updateMatrixWorld(e);break;default:console.error("Unkown orientation mode: "+i.orientation_mode)}}}class Va extends Ea.EventDispatcher{constructor(e){super();var t=this,i=(e=e||{}).menuEntries,r=e.className||"default-interactive-marker-menu";e.entryClassName;var n,o,s,a=e.overlayClassName||"default-interactive-marker-overlay",c=e.menuFontSize||"0.8em",h=[];if(h[0]={children:[]},null===document.getElementById("default-interactive-marker-menu-css")){var l=document.createElement("style");l.id="default-interactive-marker-menu-css",l.type="text/css",l.innerHTML=".default-interactive-marker-menu {background-color: #444444;border: 1px solid #888888;border: 1px solid #888888;padding: 0px 0px 0px 0px;color: #FFFFFF;font-family: sans-serif;font-size: "+c+";z-index: 1002;}.default-interactive-marker-menu ul {padding: 0px 0px 5px 0px;margin: 0px;list-style-type: none;}.default-interactive-marker-menu ul li div {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;cursor: default;padding: 3px 10px 3px 10px;}.default-interactive-marker-menu-entry:hover {  background-color: #666666;  cursor: pointer;}.default-interactive-marker-menu ul ul {  font-style: italic;  padding-left: 10px;}.default-interactive-marker-overlay {  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index: 1001;  -moz-opacity: 0.0;  opacity: .0;  filter: alpha(opacity = 0);}",document.getElementsByTagName("head")[0].appendChild(l)}for(this.menuDomElem=document.createElement("div"),this.menuDomElem.style.position="absolute",this.menuDomElem.className=r,this.menuDomElem.addEventListener("contextmenu",(function(e){e.preventDefault()})),this.overlayDomElem=document.createElement("div"),this.overlayDomElem.className=a,this.hideListener=this.hide.bind(this),this.overlayDomElem.addEventListener("contextmenu",this.hideListener),this.overlayDomElem.addEventListener("click",this.hideListener),this.overlayDomElem.addEventListener("touchstart",this.hideListener),n=0;n<i.length;n++)h[s=(o=i[n]).id]={title:o.title,id:s,children:[]};for(n=0;n<i.length;n++){var u=h[s=(o=i[n]).id];h[o.parent_id].children.push(u)}function p(e,t){this.dispatchEvent({type:"menu-select",domEvent:t,id:e.id,controlName:this.controlName}),this.hide(t)}!function e(i,r){var n=document.createElement("ul");i.appendChild(n);for(var o=r.children,s=0;s<o.length;s++){var a=document.createElement("li"),c=document.createElement("div");c.appendChild(document.createTextNode(o[s].title)),n.appendChild(a),a.appendChild(c),o[s].children.length>0?(e(a,o[s]),c.addEventListener("click",t.hide.bind(t)),c.addEventListener("touchstart",t.hide.bind(t))):(c.addEventListener("click",p.bind(t,o[s])),c.addEventListener("touchstart",p.bind(t,o[s])),c.className="default-interactive-marker-menu-entry")}}(this.menuDomElem,h[0])}show(e,t){t&&t.preventDefault&&t.preventDefault(),this.controlName=e.name,void 0!==t.domEvent.changedTouches?(this.menuDomElem.style.left=t.domEvent.changedTouches[0].pageX+"px",this.menuDomElem.style.top=t.domEvent.changedTouches[0].pageY+"px"):(this.menuDomElem.style.left=t.domEvent.clientX+"px",this.menuDomElem.style.top=t.domEvent.clientY+"px"),document.body.appendChild(this.overlayDomElem),document.body.appendChild(this.menuDomElem)}hide(e){e&&e.preventDefault&&e.preventDefault(),document.body.removeChild(this.overlayDomElem),document.body.removeChild(this.menuDomElem)}}class Ha extends Ea.Object3D{constructor(e){super();var t=this,i=(e=e||{}).handle;this.name=i.name;var r=e.camera,n=e.path||"/",o=e.loader;this.dragging=!1,this.onServerSetPose({pose:i.pose}),this.dragStart={position:new Ea.Vector3,orientation:new Ea.Quaternion,positionWorld:new Ea.Vector3,orientationWorld:new Ea.Quaternion,event3d:{}},i.controls.forEach((function(e){t.add(new ja({parent:t,handle:i,message:e,camera:r,path:n,loader:o}))})),i.menuEntries.length>0&&(this.menu=new Va({menuEntries:i.menuEntries,menuFontSize:i.menuFontSize}),this.menu.addEventListener("menu-select",(function(e){t.dispatchEvent(e)})))}showMenu(e,t){this.menu&&this.menu.show(e,t)}moveAxis(e,t,i){if(this.dragging){var r=e.currentControlOri,n=t.clone().applyQuaternion(r),o=this.dragStart.event3d.intersection.point,s=n.clone().applyQuaternion(this.dragStart.orientationWorld.clone()),a=new Ea.Ray(o,s),c=La(a,i.camera,i.mousePos),h=new Ea.Vector3;h.addVectors(this.dragStart.position,n.clone().applyQuaternion(this.dragStart.orientation).multiplyScalar(c)),this.setPosition(e,h),i.stopPropagation()}}move3d(e,t,i){if(this.dragging)if(e.isShift);else{var r=e.camera.getWorldDirection(),n=Math.abs(r.x),o=Math.abs(r.y),s=Math.abs(r.z),a=new Ea.Quaternion(1,0,0,1);o>n&&o>s?a=new Ea.Quaternion(0,0,1,1):s>n&&s>o&&(a=new Ea.Quaternion(0,1,0,1)),a.normalize(),(t=new Ea.Vector3(1,0,0)).applyQuaternion(a),this.movePlane(e,t,i)}}movePlane(e,t,i){if(this.dragging){var r=e.currentControlOri,n=t.clone().applyQuaternion(r),o=this.dragStart.event3d.intersection.point,s=n.clone().applyQuaternion(this.dragStart.orientationWorld),a=Sa(i.mouseRay,o,s),c=new Ea.Vector3;c.subVectors(a,o),c.add(this.dragStart.positionWorld),this.setPosition(e,c),i.stopPropagation()}}rotateAxis(e,t,i){if(this.dragging){e.updateMatrixWorld();var r=e.currentControlOri.clone().multiply(t.clone()),n=new Ea.Vector3(1,0,0).applyQuaternion(r),o=this.dragStart.event3d.intersection.point,s=n.applyQuaternion(this.dragStart.orientationWorld),a=Sa(i.mouseRay,o,s),c=new Ea.Ray(this.dragStart.positionWorld,s),h=Sa(c,o,s),l=this.dragStart.orientationWorld.clone().multiply(r).clone().inverse();a.sub(h),a.applyQuaternion(l);var u=this.dragStart.event3d.intersection.point.clone();u.sub(h),u.applyQuaternion(l);var p=Math.atan2(a.y,a.z),d=Math.atan2(u.y,u.z)-p,f=new Ea.Quaternion;f.setFromAxisAngle(n,d),this.setOrientation(e,f.multiply(this.dragStart.orientationWorld)),i.stopPropagation()}}feedbackEvent(e,t){this.dispatchEvent({type:e,position:this.position.clone(),orientation:this.quaternion.clone(),controlName:t.name})}startDrag(e,t){if(0===t.domEvent.button){t.stopPropagation(),this.dragging=!0,this.updateMatrixWorld(!0);var i=new Ea.Vector3;this.matrixWorld.decompose(this.dragStart.positionWorld,this.dragStart.orientationWorld,i),this.dragStart.position=this.position.clone(),this.dragStart.orientation=this.quaternion.clone(),this.dragStart.event3d=t,this.feedbackEvent("user-mousedown",e)}}stopDrag(e,t){0===t.domEvent.button&&(t.stopPropagation(),this.dragging=!1,this.dragStart.event3d={},this.onServerSetPose(this.bufferedPoseEvent),this.bufferedPoseEvent=void 0,this.feedbackEvent("user-mouseup",e))}buttonClick(e,t){t.stopPropagation(),this.feedbackEvent("user-button-click",e)}setPosition(e,t){this.position.copy(t),this.feedbackEvent("user-pose-change",e)}setOrientation(e,t){t.normalize(),this.quaternion.copy(t),this.feedbackEvent("user-pose-change",e)}onServerSetPose(e){if(void 0!==e)if(this.dragging)this.bufferedPoseEvent=e;else{var t=e.pose;this.position.copy(t.position),this.quaternion.copy(t.orientation),this.updateMatrixWorld(!0)}}dispose(){var e=this;this.children.forEach((function(t){t.children.forEach((function(e){e.dispose(),t.remove(e)})),e.remove(t)}))}}
/*!
	 * EventEmitter2
	 * https://github.com/hij1nx/EventEmitter2
	 *
	 * Copyright (c) 2013 hij1nx
	 * Licensed under the MIT license.
	 */var Wa=Object.hasOwnProperty,Xa=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},qa="object"==typeof process&&"function"==typeof process.nextTick,Ya="function"==typeof Symbol,Za="object"==typeof Reflect,Ja="function"==typeof setImmediate?setImmediate:setTimeout,Qa=Ya?Za&&"function"==typeof Reflect.ownKeys?Reflect.ownKeys:function(e){var t=Object.getOwnPropertyNames(e);return t.push.apply(t,Object.getOwnPropertySymbols(e)),t}:Object.keys;function Ka(){this._events={},this._conf&&$a.call(this,this._conf)}function $a(e){e&&(this._conf=e,e.delimiter&&(this.delimiter=e.delimiter),void 0!==e.maxListeners&&(this._maxListeners=e.maxListeners),e.wildcard&&(this.wildcard=e.wildcard),e.newListener&&(this._newListener=e.newListener),e.removeListener&&(this._removeListener=e.removeListener),e.verboseMemoryLeak&&(this.verboseMemoryLeak=e.verboseMemoryLeak),e.ignoreErrors&&(this.ignoreErrors=e.ignoreErrors),this.wildcard&&(this.listenerTree={}))}function ec(e,t){var i="(node) warning: possible EventEmitter memory leak detected. "+e+" listeners added. Use emitter.setMaxListeners() to increase limit.";if(this.verboseMemoryLeak&&(i+=" Event name: "+t+"."),"undefined"!=typeof process&&process.emitWarning){var r=new Error(i);r.name="MaxListenersExceededWarning",r.emitter=this,r.count=e,process.emitWarning(r)}else console.error(i),console.trace&&console.trace()}var tc=function(e,t,i){var r=arguments.length;switch(r){case 0:return[];case 1:return[e];case 2:return[e,t];case 3:return[e,t,i];default:for(var n=new Array(r);r--;)n[r]=arguments[r];return n}};function ic(e,t){for(var i={},r=e.length,n=t?value.length:0,o=0;o<r;o++)i[e[o]]=o<n?t[o]:void 0;return i}function rc(e,t,i){var r,n;if(this._emitter=e,this._target=t,this._listeners={},this._listenersCount=0,(i.on||i.off)&&(r=i.on,n=i.off),t.addEventListener?(r=t.addEventListener,n=t.removeEventListener):t.addListener?(r=t.addListener,n=t.removeListener):t.on&&(r=t.on,n=t.off),!r&&!n)throw Error("target does not implement any known event API");if("function"!=typeof r)throw TypeError("on method must be a function");if("function"!=typeof n)throw TypeError("off method must be a function");this._on=r,this._off=n;var o=e._observers;o?o.push(this):e._observers=[this]}function nc(e,t,i,r){var n=Object.assign({},t);if(!e)return n;if("object"!=typeof e)throw TypeError("options must be an object");var o,s,a,c=Object.keys(e),h=c.length;function l(e){throw Error('Invalid "'+o+'" option value'+(e?". Reason: "+e:""))}for(var u=0;u<h;u++){if(o=c[u],!r&&!Wa.call(t,o))throw Error('Unknown "'+o+'" option');void 0!==(s=e[o])&&(a=i[o],n[o]=a?a(s,l):s)}return n}function oc(e,t){return"function"==typeof e&&e.hasOwnProperty("prototype")||t("value must be a constructor"),e}function sc(e){var t="value must be type of "+e.join("|"),i=e.length,r=e[0],n=e[1];return 1===i?function(e,i){if(typeof e===r)return e;i(t)}:2===i?function(e,i){var o=typeof e;if(o===r||o===n)return e;i(t)}:function(r,n){for(var o=typeof r,s=i;s-- >0;)if(o===e[s])return r;n(t)}}Object.assign(rc.prototype,{subscribe:function(e,t,i){var r=this,n=this._target,o=this._emitter,s=this._listeners,a=function(){var r=tc.apply(null,arguments),s={data:r,name:t,original:e};if(i){var a=i.call(n,s);!1!==a&&o.emit.apply(o,[s.name].concat(r))}else o.emit.apply(o,[t].concat(r))};if(s[e])throw Error("Event '"+e+"' is already listening");this._listenersCount++,o._newListener&&o._removeListener&&!r._onNewListener?(this._onNewListener=function(i){i===t&&null===s[e]&&(s[e]=a,r._on.call(n,e,a))},o.on("newListener",this._onNewListener),this._onRemoveListener=function(i){i===t&&!o.hasListeners(i)&&s[e]&&(s[e]=null,r._off.call(n,e,a))},s[e]=null,o.on("removeListener",this._onRemoveListener)):(s[e]=a,r._on.call(n,e,a))},unsubscribe:function(e){var t,i,r,n=this,o=this._listeners,s=this._emitter,a=this._off,c=this._target;if(e&&"string"!=typeof e)throw TypeError("event must be a string");function h(){n._onNewListener&&(s.off("newListener",n._onNewListener),s.off("removeListener",n._onRemoveListener),n._onNewListener=null,n._onRemoveListener=null);var e=lc.call(s,n);s._observers.splice(e,1)}if(e){if(!(t=o[e]))return;a.call(c,e,t),delete o[e],--this._listenersCount||h()}else{for(r=(i=Qa(o)).length;r-- >0;)e=i[r],a.call(c,e,o[e]);this._listeners={},this._listenersCount=0,h()}}});var ac=sc(["function"]),cc=sc(["object","function"]);function hc(e,t,i){var r,n,o,s=0,a=new e((function(c,h,l){function u(){n&&(n=null),s&&(clearTimeout(s),s=0)}i=nc(i,{timeout:0,overload:!1},{timeout:function(e,t){return("number"!=typeof(e*=1)||e<0||!Number.isFinite(e))&&t("timeout must be a positive number"),e}}),r=!i.overload&&"function"==typeof e.prototype.cancel&&"function"==typeof l;var p=function(e){u(),c(e)},d=function(e){u(),h(e)};r?t(p,d,l):(n=[function(e){d(e||Error("canceled"))}],t(p,d,(function(e){if(o)throw Error("Unable to subscribe on cancel event asynchronously");if("function"!=typeof e)throw TypeError("onCancel callback must be a function");n.push(e)})),o=!0),i.timeout>0&&(s=setTimeout((function(){var e=Error("timeout");e.code="ETIMEDOUT",s=0,a.cancel(e),h(e)}),i.timeout))}));return r||(a.cancel=function(e){if(n){for(var t=n.length,i=1;i<t;i++)n[i](e);n[0](e),n=null}}),a}function lc(e){var t=this._observers;if(!t)return-1;for(var i=t.length,r=0;r<i;r++)if(t[r]._target===e)return r;return-1}function uc(e,t,i,r,n){if(!i)return null;if(0===r){var o=typeof t;if("string"===o){var s,a,c=0,h=0,l=this.delimiter,u=l.length;if(-1!==(a=t.indexOf(l))){s=new Array(5);do{s[c++]=t.slice(h,a),h=a+u}while(-1!==(a=t.indexOf(l,h)));s[c++]=t.slice(h),t=s,n=c}else t=[t],n=1}else"object"===o?n=t.length:(t=[t],n=1)}var p,d,f,m,v,g,y,b=null,x=t[r],w=t[r+1];if(r===n&&i._listeners)return"function"==typeof i._listeners?(e&&e.push(i._listeners),[i]):(e&&e.push.apply(e,i._listeners),[i]);if("*"===x){for(a=(g=Qa(i)).length;a-- >0;)"_listeners"!==(p=g[a])&&(y=uc(e,t,i[p],r+1,n))&&(b?b.push.apply(b,y):b=y);return b}if("**"===x){for((v=r+1===n||r+2===n&&"*"===w)&&i._listeners&&(b=uc(e,t,i,n,n)),a=(g=Qa(i)).length;a-- >0;)"_listeners"!==(p=g[a])&&("*"===p||"**"===p?(i[p]._listeners&&!v&&(y=uc(e,t,i[p],n,n))&&(b?b.push.apply(b,y):b=y),y=uc(e,t,i[p],r,n)):y=uc(e,t,i[p],p===w?r+2:r,n),y&&(b?b.push.apply(b,y):b=y));return b}if(i[x]&&(b=uc(e,t,i[x],r+1,n)),(d=i["*"])&&uc(e,t,d,r+1,n),f=i["**"])if(r<n)for(f._listeners&&uc(e,t,f,n,n),a=(g=Qa(f)).length;a-- >0;)"_listeners"!==(p=g[a])&&(p===w?uc(e,t,f[p],r+2,n):p===x?uc(e,t,f[p],r+1,n):((m={})[p]=f[p],uc(e,t,{"**":m},r+1,n)));else f._listeners?uc(e,t,f,n,n):f["*"]&&f["*"]._listeners&&uc(e,t,f["*"],n,n);return b}function pc(e,t,i){var r,n,o=0,s=0,a=this.delimiter,c=a.length;if("string"==typeof e)if(-1!==(r=e.indexOf(a))){n=new Array(5);do{n[o++]=e.slice(s,r),s=r+c}while(-1!==(r=e.indexOf(a,s)));n[o++]=e.slice(s)}else n=[e],o=1;else n=e,o=e.length;if(o>1)for(r=0;r+1<o;r++)if("**"===n[r]&&"**"===n[r+1])return;var h,l=this.listenerTree;for(r=0;r<o;r++)if(l=l[h=n[r]]||(l[h]={}),r===o-1)return l._listeners?("function"==typeof l._listeners&&(l._listeners=[l._listeners]),i?l._listeners.unshift(t):l._listeners.push(t),!l._listeners.warned&&this._maxListeners>0&&l._listeners.length>this._maxListeners&&(l._listeners.warned=!0,ec.call(this,l._listeners.length,h))):l._listeners=t,!0;return!0}function dc(e,t,i,r){for(var n,o,s,a,c=Qa(e),h=c.length,l=e._listeners;h-- >0;)n=e[o=c[h]],s="_listeners"===o?i:i?i.concat(o):[o],a=r||"symbol"==typeof o,l&&t.push(a?s:s.join(this.delimiter)),"object"==typeof n&&dc.call(this,n,t,s,a);return t}function fc(e){for(var t,i,r,n=Qa(e),o=n.length;o-- >0;)(t=e[i=n[o]])&&(r=!0,"_listeners"===i||fc(t)||delete e[i]);return r}function mc(e,t,i){this.emitter=e,this.event=t,this.listener=i}function vc(e,t,i){if(!0===i)n=!0;else if(!1===i)r=!0;else{if(!i||"object"!=typeof i)throw TypeError("options should be an object or true");var r=i.async,n=i.promisify,o=i.nextTick,s=i.objectify}if(r||o||n){var a=t,c=t._origin||t;if(o&&!qa)throw Error("process.nextTick is not supported");void 0===n&&(n="AsyncFunction"===t.constructor.name),(t=function(){var e=arguments,t=this,i=this.event;return n?o?Promise.resolve():new Promise((function(e){Ja(e)})).then((function(){return t.event=i,a.apply(t,e)})):(o?process.nextTick:Ja)((function(){t.event=i,a.apply(t,e)}))})._async=!0,t._origin=c}return[t,s?new mc(this,e,t):this]}function gc(e){this._events={},this._newListener=!1,this._removeListener=!1,this.verboseMemoryLeak=!1,$a.call(this,e)}mc.prototype.off=function(){return this.emitter.off(this.event,this.listener),this},gc.EventEmitter2=gc,gc.prototype.listenTo=function(e,t,i){if("object"!=typeof e)throw TypeError("target musts be an object");var r=this;function n(t){if("object"!=typeof t)throw TypeError("events must be an object");var n,o=i.reducers,s=lc.call(r,e);n=-1===s?new rc(r,e,i):r._observers[s];for(var a,c=Qa(t),h=c.length,l="function"==typeof o,u=0;u<h;u++)a=c[u],n.subscribe(a,t[a]||a,l?o:o&&o[a])}return i=nc(i,{on:void 0,off:void 0,reducers:void 0},{on:ac,off:ac,reducers:cc}),Xa(t)?n(ic(t)):n("string"==typeof t?ic(t.split(/\s+/)):t),this},gc.prototype.stopListeningTo=function(e,t){var i=this._observers;if(!i)return!1;var r,n=i.length,o=!1;if(e&&"object"!=typeof e)throw TypeError("target should be an object");for(;n-- >0;)r=i[n],e&&r._target!==e||(r.unsubscribe(t),o=!0);return o},gc.prototype.delimiter=".",gc.prototype.setMaxListeners=function(e){void 0!==e&&(this._maxListeners=e,this._conf||(this._conf={}),this._conf.maxListeners=e)},gc.prototype.getMaxListeners=function(){return this._maxListeners},gc.prototype.event="",gc.prototype.once=function(e,t,i){return this._once(e,t,!1,i)},gc.prototype.prependOnceListener=function(e,t,i){return this._once(e,t,!0,i)},gc.prototype._once=function(e,t,i,r){return this._many(e,1,t,i,r)},gc.prototype.many=function(e,t,i,r){return this._many(e,t,i,!1,r)},gc.prototype.prependMany=function(e,t,i,r){return this._many(e,t,i,!0,r)},gc.prototype._many=function(e,t,i,r,n){var o=this;if("function"!=typeof i)throw new Error("many only accepts instances of Function");function s(){return 0==--t&&o.off(e,s),i.apply(this,arguments)}return s._origin=i,this._on(e,s,r,n)},gc.prototype.emit=function(){if(!this._events&&!this._all)return!1;this._events||Ka.call(this);var e,t,i,r,n,o,s=arguments[0],a=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return!1;if(a&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"==typeof s)){if(i=s.length,Ya)for(r=0;r<i;r++)if("symbol"==typeof s[r]){o=!0;break}o||(s=s.join(this.delimiter))}var c,h=arguments.length;if(this._all&&this._all.length)for(r=0,i=(c=this._all.slice()).length;r<i;r++)switch(this.event=s,h){case 1:c[r].call(this,s);break;case 2:c[r].call(this,s,arguments[1]);break;case 3:c[r].call(this,s,arguments[1],arguments[2]);break;default:c[r].apply(this,arguments)}if(a)c=[],uc.call(this,c,e,this.listenerTree,0,i);else{if("function"==typeof(c=this._events[s])){switch(this.event=s,h){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(t=new Array(h-1),n=1;n<h;n++)t[n-1]=arguments[n];c.apply(this,t)}return!0}c&&(c=c.slice())}if(c&&c.length){if(h>3)for(t=new Array(h-1),n=1;n<h;n++)t[n-1]=arguments[n];for(r=0,i=c.length;r<i;r++)switch(this.event=s,h){case 1:c[r].call(this);break;case 2:c[r].call(this,arguments[1]);break;case 3:c[r].call(this,arguments[1],arguments[2]);break;default:c[r].apply(this,t)}return!0}if(!this.ignoreErrors&&!this._all&&"error"===s)throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");return!!this._all},gc.prototype.emitAsync=function(){if(!this._events&&!this._all)return!1;this._events||Ka.call(this);var e,t,i,r,n,o,s=arguments[0],a=this.wildcard;if("newListener"===s&&!this._newListener&&!this._events.newListener)return Promise.resolve([!1]);if(a&&(e=s,"newListener"!==s&&"removeListener"!==s&&"object"==typeof s)){if(r=s.length,Ya)for(n=0;n<r;n++)if("symbol"==typeof s[n]){t=!0;break}t||(s=s.join(this.delimiter))}var c,h=[],l=arguments.length;if(this._all)for(n=0,r=this._all.length;n<r;n++)switch(this.event=s,l){case 1:h.push(this._all[n].call(this,s));break;case 2:h.push(this._all[n].call(this,s,arguments[1]));break;case 3:h.push(this._all[n].call(this,s,arguments[1],arguments[2]));break;default:h.push(this._all[n].apply(this,arguments))}if(a?(c=[],uc.call(this,c,e,this.listenerTree,0)):c=this._events[s],"function"==typeof c)switch(this.event=s,l){case 1:h.push(c.call(this));break;case 2:h.push(c.call(this,arguments[1]));break;case 3:h.push(c.call(this,arguments[1],arguments[2]));break;default:for(i=new Array(l-1),o=1;o<l;o++)i[o-1]=arguments[o];h.push(c.apply(this,i))}else if(c&&c.length){if(c=c.slice(),l>3)for(i=new Array(l-1),o=1;o<l;o++)i[o-1]=arguments[o];for(n=0,r=c.length;n<r;n++)switch(this.event=s,l){case 1:h.push(c[n].call(this));break;case 2:h.push(c[n].call(this,arguments[1]));break;case 3:h.push(c[n].call(this,arguments[1],arguments[2]));break;default:h.push(c[n].apply(this,i))}}else if(!this.ignoreErrors&&!this._all&&"error"===s)return arguments[1]instanceof Error?Promise.reject(arguments[1]):Promise.reject("Uncaught, unspecified 'error' event.");return Promise.all(h)},gc.prototype.on=function(e,t,i){return this._on(e,t,!1,i)},gc.prototype.prependListener=function(e,t,i){return this._on(e,t,!0,i)},gc.prototype.onAny=function(e){return this._onAny(e,!1)},gc.prototype.prependAny=function(e){return this._onAny(e,!0)},gc.prototype.addListener=gc.prototype.on,gc.prototype._onAny=function(e,t){if("function"!=typeof e)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),t?this._all.unshift(e):this._all.push(e),this},gc.prototype._on=function(e,t,i,r){if("function"==typeof e)return this._onAny(e,t),this;if("function"!=typeof t)throw new Error("on only accepts instances of Function");this._events||Ka.call(this);var n,o=this;return void 0!==r&&(t=(n=vc.call(this,e,t,r))[0],o=n[1]),this._newListener&&this.emit("newListener",e,t),this.wildcard?(pc.call(this,e,t,i),o):(this._events[e]?("function"==typeof this._events[e]&&(this._events[e]=[this._events[e]]),i?this._events[e].unshift(t):this._events[e].push(t),!this._events[e].warned&&this._maxListeners>0&&this._events[e].length>this._maxListeners&&(this._events[e].warned=!0,ec.call(this,this._events[e].length,e))):this._events[e]=t,o)},gc.prototype.off=function(e,t){if("function"!=typeof t)throw new Error("removeListener only takes instances of Function");var i,r=[];if(this.wildcard){var n="string"==typeof e?e.split(this.delimiter):e.slice();if(!(r=uc.call(this,null,n,this.listenerTree,0)))return this}else{if(!this._events[e])return this;i=this._events[e],r.push({_listeners:i})}for(var o=0;o<r.length;o++){var s=r[o];if(i=s._listeners,Xa(i)){for(var a=-1,c=0,h=i.length;c<h;c++)if(i[c]===t||i[c].listener&&i[c].listener===t||i[c]._origin&&i[c]._origin===t){a=c;break}if(a<0)continue;return this.wildcard?s._listeners.splice(a,1):this._events[e].splice(a,1),0===i.length&&(this.wildcard?delete s._listeners:delete this._events[e]),this._removeListener&&this.emit("removeListener",e,t),this}(i===t||i.listener&&i.listener===t||i._origin&&i._origin===t)&&(this.wildcard?delete s._listeners:delete this._events[e],this._removeListener&&this.emit("removeListener",e,t))}return this.listenerTree&&fc(this.listenerTree),this},gc.prototype.offAny=function(e){var t,i=0,r=0;if(e&&this._all&&this._all.length>0){for(i=0,r=(t=this._all).length;i<r;i++)if(e===t[i])return t.splice(i,1),this._removeListener&&this.emit("removeListenerAny",e),this}else{if(t=this._all,this._removeListener)for(i=0,r=t.length;i<r;i++)this.emit("removeListenerAny",t[i]);this._all=[]}return this},gc.prototype.removeListener=gc.prototype.off,gc.prototype.removeAllListeners=function(e){if(void 0===e)return!this._events||Ka.call(this),this;if(this.wildcard){var t,i=uc.call(this,null,e,this.listenerTree,0);if(!i)return this;for(t=0;t<i.length;t++)i[t]._listeners=null;this.listenerTree&&fc(this.listenerTree)}else this._events&&(this._events[e]=null);return this},gc.prototype.listeners=function(e){var t,i,r,n,o,s=this._events;if(void 0===e){if(this.wildcard)throw Error("event name required for wildcard emitter");if(!s)return[];for(n=(t=Qa(s)).length,r=[];n-- >0;)"function"==typeof(i=s[t[n]])?r.push(i):r.push.apply(r,i);return r}if(this.wildcard){if(!(o=this.listenerTree))return[];var a=[],c="string"==typeof e?e.split(this.delimiter):e.slice();return uc.call(this,a,c,o,0),a}return s&&(i=s[e])?"function"==typeof i?[i]:i:[]},gc.prototype.eventNames=function(e){var t=this._events;return this.wildcard?dc.call(this,this.listenerTree,[],null,e):t?Qa(t):[]},gc.prototype.listenerCount=function(e){return this.listeners(e).length},gc.prototype.hasListeners=function(e){if(this.wildcard){var t=[],i="string"==typeof e?e.split(this.delimiter):e.slice();return uc.call(this,t,i,this.listenerTree,0),t.length>0}var r=this._events,n=this._all;return!!(n&&n.length||r&&(void 0===e?Qa(r).length:r[e]))},gc.prototype.listenersAny=function(){return this._all?this._all:[]},gc.prototype.waitFor=function(e,t){var i=this,r=typeof t;return"number"===r?t={timeout:t}:"function"===r&&(t={filter:t}),hc((t=nc(t,{timeout:0,filter:void 0,handleError:!1,Promise:Promise,overload:!1},{filter:ac,Promise:oc})).Promise,(function(r,n,o){function s(){var o=t.filter;if(!o||o.apply(i,arguments))if(i.off(e,s),t.handleError){var a=arguments[0];a?n(a):r(tc.apply(null,arguments).slice(1))}else r(tc.apply(null,arguments))}o((function(){i.off(e,s)})),i._on(e,s,!1)}),{timeout:t.timeout,overload:t.overload})};var yc=gc.prototype;Object.defineProperties(gc,{defaultMaxListeners:{get:function(){return yc._maxListeners},set:function(e){if("number"!=typeof e||e<0||Number.isNaN(e))throw TypeError("n must be a non-negative number");yc._maxListeners=e},enumerable:!0},once:{value:function(e,t,i){return hc((i=nc(i,{Promise:Promise,timeout:0,overload:!1},{Promise:oc})).Promise,(function(i,r,n){var o;if("function"==typeof e.addEventListener)return o=function(){i(tc.apply(null,arguments))},n((function(){e.removeEventListener(t,o)})),void e.addEventListener(t,o,{once:!0});var s,a=function(){s&&e.removeListener("error",s),i(tc.apply(null,arguments))};"error"!==t&&(s=function(i){e.removeListener(t,a),r(i)},e.once("error",s)),n((function(){s&&e.removeListener("error",s),e.removeListener(t,a)})),e.once(t,a)}),{timeout:i.timeout,overload:i.overload})},writable:!0,configurable:!0}}),Object.defineProperties(yc,{_maxListeners:{value:10,writable:!0,configurable:!0},_observers:{value:null,writable:!0,configurable:!0}});const bc=gc.EventEmitter2;class xc extends bc{constructor(e){super(),e=e||{},this.message=e.message,this.feedbackTopic=e.feedbackTopic,this.tfClient=e.tfClient,this.menuFontSize=e.menuFontSize||"0.8em",this.name=this.message.name,this.header=this.message.header,this.controls=this.message.controls,this.menuEntries=this.message.menu_entries,this.dragging=!1,this.timeoutHandle=null,this.tfTransform=new Na.Transform,this.pose=new Na.Pose,this.setPoseFromClientBound=this.setPoseFromClient.bind(this),this.onMouseDownBound=this.onMouseDown.bind(this),this.onMouseUpBound=this.onMouseUp.bind(this),this.onButtonClickBound=this.onButtonClick.bind(this),this.onMenuSelectBound=this.onMenuSelect.bind(this),this.setPoseFromServer(this.message.pose),this.tfUpdateBound=this.tfUpdate.bind(this)}subscribeTf(){0===this.message.header.stamp.secs&&0===this.message.header.stamp.nsecs&&this.tfClient.subscribe(this.message.header.frame_id,this.tfUpdateBound)}unsubscribeTf(){this.tfClient.unsubscribe(this.message.header.frame_id,this.tfUpdateBound)}emitServerPoseUpdate(){var e=new Na.Pose(this.pose);e.applyTransform(this.tfTransform),this.emit("pose",e)}setPoseFromServer(e){this.pose=new Na.Pose(e),this.emitServerPoseUpdate()}tfUpdate(e){this.tfTransform=new Na.Transform(e),this.emitServerPoseUpdate()}setPoseFromClient(e){this.pose=new Na.Pose(e);var t=this.tfTransform.clone();t.rotation.invert(),t.translation.multiplyQuaternion(t.rotation),t.translation.x*=-1,t.translation.y*=-1,t.translation.z*=-1,this.pose.applyTransform(t),this.sendFeedback(1,void 0,0,e.controlName),this.dragging&&(this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(this.setPoseFromClient.bind(this,e),250))}onButtonClick(e){this.sendFeedback(3,e.clickPosition,0,e.controlName)}onMouseDown(e){this.sendFeedback(4,e.clickPosition,0,e.controlName),this.dragging=!0}onMouseUp(e){this.sendFeedback(5,e.clickPosition,0,e.controlName),this.dragging=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)}onMenuSelect(e){this.sendFeedback(2,void 0,e.id,e.controlName)}sendFeedback(e,t,i,r){var n=void 0!==t;t=t||{x:0,y:0,z:0};var o={header:this.header,client_id:this.clientID,marker_name:this.name,control_name:r,event_type:e,pose:this.pose,mouse_point:t,mouse_point_valid:n,menu_entry_id:i};this.feedbackTopic.publish(o)}}class wc extends Ea.Object3D{constructor(e){super(),e=e||{};var t=this;this.tfClient=e.tfClient,this.frameID=e.frameID;var i=e.object;this.pose=e.pose||new Na.Pose,this.visible=!1,this.add(i),this.updatePose(this.pose),this.tfUpdate=function(e){var i=new Na.Transform(e),r=new Na.Pose(t.pose);r.applyTransform(i),t.updatePose(r),t.visible=!0},this.tfClient.subscribe(this.frameID,this.tfUpdate)}updatePose(e){this.position.set(e.position.x,e.position.y,e.position.z),this.quaternion.set(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.updateMatrixWorld(!0)}unsubscribeTf(){this.tfClient.unsubscribe(this.frameID,this.tfUpdate)}}class _c extends Ea.ArrowHelper{constructor(e){var t=(e=e||{}).origin||new Ea.Vector3(0,0,0),i=e.direction||new Ea.Vector3(1,0,0),r=e.length||1;e.headLength,e.shaftDiameter,e.headDiameter,e.material||new Ea.MeshBasicMaterial,super(i,t,r,16711680)}dispose(){void 0!==this.line&&(this.line.material.dispose(),this.line.geometry.dispose()),void 0!==this.cone&&(this.cone.material.dispose(),this.cone.geometry.dispose())}}class Mc extends Ea.Object3D{constructor(e){super();var t=this,i=(e=e||{}).shaftRadius||.008,r=e.headRadius||.023,n=e.headLength||.1,o=e.scale||1,s=e.lineType||"full",a=e.lineDashLength||.1;function c(e){var r=new Ea.Color;r.setRGB(e.x,e.y,e.z);var n=new Ea.MeshBasicMaterial({color:r.getHex()}),o=new Ea.Vector3;o.crossVectors(e,new Ea.Vector3(0,-1,0));var c=new Ea.Quaternion;c.setFromAxisAngle(o,.5*Math.PI);var h,l=new Ea.Mesh(t.headGeom,n);if(l.position.copy(e),l.position.multiplyScalar(.95),l.quaternion.copy(c),l.updateMatrix(),t.add(l),"dashed"===s)for(var u=a,p=0;u/2+3*u*p+u/2<=1;++p){var d=new Ea.CylinderGeometry(i,i,u);(h=new Ea.Mesh(d,n)).position.copy(e),h.position.multiplyScalar(u/2+3*u*p),h.quaternion.copy(c),h.updateMatrix(),t.add(h)}else"full"===s?((h=new Ea.Mesh(t.lineGeom,n)).position.copy(e),h.position.multiplyScalar(.45),h.quaternion.copy(c),h.updateMatrix(),t.add(h)):console.warn("[Axes]: Unsupported line type. Not drawing any axes.")}this.scale.set(o,o,o),this.lineGeom=new Ea.CylinderGeometry(i,i,1-n),this.headGeom=new Ea.CylinderGeometry(0,r,n),c(new Ea.Vector3(1,0,0)),c(new Ea.Vector3(0,1,0)),c(new Ea.Vector3(0,0,1))}}class Ec extends Ea.Object3D{constructor(e){var t=(e=e||{}).num_cells||10,i=e.color||"#cccccc",r=e.lineWidth||1,n=e.cellSize||1;super();for(var o=new Ea.LineBasicMaterial({color:i,linewidth:r}),s=0;s<=t;++s){var a=n*t/2,c=a-s*n,h=new Ea.Geometry;h.vertices.push(new Ea.Vector3(-a,c,0),new Ea.Vector3(a,c,0));var l=new Ea.Geometry;l.vertices.push(new Ea.Vector3(c,-a,0),new Ea.Vector3(c,a,0)),this.add(new Ea.Line(h,o)),this.add(new Ea.Line(l,o))}}}class Tc extends Ea.Mesh{constructor(e){var t=(e=e||{}).message,i=e.opacity||1,r=e.color||{r:255,g:255,b:255,a:255},n=t.info,o=n.origin,s=n.width,a=n.height,c=new Ea.PlaneBufferGeometry(s,a),h=new Uint8Array(s*a*4),l=new Ea.DataTexture(h,s,a,Ea.RGBAFormat);l.flipY=!0,l.minFilter=Ea.NearestFilter,l.magFilter=Ea.NearestFilter,l.needsUpdate=!0;var u=new Ea.MeshBasicMaterial({map:l,transparent:i<1,opacity:i});u.side=Ea.DoubleSide,super(c,u),Object.assign(this,e),this.quaternion.copy(new Ea.Quaternion(o.orientation.x,o.orientation.y,o.orientation.z,o.orientation.w)),this.position.x=s*n.resolution/2+o.position.x,this.position.y=a*n.resolution/2+o.position.y,this.position.z=o.position.z,this.scale.x=n.resolution,this.scale.y=n.resolution;var p=t.data;this.color=r,this.material=u,this.texture=l;for(var d=0;d<a;d++)for(var f=0;f<s;f++){var m=a-d-1,v=f+m*s,g=this.getValue(v,m,f,p),y=(r=this.getColor(v,m,f,g),4*(f+d*s));h.set(r,y)}l.needsUpdate=!0}dispose(){this.material.dispose(),this.texture.dispose()}getValue(e,t,i,r){return r[e]}getColor(e,t,i,r){return[r*this.color.r/255,r*this.color.g/255,r*this.color.b/255,255]}}class Sc{constructor(){this._children=[null,null,null,null,null,null,null,null],this.value=null}createChildNodeAt(e,t){this._children[t%8]=e}hasChildAt(e){return null!==this._children[e%8]}getChildAt(e){return this._children[e%8]}isLeafNode(){for(let e=0;e<8;++e)if(null!==this._children[e])return!1;return!0}hasChildren(){for(let e=0;e<8;++e)if(null!==this._children[e])return!0;return!1}}var Ac="occupied",Lc="free";function Rc(e,t){return this.buffer=e.buffer,this.length=e.length,this.isLittleEndian=void 0===t||!!t,this._dataView=new DataView(this.buffer),this._cursor=0,[{kind:"Int8",width:1},{kind:"Uint8",width:1},{kind:"Int16",width:2},{kind:"Uint16",width:2},{kind:"Int32",width:4},{kind:"Uint32",width:4},{kind:"BigInt64",width:8},{kind:"BigUint64",width:8},{kind:"Float32",width:4},{kind:"Float64",width:8}].forEach((e=>{const t="read"+e.kind,i="get"+e.kind;this[t]=()=>{if(this._cursor+e.width>this.length)throw new Error("Cannot read data stream. Overflow. Len="+this.length+" crsr="+this._cursor);const t=this._dataView[i](this._cursor,this.isLittleEndian);return this._cursor+=e.width,t}})),Object.defineProperty(this,"isEnd",{get:()=>this.cursor>=this.data.length}),this}class Cc{constructor(e){this.resolution=void 0!==e.resolution?e.resolution:1,this.color=new Ea.Color(void 0!==e.color?e.color:"green"),this.opacity=void 0!==e.opacity?e.opacity:1,this.voxelRenderMode=void 0!==e.voxelRenderMode?e.voxelRenderMode:Ac,this._rootNode=null,this._treeDepth=16,this._treeMaxKeyVal=32768,this.nodeSizeTable=new Array(this._treeDepth);let t=this.resolution;for(let e=this._treeDepth-1;e>=0;--e)this.nodeSizeTable[e]=t,t*=2;this._defaultOccupiedValue=!0,this._defaultFreeValue=!1,this.object=null}_BINARY_UNALLOCATED=0;_BINARY_LEAF_FREE=1;_BINARY_LEAF_OCCUPIED=2;_BINARY_HAS_CHILDREN=3;BINARY_CHILD_BUILD_TABLE={[this._BINARY_LEAF_FREE]:e=>{e.value=this._defaultFreeValue},[this._BINARY_LEAF_OCCUPIED]:e=>{e.value=this._defaultOccupiedValue},[this._BINARY_HAS_CHILDREN]:e=>{e.value=null}};_FACES=[{normal:[-1,0,0],vertices:[[0,1,0],[0,0,0],[0,1,1],[0,0,1]],childIndex:[1,3,5,7]},{normal:[1,0,0],vertices:[[1,1,1],[1,0,1],[1,1,0],[1,0,0]],childIndex:[0,2,4,6]},{normal:[0,-1,0],vertices:[[1,0,1],[0,0,1],[1,0,0],[0,0,0]],childIndex:[2,3,6,7]},{normal:[0,1,0],vertices:[[0,1,1],[1,1,1],[0,1,0],[1,1,0]],childIndex:[0,1,4,5]},{normal:[0,0,-1],vertices:[[1,0,0],[0,0,0],[1,1,0],[0,1,0]],childIndex:[4,5,6,7]},{normal:[0,0,1],vertices:[[0,0,1],[1,0,1],[0,1,1],[1,1,1]],childIndex:[0,1,2,3]}];searchAtDepth(e,t){t=void 0!==t&&t>0?t:this._treeDepth;const i=this._adjustKeyAtDepth(e,t),r=this._treeDepth-t;let n=this._rootNode;for(let e=this._treeDepth-1;e>=r;--e){const t=this._computeChildIdx(i,e);if(!n.hasChildAt(t))return n.hasChildren()?null:n;n=n.getChildAt(t)}return n}_computeCoordFromKey(e){return e.map((e=>this.resolution*(e-this._treeMaxKeyVal)))}_computeChildIdx(e,t){let i=0;return e[0]&1<<t&&(i+=1),e[1]&1<<t&&(i+=2),e[2]&1<<t&&(i+=4),i}_computeKeyFromChildIdx(e,t,i){const r=this._treeDepth-i-1;return[t[0]+(!!(1&e)<<r),t[1]+(!!(2&e)<<r),t[2]+(!!(4&e)<<r)]}_adjustKeyAtDepth(e,t){let i=this._treeDepth-t;return 0===i?e:e.map((e=>(e-this._treeMaxKeyVal>>i<<i)+(1<<i-1)+this._treeMaxKeyVal))}_newNode(){return new Sc}readBinary(e){null!==this._rootNode&&delete this._rootNode,this._rootNode=this._newNode();let t=new Rc(e,!0),i=new Array;for(i.push(this._rootNode);i.length>0;){let e=i.pop();const r=t.readUint16();let n=8;for(;0!==n;){--n;const t=(r&3<<2*n)>>2*n;if(t!==this._BINARY_UNALLOCATED){let r=this._newNode();(0,this.BINARY_CHILD_BUILD_TABLE[t])(r),e.createChildNodeAt(r,n),t===this._BINARY_HAS_CHILDREN&&i.push(r)}}}}read(e){null!==this._rootNode&&delete this._rootNode,this._rootNode=this._newNode();let t=new Rc(e,!0),i=new Array;for(i.push(this._rootNode);i.length>0;){let e=i.pop();this._readNodeData(t,e);const r=t.readUint8();let n=8;for(;0!==n;){--n;if(r&1<<n){let t=this._newNode();t.value=null,e.createChildNodeAt(t,n),i.push(t)}}}}_readNodeData(e,t){console.error("Not implemented")}buildGeometry(){console.assert(null!==this._rootNode,"No tree data");const{vertices:e,normals:t,colors:i,indices:r}=this._buildFaces(),n=new Ea.BufferGeometry,o=new Ea.MeshBasicMaterial({color:"white",flatShading:!0,vertexColors:Ea.VertexColors,transparent:this.opacity<1,opacity:this.opacity});n.addAttribute("position",new Ea.BufferAttribute(new Float32Array(e),3)),n.addAttribute("normal",new Ea.BufferAttribute(new Float32Array(t),3)),n.addAttribute("color",new Ea.BufferAttribute(new Float32Array(i),3)),n.setIndex(r);const s=new Ea.Mesh(n,o);this.object=new Ea.Object3D,this.object.add(s)}_traverseLeaves(e){let t=new Array;for(t.push({node:this._rootNode,depth:0,key:[0,0,0]});t.length>0;){let i=t.pop();if(i.node.isLeafNode())e(i.node,i.key,i.depth-1);else for(let e=0;e<8;++e)if(i.node.hasChildAt(e)){const r=this._computeKeyFromChildIdx(e,i.key,i.depth);t.push({node:i.node.getChildAt(e),depth:i.depth+1,key:r})}}}_obtainColor(e){return this.color}_checkOccupied(e){return!1!==e.value}_checkOccupied(e){return e.value<this.freeThreshold}_buildFaces(){let e={vertices:[],indices:[],normals:[],colors:[],_insertFace:function(e,t,i,r){const n=this.vertices.length/3;for(const r of e.vertices)this.vertices.push(t[0]+r[0]*i,t[1]+r[1]*i,t[2]+r[2]*i);const o=[r.r,r.g,r.b];this.colors.push(...o,...o,...o,...o),this.normals.push(...e.normal,...e.normal,...e.normal,...e.normal),this.indices.push(n,n+1,n+2,n+2,n+1,n+3)},_checkNeighborsTouchingFace:function(e,t,i){let r=new Array;for(r.push(t);0!==r.length;){const t=r.pop();if(t.hasChildren())for(const n of e.childIndex){if(!t.hasChildAt(n))return!0;{const e=t.getChildAt(n),o=this._checkOccupied(t);(o&&i===Ac||!o&&i===Lc)&&r.push(e)}}}return!1}};return this._traverseLeaves(((t,i,r)=>{const n=this._computeCoordFromKey(i),o=this.nodeSizeTable[r],s=this._treeDepth-r,a=this._checkOccupied(t);if((a||this.voxelRenderMode!==Ac)&&(!a||this.voxelRenderMode!==Lc))for(const a of this._FACES){const c=[i[0]+a.normal[0]*s*s,i[1]+a.normal[1]*s*s,i[2]+a.normal[2]*s*s],h=this.searchAtDepth(c);(null===h||r<this._treeDepth&&e._checkNeighborsTouchingFace(a,h,this.voxelRenderMode))&&e._insertFace(a,n,o,this._obtainColor(t))}})),{vertices:e.vertices,normals:e.normals,colors:e.colors,indices:e.indices}}}var Pc={SOLID:"solid",OCCUPANCY:"occupancy",COLOR:"color"};class Nc extends Cc{constructor(e){super(e),this._defaultOccupiedValue=1,this._defaultFreeValue=-1,this.occupancyThreshold=void 0!==e.occupancyThreshold?e.occupancyThreshold:1e-7,this.useFlatColoring=void 0!==e.colorMode&&e.colorMode===Pc.SOLID,this.palette=void 0!==e.palette?e.palette.map((e=>new THREE.Color(e))):[{r:0,g:0,b:128},{r:0,g:255,b:0},{r:255,g:255,b:0},{r:255,g:128,b:0},{r:255,g:0,b:0}],this.paletteScale=void 0!==e.paletteScale?e.paletteScale:1}_readNodeData(e,t){t.value=e.readFloat32()}_obtainColor(e){if(this.useFlatColoring)return this.color;const t=1/(1+Math.exp(-e.value*this.paletteScale))*this.palette.length,i=Math.trunc(t),r=t-i;return i<0?this.palette[0]:i>=this.palette.length-1?this.palette[this.palette.length-1]:{r:r*this.palette[i].r+(1-r)*this.palette[i+1].r,g:r*this.palette[i].g+(1-r)*this.palette[i+1].g,b:r*this.palette[i].b+(1-r)*this.palette[i+1].b}}_checkOccupied(e){return e.value>=this.occupancyThreshold}}class Oc extends Nc{constructor(e){super(e),this.useOwnColor=void 0!==e.palette&&e.colorMode===Pc.COLOR}_readNodeData(e,t){t.value=e.readFloat32(),t.color={r:e.readUint8(),g:e.readUint8(),b:e.readUint8()}}_obtainColor(e){return this.useOwnColor?e.color:Nc.prototype._obtainColor.call(this,e)}}class Ic extends Ea.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new Ea.Object3D,this.keep=e.keep||1,this.sns=[],this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Odometry"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.sns.length>=this.keep&&(this.sns[0].unsubscribeTf(),this.rootObject.remove(this.sns[0]),this.sns.shift()),this.options.origin=new Ea.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new Ea.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new Ea.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new Ea.MeshBasicMaterial({color:this.color});var i=new Oa(this.options);this.sns.push(new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i})),this.rootObject.add(this.sns[this.sns.length-1])}}class Dc extends Ea.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new Ea.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"nav_msgs/Path"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t=new Ea.Geometry,i=0;i<e.poses.length;i++){var r=new Ea.Vector3(e.poses[i].pose.position.x,e.poses[i].pose.position.y,e.poses[i].pose.position.z);t.vertices.push(r)}t.computeLineDistances();var n=new Ea.LineBasicMaterial({color:this.color}),o=new Ea.Line(t,n);this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:o}),this.rootObject.add(this.sn)}}class Uc extends Ea.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/point",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new Ea.Object3D,this.radius=e.radius||.2,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PointStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));var t=new Ea.SphereGeometry(this.radius),i=new Ea.MeshBasicMaterial({color:this.color}),r=new Ea.Mesh(t,i);r.position.set(e.point.x,e.point.y,e.point.z),this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:r}),this.rootObject.add(this.sn)}}class Fc extends Ea.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/path",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new Ea.Object3D,this.sn=null,this.line=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PolygonStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,i=new Ea.Geometry,r=0;r<e.polygon.points.length;r++)t=new Ea.Vector3(e.polygon.points[r].x,e.polygon.points[r].y,e.polygon.points[r].z),i.vertices.push(t);t=new Ea.Vector3(e.polygon.points[0].x,e.polygon.points[0].y,e.polygon.points[0].z),i.vertices.push(t),i.computeLineDistances();var n=new Ea.LineBasicMaterial({color:this.color}),o=new Ea.Line(i,n);this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:o}),this.rootObject.add(this.sn)}}class kc extends Ea.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/pose",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new Ea.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new Ea.Vector3(e.pose.position.x,e.pose.position.y,e.pose.position.z);var t=new Ea.Quaternion(e.pose.orientation.x,e.pose.orientation.y,e.pose.orientation.z,e.pose.orientation.w);this.options.direction=new Ea.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new Ea.MeshBasicMaterial({color:this.color});var i=new Oa(this.options);this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class Bc extends Ea.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/particlecloud",this.tfClient=e.tfClient,this.color=e.color||13369599,this.length=e.length||1,this.rootObject=e.rootObject||new Ea.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseArray"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn));for(var t,i=new Ea.Object3D,r=0;r<e.poses.length;r++){var n=new Ea.Geometry,o=new Ea.Vector3(e.poses[r].position.x,e.poses[r].position.y,e.poses[r].position.z);n.vertices.push(o);var s=new Ea.Quaternion(e.poses[r].orientation.x,e.poses[r].orientation.y,e.poses[r].orientation.z,e.poses[r].orientation.w),a=new Ea.Vector3(this.length,0,0),c=new Ea.Vector3(.8*this.length,.2*this.length,0),h=new Ea.Vector3(.8*this.length,.2*-this.length,0);a.applyQuaternion(s),c.applyQuaternion(s),h.applyQuaternion(s),n.vertices.push(a.add(o)),n.vertices.push(c.add(o)),n.vertices.push(h.add(o)),n.vertices.push(a),n.computeLineDistances();var l=new Ea.LineBasicMaterial({color:this.color});t=new Ea.Line(n,l),i.add(t)}this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class zc extends Ea.Object3D{constructor(e){super(),this.options=e||{},this.ros=e.ros,this.topicName=e.topic||"/PoseWithCovariance",this.tfClient=e.tfClient,this.color=e.color||13369599,this.rootObject=e.rootObject||new Ea.Object3D,this.sn=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"geometry_msgs/PoseWithCovarianceStamped"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){null!==this.sn&&(this.sn.unsubscribeTf(),this.rootObject.remove(this.sn)),this.options.origin=new Ea.Vector3(e.pose.pose.position.x,e.pose.pose.position.y,e.pose.pose.position.z);var t=new Ea.Quaternion(e.pose.pose.orientation.x,e.pose.pose.orientation.y,e.pose.pose.orientation.z,e.pose.pose.orientation.w);this.options.direction=new Ea.Vector3(1,0,0),this.options.direction.applyQuaternion(t),this.options.material=new Ea.MeshBasicMaterial({color:this.color});var i=new Oa(this.options);this.sn=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.sn)}}class Gc extends Ea.Object3D{constructor(e){super(),e=e||{},this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.max_pts=e.max_pts||1e4,this.pointRatio=e.pointRatio||1,this.messageRatio=e.messageRatio||1,this.messageCount=0,this.material=e.material||{},this.colorsrc=e.colorsrc,this.colormap=e.colormap,("color"in e||"size"in e||"texture"in e)&&console.warn('toplevel "color", "size" and "texture" options are deprecated.They should beprovided within a "material" option, e.g. :  { tfClient, material : { color: mycolor, size: mysize, map: mytexture }, ... }'),this.sn=null}setup(e,t,i){if(null===this.sn){i=i||[],this.fields={};for(var r=0;r<i.length;r++)this.fields[i[r].name]=i[r];if(this.geom=new Ea.BufferGeometry,this.positions=new Ea.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.addAttribute("position",this.positions.setDynamic(!0)),!this.colorsrc&&this.fields.rgb&&(this.colorsrc="rgb"),this.colorsrc){var n=this.fields[this.colorsrc];if(n){this.colors=new Ea.BufferAttribute(new Float32Array(3*this.max_pts),3,!1),this.geom.addAttribute("color",this.colors.setDynamic(!0));var o=n.offset;this.getColor=[function(e,t,i){return e.getInt8(t+o,i)},function(e,t,i){return e.getUint8(t+o,i)},function(e,t,i){return e.getInt16(t+o,i)},function(e,t,i){return e.getUint16(t+o,i)},function(e,t,i){return e.getInt32(t+o,i)},function(e,t,i){return e.getUint32(t+o,i)},function(e,t,i){return e.getFloat32(t+o,i)},function(e,t,i){return e.getFloat64(t+o,i)}][n.datatype-1],this.colormap=this.colormap||function(e){return new Ea.Color(e)}}else console.warn('unavailable field "'+this.colorsrc+'" for coloring.')}this.material.isMaterial||(this.colors&&void 0===this.material.vertexColors&&(this.material.vertexColors=Ea.VertexColors),this.material=new Ea.PointsMaterial(this.material)),this.object=new Ea.Points(this.geom,this.material),this.sn=new wc({frameID:e,tfClient:this.tfClient,object:this.object}),this.rootObject.add(this.sn)}return this.messageCount++%this.messageRatio==0}update(e){this.geom.setDrawRange(0,e),this.positions.needsUpdate=!0,this.positions.updateRange.count=e*this.positions.itemSize,this.colors&&(this.colors.needsUpdate=!0,this.colors.updateRange.count=e*this.colors.itemSize)}}class jc extends Ea.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/scan",this.compression=e.compression||"cbor",this.points=new Gc(e),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,compression:this.compression,queue_length:1,messageType:"sensor_msgs/LaserScan"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(this.points.setup(e.header.frame_id)){for(var t=e.ranges.length,i=0,r=0;r<t;r+=this.points.pointRatio){var n=e.ranges[r];if(n>=e.range_min&&n<=e.range_max){var o=e.angle_min+r*e.angle_increment;this.points.positions.array[i++]=n*Math.cos(o),this.points.positions.array[i++]=n*Math.sin(o),this.points.positions.array[i++]=0}}this.points.update(i/3)}}}class Vc extends Ea.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/gps/fix",this.rootObject=e.rootObject||new Ea.Object3D,this.object3d=e.object3d||new Ea.Object3D;var t=e.material||{};this.altitudeNaN=e.altitudeNaN||0,this.keep=e.keep||100,this.convert=e.convert||function(e,t,i){return new Ea.Vector3(e,t,i)},this.count=0,this.next1=0,this.next2=this.keep,this.geom=new Ea.BufferGeometry,this.vertices=new Ea.BufferAttribute(new Float32Array(6*this.keep),3),this.geom.addAttribute("position",this.vertices),this.material=t.isMaterial?t:new Ea.LineBasicMaterial(t),this.line=new Ea.Line(this.geom,this.material),this.rootObject.add(this.object3d),this.rootObject.add(this.line),this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,queue_length:1,messageType:"sensor_msgs/NavSatFix"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=isNaN(e.altitude)?this.altitudeNaN:e.altitude,i=this.convert(e.longitude,e.latitude,t);this.object3d.position.copy(i),this.object3d.updateMatrixWorld(!0),this.vertices.array[3*this.next1]=i.x,this.vertices.array[3*this.next1+1]=i.y,this.vertices.array[3*this.next1+2]=i.z,this.vertices.array[3*this.next2]=i.x,this.vertices.array[3*this.next2+1]=i.y,this.vertices.array[3*this.next2+2]=i.z,this.vertices.needsUpdate=!0,this.next1=(this.next1+1)%this.keep,this.next2=this.next1+this.keep,this.count=Math.min(this.count+1,this.keep),this.geom.setDrawRange(this.next2-this.count,this.count)}}function Hc(e,t,i,r){var n,o=0,s=0,a=0,c=e.length,h=t.length,l=((r=r||1)-1)*(i=i||h)*8;for(n=0;n<c&&a<h;n++)o=(o<<6)+Hc.e[e.charAt(n)],(s+=6)>=8&&(s-=8,t[a++]=o>>>s&255,a%i==0&&(n+=Math.ceil((l-s)/6),(s%=8)>0&&(o=Hc.e[e.charAt(n)])));return Math.floor(a/i)}Hc.S="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Hc.e={};for(var Wc=0;Wc<64;Wc++)Hc.e[Hc.S.charAt(Wc)]=Wc;class Xc extends Ea.Object3D{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/points",this.throttle_rate=e.throttle_rate||null,this.compression=e.compression||"cbor",this.max_pts=e.max_pts||1e4,this.points=new Gc(e),this.rosTopic=void 0,this.buffer=null,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,messageType:"sensor_msgs/PointCloud2",throttle_rate:this.throttle_rate,queue_length:1,compression:this.compression}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){if(this.points.setup(e.header.frame_id,e.point_step,e.fields)){var t,i=this.points.pointRatio,r=this.max_pts*e.point_step;e.data.buffer?(this.buffer=e.data.slice(0,Math.min(e.data.byteLength,r)),t=Math.min(e.height*e.width/i,this.points.positions.array.length/3)):((!this.buffer||this.buffer.byteLength<r)&&(this.buffer=new Uint8Array(r)),t=Hc(e.data,this.buffer,e.point_step,i),i=1);for(var n,o,s=new DataView(this.buffer.buffer),a=!e.is_bigendian,c=this.points.fields.x.offset,h=this.points.fields.y.offset,l=this.points.fields.z.offset,u=0;u<t;u++)n=u*i*e.point_step,this.points.positions.array[3*u]=s.getFloat32(n+c,a),this.points.positions.array[3*u+1]=s.getFloat32(n+h,a),this.points.positions.array[3*u+2]=s.getFloat32(n+l,a),this.points.colors&&(o=this.points.colormap(this.points.getColor(s,n,a)),this.points.colors.array[3*u]=o.r,this.points.colors.array[3*u+1]=o.g,this.points.colors.array[3*u+2]=o.b);this.points.update(t)}}}class qc extends Ea.Object3D{constructor(e){super(),e=e||{},this.frame_id=e.frame_id,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.axes=new Mc({shaftRadius:e.shaftRadius||.025,headRadius:e.headRaidus||.07,headLength:e.headLength||.2,scale:e.scale||1,lineType:e.lineType||"full",lineDashLength:e.lineDashLength||.1}),this.sn=new wc({frameID:this.frame_id,tfClient:this.tfClient,object:this.axes}),this.rootObject.add(this.sn)}}class Yc extends Ea.Object3D{constructor(e){var t=(e=e||{}).urdfModel,i=e.path||"/",r=e.tfClient,n=e.tfPrefix||"",o=e.loader;super();var s=t.links;for(var a in s)for(var c=s[a],h=0;h<c.visuals.length;h++){var l=c.visuals[h];if(l&&l.geometry){var u=n+"/"+c.name,p=null;if(l.material&&l.material.color){var d=l.material&&l.material.color;p=Ta(d.r,d.g,d.b,d.a)}if(l.geometry.type===Na.URDF_MESH){var f=l.geometry.filename,m=f.indexOf("package://");-1!==m&&(f=f.substr(m+"package://".length));var v=f.substr(-3).toLowerCase();if(ka.loaders[v]){var g=new Ba({path:i,resource:f,loader:o,material:p});c.visuals[h].geometry.scale&&g.scale.copy(l.geometry.scale);var y=new wc({frameID:u,pose:l.origin,tfClient:r,object:g});y.name=l.name,this.add(y)}else console.warn("Could not load geometry mesh: "+f)}else{var b=this.createShapeMesh(l,e),x=new wc({frameID:u,pose:l.origin,tfClient:r,object:b});x.name=l.name,this.add(x)}}}}createShapeMesh(e,t){var i,r=null;switch(r||(r=Ta(0,0,0,1)),e.geometry.type){case Na.URDF_BOX:var n=e.geometry.dimension,o=new Ea.BoxGeometry(n.x,n.y,n.z);i=new Ea.Mesh(o,r);break;case Na.URDF_CYLINDER:var s=e.geometry.radius,a=e.geometry.length,c=new Ea.CylinderGeometry(s,s,a,16,1,!1);(i=new Ea.Mesh(c,r)).quaternion.setFromAxisAngle(new Ea.Vector3(1,0,0),.5*Math.PI);break;case Na.URDF_SPHERE:var h=new Ea.SphereGeometry(e.geometry.radius,16);i=new Ea.Mesh(h,r)}return i}unsubscribeTf(){this.children.forEach((function(e){"function"==typeof e.unsubscribeTf&&e.unsubscribeTf()}))}}class Zc{constructor(e){e=e||{},this.mouseHandler=e.mouseHandler,this.hoverObjs={},this.mouseHandler.addEventListener("mouseover",this.onMouseOver.bind(this)),this.mouseHandler.addEventListener("mouseout",this.onMouseOut.bind(this))}onMouseOver(e){this.hoverObjs[e.currentTarget.uuid]=e.currentTarget}onMouseOut(e){var t=e.currentTarget.uuid;t in this.hoverObjs&&delete this.hoverObjs[t]}renderHighlights(e,t,i){this.makeEverythingInvisible(e),this.makeHighlightedVisible(e);var r=e.overrideMaterial;e.overrideMaterial=new Ea.MeshBasicMaterial({fog:!1,opacity:.5,transparent:!0,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetUnits:-1,side:Ea.DoubleSide}),t.render(e,i),e.overrideMaterial=r,this.restoreVisibility(e)}makeEverythingInvisible(e){e.traverse((function(e){(e instanceof Ea.Mesh||e instanceof Ea.Line||e instanceof Ea.Sprite)&&(e.previousVisibility=e.visible,e.visible=!1)}))}makeHighlightedVisible(e){var t=function(e){(e instanceof Ea.Mesh||e instanceof Ea.Line||e instanceof Ea.Sprite)&&(e.visible=!0)};for(var i in this.hoverObjs){var r=this.hoverObjs[i];r.visible=!0,r.traverse(t)}}restoreVisibility(e){e.traverse(function(e){e.hasOwnProperty("previousVisibility")&&(e.visible=e.previousVisibility)}.bind(this))}}class Jc extends Ea.EventDispatcher{constructor(e){super(),this.renderer=e.renderer,this.camera=e.camera,this.rootObject=e.rootObject,this.fallbackTarget=e.fallbackTarget,this.lastTarget=this.fallbackTarget,this.dragging=!1;this.listeners={},["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"].forEach((function(e){this.listeners[e]=this.processDomEvent.bind(this),this.renderer.domElement.addEventListener(e,this.listeners[e],!1)}),this)}processDomEvent(e){e.preventDefault();var t,i,r=e.target,n=r.getBoundingClientRect();if(-1!==e.type.indexOf("touch")){t=0,i=0;for(var o=0;o<e.touches.length;++o)t+=e.touches[o].clientX,i+=e.touches[o].clientY;t/=e.touches.length,i/=e.touches.length}else t=e.clientX,i=e.clientY;var s=t-n.left-r.clientLeft+r.scrollLeft,a=i-n.top-r.clientTop+r.scrollTop,c=s/r.clientWidth*2-1,h=-a/r.clientHeight*2+1,l=new Ea.Vector2(c,h),u=new Ea.Raycaster;u.linePrecision=.001,u.setFromCamera(l,this.camera);var p={mousePos:l,mouseRay:u.ray,domEvent:e,camera:this.camera,intersection:this.lastIntersection};if("mouseout"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",p),this.dragging=!1),this.notify(this.lastTarget,"mouseout",p),void(this.lastTarget=null);if("touchleave"===e.type||"touchend"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",p),this.dragging=!1),this.notify(this.lastTarget,"touchend",p),void(this.lastTarget=null);if(this.dragging)return this.notify(this.lastTarget,e.type,p),void(("mouseup"===e.type&&2===e.button||"click"===e.type||"touchend"===e.type)&&(this.dragging=!1));r=this.lastTarget;var d;if((d=u.intersectObject(this.rootObject,!0)).length>0?(r=d[0].object,p.intersection=this.lastIntersection=d[0]):r=this.fallbackTarget,r!==this.lastTarget&&e.type.match(/mouse/)){var f=this.notify(r,"mouseover",p);0===f?this.notify(this.lastTarget,"mouseout",p):1===f&&(r=this.fallbackTarget)!==this.lastTarget&&(this.notify(r,"mouseover",p),this.notify(this.lastTarget,"mouseout",p))}r!==this.lastTarget&&e.type.match(/touch/)&&(this.notify(r,e.type,p)?(this.notify(this.lastTarget,"touchleave",p),this.notify(this.lastTarget,"touchend",p)):(r=this.fallbackTarget)!==this.lastTarget&&(this.notify(this.lastTarget,"touchmove",p),this.notify(this.lastTarget,"touchend",p)));this.notify(r,e.type,p),"mousedown"!==e.type&&"touchstart"!==e.type&&"touchmove"!==e.type||(this.dragging=!0),this.lastTarget=r}notify(e,t,i){for(i.type=t,i.cancelBubble=!1,i.continueBubble=!1,i.stopPropagation=function(){i.cancelBubble=!0},i.continuePropagation=function(){i.continueBubble=!0},i.currentTarget=e;i.currentTarget;){if(i.currentTarget.dispatchEvent&&i.currentTarget.dispatchEvent instanceof Function){if(i.currentTarget.dispatchEvent(i),i.cancelBubble)return this.dispatchEvent(i),0;if(i.continueBubble)return 2}i.currentTarget=i.currentTarget.parent}return 1}}class Qc extends Ea.EventDispatcher{constructor(e){super();var t=this,i=(e=e||{}).scene;this.camera=e.camera,this.center=new Ea.Vector3,this.userZoom=!0,this.userZoomSpeed=e.userZoomSpeed||1,this.userRotate=!0,this.userRotateSpeed=e.userRotateSpeed||1,this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed||2,this.displayPanAndZoomFrame=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,this.lineTypePanAndZoomFrame=e.dashedPanAndZoomFrame||"full",this.camera.up=new Ea.Vector3(0,0,1);var r=1800,n=new Ea.Vector2,o=new Ea.Vector2,s=new Ea.Vector2,a=new Ea.Vector2,c=new Ea.Vector2,h=new Ea.Vector2,l=new Ea.Vector3,u=new Ea.Vector3,p=new Ea.Vector3,d=new Ea.Vector3,f=new Array(2),m=new Array(2);this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.lastPosition=new Ea.Vector3;var v=-1,g=0,y=1,b=2,x=v;function w(e,t,i){var r=new Ea.Vector3;new Ea.Vector3;r.subVectors(t,e.origin);var n=e.direction.dot(i);if(Math.abs(n)<e.precision)return null;var o=i.dot(r)/n;return e.direction.clone().multiplyScalar(o)}function _(e){if(t.userZoom){var i=e.domEvent;(void 0!==i.wheelDelta?i.wheelDelta:-i.detail)>0?t.zoomIn():t.zoomOut(),this.showAxes()}}this.axes=new Mc({shaftRadius:.025,headRadius:.07,headLength:.2,lineType:this.lineTypePanAndZoomFrame}),this.displayPanAndZoomFrame&&(i.add(this.axes),this.axes.traverse((function(e){e.visible=!1}))),this.addEventListener("mousedown",(function(e){var i=e.domEvent;switch(i.preventDefault(),i.button){case 0:x=g,n.set(i.clientX,i.clientY);break;case 1:x=b,u=new Ea.Vector3(0,0,1);var r=(new Ea.Matrix4).extractRotation(this.camera.matrix);u.applyMatrix4(r),l=t.center.clone(),p=t.camera.position.clone(),d=w(e.mouseRay,l,u);break;case 2:x=y,a.set(i.clientX,i.clientY)}this.showAxes()})),this.addEventListener("mouseup",(function(e){t.userRotate&&(x=v)})),this.addEventListener("mousemove",(function(e){var i=e.domEvent;if(x===g)o.set(i.clientX,i.clientY),s.subVectors(o,n),t.rotateLeft(2*Math.PI*s.x/r*t.userRotateSpeed),t.rotateUp(2*Math.PI*s.y/r*t.userRotateSpeed),n.copy(o),this.showAxes();else if(x===y)c.set(i.clientX,i.clientY),h.subVectors(c,a),h.y>0?t.zoomIn():t.zoomOut(),a.copy(c),this.showAxes();else if(x===b){var f=w(e.mouseRay,t.center,u);if(!f)return;var m=(new Ea.Vector3).subVectors(d.clone(),f.clone());t.center.addVectors(l.clone(),m.clone()),t.camera.position.addVectors(p.clone(),m.clone()),t.update(),t.camera.updateMatrixWorld(),this.showAxes()}})),this.addEventListener("touchstart",(function(e){var i=e.domEvent;switch(i.touches.length){case 1:x=g,n.set(i.touches[0].pageX-window.scrollX,i.touches[0].pageY-window.scrollY);break;case 2:x=v,u=new Ea.Vector3(0,0,1);var r=(new Ea.Matrix4).extractRotation(this.camera.matrix);u.applyMatrix4(r),l=t.center.clone(),p=t.camera.position.clone(),d=w(e.mouseRay,l,u),f[0]=new Ea.Vector2(i.touches[0].pageX,i.touches[0].pageY),f[1]=new Ea.Vector2(i.touches[1].pageX,i.touches[1].pageY),m[0]=new Ea.Vector2(0,0),m[1]=new Ea.Vector2(0,0)}this.showAxes(),i.preventDefault()})),this.addEventListener("touchmove",(function(e){var i=e.domEvent;if(x===g)o.set(i.touches[0].pageX-window.scrollX,i.touches[0].pageY-window.scrollY),s.subVectors(o,n),t.rotateLeft(2*Math.PI*s.x/r*t.userRotateSpeed),t.rotateUp(2*Math.PI*s.y/r*t.userRotateSpeed),n.copy(o),this.showAxes();else{if(m[0].set(f[0].x-i.touches[0].pageX,f[0].y-i.touches[0].pageY),m[1].set(f[1].x-i.touches[1].pageX,f[1].y-i.touches[1].pageY),m[0].lengthSq()>10&&m[1].lengthSq()>10&&(f[0].set(i.touches[0].pageX,i.touches[0].pageY),f[1].set(i.touches[1].pageX,i.touches[1].pageY),m[0].dot(m[1])>0&&x!==y?x=b:m[0].dot(m[1])<0&&x!==b&&(x=y),x===y)){var a=new Ea.Vector2;a.subVectors(f[0],f[1]),m[0].dot(a)<0&&m[1].dot(a)>0?t.zoomOut():m[0].dot(a)>0&&m[1].dot(a)<0&&t.zoomIn()}if(x===b){var c=w(e.mouseRay,t.center,u);if(!c)return;var h=(new Ea.Vector3).subVectors(d.clone(),c.clone());t.center.addVectors(l.clone(),h.clone()),t.camera.position.addVectors(p.clone(),h.clone()),t.update(),t.camera.updateMatrixWorld()}this.showAxes(),i.preventDefault()}})),this.addEventListener("touchend",(function(e){var t=e.domEvent;1===t.touches.length&&x!==g?(x=g,n.set(t.touches[0].pageX-window.scrollX,t.touches[0].pageY-window.scrollY)):x=v})),this.addEventListener("mousewheel",_),this.addEventListener("DOMMouseScroll",_)}showAxes(){var e=this;this.axes.traverse((function(e){e.visible=!0})),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout((function(){e.axes.traverse((function(e){e.visible=!1})),e.hideTimeout=!1}),1e3)}rotateLeft(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta-=e}rotateRight(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta+=e}rotateUp(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=e}rotateDown(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta+=e}zoomIn(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale/=e}zoomOut(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale*=e}update(){var e=this.camera.position,t=e.clone().sub(this.center),i=Math.atan2(t.y,t.x),r=Math.atan2(Math.sqrt(t.y*t.y+t.x*t.x),t.z);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed),i+=this.thetaDelta,r+=this.phiDelta;var n=1e-6;r=Math.max(n,Math.min(Math.PI-n,r));var o=t.length();t.set(o*Math.sin(r)*Math.cos(i),o*Math.sin(r)*Math.sin(i),o*Math.cos(r)),t.multiplyScalar(this.scale),e.copy(this.center).add(t),this.camera.lookAt(this.center),o=t.length(),this.axes.position.copy(this.center),this.axes.scale.set(.05*o,.05*o,.05*o),this.axes.updateMatrixWorld(!0),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.lastPosition.distanceTo(this.camera.position)>0&&(this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.camera.position))}}return e.Arrow=Oa,e.Arrow2=_c,e.Axes=Mc,e.ColorOcTree=Oc,e.DepthCloud=Ra,e.Grid=Ec,e.Highlighter=Zc,e.INTERACTIVE_MARKER_BUTTON=2,e.INTERACTIVE_MARKER_BUTTON_CLICK=3,e.INTERACTIVE_MARKER_FIXED=1,e.INTERACTIVE_MARKER_INHERIT=0,e.INTERACTIVE_MARKER_KEEP_ALIVE=0,e.INTERACTIVE_MARKER_MENU=1,e.INTERACTIVE_MARKER_MENU_SELECT=2,e.INTERACTIVE_MARKER_MOUSE_DOWN=4,e.INTERACTIVE_MARKER_MOUSE_UP=5,e.INTERACTIVE_MARKER_MOVE_3D=7,e.INTERACTIVE_MARKER_MOVE_AXIS=3,e.INTERACTIVE_MARKER_MOVE_PLANE=4,e.INTERACTIVE_MARKER_MOVE_ROTATE=6,e.INTERACTIVE_MARKER_MOVE_ROTATE_3D=9,e.INTERACTIVE_MARKER_NONE=0,e.INTERACTIVE_MARKER_POSE_UPDATE=1,e.INTERACTIVE_MARKER_ROTATE_3D=8,e.INTERACTIVE_MARKER_ROTATE_AXIS=5,e.INTERACTIVE_MARKER_VIEW_FACING=2,e.InteractiveMarker=Ha,e.InteractiveMarkerClient=class{constructor(e){e=e||{},this.ros=e.ros,this.tfClient=e.tfClient,this.topicName=e.topic,this.path=e.path||"/",this.camera=e.camera,this.rootObject=e.rootObject||new Ea.Object3D,this.loader=e.loader,this.menuFontSize=e.menuFontSize||"0.8em",this.interactiveMarkers={},this.updateTopic=null,this.feedbackTopic=null,this.topicName&&this.subscribe(this.topicName)}subscribe(e){this.unsubscribe(),this.updateTopic=new Na.Topic({ros:this.ros,name:e+"/tunneled/update",messageType:"visualization_msgs/InteractiveMarkerUpdate",compression:"png"}),this.updateTopic.subscribe(this.processUpdate.bind(this)),this.feedbackTopic=new Na.Topic({ros:this.ros,name:e+"/feedback",messageType:"visualization_msgs/InteractiveMarkerFeedback",compression:"png"}),this.feedbackTopic.advertise(),this.initService=new Na.Service({ros:this.ros,name:e+"/tunneled/get_init",serviceType:"demo_interactive_markers/GetInit"});var t=new Na.ServiceRequest({});this.initService.callService(t,this.processInit.bind(this))}unsubscribe(){for(var e in this.updateTopic&&this.updateTopic.unsubscribe(),this.feedbackTopic&&this.feedbackTopic.unadvertise(),this.interactiveMarkers)this.eraseIntMarker(e);this.interactiveMarkers={}}processInit(e){var t=e.msg;for(var i in t.erases=[],this.interactiveMarkers)t.erases.push(i);t.poses=[],this.processUpdate(t)}processUpdate(e){var t=this;e.erases.forEach((function(e){t.eraseIntMarker(e)})),e.poses.forEach((function(e){var i=t.interactiveMarkers[e.name];i&&i.setPoseFromServer(e.pose)})),e.markers.forEach((function(e){var i=t.interactiveMarkers[e.name];i&&t.eraseIntMarker(i.name);var r=new xc({message:e,feedbackTopic:t.feedbackTopic,tfClient:t.tfClient,menuFontSize:t.menuFontSize});t.interactiveMarkers[e.name]=r;var n=new Ha({handle:r,camera:t.camera,path:t.path,loader:t.loader});n.name=e.name,t.rootObject.add(n),r.on("pose",(function(e){n.onServerSetPose({pose:e})})),n.addEventListener("user-pose-change",r.setPoseFromClientBound),n.addEventListener("user-mousedown",r.onMouseDownBound),n.addEventListener("user-mouseup",r.onMouseUpBound),n.addEventListener("user-button-click",r.onButtonClickBound),n.addEventListener("menu-select",r.onMenuSelectBound),r.subscribeTf()}))}eraseIntMarker(e){if(this.interactiveMarkers[e]){var t=this.rootObject.getObjectByName(e);this.rootObject.remove(t);var i=this.interactiveMarkers[e];i.unsubscribeTf(),t.removeEventListener("user-pose-change",i.setPoseFromClientBound),t.removeEventListener("user-mousedown",i.onMouseDownBound),t.removeEventListener("user-mouseup",i.onMouseUpBound),t.removeEventListener("user-button-click",i.onButtonClickBound),t.removeEventListener("menu-select",i.onMenuSelectBound),delete this.interactiveMarkers[e],t.dispose()}}},e.InteractiveMarkerControl=ja,e.InteractiveMarkerHandle=xc,e.InteractiveMarkerMenu=Va,e.LaserScan=jc,e.MARKER_ARROW=0,e.MARKER_CUBE=1,e.MARKER_CUBE_LIST=6,e.MARKER_CYLINDER=3,e.MARKER_LINE_LIST=5,e.MARKER_LINE_STRIP=4,e.MARKER_MESH_RESOURCE=10,e.MARKER_POINTS=8,e.MARKER_SPHERE=2,e.MARKER_SPHERE_LIST=7,e.MARKER_TEXT_VIEW_FACING=9,e.MARKER_TRIANGLE_LIST=11,e.Marker=Ga,e.MarkerArrayClient=class extends bc{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.path=e.path||"/",this.markers={},this.rosTopic=void 0,this.subscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/MarkerArray",compression:"png"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){e.markers.forEach(function(e){if(0===e.action){var t=!1;if(e.ns+e.id in this.markers&&((t=this.markers[e.ns+e.id].children[0].update(e))||this.removeMarker(e.ns+e.id)),!t){var i=new Ga({message:e,path:this.path});this.markers[e.ns+e.id]=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[e.ns+e.id])}}else if(1===e.action)console.warn('Received marker message with deprecated action identifier "1"');else if(2===e.action)this.removeMarker(e.ns+e.id);else if(3===e.action){for(var r in this.markers)this.removeMarker(r);this.markers={}}else console.warn('Received marker message with unknown action identifier "'+e.action+'"')}.bind(this)),this.emit("change")}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}},e.MarkerClient=class extends bc{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.path=e.path||"/",this.lifetime=e.lifetime||0,this.markers={},this.rosTopic=void 0,this.updatedTime={},this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}checkTime(e){if((new Date).getTime()-this.updatedTime[e]>this.lifetime)this.removeMarker(e),this.emit("change");else{var t=this;setTimeout((function(){t.checkTime(e)}),100)}}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,messageType:"visualization_msgs/Marker",compression:"png"}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){var t=this.markers[e.ns+e.id];if(this.updatedTime[e.ns+e.id]=(new Date).getTime(),t?this.removeMarker(e.ns+e.id):this.lifetime&&this.checkTime(e.ns+e.id),0===e.action){var i=new Ga({message:e,path:this.path});this.markers[e.ns+e.id]=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:i}),this.rootObject.add(this.markers[e.ns+e.id])}this.emit("change")}removeMarker(e){var t=this.markers[e];t&&(t.unsubscribeTf(),this.rootObject.remove(t),t.children.forEach((e=>{e.dispose()})),delete this.markers[e])}},e.MeshLoader=ka,e.MeshResource=Ba,e.MouseHandler=Jc,e.NavSatFix=Vc,e.OcTree=Nc,e.OcTreeClient=class extends bc{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/octomap",this.compression=e.compression||"cbor",this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.offsetPose=e.offsetPose||new Na.Pose,this.options={},void 0!==e.color&&(this.options.color=e.color),void 0!==e.opacity&&(this.options.opacity=e.opacity),void 0!==e.colorMode&&(this.options.colorMode=e.colorMode),void 0!==e.palette&&(this.options.palette=e.palette),void 0!==e.paletteScale&&(this.options.paletteScale=e.palette),void 0!==e.voxelRenderMode&&(this.options.voxelRenderMode=e.voxelRenderMode),this.currentMap=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}_MESSAGE_TYPE="octomap_msgs/Octomap";subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,messageType:this._MESSAGE_TYPE,queue_length:1,compression:this.compression}),this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentMap&&this.currentMap.tfClient&&this.currentMap.unsubscribeTf(),this._processMessagePrivate(e),this.continuous||this.rosTopic.unsubscribe()}_loadOcTree(e){return new Promise(function(t,i){const r=Object.assign({resolution:e.resolution},this.options);let n=null;if(e.binary)n=new Cc(r),n.readBinary(e.data);else{const t={OcTree:Nc,ColorOcTree:Oc};e.id in t&&(console.log(e.id,t),n=new t[e.id](r),n.read(e.data))}n.buildGeometry(),t(n)}.bind(this))}_processMessagePrivate(e){this._loadOcTree(e).then(function(t){const i=this.sceneNode;this.tfClient?(this.currentMap=t,this.sceneNode=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:t.object,pose:this.offsetPose})):(this.sceneNode=t.object,this.currentMap=t),this.rootObject.remove(i),this.rootObject.add(this.sceneNode),this.emit("change")}.bind(this))}},e.OcTreeColorMode=Pc,e.OccupancyGrid=Tc,e.OccupancyGridClient=class extends bc{constructor(e){super(),e=e||{},this.ros=e.ros,this.topicName=e.topic||"/map",this.compression=e.compression||"cbor",this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.offsetPose=e.offsetPose||new Na.Pose,this.color=e.color||{r:255,g:255,b:255},this.opacity=e.opacity||1,this.currentGrid=null,this.rosTopic=void 0,this.subscribe()}unsubscribe(){this.rosTopic&&this.rosTopic.unsubscribe()}subscribe(){this.unsubscribe(),this.rosTopic=new Na.Topic({ros:this.ros,name:this.topicName,messageType:"nav_msgs/OccupancyGrid",queue_length:1,compression:this.compression}),this.sceneNode=null,this.rosTopic.subscribe(this.processMessage.bind(this))}processMessage(e){this.currentGrid&&(this.currentGrid.tfClient&&this.currentGrid.unsubscribeTf(),this.sceneNode.remove(this.currentGrid),this.currentGrid.dispose());var t=new Tc({message:e,color:this.color,opacity:this.opacity});this.tfClient?(this.currentGrid=t,null===this.sceneNode?(this.sceneNode=new wc({frameID:e.header.frame_id,tfClient:this.tfClient,object:t,pose:this.offsetPose}),this.rootObject.add(this.sceneNode)):this.sceneNode.add(this.currentGrid)):(this.sceneNode=this.currentGrid=t,this.rootObject.add(this.currentGrid)),this.emit("change"),this.continuous||this.rosTopic.unsubscribe()}},e.Odometry=Ic,e.OrbitControls=Qc,e.Path=Dc,e.Point=Uc,e.PointCloud2=Xc,e.Points=Gc,e.Polygon=Fc,e.Pose=kc,e.PoseArray=Bc,e.PoseWithCovariance=zc,e.REVISION="1.0.1",e.SceneNode=wc,e.TFAxes=qc,e.TriangleList=za,e.Urdf=Yc,e.UrdfClient=class{constructor(e){var t=this,i=(e=e||{}).ros;this.param=e.param||"robot_description",this.path=e.path||"/",this.tfClient=e.tfClient,this.rootObject=e.rootObject||new Ea.Object3D,this.tfPrefix=e.tfPrefix||"",this.loader=e.loader,new Na.Param({ros:i,name:this.param}).get((function(e){var i=new Na.UrdfModel({string:e});t.urdf=new Yc({urdfModel:i,path:t.path,tfClient:t.tfClient,tfPrefix:t.tfPrefix,loader:t.loader}),t.rootObject.add(t.urdf)}))}},e.Viewer=class{constructor(e){var t=(e=e||{}).divID,i=e.elem,r=e.width,n=e.height,o=e.background||"#111111",s=e.antialias,a=e.intensity||.66,c=e.near||.01,h=e.far||1e3,l=e.alpha||1,u=e.cameraPose||{x:3,y:3,z:3},p=e.cameraZoomSpeed||.5,d=void 0===e.displayPanAndZoomFrame||!!e.displayPanAndZoomFrame,f=e.lineTypePanAndZoomFrame||"full";this.renderer=new Ea.WebGLRenderer({antialias:s,alpha:!0}),this.renderer.setClearColor(parseInt(o.replace("#","0x"),16),l),this.renderer.sortObjects=!1,this.renderer.setSize(r,n),this.renderer.shadowMap.enabled=!1,this.renderer.autoClear=!1,this.scene=new Ea.Scene,this.camera=new Ea.PerspectiveCamera(40,r/n,c,h),this.camera.position.x=u.x,this.camera.position.y=u.y,this.camera.position.z=u.z,this.cameraControls=new Qc({scene:this.scene,camera:this.camera,displayPanAndZoomFrame:d,lineTypePanAndZoomFrame:f}),this.cameraControls.userZoomSpeed=p,this.scene.add(new Ea.AmbientLight(5592405)),this.directionalLight=new Ea.DirectionalLight(16777215,a),this.scene.add(this.directionalLight),this.selectableObjects=new Ea.Group,this.scene.add(this.selectableObjects);var m=new Jc({renderer:this.renderer,camera:this.camera,rootObject:this.selectableObjects,fallbackTarget:this.cameraControls});this.highlighter=new Zc({mouseHandler:m}),this.stopped=!0,this.animationRequestId=void 0,(i||document.getElementById(t)).appendChild(this.renderer.domElement),this.start()}start(){this.stopped=!1,this.draw()}draw(){this.stopped||(this.cameraControls.update(),this.directionalLight.position.normalize(),this.renderer.clear(!0,!0,!0),this.renderer.render(this.scene,this.camera),this.highlighter.renderHighlights(this.scene,this.renderer,this.camera),this.animationRequestId=requestAnimationFrame(this.draw.bind(this)))}stop(){this.stopped||cancelAnimationFrame(this.animationRequestId),this.stopped=!0}addObject(e,t){t?this.selectableObjects.add(e):this.scene.add(e)}resize(e,t){this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t)}},e.closestAxisPoint=La,e.findClosestPoint=Aa,e.intersectPlane=Sa,e.makeColorMaterial=Ta,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
