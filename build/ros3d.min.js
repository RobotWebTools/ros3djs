var ROS3D=ROS3D||{REVISION:"1"};ROS3D.MARKER_ARROW=0;ROS3D.MARKER_CUBE=1;ROS3D.MARKER_SPHERE=2;ROS3D.MARKER_CYLINDER=3;ROS3D.MARKER_LINE_STRIP=4;ROS3D.MARKER_LINE_LIST=5;ROS3D.MARKER_CUBE_LIST=6;ROS3D.MARKER_SPHERE_LIST=7;ROS3D.MARKER_POINTS=8;ROS3D.MARKER_TEXT_VIEW_FACING=9;ROS3D.MARKER_MESH_RESOURCE=10;ROS3D.MARKER_TRIANGLE_LIST=11;ROS3D.INTERACTIVE_MARKER_KEEP_ALIVE=0;ROS3D.INTERACTIVE_MARKER_POSE_UPDATE=1;ROS3D.INTERACTIVE_MARKER_MENU_SELECT=2;ROS3D.INTERACTIVE_MARKER_BUTTON_CLICK=3;ROS3D.INTERACTIVE_MARKER_MOUSE_DOWN=4;ROS3D.INTERACTIVE_MARKER_MOUSE_UP=5;ROS3D.INTERACTIVE_MARKER_NONE=0;ROS3D.INTERACTIVE_MARKER_MENU=1;ROS3D.INTERACTIVE_MARKER_BUTTON=2;ROS3D.INTERACTIVE_MARKER_MOVE_AXIS=3;ROS3D.INTERACTIVE_MARKER_MOVE_PLANE=4;ROS3D.INTERACTIVE_MARKER_ROTATE_AXIS=5;ROS3D.INTERACTIVE_MARKER_MOVE_ROTATE=6;ROS3D.INTERACTIVE_MARKER_INHERIT=0;ROS3D.INTERACTIVE_MARKER_FIXED=1;ROS3D.INTERACTIVE_MARKER_VIEW_FACING=2;ROS3D.makeColorMaterial=function(h,f,c,d){var e=new THREE.Color();e.setRGB(h,f,c);if(d<=0.99){return new THREE.MeshBasicMaterial({color:e.getHex(),opacity:d+0.1,transparent:true,depthWrite:true,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendEquation:THREE.ReverseSubtractEquation,blending:THREE.NormalBlending})}else{return new THREE.MeshLambertMaterial({color:e.getHex(),opacity:d,blending:THREE.NormalBlending})}};ROS3D.intersectPlane=function(d,a,e){var b=new THREE.Vector3();var c=new THREE.Vector3();b.subVectors(a,d.origin);dot=d.direction.dot(e);if(Math.abs(dot)<d.precision){return undefined}scalar=e.dot(b)/dot;c.addVectors(d.origin,d.direction.clone().multiplyScalar(scalar));return c};ROS3D.findClosestPoint=function(o,n){var g=new THREE.Vector3;g.subVectors(o.origin,n.origin);var e=n.direction.clone();var b=o.direction.clone();var c=g.dot(e);var d=e.dot(b);var a=g.dot(b);var l=e.dot(e);var f=b.dot(b);var k=f*l-d*d;if(Math.abs(k)<=0.0001){return undefined}var h=c*d-a*l;var m=h/k;return m};ROS3D.closestAxisPoint=function(a,k,n){var m=new THREE.Projector();var c=a.origin.clone();m.projectVector(c,k);var g=a.direction.clone().add(a.origin);m.projectVector(g,k);var l=g.clone().sub(c);var h=new THREE.Vector2;var p=h.subVectors(n,c).dot(l)/l.dot(l);var f=new THREE.Vector2;f.addVectors(c,l.clone().multiplyScalar(p));var e=new THREE.Vector3(f.x,f.y,0.5);m.unprojectVector(e,k);var b=new THREE.Ray(k.position,e.sub(k.position).normalize());return ROS3D.findClosestPoint(a,b)};ROS3D.InteractiveMarker=function(a){THREE.Object3D.call(this);THREE.EventDispatcher.call(this);var c=this;var a=a||{};var d=a.handle;this.name=d.name;var b=a.camera;var e=a.path||"/";this.dragging=false;this.onServerSetPose({pose:d.pose});this.dragStart={position:new THREE.Vector3(),orientation:new THREE.Quaternion(),positionWorld:new THREE.Vector3(),orientationWorld:new THREE.Quaternion(),event3d:{}};d.controls.forEach(function(f){c.add(new ROS3D.InteractiveMarkerControl({parent:c,message:f,camera:b,path:e}))});if(d.menuEntries.length>0){this.menu=new ROS3D.InteractiveMarkerMenu({menuEntries:d.menuEntries});this.menu.addEventListener("menu-select",function(f){c.dispatchEvent(f)})}};ROS3D.InteractiveMarker.prototype.__proto__=THREE.Object3D.prototype;ROS3D.InteractiveMarker.prototype.showMenu=function(b,a){if(this.menu){this.menu.show(b,a)}};ROS3D.InteractiveMarker.prototype.moveAxis=function(e,h,f){if(this.dragging){var d=e.currentControlOri;var c=h.clone().applyQuaternion(d);var g=this.dragStart.event3d.intersection.point;var l=c.clone().applyQuaternion(this.dragStart.orientationWorld.clone());var a=new THREE.Ray(g,l);var k=ROS3D.closestAxisPoint(a,f.camera,f.mousePos);var b=new THREE.Vector3;b.addVectors(this.dragStart.position,c.clone().applyQuaternion(this.dragStart.orientation).multiplyScalar(k));this.setPosition(e,b);f.stopPropagation()}};ROS3D.InteractiveMarker.prototype.movePlane=function(d,g,h){if(this.dragging){var c=d.currentControlOri;var f=g.clone().applyQuaternion(c);var k=this.dragStart.event3d.intersection.point;var e=f.clone().applyQuaternion(this.dragStart.orientationWorld);var a=ROS3D.intersectPlane(h.mouseRay,k,e);var b=new THREE.Vector3;b.subVectors(a,k);b.add(this.dragStart.positionWorld);this.setPosition(d,b);h.stopPropagation()}};ROS3D.InteractiveMarker.prototype.rotateAxis=function(l,g,c){if(this.dragging){l.updateMatrixWorld();var q=l.currentControlOri;var e=q.clone().multiply(g.clone());var t=(new THREE.Vector3(1,0,0)).applyQuaternion(e);var n=this.dragStart.event3d.intersection.point;var f=t.applyQuaternion(this.dragStart.orientationWorld);var k=ROS3D.intersectPlane(c.mouseRay,n,f);var b=new THREE.Ray(this.dragStart.positionWorld,f);var d=ROS3D.intersectPlane(b,n,f);var m=this.dragStart.orientationWorld.clone().multiply(e);var p=m.clone().inverse();k.sub(d);k.applyQuaternion(p);var o=this.dragStart.event3d.intersection.point.clone();o.sub(d);o.applyQuaternion(p);var u=Math.atan2(k.y,k.z);var s=Math.atan2(o.y,o.z);var r=s-u;var h=new THREE.Quaternion();h.setFromAxisAngle(t,r);this.setOrientation(l,h.multiply(this.dragStart.orientationWorld));c.stopPropagation()}};ROS3D.InteractiveMarker.prototype.feedbackEvent=function(a,b){this.dispatchEvent({type:a,position:this.position.clone(),orientation:this.quaternion.clone(),controlName:b.name})};ROS3D.InteractiveMarker.prototype.startDrag=function(b,a){if(a.domEvent.button===0){a.stopPropagation();this.dragging=true;this.updateMatrixWorld(true);var c=new THREE.Vector3();this.matrixWorld.decompose(this.dragStart.positionWorld,this.dragStart.orientationWorld,c);this.dragStart.position=this.position.clone();this.dragStart.orientation=this.quaternion.clone();this.dragStart.event3d=a;this.feedbackEvent("user-mousedown",b)}};ROS3D.InteractiveMarker.prototype.stopDrag=function(b,a){if(a.domEvent.button===0){a.stopPropagation();this.dragging=false;this.dragStart.event3d={};this.onServerSetPose(this.bufferedPoseEvent);this.bufferedPoseEvent=undefined;this.feedbackEvent("user-mouseup",b)}};ROS3D.InteractiveMarker.prototype.buttonClick=function(b,a){a.stopPropagation();this.feedbackEvent("user-button-click",b)};ROS3D.InteractiveMarker.prototype.setPosition=function(b,a){this.position=a;this.feedbackEvent("user-pose-change",b)};ROS3D.InteractiveMarker.prototype.setOrientation=function(b,a){a.normalize();this.quaternion=a;this.feedbackEvent("user-pose-change",b)};ROS3D.InteractiveMarker.prototype.onServerSetPose=function(a){if(a!==undefined){if(this.dragging){this.bufferedPoseEvent=a}else{var b=a.pose;this.position.x=b.position.x;this.position.y=b.position.y;this.position.z=b.position.z;this.useQuaternion=true;this.quaternion=new THREE.Quaternion(b.orientation.x,b.orientation.y,b.orientation.z,b.orientation.w);this.updateMatrixWorld(true)}}};ROS3D.InteractiveMarkerClient=function(a){var b=this;var a=a||{};this.ros=a.ros;this.tfClient=a.tfClient;this.topic=a.topic;this.path="";this.camera=a.camera;this.rootObject=a.rootObject||new THREE.Object3D();this.interactiveMarkers={};this.updateTopic=null;this.feedbackTopic=null;if(this.topic){this.subscribe(this.topic)}};ROS3D.InteractiveMarkerClient.prototype.subscribe=function(a){this.unsubscribe();this.updateTopic=new ROSLIB.Topic({ros:this.ros,name:a+"/tunneled/update",messageType:"visualization_msgs/InteractiveMarkerUpdate",compression:"png"});this.updateTopic.subscribe(this.processUpdate.bind(this));this.feedbackTopic=new ROSLIB.Topic({ros:this.ros,name:a+"/feedback",messageType:"visualization_msgs/InteractiveMarkerFeedback",compression:"png"});this.feedbackTopic.advertise();this.initService=new ROSLIB.Service({ros:this.ros,name:a+"/tunneled/get_init",serviceType:"demo_interactive_markers/GetInit"});var b=new ROSLIB.ServiceRequest({});this.initService.callService(b,this.processInit.bind(this))};ROS3D.InteractiveMarkerClient.prototype.unsubscribe=function(){if(this.updateTopic){this.updateTopic.unsubscribe()}if(this.feedbackTopic){this.feedbackTopic.unadvertise()}for(intMarkerName in this.interactiveMarkers){this.eraseIntMarker(intMarkerName)}this.interactiveMarkers={}};ROS3D.InteractiveMarkerClient.prototype.processInit=function(b){var a=b.msg;a.erases=[];for(intMarkerName in this.interactiveMarkers){a.erases.push(intMarkerName)}a.poses=[];this.processUpdate(a)};ROS3D.InteractiveMarkerClient.prototype.processUpdate=function(b){var a=this;b.erases.forEach(function(d){var c=a.interactiveMarkers[d];a.eraseIntMarker(d)});b.poses.forEach(function(d){var c=a.interactiveMarkers[d.name];if(c){c.setPoseFromServer(d.pose)}});b.markers.forEach(function(f){var e=a.interactiveMarkers[f.name];if(e){a.eraseIntMarker(e.name)}var d=new ROS3D.InteractiveMarkerHandle({message:f,feedbackTopic:a.feedbackTopic,tfClient:a.tfClient});a.interactiveMarkers[f.name]=d;var c=new ROS3D.InteractiveMarker({handle:d,camera:a.camera,path:a.path});a.rootObject.add(c);d.on("pose",function(g){c.onServerSetPose({pose:g})});c.addEventListener("user-pose-change",d.setPoseFromClient.bind(d));c.addEventListener("user-mousedown",d.onMouseDown.bind(d));c.addEventListener("user-mouseup",d.onMouseUp.bind(d));c.addEventListener("user-button-click",d.onButtonClick.bind(d));c.addEventListener("menu-select",d.onMenuSelect.bind(d));d.subscribeTf()})};ROS3D.InteractiveMarkerClient.prototype.eraseIntMarker=function(a){if(this.interactiveMarkers[a]){delete this.interactiveMarkers[a]}};ROS3D.InteractiveMarkerControl=function(k){var e=this;THREE.Object3D.call(this);THREE.EventDispatcher.call(this);var k=k||{};this.parent=k.parent;var h=k.message;this.name=h.name;this.camera=k.camera;this.path=k.path||"/";this.dragging=false;var a=new THREE.Quaternion(h.orientation.x,h.orientation.y,h.orientation.z,h.orientation.w);a.normalize();var f=new THREE.Vector3(1,0,0);f.applyQuaternion(a);this.currentControlOri=new THREE.Quaternion();switch(h.interaction_mode){case ROS3D.INTERACTIVE_MARKER_MOVE_AXIS:this.addEventListener("mousemove",this.parent.moveAxis.bind(this.parent,this,f));this.addEventListener("touchmove",this.parent.moveAxis.bind(this.parent,this,f));break;case ROS3D.INTERACTIVE_MARKER_ROTATE_AXIS:this.addEventListener("mousemove",this.parent.rotateAxis.bind(this.parent,this,a));break;case ROS3D.INTERACTIVE_MARKER_MOVE_PLANE:this.addEventListener("mousemove",this.parent.movePlane.bind(this.parent,this,f));break;case ROS3D.INTERACTIVE_MARKER_BUTTON:this.addEventListener("click",this.parent.buttonClick.bind(this.parent,this));break;default:break}function g(l){l.stopPropagation()}if(h.interaction_mode!=ROS3D.INTERACTIVE_MARKER_NONE){this.addEventListener("mousedown",this.parent.startDrag.bind(this.parent,this));this.addEventListener("mouseup",this.parent.stopDrag.bind(this.parent,this));this.addEventListener("contextmenu",this.parent.showMenu.bind(this.parent,this));this.addEventListener("mouseover",g);this.addEventListener("mouseout",g);this.addEventListener("click",g);this.addEventListener("touchstart",function(l){console.log(l.domEvent);if(l.domEvent.touches.length==1){l.type="mousedown";l.domEvent.button=0;e.dispatchEvent(l)}});this.addEventListener("touchmove",function(l){if(l.domEvent.touches.length==1){console.log(l.domEvent);l.type="mousemove";l.domEvent.button=0;e.dispatchEvent(l)}});this.addEventListener("touchend",function(l){if(l.domEvent.touches.length==0){l.domEvent.button=0;l.type="mouseup";e.dispatchEvent(l);l.type="click";e.dispatchEvent(l)}})}var d=new THREE.Quaternion();var b=this.parent.position.clone().multiplyScalar(-1);switch(h.orientation_mode){case ROS3D.INTERACTIVE_MARKER_INHERIT:d=this.parent.quaternion.clone().inverse();this.updateMatrixWorld=function(l){ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(e,l);e.currentControlOri.copy(e.quaternion);e.currentControlOri.normalize()};break;case ROS3D.INTERACTIVE_MARKER_FIXED:this.updateMatrixWorld=function(l){e.useQuaternion=true;e.quaternion=e.parent.quaternion.clone().inverse();e.updateMatrix();e.matrixWorldNeedsUpdate=true;ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(e,l);e.currentControlOri.copy(e.quaternion)};break;case ROS3D.INTERACTIVE_MARKER_VIEW_FACING:var c=h.independentMarkerOrientation;this.updateMatrixWorld=function(n){e.camera.updateMatrixWorld();var q=new THREE.Matrix4().extractRotation(e.camera.matrixWorld);var o=new THREE.Matrix4();var m=Math.PI*0.5;var p=new THREE.Vector3(-m,0,m);o.setRotationFromEuler(p);var l=new THREE.Matrix4();l.getInverse(e.parent.matrixWorld);q.multiplyMatrices(q,o);q.multiplyMatrices(l,q);e.currentControlOri.setFromRotationMatrix(q);if(!c){e.useQuaternion=true;e.quaternion.copy(e.currentControlOri);e.updateMatrix();e.matrixWorldNeedsUpdate=true}ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(e,n)};break;default:console.error("Unkown orientation mode: "+h.orientation_mode);break}h.markers.forEach(function(m){var l=new ROS3D.Marker({message:m,path:e.path});if(m.header.frame_id!==""){l.position.add(b);l.position.applyQuaternion(d);l.quaternion.multiplyQuaternions(d,l.quaternion);l.updateMatrixWorld()}e.add(l)})};ROS3D.InteractiveMarkerControl.prototype.__proto__=THREE.Object3D.prototype;ROS3D.InteractiveMarkerHandle=function(a){var a=a||{};this.message=a.message;this.feedbackTopic=a.feedbackTopic;this.tfClient=a.tfClient;this.name=this.message.name;this.header=this.message.header;this.controls=this.message.controls;this.menuEntries=this.message.menu_entries;this.dragging=false;this.timeoutHandle=null;this.tfTransform=new ROSLIB.Transform();this.pose=new ROSLIB.Pose();this.setPoseFromServer(this.message.pose)};ROS3D.InteractiveMarkerHandle.prototype.__proto__=EventEmitter2.prototype;ROS3D.InteractiveMarkerHandle.prototype.subscribeTf=function(){if(this.message.header.stamp.secs===0&&this.message.header.stamp.nsecs===0){this.tfClient.subscribe(this.message.header.frame_id,this.tfUpdate.bind(this))}};ROS3D.InteractiveMarkerHandle.prototype.emitServerPoseUpdate=function(){var a=new ROSLIB.Pose(this.pose);a.applyTransform(this.tfTransform);this.emit("pose",a)};ROS3D.InteractiveMarkerHandle.prototype.setPoseFromServer=function(a){this.pose=new ROSLIB.Pose(a);this.emitServerPoseUpdate()};ROS3D.InteractiveMarkerHandle.prototype.tfUpdate=function(a){this.tfTransform=new ROSLIB.Transform(a);this.emitServerPoseUpdate()};ROS3D.InteractiveMarkerHandle.prototype.setPoseFromClient=function(b){this.pose=new ROSLIB.Pose(b);var a=this.tfTransform.clone();a.rotation.invert();this.pose.applyTransform(a);this.sendFeedback(ROS3D.INTERACTIVE_MARKER_POSE_UPDATE,undefined,0,b.controlName);if(this.dragging){if(this.timeoutHandle){clearTimeout(this.timeoutHandle)}this.timeoutHandle=setTimeout(this.setPoseFromClient.bind(this,b),250)}};ROS3D.InteractiveMarkerHandle.prototype.onButtonClick=function(a){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_BUTTON_CLICK,a.clickPosition,0,a.controlName)};ROS3D.InteractiveMarkerHandle.prototype.onMouseDown=function(a){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MOUSE_DOWN,a.clickPosition,0,a.controlName);this.dragging=true};ROS3D.InteractiveMarkerHandle.prototype.onMouseUp=function(a){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MOUSE_UP,a.clickPosition,0,a.controlName);this.dragging=false;if(this.timeoutHandle){clearTimeout(this.timeoutHandle)}};ROS3D.InteractiveMarkerHandle.prototype.onMenuSelect=function(a){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MENU_SELECT,undefined,a.id,a.controlName)};ROS3D.InteractiveMarkerHandle.prototype.sendFeedback=function(c,d,e,f){var b=d!==undefined;var d=d||{x:0,y:0,z:0};var a={header:this.header,client_id:this.clientID,marker_name:this.name,control_name:f,event_type:c,pose:this.pose,mouse_point:d,mousePointValid:b,menuEntryID:e};this.feedbackTopic.publish(a)};ROS3D.InteractiveMarkerMenu=function(q){var g=this;var q=q||{};var f=q.menuEntries;var h=q.className||"default-interactive-marker-menu";var p=q.entryClassName||"default-interactive-marker-menu-entry";var o=q.overlayClassName||"default-interactive-marker-overlay";var d=[];d[0]={children:[]};THREE.EventDispatcher.call(this);if(document.getElementById("default-interactive-marker-menu-css")===null){var a=document.createElement("style");a.id="default-interactive-marker-menu-css";a.type="text/css";a.innerHTML=".default-interactive-marker-menu {background-color: #444444;border: 1px solid #888888;border: 1px solid #888888;padding: 0px 0px 0px 0px;color: #FFFFFF;font-family: sans-serif;font-size: 0.8em;z-index: 1002;}.default-interactive-marker-menu ul {padding: 0px 0px 5px 0px;margin: 0px;list-style-type: none;}.default-interactive-marker-menu ul li div {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;cursor: default;padding: 3px 10px 3px 10px;}.default-interactive-marker-menu-entry:hover {  background-color: #666666;  cursor: pointer;}.default-interactive-marker-menu ul ul {  font-style: italic;  padding-left: 10px;}.default-interactive-marker-overlay {  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index: 1001;  -moz-opacity: 0.0;  opacity: .0;  filter: alpha(opacity = 0);}";document.getElementsByTagName("head")[0].appendChild(a)}this.menuDomElem=document.createElement("div");this.menuDomElem.style.position="absolute";this.menuDomElem.className=h;this.menuDomElem.addEventListener("contextmenu",function(r){r.preventDefault()});this.overlayDomElem=document.createElement("div");this.overlayDomElem.className=o;this.hideListener=this.hide.bind(this);this.overlayDomElem.addEventListener("contextmenu",this.hideListener);this.overlayDomElem.addEventListener("click",this.hideListener);for(var e=0;e<f.length;e++){var n=f[e];var b=n.id;d[b]={title:n.title,id:b,children:[]}}for(var e=0;e<f.length;e++){var n=f[e];var b=n.id;var c=d[b];var m=d[n.parent_id];m.children.push(c)}function k(s,r){this.dispatchEvent({type:"menu-select",domEvent:r,id:s.id,controlName:this.controlName});this.hide(r)}function l(u,r){var v=document.createElement("ul");u.appendChild(v);var t=r.children;for(var s=0;s<t.length;s++){var x=document.createElement("li");var w=document.createElement("div");w.appendChild(document.createTextNode(t[s].title));v.appendChild(x);x.appendChild(w);if(t[s].children.length>0){l(x,t[s]);w.addEventListener("click",g.hide.bind(g))}else{w.addEventListener("click",k.bind(g,t[s]));w.className="default-interactive-marker-menu-entry"}}}l(this.menuDomElem,d[0])};ROS3D.InteractiveMarkerMenu.prototype.show=function(b,a){if(a&&a.preventDefault){a.preventDefault()}this.controlName=b.name;this.menuDomElem.style.left=a.domEvent.clientX+"px";this.menuDomElem.style.top=a.domEvent.clientY+"px";document.body.appendChild(this.overlayDomElem);document.body.appendChild(this.menuDomElem)};ROS3D.InteractiveMarkerMenu.prototype.hide=function(a){if(a&&a.preventDefault){a.preventDefault()}document.body.removeChild(this.overlayDomElem);document.body.removeChild(this.menuDomElem)};ROS3D.OccupancyGrid=function(p){var p=p||{};var o=p.message;var a=o.info.width;var m=o.info.height;var l=new THREE.PlaneGeometry(a,m);var g=new Uint8Array(a*m*3);for(var n=0;n<m;n++){for(var c=0;c<a;c++){var f=c+((m-n-1)*a);var e=o.data[f];if(e===100){var b=0}else{if(e===0){var b=255}else{var b=127}}var d=(c+(n*a))*3;g[d]=b;g[++d]=b;g[++d]=b}}var k=new THREE.DataTexture(g,a,m,THREE.RGBFormat);k.needsUpdate=true;var h=new THREE.MeshBasicMaterial({map:k});h.side=THREE.DoubleSide;THREE.Mesh.call(this,l,h);this.scale.x=o.info.resolution;this.scale.y=o.info.resolution};ROS3D.OccupancyGrid.prototype.__proto__=THREE.Mesh.prototype;ROS3D.OccupancyGridClient=function(d){var e=this;var d=d||{};var b=d.ros;var c=d.topic||"/map";this.tfClient=d.tfClient;this.rootObject=d.rootObject||new THREE.Object3D();this.currentGrid=null;var a=new ROSLIB.Topic({ros:b,name:c,messageType:"nav_msgs/OccupancyGrid",compression:"png"});a.subscribe(function(f){if(e.currentGrid){e.rootObject.remove(e.currentGrid)}e.currentGrid=new ROS3D.OccupancyGrid({message:f});e.rootObject.add(e.currentGrid);e.emit("change")})};ROS3D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype;ROS3D.Marker=function(f){var f=f||{};var n=f.path||"/";var k=f.message;if(n.substr(n.length-1)!=="/"){n+="/"}THREE.Object3D.call(this);this.useQuaternion=true;this.setPose(k.pose);var o=ROS3D.makeColorMaterial(k.color.r,k.color.g,k.color.b,k.color.a);switch(k.type){case ROS3D.MARKER_ARROW:var u=k.scale.x;var s=u*0.23;var c=k.scale.y;var l=c*0.5;if(k.points.length===2){var d=new THREE.Vector3(k.points[0].x,k.points[0].y,k.points[0].z);var b=new THREE.Vector3(k.points[1].x,k.points[1].y,k.points[1].z);var w=d.clone().negate().add(b);u=w.length();c=k.scale.y;l=k.scale.x;if(k.scale.z!==0){s=k.scale.z}}this.add(new ROS3D.Arrow({direction:w,origin:d,length:u,headLength:s,shaftDiameter:l,headDiameter:c,material:o}));break;case ROS3D.MARKER_CUBE:var p=new THREE.CubeGeometry(k.scale.x,k.scale.y,k.scale.z);this.add(new THREE.Mesh(p,o));break;case ROS3D.MARKER_SPHERE:var p=new THREE.SphereGeometry(0.5);var a=new THREE.Mesh(p,o);a.scale.x=k.scale.x;a.scale.y=k.scale.y;a.scale.z=k.scale.z;this.add(a);break;case ROS3D.MARKER_CYLINDER:var p=new THREE.CylinderGeometry(0.5,0.5,1,16,1,false);var a=new THREE.Mesh(p,o);a.useQuaternion=true;a.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),Math.PI*0.5);a.scale=new THREE.Vector3(k.scale.x,k.scale.y,k.scale.z);this.add(a);break;case ROS3D.MARKER_CUBE_LIST:case ROS3D.MARKER_SPHERE_LIST:case ROS3D.MARKER_POINTS:var g=new THREE.Geometry();var m=new THREE.ParticleBasicMaterial({size:k.scale.x});for(var t=0;t<k.points.length;t++){var v=new THREE.Vector3();v.x=k.points[t].x;v.y=k.points[t].y;v.z=k.points[t].z;g.vertices.push(v)}if(k.colors.length===k.points.length){m.vertexColors=true;for(var t=0;t<k.points.length;t++){var q=new THREE.Color();q.setRGB(k.colors[t].r,k.colors[t].g,k.colors[t].b);g.colors.push(q)}}else{m.color.setRGB(k.color.r,k.color.g,k.color.b)}this.add(new THREE.ParticleSystem(g,m));break;case ROS3D.MARKER_TEXT_VIEW_FACING:var h=new THREE.TextGeometry(k.text,{size:k.scale.x*0.5,height:0.1*k.scale.x,curveSegments:4,font:"helvetiker",bevelEnabled:false,bevelThickness:2,bevelSize:2,material:0,extrudeMaterial:0});h.computeVertexNormals();h.computeBoundingBox();var a=new THREE.Mesh(h,o);var e=-0.5*(h.boundingBox.max.x-h.boundingBox.min.x);a.position.y=-e;a.rotation.x=Math.PI*0.5;a.rotation.y=Math.PI*1.5;this.add(a);break;case ROS3D.MARKER_MESH_RESOURCE:this.add(new ROS3D.MeshResource({path:n,resource:k.mesh_resource.substr(10)}));break;case ROS3D.MARKER_TRIANGLE_LIST:var r=new ROS3D.TriangleList({material:o,vertices:k.points,colors:k.colors});r.scale=new THREE.Vector3(k.scale.x,k.scale.y,k.scale.z);this.add(r);break;default:console.error("Currently unsupported marker type: "+k.type);break}};ROS3D.Marker.prototype.__proto__=THREE.Object3D.prototype;ROS3D.Marker.prototype.setPose=function(a){this.position.x=a.position.x;this.position.y=a.position.y;this.position.z=a.position.z;this.quaternion=new THREE.Quaternion(a.orientation.x,a.orientation.y,a.orientation.z,a.orientation.w);this.quaternion.normalize();this.updateMatrixWorld()};ROS3D.MarkerClient=function(d){var e=this;var d=d||{};var b=d.ros;var c=d.topic;this.tfClient=d.tfClient;this.rootObject=d.rootObject||new THREE.Object3D();this.currentMarker=null;var a=new ROSLIB.Topic({ros:b,name:c,messageType:"visualization_msgs/Marker",compression:"png"});a.subscribe(function(g){var f=new ROS3D.Marker({message:g});if(e.currentMarker){e.rootObject.remove(e.currentMarker)}e.currentMarker=new ROS3D.SceneNode({frameID:g.header.frame_id,tfClient:e.tfClient,object:f});e.rootObject.add(e.currentMarker);e.emit("change")})};ROS3D.MarkerClient.prototype.__proto__=EventEmitter2.prototype;ROS3D.Arrow=function(o){var o=o||{};var l=o.origin||new THREE.Vector3(0,0,0);var k=o.direction||new THREE.Vector3(1,0,0);var a=o.length||1;var f=o.headLength||0.2;var c=o.shaftDiameter||0.05;var d=o.headDiameter||0.1;var g=o.material||new THREE.MeshBasicMaterial();var e=a-f;var h=new THREE.CylinderGeometry(c*0.5,c*0.5,e,12,1);var b=new THREE.Matrix4();b.setPosition(new THREE.Vector3(0,e*0.5,0));h.applyMatrix(b);var n=new THREE.CylinderGeometry(0,d*0.5,f,12,1);b.setPosition(new THREE.Vector3(0,e+(f*0.5),0));n.applyMatrix(b);THREE.GeometryUtils.merge(h,n);THREE.Mesh.call(this,h,g);this.position=l;this.setDirection(k)};ROS3D.Arrow.prototype.__proto__=THREE.Mesh.prototype;ROS3D.Arrow.prototype.setDirection=function(c){var a=new THREE.Vector3(0,1,0).cross(c);var b=Math.acos(new THREE.Vector3(0,1,0).dot(c.clone().normalize()));this.matrix=new THREE.Matrix4().makeRotationAxis(a.normalize(),b);this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)};ROS3D.Arrow.prototype.setLength=function(a){this.scale.set(a,a,a)};ROS3D.Arrow.prototype.setColor=function(a){this.line.material.color.setHex(a);this.cone.material.color.setHex(a)};ROS3D.Axes=function(b){var c=this;var b=b||{};var e=b.shaftRadius||0.008;var d=b.headRadius||0.023;var a=b.headLength||0.1;THREE.Object3D.call(this);this.lineGeom=new THREE.CylinderGeometry(e,e,1-a);this.headGeom=new THREE.CylinderGeometry(0,d,a);function f(m){var k=new THREE.Color();k.setRGB(m.x,m.y,m.z);var l=new THREE.MeshBasicMaterial({color:k.getHex()});var o=new THREE.Vector3;o.crossVectors(m,new THREE.Vector3(0,-1,0));var h=new THREE.Quaternion;h.setFromAxisAngle(o,0.5*Math.PI);var n=new THREE.Mesh(c.headGeom,l);n.position=m.clone();n.position.multiplyScalar(0.95);n.useQuaternion=true;n.quaternion=h;n.updateMatrix();c.add(n);var g=new THREE.Mesh(c.lineGeom,l);g.position=m.clone();g.position.multiplyScalar(0.45);g.useQuaternion=true;g.quaternion=h;g.updateMatrix();c.add(g)}f(new THREE.Vector3(1,0,0));f(new THREE.Vector3(0,1,0));f(new THREE.Vector3(0,0,1))};ROS3D.Axes.prototype.__proto__=THREE.Object3D.prototype;ROS3D.Grid=function(c){var c=c||{};var d=c.size||50;var b=c.color||"#cccccc";var a=c.lineWidth||1;THREE.Mesh.call(this,new THREE.PlaneGeometry(d,d,d,d),new THREE.MeshBasicMaterial({color:b,wireframe:true,wireframeLinewidth:a,transparent:true}))};ROS3D.Grid.prototype.__proto__=THREE.Mesh.prototype;ROS3D.MeshResource=function(c){var e=this;var c=c||{};var h=c.path||"/";var g=c.resource;THREE.Object3D.call(this);if(h.substr(h.length-1)!=="/"){this.path+="/"}var d=h+g;var b=d.substr(-4).toLowerCase();if(d.substr(-4).toLowerCase()===".dae"){var a=new THREE.ColladaLoader();a.load(d,function f(k){e.add(k.scene)})}};ROS3D.MeshResource.prototype.__proto__=THREE.Object3D.prototype;ROS3D.TriangleList=function(d){var d=d||{};var e=d.material||new THREE.MeshBasicMaterial();var c=d.vertices;var a=d.colors;THREE.Object3D.call(this);e.side=THREE.DoubleSide;var g=new THREE.Geometry();for(i=0;i<c.length;i++){g.vertices.push(new THREE.Vector3(c[i].x,c[i].y,c[i].z))}if(a.length===c.length){for(i=0;i<c.length;i+=3){var f=new THREE.Face3(i,i+1,i+2);for(j=i*3;j<i*3+3;i++){var b=new THREE.Color();b.setRGB(a[i].r,a[i].g,a[i].b);f.vertexColors.push(b)}g.faces.push(f)}e.vertexColors=THREE.VertexColors}else{if(a.length===c.length/3){for(i=0;i<c.length;i+=3){var f=new THREE.Face3(i,i+1,i+2);f.color.setRGB(a[i/3].r,a[i/3].g,a[i/3].b);g.faces.push(f)}e.vertexColors=THREE.FaceColors}else{for(i=0;i<c.length;i+=3){var f=new THREE.Face3(i,i+1,i+2);g.faces.push(f)}}}g.computeBoundingBox();g.computeBoundingSphere();g.computeCentroids();g.computeFaceNormals();this.add(new THREE.Mesh(g,e))};ROS3D.TriangleList.prototype.__proto__=THREE.Object3D.prototype;ROS3D.TriangleList.prototype.setColor=function(a){this.mesh.material.color.setHex(a)};ROS3D.Urdf=function(n){var n=n||{};var e=n.urdfModel;var k=n.path||"/";var g=n.tfClient;THREE.Object3D.call(this);this.useQuaternion=true;var f=e.links;for(var c in f){var d=f[c];if(d.visual&&d.visual.geometry){if(d.visual.geometry.type===ROSLIB.URDF_MESH){var m="/"+d.name;var a=d.visual.geometry.filename;var h=a.substr(-4).toLowerCase();if(h===".dae"){var b=new ROS3D.SceneNode({frameID:m,tfClient:g,object:new ROS3D.MeshResource({path:k,resource:a.substring(10)})});this.add(b)}}}}};ROS3D.Urdf.prototype.__proto__=THREE.Object3D.prototype;ROS3D.UrdfClient=function(b){var d=this;var b=b||{};var a=b.ros;var e=b.param||"robot_description";this.path=b.path||"/";this.tfClient=b.tfClient;this.rootObject=b.rootObject||new THREE.Object3D();var c=new ROSLIB.Param({ros:a,name:e});c.get(function(g){var f=new ROSLIB.UrdfModel({string:g});d.rootObject.add(new ROS3D.Urdf({urdfModel:f,path:d.path,tfClient:d.tfClient}))})};ROS3D.SceneNode=function(c){var c=c||{};var e=this;var a=c.tfClient;var d=c.frameID;var b=c.object;THREE.Object3D.call(this);this.useQuaternion=true;this.add(b);a.subscribe(d,function(h){var g=new ROSLIB.Transform(h);var f=new ROSLIB.Pose();f.applyTransform(g);e.position.x=f.position.x;e.position.y=f.position.y;e.position.z=f.position.z;e.quaternion=new THREE.Quaternion(f.orientation.x,f.orientation.y,f.orientation.z,f.orientation.w);e.updateMatrixWorld(true)})};ROS3D.SceneNode.prototype.__proto__=THREE.Object3D.prototype;ROS3D.Viewer=function(k){var d=this;var k=k||{};var c=k.divID;var b=k.width;var g=k.height;var a=k.background||"#111111";var h=k.antialias;this.renderer=new THREE.WebGLRenderer({antialias:this.antialias});this.renderer.setClearColorHex(a.replace("#","0x"),1);this.renderer.sortObjects=false;this.renderer.setSize(b,g);this.renderer.shadowMapEnabled=false;this.renderer.autoClear=false;this.scene=new THREE.Scene();this.camera=new THREE.PerspectiveCamera(40,b/g,0.01,1000);this.camera.position.x=3;this.camera.position.y=3;this.camera.position.z=3;this.cameraControls=new ROS3D.OrbitControls({scene:this.scene,camera:this.camera});this.cameraControls.userZoomSpeed=0.5;this.scene.add(new THREE.AmbientLight(5592405));this.directionalLight=new THREE.DirectionalLight(16777215);this.scene.add(this.directionalLight);this.selectableObjects=new THREE.Object3D;this.scene.add(this.selectableObjects);var e=new ROS3D.MouseHandler({renderer:this.renderer,camera:this.camera,rootObject:this.selectableObjects,fallbackTarget:this.cameraControls});this.highlighter=new ROS3D.Highlighter({mouseHandler:e});function f(){d.cameraControls.update();d.directionalLight.position=d.camera.localToWorld(new THREE.Vector3(-1,1,0));d.directionalLight.position.normalize();d.renderer.clear(true,true,true);d.renderer.render(d.scene,d.camera);d.highlighter.renderHighlight(d.renderer,d.scene,d.camera);requestAnimationFrame(f)}document.getElementById(c).appendChild(this.renderer.domElement);f()};ROS3D.Viewer.prototype.addObject=function(b,a){if(a){this.selectableObjects.add(b)}else{this.scene.add(b)}};ROS3D.Highlighter=function(a){var a=a||{};var b=a.mouseHandler;this.hoverObjs=[];b.addEventListener("mouseover",this.onMouseOver.bind(this));b.addEventListener("mouseout",this.onMouseOut.bind(this))};ROS3D.Highlighter.prototype.onMouseOver=function(a){this.hoverObjs.push(a.currentTarget)};ROS3D.Highlighter.prototype.onMouseOut=function(a){this.hoverObjs.splice(this.hoverObjs.indexOf(a.currentTarget),1)};ROS3D.Highlighter.prototype.getWebglObjects=function(e,d,b){var a=e.__webglObjects;for(var g=0;g<d.length;g++){if(d[g]){for(var f=a.length-1;f>=0;f--){if(a[f].object===d[g]){b.push(a[f]);break}}this.getWebglObjects(e,d[g].children,b)}}};ROS3D.Highlighter.prototype.renderHighlight=function(c,d,a){var b=[];this.getWebglObjects(d,this.hoverObjs,b);d.overrideMaterial=new THREE.MeshBasicMaterial({fog:false,opacity:0.5,depthTest:true,depthWrite:false,polygonOffset:true,polygonOffsetUnits:-1,side:THREE.DoubleSide});var e=d.__webglObjects;d.__webglObjects=b;c.render(d,a);d.__webglObjects=e;d.overrideMaterial=null};ROS3D.MouseHandler=function(a){THREE.EventDispatcher.call(this);this.renderer=a.renderer;this.camera=a.camera;this.rootObject=a.rootObject;this.fallbackTarget=a.fallbackTarget;this.lastTarget=this.fallbackTarget;this.dragging=false;this.projector=new THREE.Projector();var b=["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"];this.listeners={};b.forEach(function(c){this.listeners[c]=this.processDomEvent.bind(this);this.renderer.domElement.addEventListener(c,this.listeners[c],false)},this)};ROS3D.MouseHandler.prototype.processDomEvent=function(k){k.preventDefault();var l=k.target;var n=l.getBoundingClientRect();var f=k.clientX-n.left-l.clientLeft+l.scrollLeft;var m=k.clientY-n.top-l.clientTop+l.scrollTop;var c=f/l.clientWidth*2-1;var a=-m/l.clientHeight*2+1;var e=new THREE.Vector3(c,a,0.5);this.projector.unprojectVector(e,this.camera);var h=new THREE.Raycaster(this.camera.position.clone(),e.sub(this.camera.position).normalize());var o=h.ray;var b={mousePos:new THREE.Vector2(c,a),mouseRay:o,domEvent:k,camera:this.camera,intersection:this.lastIntersection};if(k.type=="mouseout"){if(this.dragging){this.notify(this.lastTarget,"mouseup",b);this.dragging=false}this.notify(this.lastTarget,"mouseout",b);this.lastTarget=null;return}if(this.dragging){this.notify(this.lastTarget,k.type,b);if((k.type==="mouseup"&&k.button===2)||k.type==="click"){this.dragging=false}return}var l=this.lastTarget;var d=[];d=h.intersectObject(this.rootObject,true);if(d.length>0){l=d[0].object;b.intersection=this.lastIntersection=d[0]}else{l=this.fallbackTarget}if(l!==this.lastTarget){var g=this.notify(l,"mouseover",b);if(g){this.notify(this.lastTarget,"mouseout",b)}else{l=this.fallbackTarget;if(l!==this.lastTarget){this.notify(l,"mouseover",b);this.notify(this.lastTarget,"mouseout",b)}}}this.notify(l,k.type,b);if(k.type==="mousedown"){this.dragging=true}this.lastTarget=l};ROS3D.MouseHandler.prototype.notify=function(c,b,a){a.type=b;a.cancelBubble=false;a.stopPropagation=function(){a.cancelBubble=true};a.currentTarget=c;while(a.currentTarget){if(a.currentTarget.dispatchEvent&&a.currentTarget.dispatchEvent instanceof Function){a.currentTarget.dispatchEvent(a);if(a.cancelBubble){this.dispatchEvent(a);return true}}a.currentTarget=a.currentTarget.parent}return false};ROS3D.MouseHandler.prototype.destroy=function(){this.listeners.forEach(function(a){this.renderer.domElement.removeEventListener(eventName,a,false)},this)};ROS3D.OrbitControls=function(e){THREE.EventDispatcher.call(this);var l=this;var e=e||{};var w=e.scene;this.camera=e.camera;this.center=new THREE.Vector3();this.userZoom=true;this.userZoomSpeed=e.userZoomSpeed||1;this.userRotate=true;this.userRotateSpeed=e.userRotateSpeed||1;this.autoRotate=e.autoRotate;this.autoRotateSpeed=e.autoRotateSpeed||2;this.camera.up=new THREE.Vector3(0,0,1);var u=1800;var v=new THREE.Vector2();var g=new THREE.Vector2();var r=new THREE.Vector2();var t=new THREE.Vector2();var x=new THREE.Vector2();var o=new THREE.Vector2();var m=new THREE.Vector3();var p=new THREE.Vector3();var c=new THREE.Vector3();var b=new THREE.Vector3();this.phiDelta=0;this.thetaDelta=0;this.scale=1;this.lastPosition=new THREE.Vector3();var s={NONE:-1,ROTATE:0,ZOOM:1,MOVE:2};var h=s.NONE;this.axes=new ROS3D.Axes({shaftRadius:0.025,headRadius:0.07,headLength:0.2});w.add(this.axes);this.axes.traverse(function(y){y.visible=false});function k(y){var z=y.domEvent;z.preventDefault();switch(z.button){case 0:h=s.ROTATE;v.set(z.clientX,z.clientY);break;case 1:h=s.MOVE;p=new THREE.Vector3(0,0,1);var A=new THREE.Matrix4().extractRotation(this.camera.matrix);p.applyMatrix4(A);m=l.center.clone();c=l.camera.position.clone();b=ROS3D.intersectPlane(y.mouseRay,m,p);break;case 2:h=s.ZOOM;t.set(z.clientX,z.clientY);break}this.showAxes()}function q(y){var z=y.domEvent;if(h===s.ROTATE){g.set(z.clientX,z.clientY);r.subVectors(g,v);l.rotateLeft(2*Math.PI*r.x/u*l.userRotateSpeed);l.rotateUp(2*Math.PI*r.y/u*l.userRotateSpeed);v.copy(g);this.showAxes()}else{if(h===s.ZOOM){x.set(z.clientX,z.clientY);o.subVectors(x,t);if(o.y>0){l.zoomIn()}else{l.zoomOut()}t.copy(x);this.showAxes()}else{if(h===s.MOVE){var B=ROS3D.intersectPlane(y.mouseRay,l.center,p);if(!B){return}var A=new THREE.Vector3().subVectors(b.clone(),B.clone());l.center.addVectors(m.clone(),A.clone());l.camera.position.addVectors(c.clone(),A.clone());l.update();l.camera.updateMatrixWorld();this.showAxes()}}}}function d(y){if(!l.userRotate){return}h=s.NONE}function n(y){if(!l.userZoom){return}var z=y.domEvent;if(typeof(z.wheelDelta)!=="undefined"){var A=z.wheelDelta}else{var A=-z.detail}if(A>0){l.zoomOut()}else{l.zoomIn()}this.showAxes()}function a(y){k(y);y.preventDefault()}function f(y){q(y);y.preventDefault()}this.addEventListener("mousedown",k);this.addEventListener("mouseup",d);this.addEventListener("mousemove",q);this.addEventListener("touchstart",a);this.addEventListener("touchmove",f);this.addEventListener("mousewheel",n);this.addEventListener("DOMMouseScroll",n)};ROS3D.OrbitControls.prototype.showAxes=function(){var a=this;this.axes.traverse(function(b){b.visible=true});if(this.hideTimeout){clearTimeout(this.hideTimeout)}this.hideTimeout=setTimeout(function(){a.axes.traverse(function(b){b.visible=false});a.hideTimeout=false},1000)};ROS3D.OrbitControls.prototype.rotateLeft=function(a){if(a===undefined){a=2*Math.PI/60/60*this.autoRotateSpeed}this.thetaDelta-=a};ROS3D.OrbitControls.prototype.rotateRight=function(a){if(a===undefined){a=2*Math.PI/60/60*this.autoRotateSpeed}this.thetaDelta+=a};ROS3D.OrbitControls.prototype.rotateUp=function(a){if(a===undefined){a=2*Math.PI/60/60*this.autoRotateSpeed}this.phiDelta-=a};ROS3D.OrbitControls.prototype.rotateDown=function(a){if(a===undefined){a=2*Math.PI/60/60*this.autoRotateSpeed}this.phiDelta+=a};ROS3D.OrbitControls.prototype.zoomIn=function(a){if(a===undefined){a=Math.pow(0.95,this.userZoomSpeed)}this.scale/=a};ROS3D.OrbitControls.prototype.zoomOut=function(a){if(a===undefined){a=Math.pow(0.95,this.userZoomSpeed)}this.scale*=a};ROS3D.OrbitControls.prototype.update=function(){var b=this.camera.position;var f=b.clone().sub(this.center);var d=Math.atan2(f.y,f.x);var e=Math.atan2(Math.sqrt(f.y*f.y+f.x*f.x),f.z);if(this.autoRotate){this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed)}d+=this.thetaDelta;e+=this.phiDelta;var c=0.000001;e=Math.max(c,Math.min(Math.PI-c,e));var a=f.length();f.y=a*Math.sin(e)*Math.sin(d);f.z=a*Math.cos(e);f.x=a*Math.sin(e)*Math.cos(d);f.multiplyScalar(this.scale);b.copy(this.center).add(f);this.camera.lookAt(this.center);a=f.length();this.axes.position=this.center.clone();this.axes.scale.x=this.axes.scale.y=this.axes.scale.z=a*0.05;this.axes.updateMatrixWorld(true);this.thetaDelta=0;this.phiDelta=0;this.scale=1;if(this.lastPosition.distanceTo(this.camera.position)>0){this.dispatchEvent({type:"change"});this.lastPosition.copy(this.camera.position)}};THREE.ColladaLoader=function(){var an=null;var I=null;var Y;var aK=null;var ab={};var m={};var Q={};var ag={};var ar={};var S={};var au={};var af={};var aO;var aI;var aR;var f;var L;var u=true;var R=THREE.SmoothShading;var ad={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:"Y",defaultEnvMap:null};var aQ=1;var av="Y";var A=null;var B=Math.PI/180;function g(a0,a4,a3){var a2=0;if(document.implementation&&document.implementation.createDocument){var a1=new XMLHttpRequest();a1.onreadystatechange=function(){if(a1.readyState==4){if(a1.status==0||a1.status==200){if(a1.responseXML){aK=a4;am(a1.responseXML,undefined,a0)}else{if(a1.responseText){aK=a4;var a5=new DOMParser();var a6=a5.parseFromString(a1.responseText,"application/xml");am(a6,undefined,a0)}else{console.error("ColladaLoader: Empty or non-existing file ("+a0+")")}}}}else{if(a1.readyState==3){if(a3){if(a2==0){a2=a1.getResponseHeader("Content-Length")}a3({total:a2,loaded:a1.responseText.length})}}}};a1.open("GET",a0,true);a1.send(null)}else{alert("Don't know how to parse XML!")}}function am(a5,a3,a1){an=a5;a3=a3||aK;if(a1!==undefined){var a4=a1.split("/");a4.pop();aR=(a4.length<1?".":a4.join("/"))+"/"}z();W();m=az("//dae:library_images/dae:image",ae,"image");S=az("//dae:library_materials/dae:material",c,"material");au=az("//dae:library_effects/dae:effect",P,"effect");ar=az("//dae:library_geometries/dae:geometry",aB,"geometry");af=az(".//dae:library_cameras/dae:camera",aP,"camera");ag=az("//dae:library_controllers/dae:controller",K,"controller");Q=az("//dae:library_animations/dae:animation",aS,"animation");aI=az(".//dae:library_visual_scenes/dae:visual_scene",aL,"visual_scene");f=[];L=[];Y=Z();I=new THREE.Object3D();for(var a2=0;a2<Y.nodes.length;a2++){I.add(d(Y.nodes[a2]))}w();var a0={scene:I,morphs:f,skins:L,animations:aO,dae:{images:m,materials:S,cameras:af,effects:au,geometries:ar,controllers:ag,animations:Q,visualScenes:aI,scene:Y}};if(a3){a3(a0)}return a0}function E(a0){R=a0}function z(){var a3=an.evaluate("//dae:asset",an,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a1=a3.iterateNext();if(a1&&a1.childNodes){for(var a0=0;a0<a1.childNodes.length;a0++){var a4=a1.childNodes[a0];switch(a4.nodeName){case"unit":var a2=a4.getAttribute("meter");if(a2){aQ=parseFloat(a2)}break;case"up_axis":av=a4.textContent.charAt(0);break}}}}function az(a6,a3,a5){var a4=an.evaluate(a6,an,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a7={};var a2=a4.iterateNext();var a1=0;while(a2){var a0=(new a3()).parse(a2);if(!a0.id||a0.id.length==0){a0.id=a5+(a1++)}a7[a0.id]=a0;a2=a4.iterateNext()}return a7}function Z(){var a1=an.evaluate(".//dae:scene/dae:instance_visual_scene",an,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(a1){var a0=a1.getAttribute("url").replace(/^#/,"");return aI[a0.length>0?a0:"visual_scene0"]}else{return null}}function w(){aO=[];q(I)}function q(a5){var a7=Y.getChildById(a5.name,true),a4=null;if(a7&&a7.keys){a4={fps:60,hierarchy:[{node:a7,keys:a7.keys,sids:a7.sids}],node:a5,name:"animation_"+a5.name,length:0};aO.push(a4);for(var a3=0,a0=a7.keys.length;a3<a0;a3++){a4.length=Math.max(a4.length,a7.keys[a3].time)}}else{a4={hierarchy:[{keys:[],sids:[]}]}}for(var a3=0,a0=a5.children.length;a3<a0;a3++){var a6=q(a5.children[a3]);for(var a1=0,a2=a6.hierarchy.length;a1<a2;a1++){a4.hierarchy.push({keys:[],sids:[]})}}return a4}function J(){var a6=1000000;var a0=-a6;var a4=0;for(var a5 in Q){var a3=Q[a5];for(var a2=0;a2<a3.sampler.length;a2++){var a1=a3.sampler[a2];a1.create();a6=Math.min(a6,a1.startTime);a0=Math.max(a0,a1.endTime);a4=Math.max(a4,a1.input.length)}}return{start:a6,end:a0,frames:a4}}function o(a7,a4){var a6=a4 instanceof F?ag[a4.url]:a4;if(!a6||!a6.morph){console.log("could not find morph controller!");return}var a3=a6.morph;for(var a2=0;a2<a3.targets.length;a2++){var a1=a3.targets[a2];var a0=ar[a1];if(!a0.mesh||!a0.mesh.primitives||!a0.mesh.primitives.length){continue}var a5=a0.mesh.primitives[0].geometry;if(a5.vertices.length===a7.vertices.length){a7.morphTargets.push({name:"target_1",vertices:a5.vertices})}}a7.morphTargets.push({name:"target_Z",vertices:a7.vertices})}function aM(a7,a0,a5){var a1=ag[a0.url];if(!a1||!a1.skin){console.log("could not find skin controller!");return}if(!a0.skeleton||!a0.skeleton.length){console.log("could not find the skeleton for the skin!");return}var a8=a1.skin;var a3=Y.getChildById(a0.skeleton[0]);var a6=[];a5=a5!==undefined?a5:true;var a2=[];a7.skinWeights=[];a7.skinIndices=[];if(a5){for(var a4=0;a4<a7.vertices.length;a4++){a8.bindShapeMatrix.multiplyVector3(a7.vertices[a4])}}}function D(a5,a1,a6,a3){a5.world=a5.world||new THREE.Matrix4();a5.world.copy(a5.matrix);if(a5.channels&&a5.channels.length){var a4=a5.channels[0];var a0=a4.sampler.output[a6];if(a0 instanceof THREE.Matrix4){a5.world.copy(a0)}}if(a3){a5.world.multiply(a3,a5.world)}a1.push(a5);for(var a2=0;a2<a5.nodes.length;a2++){D(a5.nodes[a2],a1,a6,a5.world)}}function U(a0,a7){for(var a3=0;a3<a0.length;a3++){var a6=a0[a3];var a8=-1;if(a6.type!="JOINT"){continue}for(var a2=0;a2<a7.joints.length;a2++){if(a6.sid==a7.joints[a2]){a8=a2;break}}if(a8>=0){var a4=a7.invBindMatrices[a8];a6.invBindMatrix=a4;a6.skinningMatrix=new THREE.Matrix4();a6.skinningMatrix.multiply(a6.world,a4);a6.weights=[];for(var a2=0;a2<a7.weights.length;a2++){for(var a1=0;a1<a7.weights[a2].length;a1++){var a5=a7.weights[a2][a1];if(a5.joint==a8){a6.weights.push(a5)}}}}else{throw"ColladaLoader: Could not find joint '"+a6.sid+"'."}}}function aT(bb,bc,a2){var a9=ag[bc.url];a2=a2!==undefined?a2:40;if(!a9||!a9.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!bc.skeleton||!bc.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var a8=J();var a4=Y.getChildById(bc.skeleton[0],true)||Y.getChildBySid(bc.skeleton[0],true);var a6,a5,bd,a0,a7;var be=new THREE.Vector3(),a1,bf;for(a6=0;a6<bb.vertices.length;a6++){a9.skin.bindShapeMatrix.multiplyVector3(bb.vertices[a6])}for(a2=0;a2<a8.frames;a2++){var a3=[];var ba=[];for(a6=0;a6<bb.vertices.length;a6++){ba.push(new THREE.Vector3())}D(a4,a3,a2);U(a3,a9.skin);for(a6=0;a6<a3.length;a6++){if(a3[a6].type!="JOINT"){continue}for(a5=0;a5<a3[a6].weights.length;a5++){bd=a3[a6].weights[a5];a0=bd.index;a7=bd.weight;a1=bb.vertices[a0];bf=ba[a0];be.x=a1.x;be.y=a1.y;be.z=a1.z;a3[a6].skinningMatrix.multiplyVector3(be);bf.x+=(be.x*a7);bf.y+=(be.y*a7);bf.z+=(be.z*a7)}}bb.morphTargets.push({name:"target_"+a2,vertices:ba})}}function d(bo,ba){var bf=new THREE.Object3D();var bd=false;var a8;var bj;var br,bp;for(br=0;br<bo.controllers.length;br++){var bl=ag[bo.controllers[br].url];switch(bl.type){case"skin":if(ar[bl.skin.source]){var bh=new ax();bh.url=bl.skin.source;bh.instance_material=bo.controllers[br].instance_material;bo.geometries.push(bh);bd=true;a8=bo.controllers[br]}else{if(ag[bl.skin.source]){var bv=ag[bl.skin.source];bj=bv;if(bv.morph&&ar[bv.morph.source]){var bh=new ax();bh.url=bv.morph.source;bh.instance_material=bo.controllers[br].instance_material;bo.geometries.push(bh)}}}break;case"morph":if(ar[bl.morph.source]){var bh=new ax();bh.url=bl.morph.source;bh.instance_material=bo.controllers[br].instance_material;bo.geometries.push(bh);bj=bo.controllers[br]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var a3={};for(br=0;br<bo.geometries.length;br++){var bq=bo.geometries[br];var bb=bq.instance_material;var a5=ar[bq.url];var a7={};var bt=[];var bg=0;var a2;if(a5){if(!a5.mesh||!a5.mesh.primitives){continue}if(bf.name.length==0){bf.name=a5.id}if(bb){for(bp=0;bp<bb.length;bp++){var bk=bb[bp];var bs=S[bk.target];var a6=bs.instance_effect.url;var a0=au[a6].shader;var bm=a0.material;if(a5.doubleSided){if(!(bm in a3)){var bc=bm.clone();bc.side=THREE.DoubleSide;a3[bm]=bc}bm=a3[bm]}bm.opacity=!bm.opacity?1:bm.opacity;a7[bk.symbol]=bg;bt.push(bm);a2=bm;a2.name=bs.name==null||bs.name===""?bs.id:bs.name;bg++}}var a1;var be=a2||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:a5.doubleSided?THREE.DoubleSide:THREE.FrontSide});var bn=a5.mesh.geometry3js;if(bg>1){be=new THREE.MeshFaceMaterial(bt);for(bp=0;bp<bn.faces.length;bp++){var a9=bn.faces[bp];a9.materialIndex=a7[a9.daeMaterial]}}if(a8!==undefined){aT(bn,a8);be.morphTargets=true;a1=new THREE.SkinnedMesh(bn,be,false);a1.skeleton=a8.skeleton;a1.skinController=ag[a8.url];a1.skinInstanceController=a8;a1.name="skin_"+L.length;L.push(a1)}else{if(bj!==undefined){o(bn,bj);be.morphTargets=true;a1=new THREE.Mesh(bn,be);a1.name="morph_"+f.length;f.push(a1)}else{a1=new THREE.Mesh(bn,be)}}bo.geometries.length>1?bf.add(a1):bf=a1}}for(br=0;br<bo.cameras.length;br++){var bi=bo.cameras[br];var bw=af[bi.url];bf=new THREE.PerspectiveCamera(bw.fov,bw.aspect_ratio,bw.znear,bw.zfar)}bf.name=bo.id||"";bf.matrix=bo.matrix;var a4=bo.matrix.decompose();bf.position=a4[0];bf.quaternion=a4[1];bf.useQuaternion=true;bf.scale=a4[2];bf.position.multiplyScalar(aQ);bf.scale.multiplyScalar(aQ);if(ad.centerGeometry&&bf.geometry){var bu=THREE.GeometryUtils.center(bf.geometry);bf.quaternion.multiplyVector3(bu.multiply(bf.scale));bf.position.sub(bu)}for(br=0;br<bo.nodes.length;br++){bf.add(d(bo.nodes[br],bo))}return bf}function p(a1,a2){for(var a0=0;a0<a1.joints.length;a0++){if(a1.joints[a0]==a2){return a0}}}function M(a0){return an.evaluate(".//dae:library_nodes//dae:node[@id='"+a0+"']",an,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function s(a2){var a5=[];var a1=1000000;var a6=-1000000;for(var a0 in Q){var a3=Q[a0];for(var a4=0;a4<a3.channel.length;a4++){var a7=a3.channel[a4];var a8=a3.sampler[a4];var a0=a7.target.split("/")[0];if(a0==a2.id){a8.create();a7.sampler=a8;a1=Math.min(a1,a8.startTime);a6=Math.max(a6,a8.endTime);a5.push(a7)}}}if(a5.length){a2.startTime=a1;a2.endTime=a6}return a5}function aV(a5){var a3=10000000;for(var a2=0;a2<a5.channels.length;a2++){var a1=a5.channels[a2].sampler;for(var a0=0;a0<a1.input.length-1;a0++){var a6=a1.input[a0];var a4=a1.input[a0+1];a3=Math.min(a3,a4-a6)}}return a3}function ac(a1,a9){var a2={};var a4,a3;for(a4=0;a4<a1.channels.length;a4++){var a5=a1.channels[a4];a2[a5.sid]=a5}var a7=new THREE.Matrix4();for(a4=0;a4<a1.transforms.length;a4++){var a0=a1.transforms[a4];var a5=a2[a0.sid];if(a5!==undefined){var a6=a5.sampler;var a8;for(a3=0;a3<a6.input.length-1;a3++){if(a6.input[a3+1]>a9){a8=a6.output[a3];break}}if(a8!==undefined){if(a8 instanceof THREE.Matrix4){a7=a7.multiply(a7,a8)}else{a7=a7.multiply(a7,a0.matrix)}}else{a7=a7.multiply(a7,a0.matrix)}}else{a7=a7.multiply(a7,a0.matrix)}}return a7}function aF(ba){if(ba.channels&&ba.channels.length){var a8=[],be=[];for(var bc=0,a5=ba.channels.length;bc<a5;bc++){var bh=ba.channels[bc],a0=bh.fullSid,a9=bh.sampler,a6=a9.input,a7=ba.getTransformBySid(bh.sid),a1;if(bh.arrIndices){a1=[];for(var bb=0,bd=bh.arrIndices.length;bb<bd;bb++){a1[bb]=aA(bh.arrIndices[bb])}}else{a1=V(bh.member)}if(a7){if(be.indexOf(a0)===-1){be.push(a0)}for(var bb=0,bd=a6.length;bb<bd;bb++){var a4=a6[bb],bf=a9.getData(a7.type,bb),bg=ap(a8,a4);if(!bg){bg=new ah(a4);var a3=x(a8,a4);a8.splice(a3==-1?a8.length:a3,0,bg)}bg.addTarget(a0,a7,a1,bf)}}else{console.log('Could not find transform "'+bh.sid+'" in node '+ba.id)}}for(var bc=0;bc<be.length;bc++){var a2=be[bc];for(var bb=0;bb<a8.length;bb++){var bg=a8[bb];if(!bg.hasTarget(a2)){v(a8,bg,bb,a2)}}}ba.keys=a8;ba.sids=be}}function ap(a3,a5){var a4=null;for(var a2=0,a0=a3.length;a2<a0&&a4==null;a2++){var a1=a3[a2];if(a1.time===a5){a4=a1}else{if(a1.time>a5){break}}}return a4}function x(a4,a5){var a1=-1;for(var a3=0,a0=a4.length;a3<a0&&a1==-1;a3++){var a2=a4[a3];if(a2.time>=a5){a1=a3}}return a1}function v(ba,a7,a8,a5){var bb=ay(ba,a5,a8?a8-1:0),a6=l(ba,a5,a8+1);if(bb&&a6){var a1=(a7.time-bb.time)/(a6.time-bb.time),a9=bb.getTarget(a5),a4=a6.getTarget(a5).data,a0=a9.data,a3;if(a9.type==="matrix"){a3=a0}else{if(a0.length){a3=[];for(var a2=0;a2<a0.length;++a2){a3[a2]=a0[a2]+(a4[a2]-a0[a2])*a1}}else{a3=a0+(a4-a0)*a1}}a7.addTarget(a5,a9.transform,a9.member,a3)}}function l(a2,a3,a0){for(;a0<a2.length;a0++){var a1=a2[a0];if(a1.hasTarget(a3)){return a1}}return null}function ay(a2,a3,a0){a0=a0>=0?a0:a0+a2.length;for(;a0>=0;a0--){var a1=a2[a0];if(a1.hasTarget(a3)){return a1}}return null}function ae(){this.id="";this.init_from=""}ae.prototype.parse=function(a1){this.id=a1.getAttribute("id");for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeName=="init_from"){this.init_from=a2.textContent}}return this};function K(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null}K.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");this.type="none";for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];switch(a2.nodeName){case"skin":this.skin=(new r()).parse(a2);this.type=a2.nodeName;break;case"morph":this.morph=(new k()).parse(a2);this.type=a2.nodeName;break;default:break}}return this};function k(){this.method=null;this.source=null;this.targets=null;this.weights=null}k.prototype.parse=function(a4){var a2={};var a0=[];var a3;this.method=a4.getAttribute("method");this.source=a4.getAttribute("source").replace(/^#/,"");for(a3=0;a3<a4.childNodes.length;a3++){var a6=a4.childNodes[a3];if(a6.nodeType!=1){continue}switch(a6.nodeName){case"source":var a5=(new aN()).parse(a6);a2[a5.id]=a5;break;case"targets":a0=this.parseInputs(a6);break;default:console.log(a6.nodeName);break}}for(a3=0;a3<a0.length;a3++){var a1=a0[a3];var a5=a2[a1.source];switch(a1.semantic){case"MORPH_TARGET":this.targets=a5.read();break;case"MORPH_WEIGHT":this.weights=a5.read();break;default:break}}return this};k.prototype.parseInputs=function(a2){var a0=[];for(var a1=0;a1<a2.childNodes.length;a1++){var a3=a2.childNodes[a1];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"input":a0.push((new a()).parse(a3));break;default:break}}return a0};function r(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}r.prototype.parse=function(a3){var a1={};var a0,a4;this.source=a3.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var a2=0;a2<a3.childNodes.length;a2++){var a7=a3.childNodes[a2];if(a7.nodeType!=1){continue}switch(a7.nodeName){case"bind_shape_matrix":var a5=e(a7.textContent);this.bindShapeMatrix=al(a5);break;case"source":var a6=new aN().parse(a7);a1[a6.id]=a6;break;case"joints":a0=a7;break;case"vertex_weights":a4=a7;break;default:console.log(a7.nodeName);break}}this.parseJoints(a0,a1);this.parseWeights(a4,a1);return this};r.prototype.parseJoints=function(a3,a1){for(var a2=0;a2<a3.childNodes.length;a2++){var a5=a3.childNodes[a2];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"input":var a0=(new a()).parse(a5);var a4=a1[a0.source];if(a0.semantic=="JOINT"){this.joints=a4.read()}else{if(a0.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=a4.read()}}break;default:break}}};r.prototype.parseWeights=function(a5,a0){var be,bb,a8=[];for(var a6=0;a6<a5.childNodes.length;a6++){var a1=a5.childNodes[a6];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"input":a8.push((new a()).parse(a1));break;case"v":be=aU(a1.textContent);break;case"vcount":bb=aU(a1.textContent);break;default:break}}var a9=0;for(var a6=0;a6<bb.length;a6++){var a3=bb[a6];var a7=[];for(var a4=0;a4<a3;a4++){var ba={};for(var a2=0;a2<a8.length;a2++){var bc=a8[a2];var bd=be[a9+bc.offset];switch(bc.semantic){case"JOINT":ba.joint=bd;break;case"WEIGHT":ba.weight=a0[bc.source].data[bd];break;default:break}}a7.push(ba);a9+=a8.length}for(var a4=0;a4<a7.length;a4++){a7[a4].index=a6}this.weights.push(a7)}};function aL(){this.id="";this.name="";this.nodes=[];this.scene=new THREE.Object3D()}aL.prototype.getChildById=function(a3,a0){for(var a1=0;a1<this.nodes.length;a1++){var a2=this.nodes[a1].getChildById(a3,a0);if(a2){return a2}}return null};aL.prototype.getChildBySid=function(a0,a1){for(var a2=0;a2<this.nodes.length;a2++){var a3=this.nodes[a2].getChildBySid(a0,a1);if(a3){return a3}}return null};aL.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");this.nodes=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"node":this.nodes.push((new aC()).parse(a2));break;default:break}}return this};function aC(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4()}aC.prototype.getChannelForTransform=function(ba){for(var a6=0;a6<this.channels.length;a6++){var a7=this.channels[a6];var a4=a7.target.split("/");var a0=a4.shift();var a1=a4.shift();var a8=(a1.indexOf(".")>=0);var a9=(a1.indexOf("(")>=0);var a3;var a5;if(a8){a4=a1.split(".");a1=a4.shift();a5=a4.shift()}else{if(a9){a3=a1.split("(");a1=a3.shift();for(var a2=0;a2<a3.length;a2++){a3[a2]=parseInt(a3[a2].replace(/\)/,""))}}}if(a1==ba){a7.info={sid:a1,dotSyntax:a8,arrSyntax:a9,arrIndices:a3};return a7}}return null};aC.prototype.getChildById=function(a3,a0){if(this.id==a3){return this}if(a0){for(var a1=0;a1<this.nodes.length;a1++){var a2=this.nodes[a1].getChildById(a3,a0);if(a2){return a2}}}return null};aC.prototype.getChildBySid=function(a0,a1){if(this.sid==a0){return this}if(a1){for(var a2=0;a2<this.nodes.length;a2++){var a3=this.nodes[a2].getChildBySid(a0,a1);if(a3){return a3}}}return null};aC.prototype.getTransformBySid=function(a0){for(var a1=0;a1<this.transforms.length;a1++){if(this.transforms[a1].sid==a0){return this.transforms[a1]}}return null};aC.prototype.parse=function(a2){var a0;this.id=a2.getAttribute("id");this.sid=a2.getAttribute("sid");this.name=a2.getAttribute("name");this.type=a2.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.controllers=[];this.matrix=new THREE.Matrix4();for(var a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"node":this.nodes.push((new aC()).parse(a4));break;case"instance_camera":this.cameras.push((new aw()).parse(a4));break;case"instance_controller":this.controllers.push((new F()).parse(a4));break;case"instance_geometry":this.geometries.push((new ax()).parse(a4));break;case"instance_light":break;case"instance_node":a0=a4.getAttribute("url").replace(/^#/,"");var a3=M(a0);if(a3){this.nodes.push((new aC()).parse(a3))}break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aH()).parse(a4));break;case"extra":break;default:console.log(a4.nodeName);break}}this.channels=s(this);aF(this);this.updateMatrix();return this};aC.prototype.updateMatrix=function(){this.matrix.identity();for(var a0=0;a0<this.transforms.length;a0++){this.transforms[a0].apply(this.matrix)}};function aH(){this.sid="";this.type="";this.data=[];this.obj=null}aH.prototype.parse=function(a0){this.sid=a0.getAttribute("sid");this.type=a0.nodeName;this.data=e(a0.textContent);this.convert();return this};aH.prototype.convert=function(){switch(this.type){case"matrix":this.obj=al(this.data);break;case"rotate":this.angle=this.data[3]*B;case"translate":T(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":T(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}};aH.prototype.apply=function(a0){switch(this.type){case"matrix":a0.multiply(this.obj);break;case"translate":a0.translate(this.obj);break;case"rotate":a0.rotateByAxis(this.obj,this.angle);break;case"scale":a0.scale(this.obj);break}};aH.prototype.update=function(a2,a3){var a0=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!a3){this.obj.copy(a2)}else{if(a3.length===1){switch(a3[0]){case 0:this.obj.n11=a2[0];this.obj.n21=a2[1];this.obj.n31=a2[2];this.obj.n41=a2[3];break;case 1:this.obj.n12=a2[0];this.obj.n22=a2[1];this.obj.n32=a2[2];this.obj.n42=a2[3];break;case 2:this.obj.n13=a2[0];this.obj.n23=a2[1];this.obj.n33=a2[2];this.obj.n43=a2[3];break;case 3:this.obj.n14=a2[0];this.obj.n24=a2[1];this.obj.n34=a2[2];this.obj.n44=a2[3];break}}else{if(a3.length===2){var a1="n"+(a3[0]+1)+(a3[1]+1);this.obj[a1]=a2}else{console.log("Incorrect addressing of matrix in transform.")}}}break;case"translate":case"scale":if(Object.prototype.toString.call(a3)==="[object Array]"){a3=a0[a3[0]]}switch(a3){case"X":this.obj.x=a2;break;case"Y":this.obj.y=a2;break;case"Z":this.obj.z=a2;break;default:this.obj.x=a2[0];this.obj.y=a2[1];this.obj.z=a2[2];break}break;case"rotate":if(Object.prototype.toString.call(a3)==="[object Array]"){a3=a0[a3[0]]}switch(a3){case"X":this.obj.x=a2;break;case"Y":this.obj.y=a2;break;case"Z":this.obj.z=a2;break;case"ANGLE":this.angle=a2*B;break;default:this.obj.x=a2[0];this.obj.y=a2[1];this.obj.z=a2[2];this.angle=a2[3]*B;break}break}};function F(){this.url="";this.skeleton=[];this.instance_material=[]}F.prototype.parse=function(a2){this.url=a2.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!==1){continue}switch(a4.nodeName){case"skeleton":this.skeleton.push(a4.textContent.replace(/^#/,""));break;case"bind_material":var a3=an.evaluate(".//dae:instance_material",a4,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a3){var a0=a3.iterateNext();while(a0){this.instance_material.push((new h()).parse(a0));a0=a3.iterateNext()}}break;case"extra":break;default:break}}return this};function h(){this.symbol="";this.target=""}h.prototype.parse=function(a0){this.symbol=a0.getAttribute("symbol");this.target=a0.getAttribute("target").replace(/^#/,"");return this};function ax(){this.url="";this.instance_material=[]}ax.prototype.parse=function(a2){this.url=a2.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!=1){continue}if(a4.nodeName=="bind_material"){var a3=an.evaluate(".//dae:instance_material",a4,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a3){var a0=a3.iterateNext();while(a0){this.instance_material.push((new h()).parse(a0));a0=a3.iterateNext()}}break}}return this};function aB(){this.id="";this.mesh=null}aB.prototype.parse=function(a1){this.id=a1.getAttribute("id");aG(this,a1);for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];switch(a2.nodeName){case"mesh":this.mesh=(new ak(this)).parse(a2);break;case"extra":break;default:break}}return this};function ak(a0){this.geometry=a0.id;this.primitives=[];this.vertices=null;this.geometry3js=null}ak.prototype.parse=function(a4){this.primitives=[];var a3,a2;for(a3=0;a3<a4.childNodes.length;a3++){var a5=a4.childNodes[a3];switch(a5.nodeName){case"source":aX(a5);break;case"vertices":this.vertices=(new aj()).parse(a5);break;case"triangles":this.primitives.push((new aa().parse(a5)));break;case"polygons":this.primitives.push((new C().parse(a5)));break;case"polylist":this.primitives.push((new aD().parse(a5)));break;default:break}}this.geometry3js=new THREE.Geometry();var a1=ab[this.vertices.input.POSITION.source].data;for(a3=0;a3<a1.length;a3+=3){this.geometry3js.vertices.push(X(a1,a3).clone())}for(a3=0;a3<this.primitives.length;a3++){var a0=this.primitives[a3];a0.setVertices(this.vertices);this.handlePrimitive(a0,this.geometry3js)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals}this.geometry3js.computeBoundingBox();return this};ak.prototype.handlePrimitive=function(a7,a2){var bp,bo,bi=a7.p,bc=a7.inputs;var a0,bh,a3;var bb,bn;var bl=0,bj=3,bf=0;var bx=[];for(bp=0;bp<bc.length;bp++){a0=bc[bp];var bk=a0.offset+1;bf=(bf<bk)?bk:bf;switch(a0.semantic){case"TEXCOORD":bx.push(a0.set);break}}for(var a9=0;a9<bi.length;++a9){var bm=bi[a9],br=0;while(br<bm.length){var a6=[];var bq=[];var bv=null;var bd=[];if(a7.vcount){bj=a7.vcount.length?a7.vcount[bl++]:a7.vcount}else{bj=bm.length/bf}for(bp=0;bp<bj;bp++){for(bo=0;bo<bc.length;bo++){a0=bc[bo];bb=ab[a0.source];bh=bm[br+(bp*bf)+a0.offset];bn=bb.accessor.params.length;a3=bh*bn;switch(a0.semantic){case"VERTEX":a6.push(bh);break;case"NORMAL":bq.push(X(bb.data,a3));break;case"TEXCOORD":bv=bv||{};if(bv[a0.set]===undefined){bv[a0.set]=[]}bv[a0.set].push(new THREE.Vector2(bb.data[a3],bb.data[a3+1]));break;case"COLOR":bd.push(new THREE.Color().setRGB(bb.data[a3],bb.data[a3+1],bb.data[a3+2]));break;default:break}}}if(bq.length==0){a0=this.vertices.input.NORMAL;if(a0){bb=ab[a0.source];bn=bb.accessor.params.length;for(var a8=0,ba=a6.length;a8<ba;a8++){bq.push(X(bb.data,a6[a8]*bn))}}else{a2.calcNormals=true}}if(!bv){bv={};a0=this.vertices.input.TEXCOORD;if(a0){bx.push(a0.set);bb=ab[a0.source];bn=bb.accessor.params.length;for(var a8=0,ba=a6.length;a8<ba;a8++){a3=a6[a8]*bn;if(bv[a0.set]===undefined){bv[a0.set]=[]}bv[a0.set].push(new THREE.Vector2(bb.data[a3],1-bb.data[a3+1]))}}}if(bd.length==0){a0=this.vertices.input.COLOR;if(a0){bb=ab[a0.source];bn=bb.accessor.params.length;for(var a8=0,ba=a6.length;a8<ba;a8++){a3=a6[a8]*bn;bd.push(new THREE.Color().setRGB(bb.data[a3],bb.data[a3+1],bb.data[a3+2]))}}}var a4=null,a5=[],bg,be;if(bj===3){a5.push(new THREE.Face3(a6[0],a6[1],a6[2],bq,bd.length?bd:new THREE.Color()))}else{if(bj===4){a5.push(new THREE.Face4(a6[0],a6[1],a6[2],a6[3],bq,bd.length?bd:new THREE.Color()))}else{if(bj>4&&ad.subdivideFaces){var a1=bd.length?bd:new THREE.Color(),bu,bt,bs,bz,by,bw;for(bo=1;bo<bj-1;){a5.push(new THREE.Face3(a6[0],a6[bo],a6[bo+1],[bq[0],bq[bo++],bq[bo]],a1))}}}}if(a5.length){for(var a8=0,ba=a5.length;a8<ba;a8++){a4=a5[a8];a4.daeMaterial=a7.material;a2.faces.push(a4);for(bo=0;bo<bx.length;bo++){bg=bv[bx[bo]];if(bj>4){be=[bg[0],bg[a8+1],bg[a8+2]]}else{if(bj===4){be=[bg[0],bg[1],bg[2],bg[3]]}else{be=[bg[0],bg[1],bg[2]]}}if(!a2.faceVertexUvs[bo]){a2.faceVertexUvs[bo]=[]}a2.faceVertexUvs[bo].push(be)}}}else{console.log("dropped face with vcount "+bj+" for geometry with id: "+a2.id)}br+=bf*bj}}};function C(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry()}C.prototype.setVertices=function(a0){for(var a1=0;a1<this.inputs.length;a1++){if(this.inputs[a1].source==a0.id){this.inputs[a1].source=a0.input.POSITION.source}}};C.prototype.parse=function(a1){this.material=a1.getAttribute("material");this.count=n(a1,"count",0);for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];switch(a2.nodeName){case"input":this.inputs.push((new a()).parse(a1.childNodes[a0]));break;case"vcount":this.vcount=aU(a2.textContent);break;case"p":this.p.push(aU(a2.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function aD(){C.call(this);this.vcount=[]}aD.prototype=Object.create(C.prototype);function aa(){C.call(this);this.vcount=3}aa.prototype=Object.create(C.prototype);function aE(){this.source="";this.count=0;this.stride=0;this.params=[]}aE.prototype.parse=function(a1){this.params=[];this.source=a1.getAttribute("source");this.count=n(a1,"count",0);this.stride=n(a1,"stride",0);for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeName=="param"){var a2={};a2.name=a3.getAttribute("name");a2.type=a3.getAttribute("type");this.params.push(a2)}}return this};function aj(){this.input={}}aj.prototype.parse=function(a2){this.id=a2.getAttribute("id");for(var a1=0;a1<a2.childNodes.length;a1++){if(a2.childNodes[a1].nodeName=="input"){var a0=(new a()).parse(a2.childNodes[a1]);this.input[a0.semantic]=a0}}return this};function a(){this.semantic="";this.offset=0;this.source="";this.set=0}a.prototype.parse=function(a0){this.semantic=a0.getAttribute("semantic");this.source=a0.getAttribute("source").replace(/^#/,"");this.set=n(a0,"set",-1);this.offset=n(a0,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};function aN(a0){this.id=a0;this.type=null}aN.prototype.parse=function(a2){this.id=a2.getAttribute("id");for(var a1=0;a1<a2.childNodes.length;a1++){var a3=a2.childNodes[a1];switch(a3.nodeName){case"bool_array":this.data=ai(a3.textContent);this.type=a3.nodeName;break;case"float_array":this.data=e(a3.textContent);this.type=a3.nodeName;break;case"int_array":this.data=aU(a3.textContent);this.type=a3.nodeName;break;case"IDREF_array":case"Name_array":this.data=H(a3.textContent);this.type=a3.nodeName;break;case"technique_common":for(var a0=0;a0<a3.childNodes.length;a0++){if(a3.childNodes[a0].nodeName=="accessor"){this.accessor=(new aE()).parse(a3.childNodes[a0]);break}}break;default:break}}return this};aN.prototype.read=function(){var a1=[];var a4=this.accessor.params[0];switch(a4.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var a2=0;a2<this.data.length;a2+=16){var a3=this.data.slice(a2,a2+16);var a0=al(a3);a1.push(a0)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+a4.type+".");break}return a1};function c(){this.id="";this.name="";this.instance_effect=null}c.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");for(var a0=0;a0<a1.childNodes.length;a0++){if(a1.childNodes[a0].nodeName=="instance_effect"){this.instance_effect=(new y()).parse(a1.childNodes[a0]);break}}return this};function ao(){this.color=new THREE.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texture=null;this.texcoord=null;this.texOpts=null}ao.prototype.isColor=function(){return(this.texture==null)};ao.prototype.isTexture=function(){return(this.texture!=null)};ao.prototype.parse=function(a2){for(var a1=0;a1<a2.childNodes.length;a1++){var a3=a2.childNodes[a1];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"color":var a0=e(a3.textContent);this.color=new THREE.Color(0);this.color.setRGB(a0[0],a0[1],a0[2]);this.color.a=a0[3];break;case"texture":this.texture=a3.getAttribute("texture");this.texcoord=a3.getAttribute("texcoord");this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1};this.parseTexture(a3);break;default:break}}return this};ao.prototype.parseTexture=function(a1){if(!a1.childNodes){return this}if(a1.childNodes[1]&&a1.childNodes[1].nodeName==="extra"){a1=a1.childNodes[1];if(a1.childNodes[1]&&a1.childNodes[1].nodeName==="technique"){a1=a1.childNodes[1]}}for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];switch(a2.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[a2.nodeName]=parseFloat(a2.textContent);break;case"wrapU":case"wrapV":this.texOpts[a2.nodeName]=parseInt(a2.textContent);break;default:this.texOpts[a2.nodeName]=a2.textContent;break}}return this};function at(a1,a0){this.type=a1;this.effect=a0;this.material=null}at.prototype.parse=function(a1){for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[a3.nodeName]=(new ao()).parse(a3);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a2=aq(a3,".//dae:float");if(a2.length>0){this[a3.nodeName]=parseFloat(a2[0].textContent)}break;default:break}}this.create();return this};at.prototype.create=function(){var a5={};var a8=(this["transparency"]!==undefined&&this["transparency"]<1);for(var a0 in this){switch(a0){case"ambient":case"emission":case"diffuse":case"specular":var a7=this[a0];if(a7 instanceof ao){if(a7.isTexture()){var a1=a7.texture;var a6=this.effect.sampler[a1].source;if(a6){var a2=this.effect.surface[a6];var a3=m[a2.init_from];if(a3){var a4=THREE.ImageUtils.loadTexture(aR+a3.init_from);a4.wrapS=a7.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;a4.wrapT=a7.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;a4.offset.x=a7.texOpts.offsetU;a4.offset.y=a7.texOpts.offsetV;a4.repeat.x=a7.texOpts.repeatU;a4.repeat.y=a7.texOpts.repeatV;a5.map=a4;if(a0==="emission"){a5.emissive=16777215}}}}else{if(a0==="diffuse"||!a8){if(a0==="emission"){a5.emissive=a7.color.getHex()}else{a5[a0]=a7.color.getHex()}}}}break;case"shininess":a5[a0]=this[a0];break;case"reflectivity":a5[a0]=this[a0];if(a5[a0]>0){a5.envMap=ad.defaultEnvMap}a5.combine=THREE.MixOperation;break;case"index_of_refraction":a5.refractionRatio=this[a0];if(this[a0]!==1){a5.envMap=ad.defaultEnvMap}break;case"transparency":if(a8){a5.transparent=true;a5.opacity=this[a0];a8=true}break;default:break}}a5.shading=R;a5.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;switch(this.type){case"constant":if(a5.emissive!=undefined){a5.color=a5.emissive}this.material=new THREE.MeshBasicMaterial(a5);break;case"phong":case"blinn":if(a5.diffuse!=undefined){a5.color=a5.diffuse}this.material=new THREE.MeshPhongMaterial(a5);break;case"lambert":default:if(a5.diffuse!=undefined){a5.color=a5.diffuse}this.material=new THREE.MeshLambertMaterial(a5);break}return this.material};function b(a0){this.effect=a0;this.init_from=null;this.format=null}b.prototype.parse=function(a1){for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"init_from":this.init_from=a2.textContent;break;case"format":this.format=a2.textContent;break;default:console.log("unhandled Surface prop: "+a2.nodeName);break}}return this};function O(a0){this.effect=a0;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null}O.prototype.parse=function(a1){for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"source":this.source=a2.textContent;break;case"minfilter":this.minfilter=a2.textContent;break;case"magfilter":this.magfilter=a2.textContent;break;case"mipfilter":this.mipfilter=a2.textContent;break;case"wrap_s":this.wrap_s=a2.textContent;break;case"wrap_t":this.wrap_t=a2.textContent;break;default:console.log("unhandled Sampler2D prop: "+a2.nodeName);break}}return this};function P(){this.id="";this.name="";this.shader=null;this.surface={};this.sampler={}}P.prototype.create=function(){if(this.shader==null){return null}};P.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");aG(this,a1);this.shader=null;for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(a2));break;default:break}}return this};P.prototype.parseNewparam=function(a2){var a0=a2.getAttribute("sid");for(var a1=0;a1<a2.childNodes.length;a1++){var a3=a2.childNodes[a1];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"surface":this.surface[a0]=(new b(this)).parse(a3);break;case"sampler2D":this.sampler[a0]=(new O(this)).parse(a3);break;case"extra":break;default:console.log(a3.nodeName);break}}};P.prototype.parseProfileCOMMON=function(a2){var a3;for(var a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"profile_COMMON":this.parseProfileCOMMON(a4);break;case"technique":a3=a4;break;case"newparam":this.parseNewparam(a4);break;case"image":var a0=(new ae()).parse(a4);m[a0.id]=a0;break;case"extra":break;default:console.log(a4.nodeName);break}}return a3};P.prototype.parseTechnique=function(a1){for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=(new at(a2.nodeName,this)).parse(a2);break;default:break}}};function y(){this.url=""}y.prototype.parse=function(a0){this.url=a0.getAttribute("url").replace(/^#/,"");return this};function aS(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[]}aS.prototype.parse=function(a2){this.id=a2.getAttribute("id");this.name=a2.getAttribute("name");this.source={};for(var a1=0;a1<a2.childNodes.length;a1++){var a5=a2.childNodes[a1];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"animation":var a3=(new aS()).parse(a5);for(var a4 in a3.source){this.source[a4]=a3.source[a4]}for(var a0=0;a0<a3.channel.length;a0++){this.channel.push(a3.channel[a0]);this.sampler.push(a3.sampler[a0])}break;case"source":var a4=(new aN()).parse(a5);this.source[a4.id]=a4;break;case"sampler":this.sampler.push((new G(this)).parse(a5));break;case"channel":this.channel.push((new N(this)).parse(a5));break;default:break}}return this};function N(a0){this.animation=a0;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null}N.prototype.parse=function(a2){this.source=a2.getAttribute("source").replace(/^#/,"");this.target=a2.getAttribute("target");var a4=this.target.split("/");var a7=a4.shift();var a0=a4.shift();var a6=(a0.indexOf(".")>=0);var a3=(a0.indexOf("(")>=0);if(a6){a4=a0.split(".");this.sid=a4.shift();this.member=a4.shift()}else{if(a3){var a5=a0.split("(");this.sid=a5.shift();for(var a1=0;a1<a5.length;a1++){a5[a1]=parseInt(a5[a1].replace(/\)/,""))}this.arrIndices=a5}else{this.sid=a0}}this.fullSid=a0;this.dotSyntax=a6;this.arrSyntax=a3;return this};function G(a0){this.id="";this.animation=a0;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0}G.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.inputs=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"input":this.inputs.push((new a()).parse(a2));break;default:break}}return this};G.prototype.create=function(){for(var a1=0;a1<this.inputs.length;a1++){var a0=this.inputs[a1];var a2=this.animation.source[a0.source];switch(a0.semantic){case"INPUT":this.input=a2.read();break;case"OUTPUT":this.output=a2.read();this.strideOut=a2.accessor.stride;break;case"INTERPOLATION":this.interpolation=a2.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(a0.semantic);break}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(var a1=0;a1<this.input.length;a1++){this.startTime=Math.min(this.startTime,this.input[a1]);this.endTime=Math.max(this.endTime,this.input[a1])}this.duration=this.endTime-this.startTime}};G.prototype.getData=function(a2,a0){var a3;if(a2==="matrix"&&this.strideOut===16){a3=this.output[a0]}else{if(this.strideOut>1){a3=[];a0*=this.strideOut;for(var a1=0;a1<this.strideOut;++a1){a3[a1]=this.output[a0+a1]}if(this.strideOut===3){switch(a2){case"rotate":case"translate":T(a3,-1);break;case"scale":T(a3,1);break}}else{if(this.strideOut===4&&a2==="matrix"){T(a3,-1)}}}else{a3=this.output[a0]}}return a3};function ah(a0){this.targets=[];this.time=a0}ah.prototype.addTarget=function(a3,a0,a2,a1){this.targets.push({sid:a3,member:a2,transform:a0,data:a1})};ah.prototype.apply=function(a0){for(var a1=0;a1<this.targets.length;++a1){var a2=this.targets[a1];if(!a0||a2.sid===a0){a2.transform.update(a2.data,a2.member)}}};ah.prototype.getTarget=function(a1){for(var a0=0;a0<this.targets.length;++a0){if(this.targets[a0].sid===a1){return this.targets[a0]}}return null};ah.prototype.hasTarget=function(a1){for(var a0=0;a0<this.targets.length;++a0){if(this.targets[a0].sid===a1){return true}}return false};ah.prototype.interpolate=function(a9,a2){for(var a6=0;a6<this.targets.length;++a6){var a8=this.targets[a6],a0=a9.getTarget(a8.sid),a5;if(a8.transform.type!=="matrix"&&a0){var a3=(a2-this.time)/(a9.time-this.time),a7=a0.data,a1=a8.data;if(a3<0||a3>1){console.log("Key.interpolate: Warning! Scale out of bounds:"+a3);a3=a3<0?0:1}if(a1.length){a5=[];for(var a4=0;a4<a1.length;++a4){a5[a4]=a1[a4]+(a7[a4]-a1[a4])*a3}}else{a5=a1+(a7-a1)*a3}}else{a5=a8.data}a8.transform.update(a5,a8.member)}};function aP(){this.id="";this.name="";this.technique=""}aP.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"optics":this.parseOptics(a2);break;default:break}}return this};aP.prototype.parseOptics=function(a4){for(var a3=0;a3<a4.childNodes.length;a3++){if(a4.childNodes[a3].nodeName=="technique_common"){var a6=a4.childNodes[a3];for(var a2=0;a2<a6.childNodes.length;a2++){this.technique=a6.childNodes[a2].nodeName;if(this.technique=="perspective"){var a5=a6.childNodes[a2];for(var a0=0;a0<a5.childNodes.length;a0++){var a7=a5.childNodes[a0];switch(a7.nodeName){case"yfov":this.yfov=a7.textContent;break;case"xfov":this.xfov=a7.textContent;break;case"znear":this.znear=a7.textContent;break;case"zfar":this.zfar=a7.textContent;break;case"aspect_ratio":this.aspect_ratio=a7.textContent;break}}}else{if(this.technique=="orthographic"){var a1=a6.childNodes[a2];for(var a0=0;a0<a1.childNodes.length;a0++){var a7=a1.childNodes[a0];switch(a7.nodeName){case"xmag":this.xmag=a7.textContent;break;case"ymag":this.ymag=a7.textContent;break;case"znear":this.znear=a7.textContent;break;case"zfar":this.zfar=a7.textContent;break;case"aspect_ratio":this.aspect_ratio=a7.textContent;break}}}}}}}return this};function aw(){this.url=""}aw.prototype.parse=function(a0){this.url=a0.getAttribute("url").replace(/^#/,"");return this};function aX(a0){var a1=a0.getAttribute("id");if(ab[a1]!=undefined){return ab[a1]}ab[a1]=(new aN(a1)).parse(a0);return ab[a1]}function aW(a0){if(a0=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function ai(a4){var a1=H(a4);var a3=[];for(var a2=0,a0=a1.length;a2<a0;a2++){a3.push((a1[a2]=="true"||a1[a2]=="1")?true:false)}return a3}function e(a4){var a1=H(a4);var a3=[];for(var a2=0,a0=a1.length;a2<a0;a2++){a3.push(parseFloat(a1[a2]))}return a3}function aU(a4){var a1=H(a4);var a3=[];for(var a2=0,a0=a1.length;a2<a0;a2++){a3.push(parseInt(a1[a2],10))}return a3}function H(a0){return(a0.length>0)?t(a0).split(/\s+/):[]}function t(a0){return a0.replace(/^\s+/,"").replace(/\s+$/,"")}function aY(a2,a1,a0){if(a2.hasAttribute(a1)){return parseFloat(a2.getAttribute(a1))}else{return a0}}function n(a2,a1,a0){if(a2.hasAttribute(a1)){return parseInt(a2.getAttribute(a1),10)}else{return a0}}function aJ(a2,a1,a0){if(a2.hasAttribute(a1)){return a2.getAttribute(a1)}else{return a0}}function aZ(a2,a0){if(a2===undefined){var a1="0.";while(a1.length<a0+2){a1+="0"}return a1}a0=a0||2;var a3=a2.toString().split(".");a3[1]=a3.length>1?a3[1].substr(0,a0):"0";while(a3[1].length<a0){a3[1]+="0"}return a3.join(".")}function aq(a1,a3){var a4=an.evaluate(a3,a1,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a2=a4.iterateNext();var a0=[];while(a2){a0.push(a2);a2=a4.iterateNext()}return a0}function aG(a2,a0){a2.doubleSided=false;var a1=an.evaluate(".//dae:extra//dae:double_sided",a0,aW,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a1){a1=a1.iterateNext();if(a1&&parseInt(a1.textContent,10)===1){a2.doubleSided=true}}}function W(){if(!ad.convertUpAxis||av===ad.upAxis){A=null}else{switch(av){case"X":A=ad.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":A=ad.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":A=ad.upAxis==="X"?"ZtoX":"ZtoY";break}}}function T(a2,a0){if(!ad.convertUpAxis||av===ad.upAxis){return}switch(A){case"XtoY":var a1=a2[0];a2[0]=a0*a2[1];a2[1]=a1;break;case"XtoZ":var a1=a2[2];a2[2]=a2[1];a2[1]=a2[0];a2[0]=a1;break;case"YtoX":var a1=a2[0];a2[0]=a2[1];a2[1]=a0*a1;break;case"YtoZ":var a1=a2[1];a2[1]=a0*a2[2];a2[2]=a1;break;case"ZtoX":var a1=a2[0];a2[0]=a2[1];a2[1]=a2[2];a2[2]=a1;break;case"ZtoY":var a1=a2[1];a2[1]=a2[2];a2[2]=a0*a1;break}}function X(a1,a2){var a0=[a1[a2],a1[a2+1],a1[a2+2]];T(a0,-1);return new THREE.Vector3(a0[0],a0[1],a0[2])}function al(a1){if(ad.convertUpAxis){var a0=[a1[0],a1[4],a1[8]];T(a0,-1);a1[0]=a0[0];a1[4]=a0[1];a1[8]=a0[2];a0=[a1[1],a1[5],a1[9]];T(a0,-1);a1[1]=a0[0];a1[5]=a0[1];a1[9]=a0[2];a0=[a1[2],a1[6],a1[10]];T(a0,-1);a1[2]=a0[0];a1[6]=a0[1];a1[10]=a0[2];a0=[a1[0],a1[1],a1[2]];T(a0,-1);a1[0]=a0[0];a1[1]=a0[1];a1[2]=a0[2];a0=[a1[4],a1[5],a1[6]];T(a0,-1);a1[4]=a0[0];a1[5]=a0[1];a1[6]=a0[2];a0=[a1[8],a1[9],a1[10]];T(a0,-1);a1[8]=a0[0];a1[9]=a0[1];a1[10]=a0[2];a0=[a1[3],a1[7],a1[11]];T(a0,-1);a1[3]=a0[0];a1[7]=a0[1];a1[11]=a0[2]}return new THREE.Matrix4(a1[0],a1[1],a1[2],a1[3],a1[4],a1[5],a1[6],a1[7],a1[8],a1[9],a1[10],a1[11],a1[12],a1[13],a1[14],a1[15])}function aA(a1){if(a1>-1&&a1<3){var a0=["X","Y","Z"],a2={X:0,Y:1,Z:2};a1=V(a0[a1]);a1=a2[a1]}return a1}function V(a0){if(ad.convertUpAxis){switch(a0){case"X":switch(A){case"XtoY":case"XtoZ":case"YtoX":a0="Y";break;case"ZtoX":a0="Z";break}break;case"Y":switch(A){case"XtoY":case"YtoX":case"ZtoX":a0="X";break;case"XtoZ":case"YtoZ":case"ZtoY":a0="Z";break}break;case"Z":switch(A){case"XtoZ":a0="X";break;case"YtoZ":case"ZtoX":case"ZtoY":a0="Y";break}break}}return a0}return{load:g,parse:am,setPreferredShading:E,applySkin:aT,geometries:ar,options:ad}};