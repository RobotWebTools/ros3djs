var ROS3D=ROS3D||{REVISION:"4"};ROS3D.MARKER_ARROW=0,ROS3D.MARKER_CUBE=1,ROS3D.MARKER_SPHERE=2,ROS3D.MARKER_CYLINDER=3,ROS3D.MARKER_LINE_STRIP=4,ROS3D.MARKER_LINE_LIST=5,ROS3D.MARKER_CUBE_LIST=6,ROS3D.MARKER_SPHERE_LIST=7,ROS3D.MARKER_POINTS=8,ROS3D.MARKER_TEXT_VIEW_FACING=9,ROS3D.MARKER_MESH_RESOURCE=10,ROS3D.MARKER_TRIANGLE_LIST=11,ROS3D.INTERACTIVE_MARKER_KEEP_ALIVE=0,ROS3D.INTERACTIVE_MARKER_POSE_UPDATE=1,ROS3D.INTERACTIVE_MARKER_MENU_SELECT=2,ROS3D.INTERACTIVE_MARKER_BUTTON_CLICK=3,ROS3D.INTERACTIVE_MARKER_MOUSE_DOWN=4,ROS3D.INTERACTIVE_MARKER_MOUSE_UP=5,ROS3D.INTERACTIVE_MARKER_NONE=0,ROS3D.INTERACTIVE_MARKER_MENU=1,ROS3D.INTERACTIVE_MARKER_BUTTON=2,ROS3D.INTERACTIVE_MARKER_MOVE_AXIS=3,ROS3D.INTERACTIVE_MARKER_MOVE_PLANE=4,ROS3D.INTERACTIVE_MARKER_ROTATE_AXIS=5,ROS3D.INTERACTIVE_MARKER_MOVE_ROTATE=6,ROS3D.INTERACTIVE_MARKER_INHERIT=0,ROS3D.INTERACTIVE_MARKER_FIXED=1,ROS3D.INTERACTIVE_MARKER_VIEW_FACING=2,ROS3D.makeColorMaterial=function(e,t,r,i){var o=new THREE.Color;return o.setRGB(e,t,r),.99>=i?new THREE.MeshBasicMaterial({color:o.getHex(),opacity:i+.1,transparent:!0,depthWrite:!0,blendSrc:THREE.SrcAlphaFactor,blendDst:THREE.OneMinusSrcAlphaFactor,blendEquation:THREE.ReverseSubtractEquation,blending:THREE.NormalBlending}):new THREE.MeshLambertMaterial({color:o.getHex(),opacity:i,blending:THREE.NormalBlending})},ROS3D.intersectPlane=function(e,t,r){var i=new THREE.Vector3,o=new THREE.Vector3;i.subVectors(t,e.origin);var n=e.direction.dot(r);if(Math.abs(n)<e.precision)return void 0;var a=r.dot(i)/n;return o.addVectors(e.origin,e.direction.clone().multiplyScalar(a)),o},ROS3D.findClosestPoint=function(e,t){var r=new THREE.Vector3;r.subVectors(e.origin,t.origin);var i=t.direction.clone(),o=e.direction.clone(),n=r.dot(i),a=i.dot(o),s=r.dot(o),c=i.dot(i),l=o.dot(o),h=l*c-a*a;if(1e-4>=Math.abs(h))return void 0;var d=n*a-s*c,p=d/h;return p},ROS3D.closestAxisPoint=function(e,t,r){var i=new THREE.Projector,o=e.origin.clone();i.projectVector(o,t);var n=e.direction.clone().add(e.origin);i.projectVector(n,t);var a=n.clone().sub(o),s=new THREE.Vector2,c=s.subVectors(r,o).dot(a)/a.dot(a),l=new THREE.Vector2;l.addVectors(o,a.clone().multiplyScalar(c));var h=new THREE.Vector3(l.x,l.y,.5);i.unprojectVector(h,t);var d=new THREE.Ray(t.position,h.sub(t.position).normalize());return ROS3D.findClosestPoint(e,d)},ROS3D.InteractiveMarker=function(e){THREE.Object3D.call(this),THREE.EventDispatcher.call(this);var t=this;e=e||{};var r=e.handle;this.name=r.name;var i=e.camera,o=e.path||"/";this.dragging=!1,this.onServerSetPose({pose:r.pose}),this.dragStart={position:new THREE.Vector3,orientation:new THREE.Quaternion,positionWorld:new THREE.Vector3,orientationWorld:new THREE.Quaternion,event3d:{}},r.controls.forEach(function(e){t.add(new ROS3D.InteractiveMarkerControl({parent:t,message:e,camera:i,path:o}))}),r.menuEntries.length>0&&(this.menu=new ROS3D.InteractiveMarkerMenu({menuEntries:r.menuEntries}),this.menu.addEventListener("menu-select",function(e){t.dispatchEvent(e)}))},ROS3D.InteractiveMarker.prototype.__proto__=THREE.Object3D.prototype,ROS3D.InteractiveMarker.prototype.showMenu=function(e,t){this.menu&&this.menu.show(e,t)},ROS3D.InteractiveMarker.prototype.moveAxis=function(e,t,r){if(this.dragging){var i=e.currentControlOri,o=t.clone().applyQuaternion(i),n=this.dragStart.event3d.intersection.point,a=o.clone().applyQuaternion(this.dragStart.orientationWorld.clone()),s=new THREE.Ray(n,a),c=ROS3D.closestAxisPoint(s,r.camera,r.mousePos),l=new THREE.Vector3;l.addVectors(this.dragStart.position,o.clone().applyQuaternion(this.dragStart.orientation).multiplyScalar(c)),this.setPosition(e,l),r.stopPropagation()}},ROS3D.InteractiveMarker.prototype.movePlane=function(e,t,r){if(this.dragging){var i=e.currentControlOri,o=t.clone().applyQuaternion(i),n=this.dragStart.event3d.intersection.point,a=o.clone().applyQuaternion(this.dragStart.orientationWorld),s=ROS3D.intersectPlane(r.mouseRay,n,a),c=new THREE.Vector3;c.subVectors(s,n),c.add(this.dragStart.positionWorld),this.setPosition(e,c),r.stopPropagation()}},ROS3D.InteractiveMarker.prototype.rotateAxis=function(e,t,r){if(this.dragging){e.updateMatrixWorld();var i=e.currentControlOri,o=i.clone().multiply(t.clone()),n=new THREE.Vector3(1,0,0).applyQuaternion(o),a=this.dragStart.event3d.intersection.point,s=n.applyQuaternion(this.dragStart.orientationWorld),c=ROS3D.intersectPlane(r.mouseRay,a,s),l=new THREE.Ray(this.dragStart.positionWorld,s),h=ROS3D.intersectPlane(l,a,s),d=this.dragStart.orientationWorld.clone().multiply(o),p=d.clone().inverse();c.sub(h),c.applyQuaternion(p);var u=this.dragStart.event3d.intersection.point.clone();u.sub(h),u.applyQuaternion(p);var E=Math.atan2(c.y,c.z),R=Math.atan2(u.y,u.z),m=R-E,v=new THREE.Quaternion;v.setFromAxisAngle(n,m),this.setOrientation(e,v.multiply(this.dragStart.orientationWorld)),r.stopPropagation()}},ROS3D.InteractiveMarker.prototype.feedbackEvent=function(e,t){this.dispatchEvent({type:e,position:this.position.clone(),orientation:this.quaternion.clone(),controlName:t.name})},ROS3D.InteractiveMarker.prototype.startDrag=function(e,t){if(0===t.domEvent.button){t.stopPropagation(),this.dragging=!0,this.updateMatrixWorld(!0);var r=new THREE.Vector3;this.matrixWorld.decompose(this.dragStart.positionWorld,this.dragStart.orientationWorld,r),this.dragStart.position=this.position.clone(),this.dragStart.orientation=this.quaternion.clone(),this.dragStart.event3d=t,this.feedbackEvent("user-mousedown",e)}},ROS3D.InteractiveMarker.prototype.stopDrag=function(e,t){0===t.domEvent.button&&(t.stopPropagation(),this.dragging=!1,this.dragStart.event3d={},this.onServerSetPose(this.bufferedPoseEvent),this.bufferedPoseEvent=void 0,this.feedbackEvent("user-mouseup",e))},ROS3D.InteractiveMarker.prototype.buttonClick=function(e,t){t.stopPropagation(),this.feedbackEvent("user-button-click",e)},ROS3D.InteractiveMarker.prototype.setPosition=function(e,t){this.position=t,this.feedbackEvent("user-pose-change",e)},ROS3D.InteractiveMarker.prototype.setOrientation=function(e,t){t.normalize(),this.quaternion=t,this.feedbackEvent("user-pose-change",e)},ROS3D.InteractiveMarker.prototype.onServerSetPose=function(e){if(void 0!==e)if(this.dragging)this.bufferedPoseEvent=e;else{var t=e.pose;this.position.x=t.position.x,this.position.y=t.position.y,this.position.z=t.position.z,this.useQuaternion=!0,this.quaternion=new THREE.Quaternion(t.orientation.x,t.orientation.y,t.orientation.z,t.orientation.w),this.updateMatrixWorld(!0)}},ROS3D.InteractiveMarkerClient=function(e){e=e||{},this.ros=e.ros,this.tfClient=e.tfClient,this.topic=e.topic,this.path=e.path||"/",this.camera=e.camera,this.rootObject=e.rootObject||new THREE.Object3D,this.interactiveMarkers={},this.updateTopic=null,this.feedbackTopic=null,this.topic&&this.subscribe(this.topic)},ROS3D.InteractiveMarkerClient.prototype.subscribe=function(e){this.unsubscribe(),this.updateTopic=new ROSLIB.Topic({ros:this.ros,name:e+"/tunneled/update",messageType:"visualization_msgs/InteractiveMarkerUpdate",compression:"png"}),this.updateTopic.subscribe(this.processUpdate.bind(this)),this.feedbackTopic=new ROSLIB.Topic({ros:this.ros,name:e+"/feedback",messageType:"visualization_msgs/InteractiveMarkerFeedback",compression:"png"}),this.feedbackTopic.advertise(),this.initService=new ROSLIB.Service({ros:this.ros,name:e+"/tunneled/get_init",serviceType:"demo_interactive_markers/GetInit"});var t=new ROSLIB.ServiceRequest({});this.initService.callService(t,this.processInit.bind(this))},ROS3D.InteractiveMarkerClient.prototype.unsubscribe=function(){this.updateTopic&&this.updateTopic.unsubscribe(),this.feedbackTopic&&this.feedbackTopic.unadvertise();for(var e in this.interactiveMarkers)this.eraseIntMarker(e);this.interactiveMarkers={}},ROS3D.InteractiveMarkerClient.prototype.processInit=function(e){var t=e.msg;t.erases=[];for(var r in this.interactiveMarkers)t.erases.push(r);t.poses=[],this.processUpdate(t)},ROS3D.InteractiveMarkerClient.prototype.processUpdate=function(e){var t=this;e.erases.forEach(function(e){t.eraseIntMarker(e)}),e.poses.forEach(function(e){var r=t.interactiveMarkers[e.name];r&&r.setPoseFromServer(e.pose)}),e.markers.forEach(function(e){var r=t.interactiveMarkers[e.name];r&&t.eraseIntMarker(r.name);var i=new ROS3D.InteractiveMarkerHandle({message:e,feedbackTopic:t.feedbackTopic,tfClient:t.tfClient});t.interactiveMarkers[e.name]=i;var o=new ROS3D.InteractiveMarker({handle:i,camera:t.camera,path:t.path});o.name=e.name,t.rootObject.add(o),i.on("pose",function(e){o.onServerSetPose({pose:e})}),o.addEventListener("user-pose-change",i.setPoseFromClient.bind(i)),o.addEventListener("user-mousedown",i.onMouseDown.bind(i)),o.addEventListener("user-mouseup",i.onMouseUp.bind(i)),o.addEventListener("user-button-click",i.onButtonClick.bind(i)),o.addEventListener("menu-select",i.onMenuSelect.bind(i)),i.subscribeTf()})},ROS3D.InteractiveMarkerClient.prototype.eraseIntMarker=function(e){this.interactiveMarkers[e]&&(this.rootObject.remove(this.rootObject.getChildByName(e)),delete this.interactiveMarkers[e])},ROS3D.InteractiveMarkerControl=function(e){function t(e){e.stopPropagation()}var r=this;THREE.Object3D.call(this),THREE.EventDispatcher.call(this),e=e||{},this.parent=e.parent;var i=e.message;this.name=i.name,this.camera=e.camera,this.path=e.path||"/",this.dragging=!1;var o=new THREE.Quaternion(i.orientation.x,i.orientation.y,i.orientation.z,i.orientation.w);o.normalize();var n=new THREE.Vector3(1,0,0);switch(n.applyQuaternion(o),this.currentControlOri=new THREE.Quaternion,i.interaction_mode){case ROS3D.INTERACTIVE_MARKER_MOVE_AXIS:this.addEventListener("mousemove",this.parent.moveAxis.bind(this.parent,this,n)),this.addEventListener("touchmove",this.parent.moveAxis.bind(this.parent,this,n));break;case ROS3D.INTERACTIVE_MARKER_ROTATE_AXIS:this.addEventListener("mousemove",this.parent.rotateAxis.bind(this.parent,this,o));break;case ROS3D.INTERACTIVE_MARKER_MOVE_PLANE:this.addEventListener("mousemove",this.parent.movePlane.bind(this.parent,this,n));break;case ROS3D.INTERACTIVE_MARKER_BUTTON:this.addEventListener("click",this.parent.buttonClick.bind(this.parent,this));break;default:}i.interaction_mode!==ROS3D.INTERACTIVE_MARKER_NONE&&(this.addEventListener("mousedown",this.parent.startDrag.bind(this.parent,this)),this.addEventListener("mouseup",this.parent.stopDrag.bind(this.parent,this)),this.addEventListener("contextmenu",this.parent.showMenu.bind(this.parent,this)),this.addEventListener("mouseover",t),this.addEventListener("mouseout",t),this.addEventListener("click",t),this.addEventListener("touchstart",function(e){console.log(e.domEvent),1===e.domEvent.touches.length&&(e.type="mousedown",e.domEvent.button=0,r.dispatchEvent(e))}),this.addEventListener("touchmove",function(e){1===e.domEvent.touches.length&&(console.log(e.domEvent),e.type="mousemove",e.domEvent.button=0,r.dispatchEvent(e))}),this.addEventListener("touchend",function(e){0===e.domEvent.touches.length&&(e.domEvent.button=0,e.type="mouseup",r.dispatchEvent(e),e.type="click",r.dispatchEvent(e))}));var a=new THREE.Quaternion,s=this.parent.position.clone().multiplyScalar(-1);switch(i.orientation_mode){case ROS3D.INTERACTIVE_MARKER_INHERIT:a=this.parent.quaternion.clone().inverse(),this.updateMatrixWorld=function(e){ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(r,e),r.currentControlOri.copy(r.quaternion),r.currentControlOri.normalize()};break;case ROS3D.INTERACTIVE_MARKER_FIXED:this.updateMatrixWorld=function(e){r.useQuaternion=!0,r.quaternion=r.parent.quaternion.clone().inverse(),r.updateMatrix(),r.matrixWorldNeedsUpdate=!0,ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(r,e),r.currentControlOri.copy(r.quaternion)};break;case ROS3D.INTERACTIVE_MARKER_VIEW_FACING:var c=i.independentMarkerOrientation;this.updateMatrixWorld=function(e){r.camera.updateMatrixWorld();var t=(new THREE.Matrix4).extractRotation(r.camera.matrixWorld),i=new THREE.Matrix4,o=.5*Math.PI,n=new THREE.Vector3(-o,0,o);i.setRotationFromEuler(n);var a=new THREE.Matrix4;a.getInverse(r.parent.matrixWorld),t.multiplyMatrices(t,i),t.multiplyMatrices(a,t),r.currentControlOri.setFromRotationMatrix(t),c||(r.useQuaternion=!0,r.quaternion.copy(r.currentControlOri),r.updateMatrix(),r.matrixWorldNeedsUpdate=!0),ROS3D.InteractiveMarkerControl.prototype.updateMatrixWorld.call(r,e)};break;default:console.error("Unkown orientation mode: "+i.orientation_mode)}i.markers.forEach(function(e){var t=new ROS3D.Marker({message:e,path:r.path});""!==e.header.frame_id&&(t.position.add(s),t.position.applyQuaternion(a),t.quaternion.multiplyQuaternions(a,t.quaternion),t.updateMatrixWorld()),r.add(t)})},ROS3D.InteractiveMarkerControl.prototype.__proto__=THREE.Object3D.prototype,ROS3D.InteractiveMarkerHandle=function(e){e=e||{},this.message=e.message,this.feedbackTopic=e.feedbackTopic,this.tfClient=e.tfClient,this.name=this.message.name,this.header=this.message.header,this.controls=this.message.controls,this.menuEntries=this.message.menu_entries,this.dragging=!1,this.timeoutHandle=null,this.tfTransform=new ROSLIB.Transform,this.pose=new ROSLIB.Pose,this.setPoseFromServer(this.message.pose)},ROS3D.InteractiveMarkerHandle.prototype.__proto__=EventEmitter2.prototype,ROS3D.InteractiveMarkerHandle.prototype.subscribeTf=function(){0===this.message.header.stamp.secs&&0===this.message.header.stamp.nsecs&&this.tfClient.subscribe(this.message.header.frame_id,this.tfUpdate.bind(this))},ROS3D.InteractiveMarkerHandle.prototype.emitServerPoseUpdate=function(){var e=new ROSLIB.Pose(this.pose);e.applyTransform(this.tfTransform),this.emit("pose",e)},ROS3D.InteractiveMarkerHandle.prototype.setPoseFromServer=function(e){this.pose=new ROSLIB.Pose(e),this.emitServerPoseUpdate()},ROS3D.InteractiveMarkerHandle.prototype.tfUpdate=function(e){this.tfTransform=new ROSLIB.Transform(e),this.emitServerPoseUpdate()},ROS3D.InteractiveMarkerHandle.prototype.setPoseFromClient=function(e){this.pose=new ROSLIB.Pose(e);var t=this.tfTransform.clone();t.rotation.invert(),this.pose.applyTransform(t),this.sendFeedback(ROS3D.INTERACTIVE_MARKER_POSE_UPDATE,void 0,0,e.controlName),this.dragging&&(this.timeoutHandle&&clearTimeout(this.timeoutHandle),this.timeoutHandle=setTimeout(this.setPoseFromClient.bind(this,e),250))},ROS3D.InteractiveMarkerHandle.prototype.onButtonClick=function(e){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_BUTTON_CLICK,e.clickPosition,0,e.controlName)},ROS3D.InteractiveMarkerHandle.prototype.onMouseDown=function(e){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MOUSE_DOWN,e.clickPosition,0,e.controlName),this.dragging=!0},ROS3D.InteractiveMarkerHandle.prototype.onMouseUp=function(e){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MOUSE_UP,e.clickPosition,0,e.controlName),this.dragging=!1,this.timeoutHandle&&clearTimeout(this.timeoutHandle)},ROS3D.InteractiveMarkerHandle.prototype.onMenuSelect=function(e){this.sendFeedback(ROS3D.INTERACTIVE_MARKER_MENU_SELECT,void 0,e.id,e.controlName)},ROS3D.InteractiveMarkerHandle.prototype.sendFeedback=function(e,t,r,i){var o=void 0!==t;t=t||{x:0,y:0,z:0};var n={header:this.header,client_id:this.clientID,marker_name:this.name,control_name:i,event_type:e,pose:this.pose,mouse_point:t,mouse_point_valid:o,menu_entry_id:r};this.feedbackTopic.publish(n)},ROS3D.InteractiveMarkerMenu=function(e){function t(e,t){this.dispatchEvent({type:"menu-select",domEvent:t,id:e.id,controlName:this.controlName}),this.hide(t)}function r(e,o){var n=document.createElement("ul");e.appendChild(n);for(var a=o.children,s=0;a.length>s;s++){var c=document.createElement("li"),l=document.createElement("div");l.appendChild(document.createTextNode(a[s].title)),n.appendChild(c),c.appendChild(l),a[s].children.length>0?(r(c,a[s]),l.addEventListener("click",i.hide.bind(i))):(l.addEventListener("click",t.bind(i,a[s])),l.className="default-interactive-marker-menu-entry")}}var i=this;e=e||{};var o=e.menuEntries,n=e.className||"default-interactive-marker-menu";e.entryClassName||"default-interactive-marker-menu-entry";var a=e.overlayClassName||"default-interactive-marker-overlay",s=[];if(s[0]={children:[]},THREE.EventDispatcher.call(this),null===document.getElementById("default-interactive-marker-menu-css")){var c=document.createElement("style");c.id="default-interactive-marker-menu-css",c.type="text/css",c.innerHTML=".default-interactive-marker-menu {background-color: #444444;border: 1px solid #888888;border: 1px solid #888888;padding: 0px 0px 0px 0px;color: #FFFFFF;font-family: sans-serif;font-size: 0.8em;z-index: 1002;}.default-interactive-marker-menu ul {padding: 0px 0px 5px 0px;margin: 0px;list-style-type: none;}.default-interactive-marker-menu ul li div {-webkit-touch-callout: none;-webkit-user-select: none;-khtml-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;cursor: default;padding: 3px 10px 3px 10px;}.default-interactive-marker-menu-entry:hover {  background-color: #666666;  cursor: pointer;}.default-interactive-marker-menu ul ul {  font-style: italic;  padding-left: 10px;}.default-interactive-marker-overlay {  position: absolute;  top: 0%;  left: 0%;  width: 100%;  height: 100%;  background-color: black;  z-index: 1001;  -moz-opacity: 0.0;  opacity: .0;  filter: alpha(opacity = 0);}",document.getElementsByTagName("head")[0].appendChild(c)}this.menuDomElem=document.createElement("div"),this.menuDomElem.style.position="absolute",this.menuDomElem.className=n,this.menuDomElem.addEventListener("contextmenu",function(e){e.preventDefault()}),this.overlayDomElem=document.createElement("div"),this.overlayDomElem.className=a,this.hideListener=this.hide.bind(this),this.overlayDomElem.addEventListener("contextmenu",this.hideListener),this.overlayDomElem.addEventListener("click",this.hideListener);var l,h,d;for(l=0;o.length>l;l++)h=o[l],d=h.id,s[d]={title:h.title,id:d,children:[]};for(l=0;o.length>l;l++){h=o[l],d=h.id;var p=s[d],u=s[h.parent_id];u.children.push(p)}r(this.menuDomElem,s[0])},ROS3D.InteractiveMarkerMenu.prototype.show=function(e,t){t&&t.preventDefault&&t.preventDefault(),this.controlName=e.name,this.menuDomElem.style.left=t.domEvent.clientX+"px",this.menuDomElem.style.top=t.domEvent.clientY+"px",document.body.appendChild(this.overlayDomElem),document.body.appendChild(this.menuDomElem)},ROS3D.InteractiveMarkerMenu.prototype.hide=function(e){e&&e.preventDefault&&e.preventDefault(),document.body.removeChild(this.overlayDomElem),document.body.removeChild(this.menuDomElem)},ROS3D.OccupancyGrid=function(e){e=e||{};var t=e.message,r=t.info.width,i=t.info.height,o=new THREE.PlaneGeometry(r,i),n=document.createElement("canvas");n.width=r,n.height=i;for(var a=n.getContext("2d"),s=a.createImageData(r,i),c=0;i>c;c++)for(var l=0;r>l;l++){var h,d=l+(i-c-1)*r,p=t.data[d];h=100===p?0:0===p?255:127;var u=4*(l+c*r);s.data[u]=h,s.data[++u]=h,s.data[++u]=h,s.data[++u]=255}a.putImageData(s,0,0);var E=new THREE.Texture(n);E.needsUpdate=!0;var R=new THREE.MeshBasicMaterial({map:E});R.side=THREE.DoubleSide,THREE.Mesh.call(this,o,R),this.position.x=r*t.info.resolution/2,this.position.y=i*t.info.resolution/2,this.scale.x=t.info.resolution,this.scale.y=t.info.resolution},ROS3D.OccupancyGrid.prototype.__proto__=THREE.Mesh.prototype,ROS3D.OccupancyGridClient=function(e){var t=this;e=e||{};var r=e.ros,i=e.topic||"/map";this.continuous=e.continuous,this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.currentGrid=null;var o=new ROSLIB.Topic({ros:r,name:i,messageType:"nav_msgs/OccupancyGrid",compression:"png"});o.subscribe(function(e){t.currentGrid&&t.rootObject.remove(t.currentGrid);var r=new ROS3D.OccupancyGrid({message:e});t.currentGrid=t.tfClient?new ROS3D.SceneNode({frameID:e.header.frame_id,tfClient:t.tfClient,object:r,pose:e.info.origin}):r,t.rootObject.add(t.currentGrid),t.emit("change"),t.continuous||o.unsubscribe()})},ROS3D.OccupancyGridClient.prototype.__proto__=EventEmitter2.prototype,ROS3D.Marker=function(e){e=e||{};var t=e.path||"/",r=e.message;"/"!==t.substr(t.length-1)&&(t+="/"),THREE.Object3D.call(this),this.useQuaternion=!0,this.setPose(r.pose);var i=ROS3D.makeColorMaterial(r.color.r,r.color.g,r.color.b,r.color.a);switch(r.type){case ROS3D.MARKER_ARROW:var o,n=r.scale.x,a=.23*n,s=r.scale.y,c=.5*s,l=null;if(2===r.points.length){l=new THREE.Vector3(r.points[0].x,r.points[0].y,r.points[0].z);var h=new THREE.Vector3(r.points[1].x,r.points[1].y,r.points[1].z);o=l.clone().negate().add(h),n=o.length(),s=r.scale.y,c=r.scale.x,0!==r.scale.z&&(a=r.scale.z)}this.add(new ROS3D.Arrow({direction:o,origin:l,length:n,headLength:a,shaftDiameter:c,headDiameter:s,material:i}));break;case ROS3D.MARKER_CUBE:var d=new THREE.CubeGeometry(r.scale.x,r.scale.y,r.scale.z);this.add(new THREE.Mesh(d,i));break;case ROS3D.MARKER_SPHERE:var p=new THREE.SphereGeometry(.5),u=new THREE.Mesh(p,i);u.scale.x=r.scale.x,u.scale.y=r.scale.y,u.scale.z=r.scale.z,this.add(u);break;case ROS3D.MARKER_CYLINDER:var E=new THREE.CylinderGeometry(.5,.5,1,16,1,!1),R=new THREE.Mesh(E,i);R.useQuaternion=!0,R.quaternion.setFromAxisAngle(new THREE.Vector3(1,0,0),.5*Math.PI),R.scale=new THREE.Vector3(r.scale.x,r.scale.y,r.scale.z),this.add(R);break;case ROS3D.MARKER_CUBE_LIST:case ROS3D.MARKER_SPHERE_LIST:case ROS3D.MARKER_POINTS:var m,v=new THREE.Geometry,T=new THREE.ParticleBasicMaterial({size:r.scale.x});for(m=0;r.points.length>m;m++){var O=new THREE.Vector3;O.x=r.points[m].x,O.y=r.points[m].y,O.z=r.points[m].z,v.vertices.push(O)}if(r.colors.length===r.points.length)for(T.vertexColors=!0,m=0;r.points.length>m;m++){var f=new THREE.Color;f.setRGB(r.colors[m].r,r.colors[m].g,r.colors[m].b),v.colors.push(f)}else T.color.setRGB(r.color.r,r.color.g,r.color.b);this.add(new THREE.ParticleSystem(v,T));break;case ROS3D.MARKER_TEXT_VIEW_FACING:var S=new THREE.TextGeometry(r.text,{size:.5*r.scale.x,height:.1*r.scale.x,curveSegments:4,font:"helvetiker",bevelEnabled:!1,bevelThickness:2,bevelSize:2,material:0,extrudeMaterial:0});S.computeVertexNormals(),S.computeBoundingBox();var g=new THREE.Mesh(S,i),M=-.5*(S.boundingBox.max.x-S.boundingBox.min.x);g.position.y=-M,g.rotation.x=.5*Math.PI,g.rotation.y=1.5*Math.PI,this.add(g);break;case ROS3D.MARKER_MESH_RESOURCE:this.add(new ROS3D.MeshResource({path:t,resource:r.mesh_resource.substr(10)}));break;case ROS3D.MARKER_TRIANGLE_LIST:var b=new ROS3D.TriangleList({material:i,vertices:r.points,colors:r.colors});b.scale=new THREE.Vector3(r.scale.x,r.scale.y,r.scale.z),this.add(b);break;default:console.error("Currently unsupported marker type: "+r.type)}},ROS3D.Marker.prototype.__proto__=THREE.Object3D.prototype,ROS3D.Marker.prototype.setPose=function(e){this.position.x=e.position.x,this.position.y=e.position.y,this.position.z=e.position.z,this.quaternion=new THREE.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.quaternion.normalize(),this.updateMatrixWorld()},ROS3D.MarkerClient=function(e){var t=this;e=e||{};var r=e.ros,i=e.topic;this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D,this.currentMarker=null;var o=new ROSLIB.Topic({ros:r,name:i,messageType:"visualization_msgs/Marker",compression:"png"});o.subscribe(function(e){var r=new ROS3D.Marker({message:e});t.currentMarker&&t.rootObject.remove(t.currentMarker),t.currentMarker=new ROS3D.SceneNode({frameID:e.header.frame_id,tfClient:t.tfClient,object:r}),t.rootObject.add(t.currentMarker),t.emit("change")})},ROS3D.MarkerClient.prototype.__proto__=EventEmitter2.prototype,ROS3D.Arrow=function(e){e=e||{};var t=e.origin||new THREE.Vector3(0,0,0),r=e.direction||new THREE.Vector3(1,0,0),i=e.length||1,o=e.headLength||.2,n=e.shaftDiameter||.05,a=e.headDiameter||.1,s=e.material||new THREE.MeshBasicMaterial,c=i-o,l=new THREE.CylinderGeometry(.5*n,.5*n,c,12,1),h=new THREE.Matrix4;h.setPosition(new THREE.Vector3(0,.5*c,0)),l.applyMatrix(h);var d=new THREE.CylinderGeometry(0,.5*a,o,12,1);h.setPosition(new THREE.Vector3(0,c+.5*o,0)),d.applyMatrix(h),THREE.GeometryUtils.merge(l,d),THREE.Mesh.call(this,l,s),this.position=t,this.setDirection(r)},ROS3D.Arrow.prototype.__proto__=THREE.Mesh.prototype,ROS3D.Arrow.prototype.setDirection=function(e){var t=new THREE.Vector3(0,1,0).cross(e),r=Math.acos(new THREE.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),r),this.rotation.setEulerFromRotationMatrix(this.matrix,this.eulerOrder)},ROS3D.Arrow.prototype.setLength=function(e){this.scale.set(e,e,e)},ROS3D.Arrow.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},ROS3D.Axes=function(e){function t(e){var t=new THREE.Color;t.setRGB(e.x,e.y,e.z);var i=new THREE.MeshBasicMaterial({color:t.getHex()}),o=new THREE.Vector3;o.crossVectors(e,new THREE.Vector3(0,-1,0));var n=new THREE.Quaternion;n.setFromAxisAngle(o,.5*Math.PI);var a=new THREE.Mesh(r.headGeom,i);a.position=e.clone(),a.position.multiplyScalar(.95),a.useQuaternion=!0,a.quaternion=n,a.updateMatrix(),r.add(a);var s=new THREE.Mesh(r.lineGeom,i);s.position=e.clone(),s.position.multiplyScalar(.45),s.useQuaternion=!0,s.quaternion=n,s.updateMatrix(),r.add(s)}var r=this;e=e||{};var i=e.shaftRadius||.008,o=e.headRadius||.023,n=e.headLength||.1;THREE.Object3D.call(this),this.lineGeom=new THREE.CylinderGeometry(i,i,1-n),this.headGeom=new THREE.CylinderGeometry(0,o,n),t(new THREE.Vector3(1,0,0)),t(new THREE.Vector3(0,1,0)),t(new THREE.Vector3(0,0,1))},ROS3D.Axes.prototype.__proto__=THREE.Object3D.prototype,ROS3D.Grid=function(e){e=e||{};var t=e.size||50,r=e.color||"#cccccc",i=e.lineWidth||1;THREE.Mesh.call(this,new THREE.PlaneGeometry(t,t,t,t),new THREE.MeshBasicMaterial({color:r,wireframe:!0,wireframeLinewidth:i,transparent:!0}))},ROS3D.Grid.prototype.__proto__=THREE.Mesh.prototype,ROS3D.MeshResource=function(e){var t=this;e=e||{};var r=e.path||"/",i=e.resource;this.warnings=e.warnings,THREE.Object3D.call(this),"/"!==r.substr(r.length-1)&&(this.path+="/");var o=r+i;if(o.substr(-4).toLowerCase(),".dae"===o.substr(-4).toLowerCase()){var n=new ColladaLoader2;n.log=function(e){t.warnings&&console.warn(e)},n.load(o,function(e){if(e.dae.asset.unit){var r=e.dae.asset.unit;e.scene.scale=new THREE.Vector3(r,r,r)}t.add(e.scene)})}},ROS3D.MeshResource.prototype.__proto__=THREE.Object3D.prototype,ROS3D.TriangleList=function(e){e=e||{};var t=e.material||new THREE.MeshBasicMaterial,r=e.vertices,i=e.colors;THREE.Object3D.call(this),t.side=THREE.DoubleSide;var o=new THREE.Geometry;for(n=0;r.length>n;n++)o.vertices.push(new THREE.Vector3(r[n].x,r[n].y,r[n].z));var n,a;if(i.length===r.length){for(n=0;r.length>n;n+=3){var s=new THREE.Face3(n,n+1,n+2);for(a=3*n;3*n+3>a;n++){var c=new THREE.Color;c.setRGB(i[n].r,i[n].g,i[n].b),s.vertexColors.push(c)}o.faces.push(h)}t.vertexColors=THREE.VertexColors}else if(i.length===r.length/3){for(n=0;r.length>n;n+=3){var l=new THREE.Face3(n,n+1,n+2);l.color.setRGB(i[n/3].r,i[n/3].g,i[n/3].b),o.faces.push(l)}t.vertexColors=THREE.FaceColors}else for(n=0;r.length>n;n+=3){var h=new THREE.Face3(n,n+1,n+2);o.faces.push(h)}o.computeBoundingBox(),o.computeBoundingSphere(),o.computeCentroids(),o.computeFaceNormals(),this.add(new THREE.Mesh(o,t))},ROS3D.TriangleList.prototype.__proto__=THREE.Object3D.prototype,ROS3D.TriangleList.prototype.setColor=function(e){this.mesh.material.color.setHex(e)},ROS3D.Urdf=function(e){e=e||{};var t=e.urdfModel,r=e.path||"/",i=e.tfClient;THREE.Object3D.call(this),this.useQuaternion=!0;var o=t.links;for(var n in o){var a=o[n];if(a.visual&&a.visual.geometry&&a.visual.geometry.type===ROSLIB.URDF_MESH){var s="/"+a.name,c=a.visual.geometry.filename,l=c.substr(-4).toLowerCase();if(".dae"===l){var h=new ROS3D.SceneNode({frameID:s,pose:a.visual.origin,tfClient:i,object:new ROS3D.MeshResource({path:r,resource:c.substring(10)})});this.add(h)}}}},ROS3D.Urdf.prototype.__proto__=THREE.Object3D.prototype,ROS3D.UrdfClient=function(e){var t=this;e=e||{};var r=e.ros,i=e.param||"robot_description";this.path=e.path||"/",this.tfClient=e.tfClient,this.rootObject=e.rootObject||new THREE.Object3D;var o=new ROSLIB.Param({ros:r,name:i});o.get(function(e){var r=new ROSLIB.UrdfModel({string:e});t.rootObject.add(new ROS3D.Urdf({urdfModel:r,path:t.path,tfClient:t.tfClient}))})},ROS3D.SceneNode=function(e){e=e||{};var t=this,r=e.tfClient,i=e.frameID,o=e.object;this.pose=e.pose||new ROSLIB.Pose,THREE.Object3D.call(this),this.useQuaternion=!0,this.add(o),this.updatePose(this.pose),r.subscribe(i,function(e){var r=new ROSLIB.Transform(e),i=new ROSLIB.Pose(t.pose);i.applyTransform(r),t.updatePose(i)})},ROS3D.SceneNode.prototype.__proto__=THREE.Object3D.prototype,ROS3D.SceneNode.prototype.updatePose=function(e){this.position.x=e.position.x,this.position.y=e.position.y,this.position.z=e.position.z,this.quaternion=new THREE.Quaternion(e.orientation.x,e.orientation.y,e.orientation.z,e.orientation.w),this.updateMatrixWorld(!0)},ROS3D.Viewer=function(e){function t(){r.cameraControls.update(),r.directionalLight.position=r.camera.localToWorld(new THREE.Vector3(-1,1,0)),r.directionalLight.position.normalize(),r.renderer.clear(!0,!0,!0),r.renderer.render(r.scene,r.camera),r.highlighter.renderHighlight(r.renderer,r.scene,r.camera),requestAnimationFrame(t)}var r=this;e=e||{};var i=e.divID,o=e.width,n=e.height,a=e.background||"#111111";e.antialias;var s=e.intensity||.66,c=e.cameraPose||{x:3,y:3,z:3};this.renderer=new THREE.WebGLRenderer({antialias:this.antialias}),this.renderer.setClearColorHex(a.replace("#","0x"),1),this.renderer.sortObjects=!1,this.renderer.setSize(o,n),this.renderer.shadowMapEnabled=!1,this.renderer.autoClear=!1,this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(40,o/n,.01,1e3),this.camera.position.x=c.x,this.camera.position.y=c.y,this.camera.position.z=c.z,this.cameraControls=new ROS3D.OrbitControls({scene:this.scene,camera:this.camera}),this.cameraControls.userZoomSpeed=.5,this.scene.add(new THREE.AmbientLight(5592405)),this.directionalLight=new THREE.DirectionalLight(16777215,s),this.scene.add(this.directionalLight),this.selectableObjects=new THREE.Object3D,this.scene.add(this.selectableObjects);var l=new ROS3D.MouseHandler({renderer:this.renderer,camera:this.camera,rootObject:this.selectableObjects,fallbackTarget:this.cameraControls});this.highlighter=new ROS3D.Highlighter({mouseHandler:l}),document.getElementById(i).appendChild(this.renderer.domElement),t()},ROS3D.Viewer.prototype.addObject=function(e,t){t?this.selectableObjects.add(e):this.scene.add(e)},ROS3D.Highlighter=function(e){e=e||{};var t=e.mouseHandler;this.hoverObjs=[],t.addEventListener("mouseover",this.onMouseOver.bind(this)),t.addEventListener("mouseout",this.onMouseOut.bind(this))},ROS3D.Highlighter.prototype.onMouseOver=function(e){this.hoverObjs.push(e.currentTarget)},ROS3D.Highlighter.prototype.onMouseOut=function(e){this.hoverObjs.splice(this.hoverObjs.indexOf(e.currentTarget),1)},ROS3D.Highlighter.prototype.getWebglObjects=function(e,t,r){for(var i=e.__webglObjects,o=0;t.length>o;o++)if(t[o]){for(var n=i.length-1;n>=0;n--)if(i[n].object===t[o]){r.push(i[n]);break}this.getWebglObjects(e,t[o].children,r)}},ROS3D.Highlighter.prototype.renderHighlight=function(e,t,r){var i=[];this.getWebglObjects(t,this.hoverObjs,i),t.overrideMaterial=new THREE.MeshBasicMaterial({fog:!1,opacity:.5,depthTest:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetUnits:-1,side:THREE.DoubleSide});var o=t.__webglObjects;t.__webglObjects=i,e.render(t,r),t.__webglObjects=o,t.overrideMaterial=null},ROS3D.MouseHandler=function(e){THREE.EventDispatcher.call(this),this.renderer=e.renderer,this.camera=e.camera,this.rootObject=e.rootObject,this.fallbackTarget=e.fallbackTarget,this.lastTarget=this.fallbackTarget,this.dragging=!1,this.projector=new THREE.Projector;var t=["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"];this.listeners={},t.forEach(function(e){this.listeners[e]=this.processDomEvent.bind(this),this.renderer.domElement.addEventListener(e,this.listeners[e],!1)},this)},ROS3D.MouseHandler.prototype.processDomEvent=function(e){e.preventDefault();
var t=e.target,r=t.getBoundingClientRect(),i=e.clientX-r.left-t.clientLeft+t.scrollLeft,o=e.clientY-r.top-t.clientTop+t.scrollTop,n=2*(i/t.clientWidth)-1,a=2*(-o/t.clientHeight)+1,s=new THREE.Vector3(n,a,.5);this.projector.unprojectVector(s,this.camera);var c=new THREE.Raycaster(this.camera.position.clone(),s.sub(this.camera.position).normalize()),l=c.ray,h={mousePos:new THREE.Vector2(n,a),mouseRay:l,domEvent:e,camera:this.camera,intersection:this.lastIntersection};if("mouseout"===e.type)return this.dragging&&(this.notify(this.lastTarget,"mouseup",h),this.dragging=!1),this.notify(this.lastTarget,"mouseout",h),this.lastTarget=null,void 0;if(this.dragging)return this.notify(this.lastTarget,e.type,h),("mouseup"===e.type&&2===e.button||"click"===e.type)&&(this.dragging=!1),void 0;t=this.lastTarget;var d=[];if(d=c.intersectObject(this.rootObject,!0),d.length>0?(t=d[0].object,h.intersection=this.lastIntersection=d[0]):t=this.fallbackTarget,t!==this.lastTarget){var p=this.notify(t,"mouseover",h);p?this.notify(this.lastTarget,"mouseout",h):(t=this.fallbackTarget,t!==this.lastTarget&&(this.notify(t,"mouseover",h),this.notify(this.lastTarget,"mouseout",h)))}this.notify(t,e.type,h),"mousedown"===e.type&&(this.dragging=!0),this.lastTarget=t},ROS3D.MouseHandler.prototype.notify=function(e,t,r){for(r.type=t,r.cancelBubble=!1,r.stopPropagation=function(){r.cancelBubble=!0},r.currentTarget=e;r.currentTarget;){if(r.currentTarget.dispatchEvent&&r.currentTarget.dispatchEvent instanceof Function&&(r.currentTarget.dispatchEvent(r),r.cancelBubble))return this.dispatchEvent(r),!0;r.currentTarget=r.currentTarget.parent}return!1},ROS3D.OrbitControls=function(e){function t(e){var t=e.domEvent;switch(t.preventDefault(),t.button){case 0:g=S.ROTATE,d.set(t.clientX,t.clientY);break;case 1:g=S.MOVE,T=new THREE.Vector3(0,0,1);var r=(new THREE.Matrix4).extractRotation(this.camera.matrix);T.applyMatrix4(r),v=c.center.clone(),O=c.camera.position.clone(),f=i(e.mouseRay,v,T);break;case 2:g=S.ZOOM,E.set(t.clientX,t.clientY)}this.showAxes()}function r(e){var t=e.domEvent;if(g===S.ROTATE)p.set(t.clientX,t.clientY),u.subVectors(p,d),c.rotateLeft(2*Math.PI*u.x/h*c.userRotateSpeed),c.rotateUp(2*Math.PI*u.y/h*c.userRotateSpeed),d.copy(p),this.showAxes();else if(g===S.ZOOM)R.set(t.clientX,t.clientY),m.subVectors(R,E),m.y>0?c.zoomIn():c.zoomOut(),E.copy(R),this.showAxes();else if(g===S.MOVE){var r=i(e.mouseRay,c.center,T);if(!r)return;var o=(new THREE.Vector3).subVectors(f.clone(),r.clone());c.center.addVectors(v.clone(),o.clone()),c.camera.position.addVectors(O.clone(),o.clone()),c.update(),c.camera.updateMatrixWorld(),this.showAxes()}}function i(e,t,r){var i=new THREE.Vector3,o=new THREE.Vector3;i.subVectors(t,e.origin);var n=e.direction.dot(r);if(Math.abs(n)<e.precision)return null;var a=r.dot(i)/n;return o=e.direction.clone().multiplyScalar(a)}function o(){c.userRotate&&(g=S.NONE)}function n(e){if(c.userZoom){var t,r=e.domEvent;t=r.wheelDelta!==void 0?r.wheelDelta:-r.detail,t>0?c.zoomOut():c.zoomIn(),this.showAxes()}}function a(e){t(e),e.preventDefault()}function s(e){r(e),e.preventDefault()}THREE.EventDispatcher.call(this);var c=this;e=e||{};var l=e.scene;this.camera=e.camera,this.center=new THREE.Vector3,this.userZoom=!0,this.userZoomSpeed=e.userZoomSpeed||1,this.userRotate=!0,this.userRotateSpeed=e.userRotateSpeed||1,this.autoRotate=e.autoRotate,this.autoRotateSpeed=e.autoRotateSpeed||2,this.camera.up=new THREE.Vector3(0,0,1);var h=1800,d=new THREE.Vector2,p=new THREE.Vector2,u=new THREE.Vector2,E=new THREE.Vector2,R=new THREE.Vector2,m=new THREE.Vector2,v=new THREE.Vector3,T=new THREE.Vector3,O=new THREE.Vector3,f=new THREE.Vector3;this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.lastPosition=new THREE.Vector3;var S={NONE:-1,ROTATE:0,ZOOM:1,MOVE:2},g=S.NONE;this.axes=new ROS3D.Axes({shaftRadius:.025,headRadius:.07,headLength:.2}),l.add(this.axes),this.axes.traverse(function(e){e.visible=!1}),this.addEventListener("mousedown",t),this.addEventListener("mouseup",o),this.addEventListener("mousemove",r),this.addEventListener("touchstart",a),this.addEventListener("touchmove",s),this.addEventListener("mousewheel",n),this.addEventListener("DOMMouseScroll",n)},ROS3D.OrbitControls.prototype.showAxes=function(){var e=this;this.axes.traverse(function(e){e.visible=!0}),this.hideTimeout&&clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(function(){e.axes.traverse(function(e){e.visible=!1}),e.hideTimeout=!1},1e3)},ROS3D.OrbitControls.prototype.rotateLeft=function(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta-=e},ROS3D.OrbitControls.prototype.rotateRight=function(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.thetaDelta+=e},ROS3D.OrbitControls.prototype.rotateUp=function(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=e},ROS3D.OrbitControls.prototype.rotateDown=function(e){void 0===e&&(e=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta+=e},ROS3D.OrbitControls.prototype.zoomIn=function(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale/=e},ROS3D.OrbitControls.prototype.zoomOut=function(e){void 0===e&&(e=Math.pow(.95,this.userZoomSpeed)),this.scale*=e},ROS3D.OrbitControls.prototype.update=function(){var e=this.camera.position,t=e.clone().sub(this.center),r=Math.atan2(t.y,t.x),i=Math.atan2(Math.sqrt(t.y*t.y+t.x*t.x),t.z);this.autoRotate&&this.rotateLeft(2*Math.PI/60/60*this.autoRotateSpeed),r+=this.thetaDelta,i+=this.phiDelta;var o=1e-6;i=Math.max(o,Math.min(Math.PI-o,i));var n=t.length();t.y=n*Math.sin(i)*Math.sin(r),t.z=n*Math.cos(i),t.x=n*Math.sin(i)*Math.cos(r),t.multiplyScalar(this.scale),e.copy(this.center).add(t),this.camera.lookAt(this.center),n=t.length(),this.axes.position=this.center.clone(),this.axes.scale.x=this.axes.scale.y=this.axes.scale.z=.05*n,this.axes.updateMatrixWorld(!0),this.thetaDelta=0,this.phiDelta=0,this.scale=1,this.lastPosition.distanceTo(this.camera.position)>0&&(this.dispatchEvent({type:"change"}),this.lastPosition.copy(this.camera.position))};