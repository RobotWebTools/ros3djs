var ROS3D=ROS3D||{REVISION:"1"};ROS3D.URDF_SPHERE=0;ROS3D.URDF_BOX=1;ROS3D.URDF_CYLINDER=2;ROS3D.URDF_MESH=3;ROS3D.UrdfBox=function(){var a=this;this.dim;this.type;this.initXml=function(c){this.type=ROS3D.URDF_BOX;if(!c.getAttribute("size")){console.error("Box shape must have a size attribute'");return false}var b=c.getAttribute("size").split(" ");if(b.length!==3){console.error("Invalid size string.");return false}else{a.dim=new ROSLIB.Vector3(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]))}return true}};ROS3D.UrdfColor=function(){var a=this;this.r;this.g;this.b;this.a;this.initString=function(c){var b=c.split(" ");if(b.length!==4){console.error("Invalid RBGA string.");return false}else{a.r=parseFloat(b[0]);a.g=parseFloat(b[1]);a.b=parseFloat(b[2]);a.a=parseFloat(b[3]);return true}}};ROS3D.UrdfLink=function(){var a=this;this.name;this.visual;this.initXml=function(b){if(!(a.name=b.getAttribute("name"))){console.error("No name given for link.");return false}var e=b.getElementsByTagName("visual");if(e.length>0){var d=e[0];var c=new ROS3D.UrdfVisual();if(!c.initXml(d)){console.error("Could not parse visual element for Link "+this.name);return false}a.visual=c}return true}};ROS3D.UrdfMaterial=function(){var a=this;this.name;this.textureFilename;this.color;this.initXml=function(e){var i=false;var g=false;if(!(a.name=e.getAttribute("name"))){console.error("URDF Material must contain a name attribute.");return false}var b=e.getElementsByTagName("texture");if(b.length>0){var f=b[0];if((a.textureFilename=f.getAttribute("filename"))){g=true}else{console.error("URDF texture has no filename for material "+a.name+".")}}var d=e.getElementsByTagName("color");if(d.length>0){var h=d[0];if(h.getAttribute("rgba")){a.color=new ROS3D.UrdfColor();i=a.color.initString(h.getAttribute("rgba"))}else{console.error("Material "+this.name+" color has no rgba.")}}return(i||g)}};ROS3D.UrdfMesh=function(){var a=this;this.filename="";this.scale;this.type;this.initXml=function(c){this.type=ROS3D.URDF_MESH;if(!(a.filename=c.getAttribute("filename"))){console.error("Mesh must contain a filename attribute.");return false}if(c.getAttribute("scale")){var b=c.getAttribute("scale").split(" ");if(b.length!==3){console.error("Invalid scale string.");return false}else{a.scale=new ROSLIB.Vector3(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]))}}return true}};ROS3D.UrdfModel=function(){var a=this;this.name;this.materials=[];this.links=[];this.initXml=function(b){var f=b.evaluate("//robot",b,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue;if(!f){console.error('Could not find the "robot" element in the URDF XML file.');return false}if(!(a.name=f.getAttribute("name"))){console.error("No name given for the robot.");return false}for(n in f.childNodes){var e=f.childNodes[n];if(e.tagName==="material"){var c=new ROS3D.UrdfMaterial();if(c.initXml(e)){if(a.materials[c.name]){console.error("Material "+c.name+"is not unique.");return false}else{a.materials[c.name]=c}}else{return false}}else{if(e.tagName==="link"){var d=new ROS3D.UrdfLink();if(d.initXml(e)){if(a.links[d.name]){console.error("Link "+d.name+" is not unique.");return false}else{if(d.visual&&d.visual.materialName){if(a.materials[d.visual.materialName]){d.visual.material=a.materials[d.visual.materialName]}else{if(d.visual.material){a.materials[d.visual.material.name]=d.visual.material}else{console.error("Link "+d.name+" material "+d.visual.material_name+" is undefined.");return false}}}a.links[d.name]=d}}else{console.error("Could not parse link.");return false}}}}return true};this.initString=function(c){var d=new DOMParser();var b=d.parseFromString(c,"text/xml");return a.initXml(b)}};ROS3D.UrdfSphere=function(){var a=this;this.radius;this.type;this.initXml=function(b){this.type=ROS3D.URDF_SPHERE;if(!b.getAttribute("radius")){console.error("Sphere shape must have a radius attribute");return false}a.radius=parseFloat(b.getAttribute("radius"));return true}};ROS3D.UrdfVisual=function(){var a=this;this.origin;this.geometry;this.material;this.materialName;this.initXml=function(h){var b=h.getElementsByTagName("origin");if(b.length===0){a.origin=new ROSLIB.Pose()}else{var B=h.getAttribute("xyz");if(!B){var C=new ROSLIB.Vector3()}else{var B=B.split(" ");if(B.length!==3){console.error("Invalid XYZ string in origin.");return false}else{var C=new ROSLIB.Vector3(parseFloat(B[0]),parseFloat(B[1]),parseFloat(B[2]))}}s=h.getAttribute("rpy");if(!s){var f=new ROSLIB.Quaternion()}else{var s=s.split(" ");if(s.length!==3){console.error("Invalid RPY string in origin.");return false}else{var v=parseFloat(s[0]);var k=parseFloat(s[1]);var o=parseFloat(s[2]);var d=v/2;var m=k/2;var A=o/2;var p=Math.sin(d)*Math.cos(m)*Math.cos(A)-Math.cos(d)*Math.sin(m)*Math.sin(A);var l=Math.cos(d)*Math.sin(m)*Math.cos(A)+Math.sin(d)*Math.cos(m)*Math.sin(A);var j=Math.cos(d)*Math.cos(m)*Math.sin(A)-Math.sin(d)*Math.sin(m)*Math.cos(A);var q=Math.cos(d)*Math.cos(m)*Math.cos(A)+Math.sin(d)*Math.sin(m)*Math.sin(A);var f=new ROSLIB.Quaternion(p,l,j,q);f.normalize()}}a.origin=new ROSLIB.Pose(C,f)}var t=h.getElementsByTagName("geometry");if(t.length>0){var c;for(n in t[0].childNodes){var u=t[0].childNodes[n];if(u.nodeType===1){c=u;break}}if(!c){console.error("Geometry tag contains no child element.");return false}var g=c.nodeName;if(g==="sphere"){geometry=new ROS3D.UrdfSphere()}else{if(g==="box"){geometry=new ROS3D.UrdfBox()}else{if(g==="cylinder"){geometry=new ROS3D.UrdfCylinder()}else{if(g==="mesh"){geometry=new ROS3D.UrdfMesh()}else{console.error("Unknown geometry type "+g);return false}}}}if(!geometry.initXml(c)){console.error("Could not parse visual.");return false}a.geometry=geometry}var e=h.getElementsByTagName("material");if(e.length>0){var i=e[0];var r=new ROS3D.UrdfMaterial();if(!(a.materialName=i.getAttribute("name"))){console.error("URDF material must contain a name attribute");return false}if(r.initXml(i)){a.material=r}}return true}};ROS3D.Axes=function(b){var f=this;b=b||{};var d=b.shaftRadius||0.008;var c=b.headRadius||0.023;var a=b.headLength||0.1;THREE.Object3D.call(this);this.lineGeom=new THREE.CylinderGeometry(d,d,1-a);this.headGeom=new THREE.CylinderGeometry(0,c,a);function e(k){var i=new THREE.Color;i.setRGB(k.x,k.y,k.z);var j=new THREE.MeshBasicMaterial({color:i.getHex()});var m=new THREE.Vector3;m.crossVectors(k,new THREE.Vector3(0,-1,0));var h=new THREE.Quaternion;h.setFromAxisAngle(m,0.5*Math.PI);var l=new THREE.Mesh(f.headGeom,j);l.position=k.clone();l.position.multiplyScalar(0.95);l.useQuaternion=true;l.quaternion=h;l.updateMatrix();f.add(l);var g=new THREE.Mesh(f.lineGeom,j);g.position=k.clone();g.position.multiplyScalar(0.45);g.useQuaternion=true;g.quaternion=h;g.updateMatrix();f.add(g)}e(new THREE.Vector3(1,0,0));e(new THREE.Vector3(0,1,0));e(new THREE.Vector3(0,0,1))};ROS3D.Axes.prototype=Object.create(THREE.Object3D.prototype);ROS3D.ColladaLoader=function(){var am=null;var H=null;var X;var aJ=null;var aa={};var k={};var P={};var af={};var aq={};var R={};var at={};var ae={};var aN;var aH;var aQ;var f;var K;var t=true;var Q=THREE.SmoothShading;var ac={centerGeometry:false,convertUpAxis:false,subdivideFaces:true,upAxis:"Y",defaultEnvMap:null};var aP=1;var au="Y";var z=null;var A=Math.PI/180;function g(aZ,a3,a2){var a1=0;if(document.implementation&&document.implementation.createDocument){var a0=new XMLHttpRequest();a0.onreadystatechange=function(){if(a0.readyState==4){if(a0.status==0||a0.status==200){if(a0.responseXML){aJ=a3;al(a0.responseXML,undefined,aZ)}else{if(a0.responseText){aJ=a3;var a4=new DOMParser();var a5=a4.parseFromString(a0.responseText,"application/xml");al(a5,undefined,aZ)}else{console.error("ColladaLoader: Empty or non-existing file ("+aZ+")")}}}}else{if(a0.readyState==3){if(a2){if(a1==0){a1=a0.getResponseHeader("Content-Length")}a2({total:a1,loaded:a0.responseText.length})}}}};a0.open("GET",aZ,true);a0.send(null)}else{alert("Don't know how to parse XML!")}}function al(a4,a2,a0){am=a4;a2=a2||aJ;if(a0!==undefined){var a3=a0.split("/");a3.pop();aQ=(a3.length<1?".":a3.join("/"))+"/"}y();V();k=ay("//dae:library_images/dae:image",ad,"image");R=ay("//dae:library_materials/dae:material",c,"material");at=ay("//dae:library_effects/dae:effect",O,"effect");aq=ay("//dae:library_geometries/dae:geometry",aA,"geometry");ae=ay(".//dae:library_cameras/dae:camera",aO,"camera");af=ay("//dae:library_controllers/dae:controller",J,"controller");P=ay("//dae:library_animations/dae:animation",aR,"animation");aH=ay(".//dae:library_visual_scenes/dae:visual_scene",aK,"visual_scene");f=[];K=[];X=Y();H=new THREE.Object3D();for(var a1=0;a1<X.nodes.length;a1++){H.add(d(X.nodes[a1]))}v();var aZ={scene:H,morphs:f,skins:K,animations:aN,dae:{images:k,materials:R,cameras:ae,effects:at,geometries:aq,controllers:af,animations:P,visualScenes:aH,scene:X}};if(a2){a2(aZ)}return aZ}function D(aZ){Q=aZ}function y(){var a2=am.evaluate("//dae:asset",am,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a0=a2.iterateNext();if(a0&&a0.childNodes){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a3=a0.childNodes[aZ];switch(a3.nodeName){case"unit":var a1=a3.getAttribute("meter");if(a1){aP=parseFloat(a1)}break;case"up_axis":au=a3.textContent.charAt(0);break}}}}function ay(a5,a2,a4){var a3=am.evaluate(a5,am,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a6={};var a1=a3.iterateNext();var a0=0;while(a1){var aZ=(new a2()).parse(a1);if(!aZ.id||aZ.id.length==0){aZ.id=a4+(a0++)}a6[aZ.id]=aZ;a1=a3.iterateNext()}return a6}function Y(){var a0=am.evaluate(".//dae:scene/dae:instance_visual_scene",am,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext();if(a0){var aZ=a0.getAttribute("url").replace(/^#/,"");return aH[aZ.length>0?aZ:"visual_scene0"]}else{return null}}function v(){aN=[];p(H)}function p(a4){var a6=X.getChildById(a4.name,true),a3=null;if(a6&&a6.keys){a3={fps:60,hierarchy:[{node:a6,keys:a6.keys,sids:a6.sids}],node:a4,name:"animation_"+a4.name,length:0};aN.push(a3);for(var a2=0,aZ=a6.keys.length;a2<aZ;a2++){a3.length=Math.max(a3.length,a6.keys[a2].time)}}else{a3={hierarchy:[{keys:[],sids:[]}]}}for(var a2=0,aZ=a4.children.length;a2<aZ;a2++){var a5=p(a4.children[a2]);for(var a0=0,a1=a5.hierarchy.length;a0<a1;a0++){a3.hierarchy.push({keys:[],sids:[]})}}return a3}function I(){var a5=1000000;var aZ=-a5;var a3=0;for(var a4 in P){var a2=P[a4];for(var a1=0;a1<a2.sampler.length;a1++){var a0=a2.sampler[a1];a0.create();a5=Math.min(a5,a0.startTime);aZ=Math.max(aZ,a0.endTime);a3=Math.max(a3,a0.input.length)}}return{start:a5,end:aZ,frames:a3}}function m(a6,a3){var a5=a3 instanceof E?af[a3.url]:a3;if(!a5||!a5.morph){console.log("could not find morph controller!");return}var a2=a5.morph;for(var a1=0;a1<a2.targets.length;a1++){var a0=a2.targets[a1];var aZ=aq[a0];if(!aZ.mesh||!aZ.mesh.primitives||!aZ.mesh.primitives.length){continue}var a4=aZ.mesh.primitives[0].geometry;if(a4.vertices.length===a6.vertices.length){a6.morphTargets.push({name:"target_1",vertices:a4.vertices})}}a6.morphTargets.push({name:"target_Z",vertices:a6.vertices})}function aL(a6,aZ,a4){var a0=af[aZ.url];if(!a0||!a0.skin){console.log("could not find skin controller!");return}if(!aZ.skeleton||!aZ.skeleton.length){console.log("could not find the skeleton for the skin!");return}var a7=a0.skin;var a2=X.getChildById(aZ.skeleton[0]);var a5=[];a4=a4!==undefined?a4:true;var a1=[];a6.skinWeights=[];a6.skinIndices=[];if(a4){for(var a3=0;a3<a6.vertices.length;a3++){a7.bindShapeMatrix.multiplyVector3(a6.vertices[a3])}}}function C(a4,a0,a5,a2){a4.world=a4.world||new THREE.Matrix4();a4.world.copy(a4.matrix);if(a4.channels&&a4.channels.length){var a3=a4.channels[0];var aZ=a3.sampler.output[a5];if(aZ instanceof THREE.Matrix4){a4.world.copy(aZ)}}if(a2){a4.world.multiply(a2,a4.world)}a0.push(a4);for(var a1=0;a1<a4.nodes.length;a1++){C(a4.nodes[a1],a0,a5,a4.world)}}function T(aZ,a6){for(var a2=0;a2<aZ.length;a2++){var a5=aZ[a2];var a7=-1;if(a5.type!="JOINT"){continue}for(var a1=0;a1<a6.joints.length;a1++){if(a5.sid==a6.joints[a1]){a7=a1;break}}if(a7>=0){var a3=a6.invBindMatrices[a7];a5.invBindMatrix=a3;a5.skinningMatrix=new THREE.Matrix4();a5.skinningMatrix.multiply(a5.world,a3);a5.weights=[];for(var a1=0;a1<a6.weights.length;a1++){for(var a0=0;a0<a6.weights[a1].length;a0++){var a4=a6.weights[a1][a0];if(a4.joint==a7){a5.weights.push(a4)}}}}else{throw"ColladaLoader: Could not find joint '"+a5.sid+"'."}}}function aS(ba,bb,a1){var a8=af[bb.url];a1=a1!==undefined?a1:40;if(!a8||!a8.skin){console.log("ColladaLoader: Could not find skin controller.");return}if(!bb.skeleton||!bb.skeleton.length){console.log("ColladaLoader: Could not find the skeleton for the skin. ");return}var a7=I();var a3=X.getChildById(bb.skeleton[0],true)||X.getChildBySid(bb.skeleton[0],true);var a5,a4,bc,aZ,a6;var bd=new THREE.Vector3(),a0,be;for(a5=0;a5<ba.vertices.length;a5++){a8.skin.bindShapeMatrix.multiplyVector3(ba.vertices[a5])}for(a1=0;a1<a7.frames;a1++){var a2=[];var a9=[];for(a5=0;a5<ba.vertices.length;a5++){a9.push(new THREE.Vector3())}C(a3,a2,a1);T(a2,a8.skin);for(a5=0;a5<a2.length;a5++){if(a2[a5].type!="JOINT"){continue}for(a4=0;a4<a2[a5].weights.length;a4++){bc=a2[a5].weights[a4];aZ=bc.index;a6=bc.weight;a0=ba.vertices[aZ];be=a9[aZ];bd.x=a0.x;bd.y=a0.y;bd.z=a0.z;a2[a5].skinningMatrix.multiplyVector3(bd);be.x+=(bd.x*a6);be.y+=(bd.y*a6);be.z+=(bd.z*a6)}}ba.morphTargets.push({name:"target_"+a1,vertices:a9})}}function d(bn,a9){var be=new THREE.Object3D();var bc=false;var a7;var bi;var bq,bo;for(bq=0;bq<bn.controllers.length;bq++){var bk=af[bn.controllers[bq].url];switch(bk.type){case"skin":if(aq[bk.skin.source]){var bg=new aw();bg.url=bk.skin.source;bg.instance_material=bn.controllers[bq].instance_material;bn.geometries.push(bg);bc=true;a7=bn.controllers[bq]}else{if(af[bk.skin.source]){var bu=af[bk.skin.source];bi=bu;if(bu.morph&&aq[bu.morph.source]){var bg=new aw();bg.url=bu.morph.source;bg.instance_material=bn.controllers[bq].instance_material;bn.geometries.push(bg)}}}break;case"morph":if(aq[bk.morph.source]){var bg=new aw();bg.url=bk.morph.source;bg.instance_material=bn.controllers[bq].instance_material;bn.geometries.push(bg);bi=bn.controllers[bq]}console.log("ColladaLoader: Morph-controller partially supported.");default:break}}var a2={};for(bq=0;bq<bn.geometries.length;bq++){var bp=bn.geometries[bq];var ba=bp.instance_material;var a4=aq[bp.url];var a6={};var bs=[];var bf=0;var a1;if(a4){if(!a4.mesh||!a4.mesh.primitives){continue}if(be.name.length==0){be.name=a4.id}if(ba){for(bo=0;bo<ba.length;bo++){var bj=ba[bo];var br=R[bj.target];var a5=br.instance_effect.url;var aZ=at[a5].shader;var bl=aZ.material;if(a4.doubleSided){if(!(bl in a2)){var bb=bl.clone();bb.side=THREE.DoubleSide;a2[bl]=bb}bl=a2[bl]}bl.opacity=!bl.opacity?1:bl.opacity;a6[bj.symbol]=bf;bs.push(bl);a1=bl;a1.name=br.name==null||br.name===""?br.id:br.name;bf++}}var a0;var bd=a1||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:a4.doubleSided?THREE.DoubleSide:THREE.FrontSide});var bm=a4.mesh.geometry3js;if(bf>1){bd=new THREE.MeshFaceMaterial(bs);for(bo=0;bo<bm.faces.length;bo++){var a8=bm.faces[bo];a8.materialIndex=a6[a8.daeMaterial]}}if(a7!==undefined){aS(bm,a7);bd.morphTargets=true;a0=new THREE.SkinnedMesh(bm,bd,false);a0.skeleton=a7.skeleton;a0.skinController=af[a7.url];a0.skinInstanceController=a7;a0.name="skin_"+K.length;K.push(a0)}else{if(bi!==undefined){m(bm,bi);bd.morphTargets=true;a0=new THREE.Mesh(bm,bd);a0.name="morph_"+f.length;f.push(a0)}else{a0=new THREE.Mesh(bm,bd)}}bn.geometries.length>1?be.add(a0):be=a0}}for(bq=0;bq<bn.cameras.length;bq++){var bh=bn.cameras[bq];var bv=ae[bh.url];be=new THREE.PerspectiveCamera(bv.fov,bv.aspect_ratio,bv.znear,bv.zfar)}be.name=bn.id||"";be.matrix=bn.matrix;var a3=bn.matrix.decompose();be.position=a3[0];be.quaternion=a3[1];be.useQuaternion=true;be.scale=a3[2];be.position.multiplyScalar(aP);be.scale.multiplyScalar(aP);if(ac.centerGeometry&&be.geometry){var bt=THREE.GeometryUtils.center(be.geometry);be.quaternion.multiplyVector3(bt.multiply(be.scale));be.position.sub(bt)}for(bq=0;bq<bn.nodes.length;bq++){be.add(d(bn.nodes[bq],bn))}return be}function o(a0,a1){for(var aZ=0;aZ<a0.joints.length;aZ++){if(a0.joints[aZ]==a1){return aZ}}}function L(aZ){return am.evaluate(".//dae:library_nodes//dae:node[@id='"+aZ+"']",am,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null).iterateNext()}function r(a1){var a4=[];var a0=1000000;var a5=-1000000;for(var aZ in P){var a2=P[aZ];for(var a3=0;a3<a2.channel.length;a3++){var a6=a2.channel[a3];var a7=a2.sampler[a3];var aZ=a6.target.split("/")[0];if(aZ==a1.id){a7.create();a6.sampler=a7;a0=Math.min(a0,a7.startTime);a5=Math.max(a5,a7.endTime);a4.push(a6)}}}if(a4.length){a1.startTime=a0;a1.endTime=a5}return a4}function aU(a4){var a2=10000000;for(var a1=0;a1<a4.channels.length;a1++){var a0=a4.channels[a1].sampler;for(var aZ=0;aZ<a0.input.length-1;aZ++){var a5=a0.input[aZ];var a3=a0.input[aZ+1];a2=Math.min(a2,a3-a5)}}return a2}function ab(a0,a8){var a1={};var a3,a2;for(a3=0;a3<a0.channels.length;a3++){var a4=a0.channels[a3];a1[a4.sid]=a4}var a6=new THREE.Matrix4();for(a3=0;a3<a0.transforms.length;a3++){var aZ=a0.transforms[a3];var a4=a1[aZ.sid];if(a4!==undefined){var a5=a4.sampler;var a7;for(a2=0;a2<a5.input.length-1;a2++){if(a5.input[a2+1]>a8){a7=a5.output[a2];break}}if(a7!==undefined){if(a7 instanceof THREE.Matrix4){a6=a6.multiply(a6,a7)}else{a6=a6.multiply(a6,aZ.matrix)}}else{a6=a6.multiply(a6,aZ.matrix)}}else{a6=a6.multiply(a6,aZ.matrix)}}return a6}function aE(a9){if(a9.channels&&a9.channels.length){var a7=[],bd=[];for(var bb=0,a4=a9.channels.length;bb<a4;bb++){var bg=a9.channels[bb],aZ=bg.fullSid,a8=bg.sampler,a5=a8.input,a6=a9.getTransformBySid(bg.sid),a0;if(bg.arrIndices){a0=[];for(var ba=0,bc=bg.arrIndices.length;ba<bc;ba++){a0[ba]=az(bg.arrIndices[ba])}}else{a0=U(bg.member)}if(a6){if(bd.indexOf(aZ)===-1){bd.push(aZ)}for(var ba=0,bc=a5.length;ba<bc;ba++){var a3=a5[ba],be=a8.getData(a6.type,ba),bf=ao(a7,a3);if(!bf){bf=new ag(a3);var a2=w(a7,a3);a7.splice(a2==-1?a7.length:a2,0,bf)}bf.addTarget(aZ,a6,a0,be)}}else{console.log('Could not find transform "'+bg.sid+'" in node '+a9.id)}}for(var bb=0;bb<bd.length;bb++){var a1=bd[bb];for(var ba=0;ba<a7.length;ba++){var bf=a7[ba];if(!bf.hasTarget(a1)){u(a7,bf,ba,a1)}}}a9.keys=a7;a9.sids=bd}}function ao(a2,a4){var a3=null;for(var a1=0,aZ=a2.length;a1<aZ&&a3==null;a1++){var a0=a2[a1];if(a0.time===a4){a3=a0}else{if(a0.time>a4){break}}}return a3}function w(a3,a4){var a0=-1;for(var a2=0,aZ=a3.length;a2<aZ&&a0==-1;a2++){var a1=a3[a2];if(a1.time>=a4){a0=a2}}return a0}function u(a9,a6,a7,a4){var ba=ax(a9,a4,a7?a7-1:0),a5=j(a9,a4,a7+1);if(ba&&a5){var a0=(a6.time-ba.time)/(a5.time-ba.time),a8=ba.getTarget(a4),a3=a5.getTarget(a4).data,aZ=a8.data,a2;if(a8.type==="matrix"){a2=aZ}else{if(aZ.length){a2=[];for(var a1=0;a1<aZ.length;++a1){a2[a1]=aZ[a1]+(a3[a1]-aZ[a1])*a0}}else{a2=aZ+(a3-aZ)*a0}}a6.addTarget(a4,a8.transform,a8.member,a2)}}function j(a1,a2,aZ){for(;aZ<a1.length;aZ++){var a0=a1[aZ];if(a0.hasTarget(a2)){return a0}}return null}function ax(a1,a2,aZ){aZ=aZ>=0?aZ:aZ+a1.length;for(;aZ>=0;aZ--){var a0=a1[aZ];if(a0.hasTarget(a2)){return a0}}return null}function ad(){this.id="";this.init_from=""}ad.prototype.parse=function(a0){this.id=a0.getAttribute("id");for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeName=="init_from"){this.init_from=a1.textContent}}return this};function J(){this.id="";this.name="";this.type="";this.skin=null;this.morph=null}J.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");this.type="none";for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];switch(a1.nodeName){case"skin":this.skin=(new q()).parse(a1);this.type=a1.nodeName;break;case"morph":this.morph=(new i()).parse(a1);this.type=a1.nodeName;break;default:break}}return this};function i(){this.method=null;this.source=null;this.targets=null;this.weights=null}i.prototype.parse=function(a3){var a1={};var aZ=[];var a2;this.method=a3.getAttribute("method");this.source=a3.getAttribute("source").replace(/^#/,"");for(a2=0;a2<a3.childNodes.length;a2++){var a5=a3.childNodes[a2];if(a5.nodeType!=1){continue}switch(a5.nodeName){case"source":var a4=(new aM()).parse(a5);a1[a4.id]=a4;break;case"targets":aZ=this.parseInputs(a5);break;default:console.log(a5.nodeName);break}}for(a2=0;a2<aZ.length;a2++){var a0=aZ[a2];var a4=a1[a0.source];switch(a0.semantic){case"MORPH_TARGET":this.targets=a4.read();break;case"MORPH_WEIGHT":this.weights=a4.read();break;default:break}}return this};i.prototype.parseInputs=function(a1){var aZ=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"input":aZ.push((new a()).parse(a2));break;default:break}}return aZ};function q(){this.source="";this.bindShapeMatrix=null;this.invBindMatrices=[];this.joints=[];this.weights=[]}q.prototype.parse=function(a2){var a0={};var aZ,a3;this.source=a2.getAttribute("source").replace(/^#/,"");this.invBindMatrices=[];this.joints=[];this.weights=[];for(var a1=0;a1<a2.childNodes.length;a1++){var a6=a2.childNodes[a1];if(a6.nodeType!=1){continue}switch(a6.nodeName){case"bind_shape_matrix":var a4=e(a6.textContent);this.bindShapeMatrix=ak(a4);break;case"source":var a5=new aM().parse(a6);a0[a5.id]=a5;break;case"joints":aZ=a6;break;case"vertex_weights":a3=a6;break;default:console.log(a6.nodeName);break}}this.parseJoints(aZ,a0);this.parseWeights(a3,a0);return this};q.prototype.parseJoints=function(a2,a0){for(var a1=0;a1<a2.childNodes.length;a1++){var a4=a2.childNodes[a1];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"input":var aZ=(new a()).parse(a4);var a3=a0[aZ.source];if(aZ.semantic=="JOINT"){this.joints=a3.read()}else{if(aZ.semantic=="INV_BIND_MATRIX"){this.invBindMatrices=a3.read()}}break;default:break}}};q.prototype.parseWeights=function(a4,aZ){var bd,ba,a7=[];for(var a5=0;a5<a4.childNodes.length;a5++){var a0=a4.childNodes[a5];if(a0.nodeType!=1){continue}switch(a0.nodeName){case"input":a7.push((new a()).parse(a0));break;case"v":bd=aT(a0.textContent);break;case"vcount":ba=aT(a0.textContent);break;default:break}}var a8=0;for(var a5=0;a5<ba.length;a5++){var a2=ba[a5];var a6=[];for(var a3=0;a3<a2;a3++){var a9={};for(var a1=0;a1<a7.length;a1++){var bb=a7[a1];var bc=bd[a8+bb.offset];switch(bb.semantic){case"JOINT":a9.joint=bc;break;case"WEIGHT":a9.weight=aZ[bb.source].data[bc];break;default:break}}a6.push(a9);a8+=a7.length}for(var a3=0;a3<a6.length;a3++){a6[a3].index=a5}this.weights.push(a6)}};function aK(){this.id="";this.name="";this.nodes=[];this.scene=new THREE.Object3D()}aK.prototype.getChildById=function(a2,aZ){for(var a0=0;a0<this.nodes.length;a0++){var a1=this.nodes[a0].getChildById(a2,aZ);if(a1){return a1}}return null};aK.prototype.getChildBySid=function(aZ,a0){for(var a1=0;a1<this.nodes.length;a1++){var a2=this.nodes[a1].getChildBySid(aZ,a0);if(a2){return a2}}return null};aK.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");this.nodes=[];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"node":this.nodes.push((new aB()).parse(a1));break;default:break}}return this};function aB(){this.id="";this.name="";this.sid="";this.nodes=[];this.controllers=[];this.transforms=[];this.geometries=[];this.channels=[];this.matrix=new THREE.Matrix4()}aB.prototype.getChannelForTransform=function(a9){for(var a5=0;a5<this.channels.length;a5++){var a6=this.channels[a5];var a3=a6.target.split("/");var aZ=a3.shift();var a0=a3.shift();var a7=(a0.indexOf(".")>=0);var a8=(a0.indexOf("(")>=0);var a2;var a4;if(a7){a3=a0.split(".");a0=a3.shift();a4=a3.shift()}else{if(a8){a2=a0.split("(");a0=a2.shift();for(var a1=0;a1<a2.length;a1++){a2[a1]=parseInt(a2[a1].replace(/\)/,""))}}}if(a0==a9){a6.info={sid:a0,dotSyntax:a7,arrSyntax:a8,arrIndices:a2};return a6}}return null};aB.prototype.getChildById=function(a2,aZ){if(this.id==a2){return this}if(aZ){for(var a0=0;a0<this.nodes.length;a0++){var a1=this.nodes[a0].getChildById(a2,aZ);if(a1){return a1}}}return null};aB.prototype.getChildBySid=function(aZ,a0){if(this.sid==aZ){return this}if(a0){for(var a1=0;a1<this.nodes.length;a1++){var a2=this.nodes[a1].getChildBySid(aZ,a0);if(a2){return a2}}}return null};aB.prototype.getTransformBySid=function(aZ){for(var a0=0;a0<this.transforms.length;a0++){if(this.transforms[a0].sid==aZ){return this.transforms[a0]}}return null};aB.prototype.parse=function(a1){var aZ;this.id=a1.getAttribute("id");this.sid=a1.getAttribute("sid");this.name=a1.getAttribute("name");this.type=a1.getAttribute("type");this.type=this.type=="JOINT"?this.type:"NODE";this.nodes=[];this.transforms=[];this.geometries=[];this.cameras=[];this.controllers=[];this.matrix=new THREE.Matrix4();for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"node":this.nodes.push((new aB()).parse(a3));break;case"instance_camera":this.cameras.push((new av()).parse(a3));break;case"instance_controller":this.controllers.push((new E()).parse(a3));break;case"instance_geometry":this.geometries.push((new aw()).parse(a3));break;case"instance_light":break;case"instance_node":aZ=a3.getAttribute("url").replace(/^#/,"");var a2=L(aZ);if(a2){this.nodes.push((new aB()).parse(a2))}break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new aG()).parse(a3));break;case"extra":break;default:console.log(a3.nodeName);break}}this.channels=r(this);aE(this);this.updateMatrix();return this};aB.prototype.updateMatrix=function(){this.matrix.identity();for(var aZ=0;aZ<this.transforms.length;aZ++){this.transforms[aZ].apply(this.matrix)}};function aG(){this.sid="";this.type="";this.data=[];this.obj=null}aG.prototype.parse=function(aZ){this.sid=aZ.getAttribute("sid");this.type=aZ.nodeName;this.data=e(aZ.textContent);this.convert();return this};aG.prototype.convert=function(){switch(this.type){case"matrix":this.obj=ak(this.data);break;case"rotate":this.angle=this.data[3]*A;case"translate":S(this.data,-1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":S(this.data,1);this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type);break}};aG.prototype.apply=function(aZ){switch(this.type){case"matrix":aZ.multiply(this.obj);break;case"translate":aZ.translate(this.obj);break;case"rotate":aZ.rotateByAxis(this.obj,this.angle);break;case"scale":aZ.scale(this.obj);break}};aG.prototype.update=function(a1,a2){var aZ=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(!a2){this.obj.copy(a1)}else{if(a2.length===1){switch(a2[0]){case 0:this.obj.n11=a1[0];this.obj.n21=a1[1];this.obj.n31=a1[2];this.obj.n41=a1[3];break;case 1:this.obj.n12=a1[0];this.obj.n22=a1[1];this.obj.n32=a1[2];this.obj.n42=a1[3];break;case 2:this.obj.n13=a1[0];this.obj.n23=a1[1];this.obj.n33=a1[2];this.obj.n43=a1[3];break;case 3:this.obj.n14=a1[0];this.obj.n24=a1[1];this.obj.n34=a1[2];this.obj.n44=a1[3];break}}else{if(a2.length===2){var a0="n"+(a2[0]+1)+(a2[1]+1);this.obj[a0]=a1}else{console.log("Incorrect addressing of matrix in transform.")}}}break;case"translate":case"scale":if(Object.prototype.toString.call(a2)==="[object Array]"){a2=aZ[a2[0]]}switch(a2){case"X":this.obj.x=a1;break;case"Y":this.obj.y=a1;break;case"Z":this.obj.z=a1;break;default:this.obj.x=a1[0];this.obj.y=a1[1];this.obj.z=a1[2];break}break;case"rotate":if(Object.prototype.toString.call(a2)==="[object Array]"){a2=aZ[a2[0]]}switch(a2){case"X":this.obj.x=a1;break;case"Y":this.obj.y=a1;break;case"Z":this.obj.z=a1;break;case"ANGLE":this.angle=a1*A;break;default:this.obj.x=a1[0];this.obj.y=a1[1];this.obj.z=a1[2];this.angle=a1[3]*A;break}break}};function E(){this.url="";this.skeleton=[];this.instance_material=[]}E.prototype.parse=function(a1){this.url=a1.getAttribute("url").replace(/^#/,"");this.skeleton=[];this.instance_material=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!==1){continue}switch(a3.nodeName){case"skeleton":this.skeleton.push(a3.textContent.replace(/^#/,""));break;case"bind_material":var a2=am.evaluate(".//dae:instance_material",a3,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a2){var aZ=a2.iterateNext();while(aZ){this.instance_material.push((new h()).parse(aZ));aZ=a2.iterateNext()}}break;case"extra":break;default:break}}return this};function h(){this.symbol="";this.target=""}h.prototype.parse=function(aZ){this.symbol=aZ.getAttribute("symbol");this.target=aZ.getAttribute("target").replace(/^#/,"");return this};function aw(){this.url="";this.instance_material=[]}aw.prototype.parse=function(a1){this.url=a1.getAttribute("url").replace(/^#/,"");this.instance_material=[];for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!=1){continue}if(a3.nodeName=="bind_material"){var a2=am.evaluate(".//dae:instance_material",a3,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a2){var aZ=a2.iterateNext();while(aZ){this.instance_material.push((new h()).parse(aZ));aZ=a2.iterateNext()}}break}}return this};function aA(){this.id="";this.mesh=null}aA.prototype.parse=function(a0){this.id=a0.getAttribute("id");aF(this,a0);for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];switch(a1.nodeName){case"mesh":this.mesh=(new aj(this)).parse(a1);break;case"extra":break;default:break}}return this};function aj(aZ){this.geometry=aZ.id;this.primitives=[];this.vertices=null;this.geometry3js=null}aj.prototype.parse=function(a3){this.primitives=[];var a2,a1;for(a2=0;a2<a3.childNodes.length;a2++){var a4=a3.childNodes[a2];switch(a4.nodeName){case"source":aW(a4);break;case"vertices":this.vertices=(new ai()).parse(a4);break;case"triangles":this.primitives.push((new Z().parse(a4)));break;case"polygons":this.primitives.push((new B().parse(a4)));break;case"polylist":this.primitives.push((new aC().parse(a4)));break;default:break}}this.geometry3js=new THREE.Geometry();var a0=aa[this.vertices.input.POSITION.source].data;for(a2=0;a2<a0.length;a2+=3){this.geometry3js.vertices.push(W(a0,a2).clone())}for(a2=0;a2<this.primitives.length;a2++){var aZ=this.primitives[a2];aZ.setVertices(this.vertices);this.handlePrimitive(aZ,this.geometry3js)}this.geometry3js.computeCentroids();this.geometry3js.computeFaceNormals();if(this.geometry3js.calcNormals){this.geometry3js.computeVertexNormals();delete this.geometry3js.calcNormals}this.geometry3js.computeBoundingBox();return this};aj.prototype.handlePrimitive=function(a6,a1){var bo,bn,bh=a6.p,bb=a6.inputs;var aZ,bg,a2;var ba,bm;var bk=0,bi=3,be=0;var bw=[];for(bo=0;bo<bb.length;bo++){aZ=bb[bo];var bj=aZ.offset+1;be=(be<bj)?bj:be;switch(aZ.semantic){case"TEXCOORD":bw.push(aZ.set);break}}for(var a8=0;a8<bh.length;++a8){var bl=bh[a8],bq=0;while(bq<bl.length){var a5=[];var bp=[];var bu=null;var bc=[];if(a6.vcount){bi=a6.vcount.length?a6.vcount[bk++]:a6.vcount}else{bi=bl.length/be}for(bo=0;bo<bi;bo++){for(bn=0;bn<bb.length;bn++){aZ=bb[bn];ba=aa[aZ.source];bg=bl[bq+(bo*be)+aZ.offset];bm=ba.accessor.params.length;a2=bg*bm;switch(aZ.semantic){case"VERTEX":a5.push(bg);break;case"NORMAL":bp.push(W(ba.data,a2));break;case"TEXCOORD":bu=bu||{};if(bu[aZ.set]===undefined){bu[aZ.set]=[]}bu[aZ.set].push(new THREE.Vector2(ba.data[a2],ba.data[a2+1]));break;case"COLOR":bc.push(new THREE.Color().setRGB(ba.data[a2],ba.data[a2+1],ba.data[a2+2]));break;default:break}}}if(bp.length==0){aZ=this.vertices.input.NORMAL;if(aZ){ba=aa[aZ.source];bm=ba.accessor.params.length;for(var a7=0,a9=a5.length;a7<a9;a7++){bp.push(W(ba.data,a5[a7]*bm))}}else{a1.calcNormals=true}}if(!bu){bu={};aZ=this.vertices.input.TEXCOORD;if(aZ){bw.push(aZ.set);ba=aa[aZ.source];bm=ba.accessor.params.length;for(var a7=0,a9=a5.length;a7<a9;a7++){a2=a5[a7]*bm;if(bu[aZ.set]===undefined){bu[aZ.set]=[]}bu[aZ.set].push(new THREE.Vector2(ba.data[a2],1-ba.data[a2+1]))}}}if(bc.length==0){aZ=this.vertices.input.COLOR;if(aZ){ba=aa[aZ.source];bm=ba.accessor.params.length;for(var a7=0,a9=a5.length;a7<a9;a7++){a2=a5[a7]*bm;bc.push(new THREE.Color().setRGB(ba.data[a2],ba.data[a2+1],ba.data[a2+2]))}}}var a3=null,a4=[],bf,bd;if(bi===3){a4.push(new THREE.Face3(a5[0],a5[1],a5[2],bp,bc.length?bc:new THREE.Color()))}else{if(bi===4){a4.push(new THREE.Face4(a5[0],a5[1],a5[2],a5[3],bp,bc.length?bc:new THREE.Color()))}else{if(bi>4&&ac.subdivideFaces){var a0=bc.length?bc:new THREE.Color(),bt,bs,br,by,bx,bv;for(bn=1;bn<bi-1;){a4.push(new THREE.Face3(a5[0],a5[bn],a5[bn+1],[bp[0],bp[bn++],bp[bn]],a0))}}}}if(a4.length){for(var a7=0,a9=a4.length;a7<a9;a7++){a3=a4[a7];a3.daeMaterial=a6.material;a1.faces.push(a3);for(bn=0;bn<bw.length;bn++){bf=bu[bw[bn]];if(bi>4){bd=[bf[0],bf[a7+1],bf[a7+2]]}else{if(bi===4){bd=[bf[0],bf[1],bf[2],bf[3]]}else{bd=[bf[0],bf[1],bf[2]]}}if(!a1.faceVertexUvs[bn]){a1.faceVertexUvs[bn]=[]}a1.faceVertexUvs[bn].push(bd)}}}else{console.log("dropped face with vcount "+bi+" for geometry with id: "+a1.id)}bq+=be*bi}}};function B(){this.material="";this.count=0;this.inputs=[];this.vcount=null;this.p=[];this.geometry=new THREE.Geometry()}B.prototype.setVertices=function(aZ){for(var a0=0;a0<this.inputs.length;a0++){if(this.inputs[a0].source==aZ.id){this.inputs[a0].source=aZ.input.POSITION.source}}};B.prototype.parse=function(a0){this.material=a0.getAttribute("material");this.count=l(a0,"count",0);for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];switch(a1.nodeName){case"input":this.inputs.push((new a()).parse(a0.childNodes[aZ]));break;case"vcount":this.vcount=aT(a1.textContent);break;case"p":this.p.push(aT(a1.textContent));break;case"ph":console.warn("polygon holes not yet supported!");break;default:break}}return this};function aC(){B.call(this);this.vcount=[]}aC.prototype=Object.create(B.prototype);function Z(){B.call(this);this.vcount=3}Z.prototype=Object.create(B.prototype);function aD(){this.source="";this.count=0;this.stride=0;this.params=[]}aD.prototype.parse=function(a0){this.params=[];this.source=a0.getAttribute("source");this.count=l(a0,"count",0);this.stride=l(a0,"stride",0);for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeName=="param"){var a1={};a1.name=a2.getAttribute("name");a1.type=a2.getAttribute("type");this.params.push(a1)}}return this};function ai(){this.input={}}ai.prototype.parse=function(a1){this.id=a1.getAttribute("id");for(var a0=0;a0<a1.childNodes.length;a0++){if(a1.childNodes[a0].nodeName=="input"){var aZ=(new a()).parse(a1.childNodes[a0]);this.input[aZ.semantic]=aZ}}return this};function a(){this.semantic="";this.offset=0;this.source="";this.set=0}a.prototype.parse=function(aZ){this.semantic=aZ.getAttribute("semantic");this.source=aZ.getAttribute("source").replace(/^#/,"");this.set=l(aZ,"set",-1);this.offset=l(aZ,"offset",0);if(this.semantic=="TEXCOORD"&&this.set<0){this.set=0}return this};function aM(aZ){this.id=aZ;this.type=null}aM.prototype.parse=function(a1){this.id=a1.getAttribute("id");for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];switch(a2.nodeName){case"bool_array":this.data=ah(a2.textContent);this.type=a2.nodeName;break;case"float_array":this.data=e(a2.textContent);this.type=a2.nodeName;break;case"int_array":this.data=aT(a2.textContent);this.type=a2.nodeName;break;case"IDREF_array":case"Name_array":this.data=G(a2.textContent);this.type=a2.nodeName;break;case"technique_common":for(var aZ=0;aZ<a2.childNodes.length;aZ++){if(a2.childNodes[aZ].nodeName=="accessor"){this.accessor=(new aD()).parse(a2.childNodes[aZ]);break}}break;default:break}}return this};aM.prototype.read=function(){var a0=[];var a3=this.accessor.params[0];switch(a3.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var a1=0;a1<this.data.length;a1+=16){var a2=this.data.slice(a1,a1+16);var aZ=ak(a2);a0.push(aZ)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+a3.type+".");break}return a0};function c(){this.id="";this.name="";this.instance_effect=null}c.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");for(var aZ=0;aZ<a0.childNodes.length;aZ++){if(a0.childNodes[aZ].nodeName=="instance_effect"){this.instance_effect=(new x()).parse(a0.childNodes[aZ]);break}}return this};function an(){this.color=new THREE.Color(0);this.color.setRGB(Math.random(),Math.random(),Math.random());this.color.a=1;this.texture=null;this.texcoord=null;this.texOpts=null}an.prototype.isColor=function(){return(this.texture==null)};an.prototype.isTexture=function(){return(this.texture!=null)};an.prototype.parse=function(a1){for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"color":var aZ=e(a2.textContent);this.color=new THREE.Color(0);this.color.setRGB(aZ[0],aZ[1],aZ[2]);this.color.a=aZ[3];break;case"texture":this.texture=a2.getAttribute("texture");this.texcoord=a2.getAttribute("texcoord");this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1};this.parseTexture(a2);break;default:break}}return this};an.prototype.parseTexture=function(a0){if(!a0.childNodes){return this}if(a0.childNodes[1]&&a0.childNodes[1].nodeName==="extra"){a0=a0.childNodes[1];if(a0.childNodes[1]&&a0.childNodes[1].nodeName==="technique"){a0=a0.childNodes[1]}}for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];switch(a1.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[a1.nodeName]=parseFloat(a1.textContent);break;case"wrapU":case"wrapV":this.texOpts[a1.nodeName]=parseInt(a1.textContent);break;default:this.texOpts[a1.nodeName]=a1.textContent;break}}return this};function ar(a0,aZ){this.type=a0;this.effect=aZ;this.material=null}ar.prototype.parse=function(a0){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a2=a0.childNodes[aZ];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[a2.nodeName]=(new an()).parse(a2);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var a1=ap(a2,".//dae:float");if(a1.length>0){this[a2.nodeName]=parseFloat(a1[0].textContent)}break;default:break}}this.create();return this};ar.prototype.create=function(){var a4={};var a7=(this["transparency"]!==undefined&&this["transparency"]<1);for(var aZ in this){switch(aZ){case"ambient":case"emission":case"diffuse":case"specular":var a6=this[aZ];if(a6 instanceof an){if(a6.isTexture()){var a0=a6.texture;var a5=this.effect.sampler[a0].source;if(a5){var a1=this.effect.surface[a5];var a2=k[a1.init_from];if(a2){var a3=THREE.ImageUtils.loadTexture(aQ+a2.init_from);a3.wrapS=a6.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;a3.wrapT=a6.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;a3.offset.x=a6.texOpts.offsetU;a3.offset.y=a6.texOpts.offsetV;a3.repeat.x=a6.texOpts.repeatU;a3.repeat.y=a6.texOpts.repeatV;a4.map=a3;if(aZ==="emission"){a4.emissive=16777215}}}}else{if(aZ==="diffuse"||!a7){if(aZ==="emission"){a4.emissive=a6.color.getHex()}else{a4[aZ]=a6.color.getHex()}}}}break;case"shininess":a4[aZ]=this[aZ];break;case"reflectivity":a4[aZ]=this[aZ];if(a4[aZ]>0){a4.envMap=ac.defaultEnvMap}a4.combine=THREE.MixOperation;break;case"index_of_refraction":a4.refractionRatio=this[aZ];if(this[aZ]!==1){a4.envMap=ac.defaultEnvMap}break;case"transparency":if(a7){a4.transparent=true;a4.opacity=this[aZ];a7=true}break;default:break}}a4.shading=Q;a4.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide;switch(this.type){case"constant":if(a4.emissive!=undefined){a4.color=a4.emissive}this.material=new THREE.MeshBasicMaterial(a4);break;case"phong":case"blinn":if(a4.diffuse!=undefined){a4.color=a4.diffuse}this.material=new THREE.MeshPhongMaterial(a4);break;case"lambert":default:if(a4.diffuse!=undefined){a4.color=a4.diffuse}this.material=new THREE.MeshLambertMaterial(a4);break}return this.material};function b(aZ){this.effect=aZ;this.init_from=null;this.format=null}b.prototype.parse=function(a0){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"init_from":this.init_from=a1.textContent;break;case"format":this.format=a1.textContent;break;default:console.log("unhandled Surface prop: "+a1.nodeName);break}}return this};function N(aZ){this.effect=aZ;this.source=null;this.wrap_s=null;this.wrap_t=null;this.minfilter=null;this.magfilter=null;this.mipfilter=null}N.prototype.parse=function(a0){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"source":this.source=a1.textContent;break;case"minfilter":this.minfilter=a1.textContent;break;case"magfilter":this.magfilter=a1.textContent;break;case"mipfilter":this.mipfilter=a1.textContent;break;case"wrap_s":this.wrap_s=a1.textContent;break;case"wrap_t":this.wrap_t=a1.textContent;break;default:console.log("unhandled Sampler2D prop: "+a1.nodeName);break}}return this};function O(){this.id="";this.name="";this.shader=null;this.surface={};this.sampler={}}O.prototype.create=function(){if(this.shader==null){return null}};O.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");aF(this,a0);this.shader=null;for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(a1));break;default:break}}return this};O.prototype.parseNewparam=function(a1){var aZ=a1.getAttribute("sid");for(var a0=0;a0<a1.childNodes.length;a0++){var a2=a1.childNodes[a0];if(a2.nodeType!=1){continue}switch(a2.nodeName){case"surface":this.surface[aZ]=(new b(this)).parse(a2);break;case"sampler2D":this.sampler[aZ]=(new N(this)).parse(a2);break;case"extra":break;default:console.log(a2.nodeName);break}}};O.prototype.parseProfileCOMMON=function(a1){var a2;for(var a0=0;a0<a1.childNodes.length;a0++){var a3=a1.childNodes[a0];if(a3.nodeType!=1){continue}switch(a3.nodeName){case"profile_COMMON":this.parseProfileCOMMON(a3);break;case"technique":a2=a3;break;case"newparam":this.parseNewparam(a3);break;case"image":var aZ=(new ad()).parse(a3);k[aZ.id]=aZ;break;case"extra":break;default:console.log(a3.nodeName);break}}return a2};O.prototype.parseTechnique=function(a0){for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=(new ar(a1.nodeName,this)).parse(a1);break;default:break}}};function x(){this.url=""}x.prototype.parse=function(aZ){this.url=aZ.getAttribute("url").replace(/^#/,"");return this};function aR(){this.id="";this.name="";this.source={};this.sampler=[];this.channel=[]}aR.prototype.parse=function(a1){this.id=a1.getAttribute("id");this.name=a1.getAttribute("name");this.source={};for(var a0=0;a0<a1.childNodes.length;a0++){var a4=a1.childNodes[a0];if(a4.nodeType!=1){continue}switch(a4.nodeName){case"animation":var a2=(new aR()).parse(a4);for(var a3 in a2.source){this.source[a3]=a2.source[a3]}for(var aZ=0;aZ<a2.channel.length;aZ++){this.channel.push(a2.channel[aZ]);this.sampler.push(a2.sampler[aZ])}break;case"source":var a3=(new aM()).parse(a4);this.source[a3.id]=a3;break;case"sampler":this.sampler.push((new F(this)).parse(a4));break;case"channel":this.channel.push((new M(this)).parse(a4));break;default:break}}return this};function M(aZ){this.animation=aZ;this.source="";this.target="";this.fullSid=null;this.sid=null;this.dotSyntax=null;this.arrSyntax=null;this.arrIndices=null;this.member=null}M.prototype.parse=function(a1){this.source=a1.getAttribute("source").replace(/^#/,"");this.target=a1.getAttribute("target");var a3=this.target.split("/");var a6=a3.shift();var aZ=a3.shift();var a5=(aZ.indexOf(".")>=0);var a2=(aZ.indexOf("(")>=0);if(a5){a3=aZ.split(".");this.sid=a3.shift();this.member=a3.shift()}else{if(a2){var a4=aZ.split("(");this.sid=a4.shift();for(var a0=0;a0<a4.length;a0++){a4[a0]=parseInt(a4[a0].replace(/\)/,""))}this.arrIndices=a4}else{this.sid=aZ}}this.fullSid=aZ;this.dotSyntax=a5;this.arrSyntax=a2;return this};function F(aZ){this.id="";this.animation=aZ;this.inputs=[];this.input=null;this.output=null;this.strideOut=null;this.interpolation=null;this.startTime=null;this.endTime=null;this.duration=0}F.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.inputs=[];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"input":this.inputs.push((new a()).parse(a1));break;default:break}}return this};F.prototype.create=function(){for(var a0=0;a0<this.inputs.length;a0++){var aZ=this.inputs[a0];var a1=this.animation.source[aZ.source];switch(aZ.semantic){case"INPUT":this.input=a1.read();break;case"OUTPUT":this.output=a1.read();this.strideOut=a1.accessor.stride;break;case"INTERPOLATION":this.interpolation=a1.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(aZ.semantic);break}}this.startTime=0;this.endTime=0;this.duration=0;if(this.input.length){this.startTime=100000000;this.endTime=-100000000;for(var a0=0;a0<this.input.length;a0++){this.startTime=Math.min(this.startTime,this.input[a0]);this.endTime=Math.max(this.endTime,this.input[a0])}this.duration=this.endTime-this.startTime}};F.prototype.getData=function(a1,aZ){var a2;if(a1==="matrix"&&this.strideOut===16){a2=this.output[aZ]}else{if(this.strideOut>1){a2=[];aZ*=this.strideOut;for(var a0=0;a0<this.strideOut;++a0){a2[a0]=this.output[aZ+a0]}if(this.strideOut===3){switch(a1){case"rotate":case"translate":S(a2,-1);break;case"scale":S(a2,1);break}}else{if(this.strideOut===4&&a1==="matrix"){S(a2,-1)}}}else{a2=this.output[aZ]}}return a2};function ag(aZ){this.targets=[];this.time=aZ}ag.prototype.addTarget=function(a2,aZ,a1,a0){this.targets.push({sid:a2,member:a1,transform:aZ,data:a0})};ag.prototype.apply=function(aZ){for(var a0=0;a0<this.targets.length;++a0){var a1=this.targets[a0];if(!aZ||a1.sid===aZ){a1.transform.update(a1.data,a1.member)}}};ag.prototype.getTarget=function(a0){for(var aZ=0;aZ<this.targets.length;++aZ){if(this.targets[aZ].sid===a0){return this.targets[aZ]}}return null};ag.prototype.hasTarget=function(a0){for(var aZ=0;aZ<this.targets.length;++aZ){if(this.targets[aZ].sid===a0){return true}}return false};ag.prototype.interpolate=function(a8,a1){for(var a5=0;a5<this.targets.length;++a5){var a7=this.targets[a5],aZ=a8.getTarget(a7.sid),a4;if(a7.transform.type!=="matrix"&&aZ){var a2=(a1-this.time)/(a8.time-this.time),a6=aZ.data,a0=a7.data;if(a2<0||a2>1){console.log("Key.interpolate: Warning! Scale out of bounds:"+a2);a2=a2<0?0:1}if(a0.length){a4=[];for(var a3=0;a3<a0.length;++a3){a4[a3]=a0[a3]+(a6[a3]-a0[a3])*a2}}else{a4=a0+(a6-a0)*a2}}else{a4=a7.data}a7.transform.update(a4,a7.member)}};function aO(){this.id="";this.name="";this.technique=""}aO.prototype.parse=function(a0){this.id=a0.getAttribute("id");this.name=a0.getAttribute("name");for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a1=a0.childNodes[aZ];if(a1.nodeType!=1){continue}switch(a1.nodeName){case"optics":this.parseOptics(a1);break;default:break}}return this};aO.prototype.parseOptics=function(a3){for(var a2=0;a2<a3.childNodes.length;a2++){if(a3.childNodes[a2].nodeName=="technique_common"){var a5=a3.childNodes[a2];for(var a1=0;a1<a5.childNodes.length;a1++){this.technique=a5.childNodes[a1].nodeName;if(this.technique=="perspective"){var a4=a5.childNodes[a1];for(var aZ=0;aZ<a4.childNodes.length;aZ++){var a6=a4.childNodes[aZ];switch(a6.nodeName){case"yfov":this.yfov=a6.textContent;break;case"xfov":this.xfov=a6.textContent;break;case"znear":this.znear=a6.textContent;break;case"zfar":this.zfar=a6.textContent;break;case"aspect_ratio":this.aspect_ratio=a6.textContent;break}}}else{if(this.technique=="orthographic"){var a0=a5.childNodes[a1];for(var aZ=0;aZ<a0.childNodes.length;aZ++){var a6=a0.childNodes[aZ];switch(a6.nodeName){case"xmag":this.xmag=a6.textContent;break;case"ymag":this.ymag=a6.textContent;break;case"znear":this.znear=a6.textContent;break;case"zfar":this.zfar=a6.textContent;break;case"aspect_ratio":this.aspect_ratio=a6.textContent;break}}}}}}}return this};function av(){this.url=""}av.prototype.parse=function(aZ){this.url=aZ.getAttribute("url").replace(/^#/,"");return this};function aW(aZ){var a0=aZ.getAttribute("id");if(aa[a0]!=undefined){return aa[a0]}aa[a0]=(new aM(a0)).parse(aZ);return aa[a0]}function aV(aZ){if(aZ=="dae"){return"http://www.collada.org/2005/11/COLLADASchema"}return null}function ah(a3){var a0=G(a3);var a2=[];for(var a1=0,aZ=a0.length;a1<aZ;a1++){a2.push((a0[a1]=="true"||a0[a1]=="1")?true:false)}return a2}function e(a3){var a0=G(a3);var a2=[];for(var a1=0,aZ=a0.length;a1<aZ;a1++){a2.push(parseFloat(a0[a1]))}return a2}function aT(a3){var a0=G(a3);var a2=[];for(var a1=0,aZ=a0.length;a1<aZ;a1++){a2.push(parseInt(a0[a1],10))}return a2}function G(aZ){return(aZ.length>0)?s(aZ).split(/\s+/):[]}function s(aZ){return aZ.replace(/^\s+/,"").replace(/\s+$/,"")}function aX(a1,a0,aZ){if(a1.hasAttribute(a0)){return parseFloat(a1.getAttribute(a0))}else{return aZ}}function l(a1,a0,aZ){if(a1.hasAttribute(a0)){return parseInt(a1.getAttribute(a0),10)}else{return aZ}}function aI(a1,a0,aZ){if(a1.hasAttribute(a0)){return a1.getAttribute(a0)}else{return aZ}}function aY(a1,aZ){if(a1===undefined){var a0="0.";while(a0.length<aZ+2){a0+="0"}return a0}aZ=aZ||2;var a2=a1.toString().split(".");a2[1]=a2.length>1?a2[1].substr(0,aZ):"0";while(a2[1].length<aZ){a2[1]+="0"}return a2.join(".")}function ap(a0,a2){var a3=am.evaluate(a2,a0,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);var a1=a3.iterateNext();var aZ=[];while(a1){aZ.push(a1);a1=a3.iterateNext()}return aZ}function aF(a1,aZ){a1.doubleSided=false;var a0=am.evaluate(".//dae:extra//dae:double_sided",aZ,aV,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null);if(a0){a0=a0.iterateNext();if(a0&&parseInt(a0.textContent,10)===1){a1.doubleSided=true}}}function V(){if(!ac.convertUpAxis||au===ac.upAxis){z=null}else{switch(au){case"X":z=ac.upAxis==="Y"?"XtoY":"XtoZ";break;case"Y":z=ac.upAxis==="X"?"YtoX":"YtoZ";break;case"Z":z=ac.upAxis==="X"?"ZtoX":"ZtoY";break}}}function S(a1,aZ){if(!ac.convertUpAxis||au===ac.upAxis){return}switch(z){case"XtoY":var a0=a1[0];a1[0]=aZ*a1[1];a1[1]=a0;break;case"XtoZ":var a0=a1[2];a1[2]=a1[1];a1[1]=a1[0];a1[0]=a0;break;case"YtoX":var a0=a1[0];a1[0]=a1[1];a1[1]=aZ*a0;break;case"YtoZ":var a0=a1[1];a1[1]=aZ*a1[2];a1[2]=a0;break;case"ZtoX":var a0=a1[0];a1[0]=a1[1];a1[1]=a1[2];a1[2]=a0;break;case"ZtoY":var a0=a1[1];a1[1]=a1[2];a1[2]=aZ*a0;break}}function W(a0,a1){var aZ=[a0[a1],a0[a1+1],a0[a1+2]];S(aZ,-1);return new THREE.Vector3(aZ[0],aZ[1],aZ[2])}function ak(a0){if(ac.convertUpAxis){var aZ=[a0[0],a0[4],a0[8]];S(aZ,-1);a0[0]=aZ[0];a0[4]=aZ[1];a0[8]=aZ[2];aZ=[a0[1],a0[5],a0[9]];S(aZ,-1);a0[1]=aZ[0];a0[5]=aZ[1];a0[9]=aZ[2];aZ=[a0[2],a0[6],a0[10]];S(aZ,-1);a0[2]=aZ[0];a0[6]=aZ[1];a0[10]=aZ[2];aZ=[a0[0],a0[1],a0[2]];S(aZ,-1);a0[0]=aZ[0];a0[1]=aZ[1];a0[2]=aZ[2];aZ=[a0[4],a0[5],a0[6]];S(aZ,-1);a0[4]=aZ[0];a0[5]=aZ[1];a0[6]=aZ[2];aZ=[a0[8],a0[9],a0[10]];S(aZ,-1);a0[8]=aZ[0];a0[9]=aZ[1];a0[10]=aZ[2];aZ=[a0[3],a0[7],a0[11]];S(aZ,-1);a0[3]=aZ[0];a0[7]=aZ[1];a0[11]=aZ[2]}return new THREE.Matrix4(a0[0],a0[1],a0[2],a0[3],a0[4],a0[5],a0[6],a0[7],a0[8],a0[9],a0[10],a0[11],a0[12],a0[13],a0[14],a0[15])}function az(a0){if(a0>-1&&a0<3){var aZ=["X","Y","Z"],a1={X:0,Y:1,Z:2};a0=U(aZ[a0]);a0=a1[a0]}return a0}function U(aZ){if(ac.convertUpAxis){switch(aZ){case"X":switch(z){case"XtoY":case"XtoZ":case"YtoX":aZ="Y";break;case"ZtoX":aZ="Z";break}break;case"Y":switch(z){case"XtoY":case"YtoX":case"ZtoX":aZ="X";break;case"XtoZ":case"YtoZ":case"ZtoY":aZ="Z";break}break;case"Z":switch(z){case"XtoZ":aZ="X";break;case"YtoZ":case"ZtoX":case"ZtoY":aZ="Y";break}break}}return aZ}return{load:g,parse:al,setPreferredShading:D,applySkin:aS,geometries:aq,options:ac}};ROS3D.MeshLoader=function(a){var b=this;if(a!==undefined){this.meshBaseUrl=a;if(this.meshBaseUrl.substr(this.meshBaseUrl.length-1)!="/"){this.meshBaseUrl=this.meshBaseUrl+"/"}}b.getMaterial=function(e){var g;var f;var d;if(e!==undefined){if(e.texture_filename!==""){g=a+e.texture_filename.substr(10);f=new THREE.ImageUtils.loadTexture(g);d=new THREE.MeshBasicMaterial({map:f})}else{var c=e.name.toLowerCase();d=new THREE.MeshBasicMaterial({color:THREE.ColorKeywords[c]})}}else{d=new THREE.MeshBasicMaterial()}return d};b.load=function(f,g){var k=new THREE.Object3D();if(a==undefined){console.log("test");THREE.Mesh.call(this,new THREE.CubeGeometry(0.01,0.01,0.01),new THREE.MeshBasicMaterial())}else{var j;var d=a+f.substr(10);var e;var h;var c;if(d.substr(-4).toLowerCase()==".dae"){j=new ROS3D.ColladaLoader();j.load(d,function i(l){var m=l.scene;k.add(m)})}}return k}};ROS3D.OrbitControls=function(y,F){THREE.EventDispatcher.call(this);this.object=F;this.object.up=new THREE.Vector3(0,0,1);this.center=new THREE.Vector3();this.userZoom=true;this.userZoomSpeed=1;this.userRotate=true;this.userRotateSpeed=1;this.autoRotate=false;this.autoRotateSpeed=2;var d=this;var t=0.000001;var C=1800;var x=new THREE.Vector2();var g=new THREE.Vector2();var r=new THREE.Vector2();var w=new THREE.Vector2();var E=new THREE.Vector2();var o=new THREE.Vector2();var l=new THREE.Vector3();var p=new THREE.Vector3();var c=new THREE.Vector3();var b=new THREE.Vector3();var i=0;var A=0;var D=1;var s=new THREE.Vector3();var v={NONE:-1,ROTATE:0,ZOOM:1,MOVE:2};var h=v.NONE;function j(){return 2*Math.PI/60/60*d.autoRotateSpeed}function u(){return Math.pow(0.95,d.userZoomSpeed)}function B(I,G,J){var H=new THREE.Vector3();var K=new THREE.Vector3();H.subVectors(G,I.origin);dot=I.direction.dot(J);if(Math.abs(dot)<I.precision){return null}scalar=J.dot(H)/dot;K=I.direction.clone().multiplyScalar(scalar);return K}this.axes=new ROS3D.Axes({shaftRadius:0.025,headRadius:0.07,headLength:0.2});y.add(this.axes);this.axes.traverse(function(G){G.visible=false});this.showAxes=function(){d.axes.traverse(function(G){G.visible=true});if(this.hideTimeout){clearTimeout(this.hideTimeout)}d.hideTimeout=setTimeout(function(){d.axes.traverse(function(G){G.visible=false});d.hideTimeout=false},1000)};var z={type:"change"};function k(G){var H=G.domEvent;H.preventDefault();switch(H.button){case 0:h=v.ROTATE;x.set(H.clientX,H.clientY);break;case 1:h=v.MOVE;p=new THREE.Vector3(0,0,1);var I=new THREE.Matrix4().extractRotation(F.matrix);p.applyMatrix4(I);l=d.center.clone();c=d.object.position.clone();b=B(G.mouseRay,l,p);break;case 2:h=v.ZOOM;w.set(H.clientX,H.clientY);break}this.showAxes()}function q(G){var H=G.domEvent;if(h===v.ROTATE){g.set(H.clientX,H.clientY);r.subVectors(g,x);d.rotateLeft(2*Math.PI*r.x/C*d.userRotateSpeed);d.rotateUp(2*Math.PI*r.y/C*d.userRotateSpeed);x.copy(g);this.showAxes()}else{if(h===v.ZOOM){E.set(H.clientX,H.clientY);o.subVectors(E,w);if(o.y>0){d.zoomIn()}else{d.zoomOut()}w.copy(E);this.showAxes()}else{if(h===v.MOVE){var J=B(G.mouseRay,d.center,p);if(!J){return}var I=new THREE.Vector3().subVectors(b.clone(),J.clone());d.center.addVectors(l.clone(),I.clone());d.object.position.addVectors(c.clone(),I.clone());d.update();d.object.updateMatrixWorld();this.showAxes()}}}}function e(G){if(!d.userRotate){return}h=v.NONE}function m(G){if(!d.userZoom){return}var H=G.domEvent;if(typeof(H.wheelDelta)!=="undefined"){var I=H.wheelDelta}else{var I=-H.detail}if(I>0){d.zoomOut()}else{d.zoomIn()}this.showAxes()}function a(G){k(G);G.preventDefault()}function f(G){q(G);G.preventDefault()}this.rotateLeft=function(G){if(G===undefined){G=j()}A-=G};this.rotateRight=function(G){if(G===undefined){G=j()}A+=G};this.rotateUp=function(G){if(G===undefined){G=j()}i-=G};this.rotateDown=function(G){if(G===undefined){G=j()}i+=G};this.zoomIn=function(G){if(G===undefined){G=u()}D/=G};this.zoomOut=function(G){if(G===undefined){G=u()}D*=G};this.update=function(){var H=this.object.position;var K=H.clone().sub(this.center);var I=Math.atan2(K.y,K.x);var J=Math.atan2(Math.sqrt(K.y*K.y+K.x*K.x),K.z);if(this.autoRotate){this.rotateLeft(j())}I+=A;J+=i;J=Math.max(t,Math.min(Math.PI-t,J));var G=K.length();K.y=G*Math.sin(J)*Math.sin(I);K.z=G*Math.cos(J);K.x=G*Math.sin(J)*Math.cos(I);K.multiplyScalar(D);H.copy(this.center).add(K);this.object.lookAt(this.center);G=K.length();this.axes.position=this.center.clone();this.axes.scale.x=this.axes.scale.y=this.axes.scale.z=G*0.05;this.axes.updateMatrixWorld(true);A=0;i=0;D=1;if(s.distanceTo(this.object.position)>0){this.dispatchEvent(z);s.copy(this.object.position)}};this.addEventListener("mousedown",k);this.addEventListener("mouseup",e);this.addEventListener("mousemove",q);this.addEventListener("touchstart",a);this.addEventListener("touchmove",f);this.addEventListener("mousewheel",m);this.addEventListener("DOMMouseScroll",m)};ROS3D.SceneNode=function(a){var b=this;THREE.Object3D.call(this);this.tfclient=a.tfclient;this.frame_id=a.frame_id;this.subscribeTf=function(c){b.tfclient.subscribe(c,b.tfUpdate)};this.setPoseFromServer=function(c){b.pose.copy(c);b.emitServerPoseUpdate()};this.tfUpdate=function(c){b.tfTransform.copy(c);console.log(c.translation.x===b.tfTransform.translation.x);b.emitServerPoseUpdate()};this.emitServerPoseUpdate=function(){var c=new ROSLIB.Pose(b.pose.position,b.pose.orientation);b.tfTransform.apply(c);b.position.x=c.position.x;b.position.y=c.position.y;b.position.z=c.position.z;b.useQuaternion=true;b.quaternion=new THREE.Quaternion(c.orientation.x,c.orientation.y,c.orientation.z,c.orientation.w);b.updateMatrixWorld(true)};b.add(a.model);b.tfTransform=new ROSLIB.Transform();b.pose=new ROSLIB.Pose();b.setPoseFromServer(a.pose);b.subscribeTf(b.frame_id)};ROS3D.SceneNode.prototype=Object.create(THREE.Object3D.prototype);ROS3D.UrdfLoader=function(b){var a=this;var b=b||{};this.ros=b.ros;this.xmlParam=b.xmlParam||"robot_description";this.objectRoot=b.objectRoot||new THREE.Object3D();this.urdfModel=new ROS3D.UrdfModel();this.meshLoader=new ROS3D.MeshLoader("resources/");this.tfClient=b.tfClient;var c=new ROSLIB.Param({ros:this.ros,name:this.xmlParam});c.get(function(h){if(a.urdfModel.initString(h)){var k=a.urdfModel.links;for(var f in k){var j=k[f];if(j.visual&&j.visual.geometry){if(j.visual.geometry.type===ROS3D.URDF_MESH){var m=new String("/"+j.name);var d=j.visual.geometry.filename;var o=d.substr(-4).toLowerCase();if(o===".dae"){var i=a.urdfModel.materials[j.visual.materialName];var g=a.meshLoader.load(d,i);var e=new ROS3D.SceneNode({frame_id:m,tfclient:a.tfClient,pose:j.visual.origin,model:g});a.objectRoot.add(e)}}}}a.emit("ready")}});this.getObjectRoot=function(){return a.objectRoot}};ROS3D.UrdfLoader.prototype.__proto__=EventEmitter2.prototype;ROS3D.Viewer=function(d){var g=this;d=d||{};this.divID=d.divID;this.width=d.width;this.height=d.height;this.disableGrid=d.disableGrid;this.gridColor=d.gridColor||"#cccccc";this.background=d.background||"#111111";this.antialias=d.antialias;this.renderer=new THREE.WebGLRenderer({antialias:this.antialias});this.renderer.setClearColorHex(this.background.replace("#","0x"),1);this.renderer.sortObjects=false;this.renderer.setSize(this.width,this.height);this.renderer.shadowMapEnabled=false;this.renderer.autoClear=false;this.scene=new THREE.Scene();this.camera=new THREE.PerspectiveCamera(40,this.width/this.height,0.01,1000);this.camera.position.x=3;this.camera.position.y=3;this.camera.position.z=3;this.cameraControls=new ROS3D.OrbitControls(this.scene,this.camera);this.cameraControls.userZoomSpeed=0.5;if(!this.disableGrid){var b=new THREE.PlaneGeometry(50,50,50,50);var c=new THREE.MeshBasicMaterial({color:this.gridColor,wireframe:true,wireframeLinewidth:1,transparent:true});var f=new THREE.Mesh(b,c);this.scene.add(f)}this.scene.add(new THREE.AmbientLight(5592405));this.directionalLight=new THREE.DirectionalLight(16777215);this.scene.add(this.directionalLight);this.selectableObjs=new THREE.Object3D;this.scene.add(this.selectableObjs);var e=new ROS3D.MouseHandler(this.renderer,this.camera,this.selectableObjs,this.cameraControls);this.highlighter=new ROS3D.Highlighter(e);function a(){g.cameraControls.update();g.directionalLight.position=g.camera.localToWorld(new THREE.Vector3(-1,1,0));g.directionalLight.position.normalize();g.renderer.clear(true,true,true);g.renderer.render(g.scene,g.camera);g.highlighter.renderHighlight(g.renderer,g.scene,g.camera);requestAnimationFrame(a)}this.addObject=function(h){g.scene.add(h)};document.getElementById(this.divID).appendChild(this.renderer.domElement);a()};ROS3D.Highlighter=function(a){this.hoverObjs=[];this.onMouseOver=function(b){this.hoverObjs.push(b.currentTarget)};this.onMouseOut=function(b){this.hoverObjs.splice(this.hoverObjs.indexOf(b.currentTarget),1)};this.getWebglObjects=function(f,e,d){var b=f.__webglObjects;for(var h=0;h<e.length;h++){if(e[h]){for(var g=b.length-1;g>=0;g--){if(b[g].object===e[h]){d.push(b[g]);break}}this.getWebglObjects(f,e[h].children,d)}}};this.renderHighlight=function(d,e,b){var c=[];this.getWebglObjects(e,this.hoverObjs,c);e.overrideMaterial=new THREE.MeshBasicMaterial({fog:false,opacity:0.5,depthTest:true,depthWrite:false,polygonOffset:true,polygonOffsetUnits:-1,side:THREE.DoubleSide});var f=e.__webglObjects;e.__webglObjects=c;d.render(e,b);e.__webglObjects=f;e.overrideMaterial=null};a.addEventListener("mouseover",this.onMouseOver.bind(this));a.addEventListener("mouseout",this.onMouseOut.bind(this))};ROS3D.MouseHandler=function(c,a,b,e){THREE.EventDispatcher.call(this);this.camera=a;this.rootObj=b;this.renderer=c;this.fallbackTarget=e;this.lastTarget=e;this.dragging=false;this.projector=new THREE.Projector();var d=["contextmenu","click","dblclick","mouseout","mousedown","mouseup","mousemove","mousewheel","DOMMouseScroll","touchstart","touchend","touchcancel","touchleave","touchmove"];this.listeners={};this.processDomEvent=function(o){o.preventDefault();var p=o.target;var r=p.getBoundingClientRect();var k=o.clientX-r.left-p.clientLeft+p.scrollLeft;var q=o.clientY-r.top-p.clientTop+p.scrollTop;var h=k/p.clientWidth*2-1;var f=-q/p.clientHeight*2+1;var j=new THREE.Vector3(h,f,0.5);this.projector.unprojectVector(j,this.camera);var m=new THREE.Raycaster(this.camera.position.clone(),j.sub(this.camera.position).normalize());var s=m.ray;var g={mousePos:new THREE.Vector2(h,f),mouseRay:s,domEvent:o,camera:this.camera,intersection:this.lastIntersection};if(o.type=="mouseout"){if(this.dragging){this.notify(this.lastTarget,"mouseup",g);this.dragging=false}this.notify(this.lastTarget,"mouseout",g);this.lastTarget=null;return}if(this.dragging){this.notify(this.lastTarget,o.type,g);if((o.type==="mouseup"&&o.button===2)||o.type==="click"){this.dragging=false}return}var p=this.lastTarget;var i=[];i=m.intersectObject(this.rootObj,true);if(i.length>0){p=i[0].object;g.intersection=this.lastIntersection=i[0]}else{p=this.fallbackTarget}if(p!==this.lastTarget){var l=this.notify(p,"mouseover",g);if(l){this.notify(this.lastTarget,"mouseout",g)}else{p=this.fallbackTarget;if(p!==this.lastTarget){this.notify(p,"mouseover",g);this.notify(this.lastTarget,"mouseout",g)}}}this.notify(p,o.type,g);if(o.type==="mousedown"){this.dragging=true}this.lastTarget=p};this.notify=function(h,g,f){f.type=g;f.cancelBubble=false;f.stopPropagation=function(){f.cancelBubble=true};f.currentTarget=h;while(f.currentTarget){if(f.currentTarget.dispatchEvent&&f.currentTarget.dispatchEvent instanceof Function){f.currentTarget.dispatchEvent(f);if(f.cancelBubble){this.dispatchEvent(f);return true}}f.currentTarget=f.currentTarget.parent}return false};this.destroy=function(){this.listeners.forEach(function(f){this.renderer.domElement.removeEventListener(eventName,f,false)},this)};d.forEach(function(f){this.listeners[f]=this.processDomEvent.bind(this);this.renderer.domElement.addEventListener(f,this.listeners[f],false)},this)};